(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,199083,e=>{"use strict";var t=e.i(216940);e.s(["StatusMessage",()=>t.default])},948168,e=>{"use strict";var t=e.i(524420);e.s(["EmptyState",()=>t.default])},21218,e=>{"use strict";let t=(0,e.i(475254).default)("activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);e.s(["Activity",()=>t],21218)},641041,e=>{"use strict";var t=e.i(765586);e.s(["BulkActionsToolbar",()=>t.default])},366612,e=>{"use strict";var t=e.i(843476),a=e.i(271645),s=e.i(618566),r=e.i(87316),i=e.i(21218),l=e.i(25652);let n=(0,e.i(475254).default)("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]]);var d=e.i(239616),c=e.i(217923),o=e.i(871689),x=e.i(16715),g=e.i(440160);e.i(633999);var h=e.i(269111),m=e.i(199083),y=e.i(739122),p=e.i(948168),u=e.i(496640),u=u;e.i(137996);var f=e.i(233061),f=f,w=e.i(641041);function b(){let e=(0,s.useRouter)(),[b,j]=(0,a.useState)([]),[k,N]=(0,a.useState)(!0),[v,S]=(0,a.useState)(""),[C,_]=(0,a.useState)(""),[T,A]=(0,a.useState)(""),[L,D]=(0,a.useState)("all"),[E,M]=(0,a.useState)("all"),[F,B]=(0,a.useState)("all"),[z,R]=(0,a.useState)("all"),[$,O]=(0,a.useState)(new Set),[U,G]=(0,a.useState)(!1),[I,W]=(0,a.useState)(!1),[K,P]=(0,a.useState)(!1),q=(e,a)=>{if(!a.trim())return e;let s=RegExp(`(${a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi"),r=e.split(s);return(0,t.jsx)(t.Fragment,{children:r.map((e,a)=>s.test(e)?(0,t.jsx)("span",{className:"bg-yellow-200 dark:bg-yellow-800 px-0.5 rounded font-semibold",children:e},a):e)})},H=async()=>{try{N(!0);let t=localStorage.getItem("authToken");if(!t)return void e.push("/login");let a=await fetch("/api/user/machine/all-statistics",{headers:{Authorization:`Bearer ${t}`}}),s=await a.json();s.success?j(s.data.statistics||[]):S(s.message||"Failed to fetch statistics")}catch(e){console.error("Error fetching statistics:",e),S("Failed to fetch machine statistics")}finally{N(!1)}};(0,a.useEffect)(()=>{H()},[]),(0,a.useEffect)(()=>{let e=e=>{A(e.detail?.query||"")};return window.addEventListener("globalSearch",e),()=>{window.removeEventListener("globalSearch",e)}},[]);let J=(0,a.useMemo)(()=>Array.from(new Set(b.map(e=>e.society_name))).sort(),[b]),Q=(0,a.useMemo)(()=>Array.from(new Set(b.map(e=>e.machine_type))).sort(),[b]),V=(0,a.useMemo)(()=>Array.from(new Set(b.map(e=>e.statistics_date))).sort().reverse(),[b]),X=(0,a.useMemo)(()=>b.filter(e=>{let t=""===T||e.machine_identifier.toLowerCase().includes(T.toLowerCase())||e.operator_name?.toLowerCase().includes(T.toLowerCase())||e.society_name.toLowerCase().includes(T.toLowerCase())||e.society_identifier.toLowerCase().includes(T.toLowerCase())||e.stats_machine_type.toLowerCase().includes(T.toLowerCase()),a="all"===L||e.society_name===L,s="all"===E||e.machine_type===E,r="all"===F||e.statistics_date===F,i="all"===z||e.auto_channel===z;return t&&a&&s&&r&&i}),[b,T,L,E,F,z]),Y=(0,a.useMemo)(()=>{if(0===X.length)return{totalTests:0,avgDailyCleaning:0,avgWeeklyCleaning:0,totalSkips:0,avgGain:0,enabledMachines:0};let e=X.reduce((e,t)=>e+t.total_test,0),t=X.reduce((e,t)=>e+t.daily_cleaning,0),a=X.reduce((e,t)=>e+t.weekly_cleaning,0),s=X.reduce((e,t)=>e+t.cleaning_skip,0),r=X.reduce((e,t)=>e+t.gain,0),i=X.filter(e=>"ENABLE"===e.auto_channel).length;return{totalTests:e,avgDailyCleaning:Math.round(t/X.length),avgWeeklyCleaning:Math.round(a/X.length),totalSkips:s,avgGain:Math.round(r/X.length),enabledMachines:i}},[X]);(0,a.useEffect)(()=>{if(0===X.length)U&&G(!1),$.size>0&&O(new Set);else{let e=X.every(e=>$.has(e.id))&&X.length>0;U!==e&&G(e)}},[X]);let Z=async()=>{if(0!==$.size){W(!0),P(!1);try{let t=localStorage.getItem("authToken");if(!t)return void e.push("/login");let a=await fetch("/api/user/machine/statistics/delete",{method:"DELETE",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({statisticIds:Array.from($)})}),s=await a.json();s.success?(_(s.message||`Deleted ${$.size} statistics successfully`),O(new Set),G(!1),await H()):S(s.message||"Failed to delete statistics")}catch(e){console.error("Error deleting statistics:",e),S("Failed to delete statistics")}finally{W(!1),setTimeout(()=>{_(""),S("")},3e3)}}};return(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 lg:pb-8",children:[(0,t.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,t.jsx)("div",{className:"px-4 sm:px-6 py-3 sm:py-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("button",{onClick:()=>e.back(),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center",children:(0,t.jsx)(o.ArrowLeft,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),(0,t.jsxs)("div",{className:"flex items-center gap-2 sm:gap-3 flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"p-2 sm:p-3 bg-gradient-to-r from-green-600 to-emerald-600 rounded-lg sm:rounded-xl flex-shrink-0",children:(0,t.jsx)(i.Activity,{className:"w-5 h-5 sm:w-6 sm:h-6 text-white"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("h1",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Machine Statistics"}),(0,t.jsx)("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400 truncate",children:"Combined operational data from all machines"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 sm:gap-3",children:[(0,t.jsxs)("button",{onClick:H,className:"flex items-center justify-center px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors shadow-sm",children:[(0,t.jsx)(x.RefreshCw,{className:"w-4 h-4 mr-2"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Refresh"})]}),(0,t.jsxs)("button",{onClick:()=>{if(0===X.length){S("No data to download"),setTimeout(()=>S(""),3e3);return}let e=new Blob([["Machine ID,Operator Name,Society,Society ID,Machine Type,Total Tests,Daily Cleaning,Weekly Cleaning,Cleaning Skips,Gain,Auto Channel,Date,Time,Created At",...X.map(e=>[e.machine_identifier,e.operator_name||"",e.society_name,e.society_identifier,e.stats_machine_type,e.total_test,e.daily_cleaning,e.weekly_cleaning,e.cleaning_skip,e.gain,e.auto_channel,e.statistics_date,e.statistics_time,new Date(e.created_at).toLocaleString()]).map(e=>e.map(e=>`"${e}"`).join(","))].join("\n")],{type:"text/csv"}),t=window.URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download=`machine-statistics-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(t),_("Statistics downloaded successfully"),setTimeout(()=>_(""),3e3)},disabled:0===X.length,className:"flex items-center justify-center px-4 sm:px-6 py-2.5 text-sm bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg hover:from-green-700 hover:to-emerald-700 transition-all duration-200 shadow-lg shadow-green-500/25 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:from-green-600 disabled:hover:to-emerald-600",children:[(0,t.jsx)(g.Download,{className:"w-4 h-4 mr-2"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Download"})]})]})]})})}),(0,t.jsx)("div",{className:"p-4 sm:p-6 lg:p-8 space-y-4 sm:space-y-6",children:(0,t.jsxs)("div",{className:"max-w-[1920px] mx-auto space-y-6",children:[(0,t.jsx)(m.StatusMessage,{success:C,error:v}),!k&&X.length>0&&(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[(0,t.jsx)(y.StatsCard,{title:"Total Tests",value:Y.totalTests.toLocaleString(),icon:(0,t.jsx)(l.TrendingUp,{className:"w-4 h-4"}),color:"blue"}),(0,t.jsx)(y.StatsCard,{title:"Daily Clean",value:Y.avgDailyCleaning.toString(),icon:(0,t.jsx)(i.Activity,{className:"w-4 h-4"}),color:"green"}),(0,t.jsx)(y.StatsCard,{title:"Weekly Clean",value:Y.avgWeeklyCleaning.toString(),icon:(0,t.jsx)(i.Activity,{className:"w-4 h-4"}),color:"blue"}),(0,t.jsx)(y.StatsCard,{title:"Total Skips",value:Y.totalSkips.toString(),icon:(0,t.jsx)(n,{className:"w-4 h-4"}),color:"yellow"}),(0,t.jsx)(y.StatsCard,{title:"Avg Gain",value:Y.avgGain.toString(),icon:(0,t.jsx)(l.TrendingUp,{className:"w-4 h-4"}),color:"blue"}),(0,t.jsx)(y.StatsCard,{title:"Enabled",value:`${Y.enabledMachines}/${X.length}`,icon:(0,t.jsx)(d.Settings,{className:"w-4 h-4"}),color:"green"})]}),(0,t.jsx)(f.default,{societyFilter:L,onSocietyChange:D,machineTypeFilter:E,onMachineTypeChange:M,dateFilter:F,onDateChange:B,autoChannelFilter:z,onAutoChannelChange:R,societies:J,machineTypes:Q,dates:V,filteredCount:X.length,totalCount:b.length,searchQuery:T,onSearchChange:A,icon:(0,t.jsx)(c.BarChart3,{className:"w-5 h-5"})}),k?(0,t.jsx)("div",{className:"flex justify-center items-center py-20",children:(0,t.jsx)(h.FlowerSpinner,{})}):0===X.length?(0,t.jsx)(p.EmptyState,{icon:(0,t.jsx)(i.Activity,{className:"w-12 h-12"}),title:"No Statistics Found",message:"all"!==L||"all"!==E||"all"!==F||"all"!==z||""!==T?"Try adjusting your filters":"No machine statistics available yet"}):(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:[(0,t.jsx)("div",{children:(0,t.jsxs)("table",{className:"w-full table-fixed",children:[(0,t.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-3 py-3 text-center w-[5%]",children:(0,t.jsx)("input",{type:"checkbox",checked:U,onChange:()=>{U?(O(new Set),G(!1)):(O(new Set(X.map(e=>e.id))),G(!0))},className:"w-4 h-4 text-green-600 bg-gray-100 border-gray-300 rounded focus:ring-green-500 dark:focus:ring-green-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"})}),(0,t.jsx)("th",{className:"px-2 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider w-[10%]",children:"Machine"}),(0,t.jsx)("th",{className:"px-2 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider w-[10%]",children:"Society"}),(0,t.jsx)("th",{className:"px-2 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider w-[9%]",children:"Type"}),(0,t.jsx)("th",{className:"px-2 py-3 text-right text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider w-[7%]",children:"Tests"}),(0,t.jsx)("th",{className:"px-2 py-3 text-right text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider w-[6%]",children:"Daily"}),(0,t.jsx)("th",{className:"px-2 py-3 text-right text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider w-[6%]",children:"Weekly"}),(0,t.jsx)("th",{className:"px-2 py-3 text-right text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider w-[6%]",children:"Skips"}),(0,t.jsx)("th",{className:"px-2 py-3 text-right text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider w-[6%]",children:"Gain"}),(0,t.jsx)("th",{className:"px-2 py-3 text-center text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider w-[6%]",children:"Auto"}),(0,t.jsx)("th",{className:"px-2 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider w-[12%]",children:"Date"}),(0,t.jsx)("th",{className:"px-2 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider w-[12%]",children:"Time"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:X.map(e=>(0,t.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[(0,t.jsx)("td",{className:"px-3 py-3 text-center",children:(0,t.jsx)("input",{type:"checkbox",checked:$.has(e.id),onChange:()=>{var t;let a;return t=e.id,void((a=new Set($)).has(t)?a.delete(t):a.add(t),O(a))},className:"w-4 h-4 text-green-600 bg-gray-100 border-gray-300 rounded focus:ring-green-500 dark:focus:ring-green-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"})}),(0,t.jsx)("td",{className:"px-2 py-3",children:(0,t.jsxs)("div",{className:"flex flex-col min-w-0",children:[(0,t.jsx)("span",{className:"text-xs font-medium text-gray-900 dark:text-gray-100 break-words",children:q(e.machine_identifier,T)}),e.operator_name&&(0,t.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 break-words",children:q(e.operator_name,T)})]})}),(0,t.jsx)("td",{className:"px-2 py-3",children:(0,t.jsxs)("div",{className:"flex flex-col min-w-0",children:[(0,t.jsx)("span",{className:"text-xs text-gray-900 dark:text-gray-100 break-words",children:q(e.society_name,T)}),(0,t.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 break-words",children:q(e.society_identifier,T)})]})}),(0,t.jsx)("td",{className:"px-2 py-3 text-xs text-gray-700 dark:text-gray-300",children:q(e.stats_machine_type,T)}),(0,t.jsx)("td",{className:"px-2 py-3 text-right",children:(0,t.jsx)(u.default,{variant:"blue",children:e.total_test.toLocaleString()})}),(0,t.jsx)("td",{className:"px-2 py-3 text-right",children:(0,t.jsx)(u.default,{variant:"green",children:e.daily_cleaning})}),(0,t.jsx)("td",{className:"px-2 py-3 text-right",children:(0,t.jsx)(u.default,{variant:"purple",children:e.weekly_cleaning})}),(0,t.jsx)("td",{className:"px-2 py-3 text-right",children:(0,t.jsx)(u.default,{variant:e.cleaning_skip>0?"orange":"gray",children:e.cleaning_skip})}),(0,t.jsx)("td",{className:"px-2 py-3 text-right",children:(0,t.jsx)(u.default,{variant:"indigo",children:e.gain})}),(0,t.jsx)("td",{className:"px-2 py-3 text-center",children:(0,t.jsx)(u.default,{variant:"ENABLE"===e.auto_channel?"emerald":"red",children:"ENABLE"===e.auto_channel?"ON":"OFF"})}),(0,t.jsx)("td",{className:"px-2 py-3",children:(0,t.jsxs)("span",{className:"flex items-center gap-1 text-xs text-gray-600 dark:text-gray-400",children:[(0,t.jsx)(r.Calendar,{className:"w-3 h-3 flex-shrink-0"}),(0,t.jsx)("span",{className:"whitespace-nowrap",children:e.statistics_date})]})}),(0,t.jsx)("td",{className:"px-2 py-3 text-xs text-gray-600 dark:text-gray-400 whitespace-nowrap",children:e.statistics_time})]},e.id))})]})}),(0,t.jsx)("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-700 border-t border-gray-200 dark:border-gray-600",children:(0,t.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Showing ",(0,t.jsx)("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:X.length})," ","of"," ",(0,t.jsx)("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:b.length})," ","statistics records"]})})]}),(0,t.jsx)(w.BulkActionsToolbar,{selectedCount:$.size,totalCount:b.length,onBulkDelete:()=>P(!0),onClearSelection:()=>{O(new Set),G(!1)},itemType:"statistic",showStatusUpdate:!1}),K&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-md w-full p-6",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Delete Statistics"}),(0,t.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-6",children:["Are you sure you want to delete ",$.size," statistic",1!==$.size?"s":"","? This action cannot be undone."]}),(0,t.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,t.jsx)("button",{onClick:()=>P(!1),disabled:I,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),(0,t.jsx)("button",{onClick:Z,disabled:I,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 dark:bg-red-500 rounded-lg hover:bg-red-700 dark:hover:bg-red-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:I?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h.FlowerSpinner,{size:16}),"Deleting..."]}):"Delete"})]})]})})]})})]})}e.s(["default",()=>b],366612)}]);