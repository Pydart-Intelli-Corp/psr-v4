(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,834161,e=>{"use strict";let a=(0,e.i(475254).default)("key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);e.s(["Key",()=>a],834161)},683736,e=>{"use strict";var a=e.i(843476),s=e.i(271645),t=e.i(846932),r=e.i(833277);e.i(633999);var l=e.i(269111),i=e.i(284614),n=e.i(263488),o=e.i(343432),c=e.i(346897),d=e.i(607486),m=e.i(87316),x=e.i(834161),h=e.i(98919),p=e.i(356909),g=e.i(283627),y=e.i(871689);function N(){let{user:e}=(0,r.useUser)(),[N,f]=(0,s.useState)(null),[u,j]=(0,s.useState)(!0),[b,v]=(0,s.useState)(!1),[w,k]=(0,s.useState)(!1),[C,S]=(0,s.useState)({firstName:"",lastName:"",companyName:"",companyAddress:"",companyPhone:""}),P=async()=>{let e=localStorage.getItem("authToken");if(!e){console.log("No auth token found, redirecting to login"),window.location.href="/login";return}try{console.log("ðŸ”„ Fetching user profile...");let a=await fetch("/api/user/profile",{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!a.ok){if(401===a.status||403===a.status){console.log("Authentication failed, redirecting to login"),localStorage.removeItem("authToken"),localStorage.removeItem("userData"),window.location.href="/login";return}throw Error(`Profile API failed: ${a.status}`)}let s=await a.json();if(console.log("âœ… User profile fetched:",s),s.success&&s.data){let e="string"==typeof s.data?JSON.parse(s.data):s.data;if("admin"===e.role){let a={id:e.id,fullName:e.fullName||`${e.firstName||""} ${e.lastName||""}`.trim(),firstName:e.firstName||e.fullName?.split(" ")[0]||"",lastName:e.lastName||e.fullName?.split(" ").slice(1).join(" ")||"",email:e.email,role:e.role,status:e.status,companyName:e.companyName,phone:e.companyPhone||e.phone,address:e.companyAddress||e.address,dbKey:e.dbKey,joinedDate:e.created_at||e.createdAt||new Date().toISOString()};f(a),S({firstName:a.firstName,lastName:a.lastName,companyName:a.companyName||"",companyAddress:a.address||"",companyPhone:a.phone||""}),console.log("Admin profile loaded:",a.fullName)}else console.log("User is not admin, redirecting to login"),window.location.href="/login"}else console.log("Invalid response format, redirecting to login"),window.location.href="/login"}catch(e){console.error("âŒ Error fetching user profile:",e),window.location.href="/login"}finally{j(!1)}},A=async()=>{let e=localStorage.getItem("authToken");if(e)try{v(!0),console.log("ðŸ’¾ Updating profile...",C);let a=await fetch("/api/user/profile",{method:"PUT",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(C)});if(!a.ok)throw Error(`Update failed: ${a.status}`);let s=await a.json();if(console.log("âœ… Profile updated:",s),s.success)await P(),k(!1),alert("Profile updated successfully!");else throw Error("Update failed")}catch(e){console.error("âŒ Error updating profile:",e),alert("Failed to update profile. Please try again.")}finally{v(!1)}};(0,s.useEffect)(()=>{P()},[]);let U=(e,a)=>{S(s=>({...s,[e]:a}))};return e?u?(0,a.jsxs)("div",{className:"flex items-center justify-center min-h-[400px]",children:[(0,a.jsx)(l.FlowerSpinner,{size:32}),(0,a.jsx)("span",{className:"ml-4 text-gray-600 dark:text-gray-400",children:"Loading profile..."})]}):N?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("button",{onClick:()=>window.history.back(),className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",children:(0,a.jsx)(y.ArrowLeft,{className:"w-5 h-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Admin Profile"}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:"Manage your account information"})]})]}),(0,a.jsx)("div",{className:"flex items-center space-x-3",children:w?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>{k(!1),S({firstName:N.firstName,lastName:N.lastName,companyName:N.companyName||"",companyAddress:N.address||"",companyPhone:N.phone||""})},className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,a.jsxs)("button",{onClick:A,disabled:b,className:"flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 transition-colors",children:[b?(0,a.jsx)(l.FlowerSpinner,{size:16,className:"mr-2"}):(0,a.jsx)(p.Save,{className:"w-4 h-4 mr-2"}),b?"Saving...":"Save Changes"]})]}):(0,a.jsxs)("button",{onClick:()=>k(!0),className:"flex items-center px-4 py-2 text-green-600 border border-green-600 rounded-lg hover:bg-green-50 transition-colors",children:[(0,a.jsx)(g.Edit3,{className:"w-4 h-4 mr-2"}),"Edit Profile"]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsx)(t.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"lg:col-span-1",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-20 h-20 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsxs)("span",{className:"text-2xl font-bold text-white",children:[N.firstName.charAt(0).toUpperCase(),N.lastName.charAt(0).toUpperCase()]})}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:N.fullName}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:N.email}),(0,a.jsxs)("div",{className:"flex items-center justify-center mt-2",children:[(0,a.jsx)(h.Shield,{className:"w-4 h-4 text-purple-600 mr-1"}),(0,a.jsx)("span",{className:"text-purple-600 font-medium capitalize",children:N.role})]})]}),(0,a.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,a.jsx)(m.Calendar,{className:"w-4 h-4 mr-2"}),"Joined ",new Date(N.joinedDate).toLocaleDateString()]}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,a.jsx)(x.Key,{className:"w-4 h-4 mr-2"}),"DB Key: ",N.dbKey||"Not assigned"]}),(0,a.jsxs)("div",{className:"flex items-center text-sm",children:[(0,a.jsx)("div",{className:`w-2 h-2 rounded-full mr-2 ${"active"===N.status?"bg-green-500":"bg-yellow-500"}`}),(0,a.jsx)("span",{className:`capitalize font-medium ${"active"===N.status?"text-green-600":"text-yellow-600"}`,children:N.status})]})]})]})}),(0,a.jsx)(t.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"lg:col-span-2",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,a.jsx)("h4",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Profile Information"}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h5",{className:"text-md font-medium text-gray-700 mb-4 flex items-center",children:[(0,a.jsx)(i.User,{className:"w-4 h-4 mr-2"}),"Personal Information"]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name"}),w?(0,a.jsx)("input",{type:"text",value:C.firstName,onChange:e=>U("firstName",e.target.value),className:"psr-input"}):(0,a.jsx)("p",{className:"text-gray-900 py-2",children:N.firstName})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name"}),w?(0,a.jsx)("input",{type:"text",value:C.lastName,onChange:e=>U("lastName",e.target.value),className:"psr-input"}):(0,a.jsx)("p",{className:"text-gray-900 py-2",children:N.lastName})]})]}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(n.Mail,{className:"w-4 h-4 text-gray-400 mr-2"}),(0,a.jsx)("p",{className:"text-gray-900",children:N.email}),(0,a.jsx)("span",{className:"ml-2 text-xs text-gray-500",children:"(Cannot be changed)"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h5",{className:"text-md font-medium text-gray-700 mb-4 flex items-center",children:[(0,a.jsx)(d.Building2,{className:"w-4 h-4 mr-2"}),"Company Information"]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Company Name"}),w?(0,a.jsx)("input",{type:"text",value:C.companyName,onChange:e=>U("companyName",e.target.value),className:"psr-input",placeholder:"Enter your company name"}):(0,a.jsx)("p",{className:"text-gray-900 py-2",children:N.companyName||"Not provided"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),w?(0,a.jsx)("input",{type:"tel",value:C.companyPhone,onChange:e=>U("companyPhone",e.target.value),className:"psr-input",placeholder:"Enter phone number"}):(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(o.Phone,{className:"w-4 h-4 text-gray-400 mr-2"}),(0,a.jsx)("p",{className:"text-gray-900",children:N.phone||"Not provided"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address"}),w?(0,a.jsx)("textarea",{value:C.companyAddress,onChange:e=>U("companyAddress",e.target.value),rows:3,className:"psr-textarea",placeholder:"Enter company address"}):(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)(c.MapPin,{className:"w-4 h-4 text-gray-400 mr-2 mt-1 flex-shrink-0"}),(0,a.jsx)("p",{className:"text-gray-900",children:N.address||"Not provided"})]})]})]})]})]})]})})]})]}):(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"Unable to load profile"}),(0,a.jsx)("button",{onClick:()=>window.location.href="/admin/dashboard",className:"mt-4 text-green-600 hover:text-green-700 dark:text-green-400 dark:hover:text-green-300",children:"Return to Dashboard"})]})}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:(0,a.jsx)(l.FlowerSpinner,{})})}e.s(["default",()=>N])}]);