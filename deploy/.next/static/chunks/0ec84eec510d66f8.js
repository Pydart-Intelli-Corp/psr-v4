(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,154041,e=>{"use strict";var t=e.i(561219);e.s(["FormGrid",()=>t.default])},545292,e=>{"use strict";var t=e.i(785187);e.s(["FormInput",()=>t.default])},199083,e=>{"use strict";var t=e.i(216940);e.s(["StatusMessage",()=>t.default])},948168,e=>{"use strict";var t=e.i(524420);e.s(["EmptyState",()=>t.default])},506296,e=>{"use strict";var t=e.i(197238);e.s(["FormSelect",()=>t.default])},931194,e=>{"use strict";function t(e){if(!e||""===e.trim())return{isValid:!1,error:"Phone number is required"};let t=e.replace(/\D/g,"");return 10!==t.length?{isValid:!1,error:"Phone number must be exactly 10 digits"}:/^[6-9]/.test(t)?{isValid:!0,formatted:t}:{isValid:!1,error:"Phone number must start with 6, 7, 8, or 9"}}function a(e){return e.replace(/\D/g,"").slice(0,10)}function r(e){return e&&""!==e.trim()&&t(e).error||""}e.s(["formatPhoneInput",()=>a,"validateIndianPhone",()=>t,"validatePhoneOnBlur",()=>r])},504767,e=>{"use strict";var t=e.i(42649);e.s(["FormActions",()=>t.default])},939544,e=>{"use strict";let t=(0,e.i(475254).default)("droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]);e.s(["Droplets",()=>t],939544)},935281,688462,e=>{"use strict";var t=e.i(379358);e.s(["PageHeader",()=>t.default],935281);var a=e.i(231788);e.s(["FilterControls",()=>a.default],688462)},892892,e=>{"use strict";var t=e.i(843476),a=e.i(846932),r=e.i(88653);let s=(0,e.i(475254).default)("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);function l({isOpen:e,onClose:l,onConfirm:i,title:n,message:d,confirmText:o="Continue",cancelText:c="Cancel"}){return e?(0,t.jsx)(r.AnimatePresence,{children:e&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:l,children:(0,t.jsxs)(a.motion.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{type:"spring",damping:25,stiffness:300},onClick:e=>e.stopPropagation(),className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-md w-full p-6",children:[(0,t.jsx)("div",{className:"flex justify-center mb-4",children:(0,t.jsx)("div",{className:"w-12 h-12 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center",children:(0,t.jsx)(s,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})})}),(0,t.jsxs)("div",{className:"text-center mb-6",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:n}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:d})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,t.jsx)("button",{onClick:l,className:"px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:c}),(0,t.jsx)("button",{onClick:i,className:"px-4 py-2 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:o})]})]})})}):null}e.s(["default",()=>l],892892)},581418,e=>{"use strict";let t=(0,e.i(475254).default)("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["ShieldCheck",()=>t],581418)},514764,e=>{"use strict";let t=(0,e.i(475254).default)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);e.s(["Send",()=>t],514764)},952733,e=>{"use strict";let t={"gmial.com":"gmail.com","gmai.com":"gmail.com","gmail.co":"gmail.com","yahooo.com":"yahoo.com","yaho.com":"yahoo.com","hotmial.com":"hotmail.com","hotmai.com":"hotmail.com","outlok.com":"outlook.com","outloo.com":"outlook.com"};function a(e){if(!e||""===e.trim())return"Email is required";if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))return"Invalid email format";let a=t[e.toLowerCase().split("@")[1].toLowerCase()];if(a)return`Did you mean ${e.split("@")[0]}@${a}?`}e.s(["validateEmailQuick",()=>a])},145858,784623,e=>{"use strict";var t=e.i(843476),a=e.i(271645),r=e.i(37727),s=e.i(878894),l=e.i(727612),i=e.i(514764),n=e.i(581418);function d({isOpen:e,onClose:d,onConfirm:o,dairyName:c,loading:m=!1,bmcCount:x=0,societyCount:u=0,farmerCount:g=0,collectionCount:h=0,machineCount:y=0}){let[b,p]=(0,a.useState)("confirm"),[f,j]=(0,a.useState)(["","","","","",""]),[k,v]=(0,a.useState)(!1),[N,w]=(0,a.useState)(""),C=(0,a.useRef)([]),S=async()=>{try{v(!0),w("");let e=window.selectedDairyIdForDelete;if(!e)return void w("Dairy ID not found. Please try again.");let t=await fetch("/api/user/dairy/send-delete-otp",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({dairyId:e})}),a=await t.json();if(!t.ok)throw Error(a.error||"Failed to send OTP");p("otp"),setTimeout(()=>C.current[0]?.focus(),100)}catch(e){w(e instanceof Error?e.message:"Failed to send OTP")}finally{v(!1)}},T=e=>{e.preventDefault();let t=e.clipboardData.getData("text").slice(0,6);if(!/^\d+$/.test(t))return;let a=[...f];t.split("").forEach((e,t)=>{t<6&&(a[t]=e)}),j(a);let r=a.findIndex(e=>!e);-1!==r?C.current[r]?.focus():C.current[5]?.focus()},F=async()=>{let e=f.join("");if(6!==e.length)return void w("Please enter the complete 6-digit OTP");try{await o(e),M()}catch(e){w(e instanceof Error?e.message:"Invalid or expired OTP"),j(["","","","","",""]),C.current[0]?.focus()}},M=()=>{p("confirm"),j(["","","","","",""]),w(""),d()};return e?(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full overflow-hidden",children:[(0,t.jsxs)("div",{className:"bg-gradient-to-r from-red-500 to-red-600 px-6 py-4 flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-white/20 rounded-lg",children:(0,t.jsx)(l.Trash2,{className:"w-5 h-5 text-white"})}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-white",children:"confirm"===b?"Delete Dairy":"Verify OTP"})]}),(0,t.jsx)("button",{onClick:M,disabled:m||k,className:"text-white/80 hover:text-white transition-colors disabled:opacity-50",children:(0,t.jsx)(r.X,{className:"w-5 h-5"})})]}),(0,t.jsx)("div",{className:"p-6",children:"confirm"===b?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-4",children:(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)(s.AlertTriangle,{className:"w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium text-red-900 dark:text-red-100 mb-1",children:"Warning: This action cannot be undone"}),(0,t.jsx)("p",{className:"text-sm text-red-700 dark:text-red-300",children:"Deleting this dairy will permanently remove:"})]})]})}),(0,t.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,t.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Dairy Name"}),(0,t.jsx)("p",{className:"font-semibold text-gray-900 dark:text-gray-100",children:c})]}),(0,t.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"The following data will be deleted:"}),(0,t.jsxs)("ul",{className:"space-y-1 text-sm text-gray-700 dark:text-gray-300",children:[x>0&&(0,t.jsxs)("li",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full"}),x," BMC",x>1?"s":""]}),u>0&&(0,t.jsxs)("li",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full"}),u," societ",u>1?"ies":"y"]}),g>0&&(0,t.jsxs)("li",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full"}),g," farmer",g>1?"s":""," and their data"]}),h>0&&(0,t.jsxs)("li",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full"}),h," collection record",h>1?"s":""]}),y>0&&(0,t.jsxs)("li",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full"}),y," machine",y>1?"s":""," and settings"]}),0===x&&0===u&&0===g&&0===h&&0===y&&(0,t.jsxs)("li",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full"}),"The dairy details only"]})]})]})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("button",{onClick:M,disabled:m||k,className:"flex-1 px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50",children:"Cancel"}),(0,t.jsx)("button",{onClick:S,disabled:m||k,className:"flex-1 px-4 py-2.5 bg-gradient-to-r from-red-500 to-red-600 rounded-lg font-medium text-white hover:from-red-600 hover:to-red-700 transition-all disabled:opacity-50 flex items-center justify-center gap-2",children:k?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Sending OTP..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.Send,{className:"w-4 h-4"}),"Send OTP"]})})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-6",children:(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)(n.ShieldCheck,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium text-blue-900 dark:text-blue-100 mb-1",children:"OTP Sent to Your Email"}),(0,t.jsx)("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:"Please enter the 6-digit OTP to confirm deletion. The code will expire in 10 minutes."})]})]})}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Enter OTP Code"}),(0,t.jsx)("div",{className:"flex gap-2 justify-center",children:f.map((e,a)=>(0,t.jsx)("input",{ref:e=>{C.current[a]=e},type:"text",inputMode:"numeric",maxLength:1,value:e,onChange:e=>((e,t)=>{if(t.length>1&&(t=t[0]),!/^\d*$/.test(t))return;let a=[...f];a[e]=t,j(a),t&&e<5&&C.current[e+1]?.focus()})(a,e.target.value),onKeyDown:e=>{"Backspace"===e.key&&!f[a]&&a>0&&C.current[a-1]?.focus()},onPaste:0===a?T:void 0,className:"w-12 h-14 text-center text-xl font-bold border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:border-red-500 focus:ring-2 focus:ring-red-500/20 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",disabled:m},a))}),N&&(0,t.jsx)("p",{className:"text-sm text-red-600 dark:text-red-400 mt-2 text-center",children:N})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("button",{onClick:()=>{p("confirm"),j(["","","","","",""]),w("")},disabled:m,className:"flex-1 px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50",children:"Back"}),(0,t.jsx)("button",{onClick:F,disabled:m||f.some(e=>!e),className:"flex-1 px-4 py-2.5 bg-gradient-to-r from-red-500 to-red-600 rounded-lg font-medium text-white hover:from-red-600 hover:to-red-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:m?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Deleting..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Trash2,{className:"w-4 h-4"}),"Delete Dairy"]})})]})]})})]})}):null}e.s(["default",()=>d],145858);var o=e.i(607486),c=e.i(263488);function m({isOpen:e,onClose:l,onConfirm:i,bmcs:n,dairies:d,dairyName:m,currentDairyId:x,adminEmail:u=""}){let[g,h]=(0,a.useState)(null),[y,b]=(0,a.useState)(!1),[p,f]=(0,a.useState)(["","","","","",""]),[j,k]=(0,a.useState)(!1),[v,N]=(0,a.useState)(""),[w,C]=(0,a.useState)(!1),[S,T]=(0,a.useState)(!1),F=(0,a.useRef)([]),M=d.filter(e=>e.id!==x);(0,a.useEffect)(()=>{e||(h(null),b(!1),f(["","","","","",""]),k(!1),N(""),C(!1),T(!1))},[e]),(0,a.useEffect)(()=>{w&&F.current[0]&&F.current[0]?.focus()},[w]);let D=async()=>{T(!0),N("");try{let e=localStorage.getItem("authToken"),t=await fetch("/api/user/dairy/send-delete-otp",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({dairyId:x})}),a=await t.json();a.success?(k(!0),C(!0),N("")):N(a.message||"Failed to send OTP")}catch(e){console.error("Error sending OTP:",e),N("Failed to send OTP. Please try again.")}finally{T(!1)}},P=()=>{if(y)if(j){let e=p.join("");if(6!==e.length)return void N("Please enter complete 6-digit OTP");i(null,!0,e)}else D();else{if(!g)return;if(j){let e=p.join("");if(6!==e.length)return void N("Please enter complete 6-digit OTP");i(g,!1,e)}else D()}},I=p.every(e=>""!==e);return e?(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[9999] flex items-center justify-center p-4",children:(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center",children:(0,t.jsx)(s.AlertTriangle,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Delete Dairy - Action Required"})]}),(0,t.jsx)("button",{onClick:l,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:(0,t.jsx)(r.X,{className:"w-5 h-5 text-gray-500 dark:text-gray-400"})})]}),(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:[(0,t.jsxs)("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[(0,t.jsx)("strong",{children:"Warning:"})," This dairy has ",(0,t.jsx)("strong",{children:n.length})," BMC",1!==n.length?"s":""," under it."]}),(0,t.jsx)("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mt-2",children:"You must either transfer these BMCs to another dairy or delete everything."})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:["BMCs under ",(0,t.jsx)("strong",{children:m}),":"]}),(0,t.jsx)("div",{className:"max-h-32 overflow-y-auto bg-gray-50 dark:bg-gray-900/50 rounded-lg p-3 space-y-1",children:n.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300",children:[(0,t.jsx)(o.Building2,{className:"w-4 h-4 text-blue-500"}),(0,t.jsxs)("span",{children:[e.name," (",e.bmcId,")"]})]},e.id))})]}),(0,t.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:(0,t.jsxs)("label",{className:"flex items-start gap-3 cursor-pointer group",children:[(0,t.jsx)("input",{type:"checkbox",checked:y,onChange:e=>{var t;b(t=e.target.checked),t&&h(null),f(["","","","","",""]),k(!1),N(""),C(!1),T(!1)},className:"mt-0.5 w-4 h-4 text-red-600 border-red-300 rounded focus:ring-red-500 focus:ring-2 cursor-pointer"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm font-semibold text-red-700 dark:text-red-300",children:"Delete All Data (Permanent)"}),(0,t.jsx)("span",{className:"px-2 py-0.5 bg-red-600 text-white text-xs font-bold rounded-full",children:"DANGER"})]}),(0,t.jsxs)("p",{className:"text-sm text-red-800 dark:text-red-200 mt-1",children:["Delete all BMCs, societies, farmers, machines, machine statistics, machine corrections, rate charts, collections, sales, dispatches, and section pulse data under this dairy.",(0,t.jsx)("strong",{className:"block mt-1",children:"This action cannot be undone!"})]}),y&&(0,t.jsxs)("div",{className:"mt-3 p-3 bg-red-100 dark:bg-red-900/40 rounded-lg",children:[(0,t.jsx)("p",{className:"text-xs font-bold text-red-900 dark:text-red-100 mb-2",children:"⚠️ The following will be permanently deleted:"}),(0,t.jsxs)("ul",{className:"text-sm text-red-800 dark:text-red-200 mt-2 space-y-1 list-disc list-inside",children:[(0,t.jsxs)("li",{children:[n.length," BMC",1!==n.length?"s":""]}),(0,t.jsx)("li",{children:"All societies under these BMCs"}),(0,t.jsx)("li",{children:"All farmers under these societies"}),(0,t.jsx)("li",{children:"All machines linked to these societies"}),(0,t.jsx)("li",{children:"All machine statistics"}),(0,t.jsx)("li",{children:"All machine corrections (admin & device saved)"}),(0,t.jsx)("li",{children:"All rate charts and rate chart data"}),(0,t.jsx)("li",{children:"All milk collection records"}),(0,t.jsx)("li",{children:"All milk sales records"}),(0,t.jsx)("li",{children:"All milk dispatch records"}),(0,t.jsx)("li",{children:"All section pulse tracking data"}),(0,t.jsxs)("li",{children:["Dairy: ",(0,t.jsx)("strong",{children:m})]})]})]})]})]})}),!y&&(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Select New Dairy for BMC Transfer:"}),(0,t.jsxs)("select",{value:g||"",onChange:e=>h(Number(e.target.value)),className:"w-full px-4 py-2.5 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,t.jsx)("option",{value:"",children:"-- Select a dairy --"}),M.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]}),0===M.length&&(0,t.jsx)("p",{className:"text-sm text-orange-600 dark:text-orange-400",children:"No other dairies available. You must delete all data instead."})]}),j&&(0,t.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(c.Mail,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),(0,t.jsxs)("p",{className:"text-sm font-semibold text-blue-900 dark:text-blue-100",children:["OTP sent to: ",u]})]}),(0,t.jsxs)("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:["Please enter the 6-digit verification code to confirm ",y?"deletion":"transfer and deletion",":"]}),(0,t.jsx)("div",{className:"flex gap-2 justify-center",onPaste:e=>{e.preventDefault();let t=e.clipboardData.getData("text").slice(0,6);if(!/^\d+$/.test(t))return;let a=[...p];t.split("").forEach((e,t)=>{t<6&&(a[t]=e)}),f(a);let r=Math.min(t.length,5);F.current[r]?.focus()},children:p.map((e,a)=>(0,t.jsx)("input",{ref:e=>{F.current[a]=e},type:"text",maxLength:1,value:e,onChange:e=>((e,t)=>{if(t&&!/^\d$/.test(t))return;let a=[...p];a[e]=t,f(a),N(""),t&&e<5&&F.current[e+1]?.focus()})(a,e.target.value),onKeyDown:e=>{"Backspace"===e.key&&!p[a]&&a>0&&F.current[a-1]?.focus()},className:"w-12 h-12 text-center text-xl font-bold bg-white dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900 dark:text-gray-100"},a))}),v&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-red-600 dark:text-red-400 text-sm",children:[(0,t.jsx)(s.AlertTriangle,{className:"w-4 h-4"}),(0,t.jsx)("span",{children:v})]}),(0,t.jsx)("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:"OTP is valid for 10 minutes. Didn't receive it? Close and try again."})]})]}),(0,t.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 p-6 bg-gray-50 dark:bg-gray-900/50 flex flex-col sm:flex-row gap-3 justify-end",children:[(0,t.jsx)("button",{onClick:l,className:"px-6 py-2.5 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 border border-gray-300 dark:border-gray-600 rounded-lg font-medium transition-colors",children:"Cancel"}),y?(0,t.jsx)("button",{onClick:P,disabled:S||j&&!I,className:"px-6 py-2.5 bg-red-600 hover:bg-red-700 disabled:bg-red-400 disabled:cursor-not-allowed text-white rounded-lg font-medium transition-colors flex items-center gap-2",children:S?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Sending OTP..."]}):j?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.AlertTriangle,{className:"w-4 h-4"}),"Verify OTP & Delete All"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.Mail,{className:"w-4 h-4"}),"Send OTP & Confirm Delete"]})}):(0,t.jsx)("button",{onClick:P,disabled:!g||S||j&&!I,className:"px-6 py-2.5 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg font-medium transition-colors flex items-center gap-2",children:S?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Sending OTP..."]}):j?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.AlertTriangle,{className:"w-4 h-4"}),"Verify OTP & Transfer"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.Mail,{className:"w-4 h-4"}),"Send OTP & Confirm Transfer"]})})]})]})}):null}e.s(["default",()=>m],784623)},157368,e=>{"use strict";var t=e.i(843476),a=e.i(271645),r=e.i(618566),s=e.i(833277),l=e.i(111110),i=e.i(931194),n=e.i(952733),d=e.i(129228),o=e.i(555706),c=e.i(785183),m=e.i(93230),x=e.i(872526),u=e.i(234239),g=e.i(731195),h=e.i(339707),y=e.i(107233),b=e.i(283627),p=e.i(346897),f=e.i(343432),j=e.i(263488),k=e.i(284614),v=e.i(87316),N=e.i(607486),w=e.i(727612),C=e.i(580555),S=e.i(761911),T=e.i(25652),F=e.i(842009),M=e.i(939544),D=e.i(286536),P=e.i(77705),I=e.i(217923),A=e.i(37727);e.i(633999);var L=e.i(269111),E=e.i(344803),O=e.i(998253),B=e.i(545292),$=e.i(506296),z=e.i(504767),V=e.i(154041),q=e.i(935281),R=e.i(199083),W=e.i(688462),Q=e.i(948168),U=e.i(583560),G=e.i(145858),J=e.i(598522),K=e.i(892892),H=e.i(784623);let X={name:"",dairyId:"",password:"",location:"",contactPerson:"",phone:"",email:"",capacity:"",status:"active",monthlyTarget:""},Y=(e,a)=>{if(!e&&0!==e)return e||"";if(!a)return e;let r=e.toString(),s=RegExp(`(${a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return r.split(s).map((e,a)=>s.test(e)?(0,t.jsx)("span",{className:"bg-yellow-200 dark:bg-yellow-800 px-0.5 rounded",children:e},a):e)};function Z(){let e,Z,_=(0,r.useRouter)(),{user:ee}=(0,s.useUser)(),{t:et}=(0,l.useLanguage)(),[ea,er]=(0,a.useState)([]),[es,el]=(0,a.useState)(!0),[ei,en]=(0,a.useState)(!1),[ed,eo]=(0,a.useState)(!1),[ec,em]=(0,a.useState)(!1),[ex,eu]=(0,a.useState)(!1),[eg,eh]=(0,a.useState)(null),[ey,eb]=(0,a.useState)(X),[ep,ef]=(0,a.useState)(!1),[ej,ek]=(0,a.useState)("all"),[ev,eN]=(0,a.useState)(""),[ew,eC]=(0,a.useState)(""),[eS,eT]=(0,a.useState)(""),[eF,eM]=(0,a.useState)({}),[eD,eP]=(0,a.useState)(!1),[eI,eA]=(0,a.useState)("quantity"),[eL,eE]=(0,a.useState)(!1),[eO,eB]=(0,a.useState)(!1),[e$,ez]=(0,a.useState)(null),[eV,eq]=(0,a.useState)(!1),[eR,eW]=(0,a.useState)([]),[eQ,eU]=(0,a.useState)(!1),[eG,eJ]=(0,a.useState)(""),eK=(0,a.useCallback)(async()=>{try{el(!0);let e=localStorage.getItem("authToken");if(!e)return void _.push("/login");let t=await fetch("/api/user/dairy",{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!t.ok){if(401===t.status||403===t.status){localStorage.removeItem("authToken"),_.push("/login");return}throw Error("Failed to fetch dairies")}let a=await t.json();er(a.data||[])}catch(e){console.error("Error fetching dairies:",e),eC("Failed to load dairy data")}finally{el(!1)}},[_]),eH=async e=>{e.preventDefault(),ef(!0),eC("");try{let e=localStorage.getItem("authToken"),t=await fetch("/api/user/dairy",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({...ey,capacity:ey.capacity?parseInt(ey.capacity):void 0,monthlyTarget:ey.monthlyTarget?parseInt(ey.monthlyTarget):void 0})});if(t.ok)eT("Dairy added successfully!"),en(!1),eb(X),await eK(),setTimeout(()=>eT(""),3e3);else{let e=(await t.json()).error||"Failed to add dairy";eM({}),e.toLowerCase().includes("dairy id")&&e.toLowerCase().includes("already exists")?eM({dairyId:"This Dairy ID already exists"}):e.toLowerCase().includes("dairy name")&&e.toLowerCase().includes("already exists")?eM({name:"This Dairy name already exists"}):e.toLowerCase().includes("already exists")?eM({dairyId:"This Dairy ID already exists"}):eC(e)}}catch(e){console.error("Error adding dairy:",e),eC("Failed to add dairy")}finally{ef(!1)}},eX=async e=>{eh(e),eU(!1),eJ("");try{let t=localStorage.getItem("authToken"),a=await fetch(`/api/user/dairy/password?id=${e.id}`,{headers:{Authorization:`Bearer ${t}`}});if(a.ok){let t=await a.json(),r="";t.data?"string"==typeof t.data?r=t.data:"object"==typeof t.data&&t.data.password&&(r=String(t.data.password)):t.password&&(r=String(t.password)),eJ(r),eb({name:e.name,dairyId:e.dairyId,password:r,location:e.location||"",contactPerson:e.contactPerson||"",phone:e.phone||"",email:e.email||"",capacity:e.capacity?.toString()||"",status:e.status||"active",monthlyTarget:e.monthlyTarget?.toString()||""})}}catch(e){console.error("Error fetching password:",e)}eo(!0)},eY=async e=>{if(e.preventDefault(),eg){ef(!0),eC("");try{let e=localStorage.getItem("authToken"),t={id:eg.id,name:ey.name,location:ey.location,contactPerson:ey.contactPerson,phone:ey.phone,email:ey.email,capacity:ey.capacity?parseInt(ey.capacity):void 0,status:ey.status,monthlyTarget:ey.monthlyTarget?parseInt(ey.monthlyTarget):void 0};ey.password&&ey.password!==eG&&(t.password=ey.password);let a=await fetch("/api/user/dairy",{method:"PUT",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(t)});if(a.ok)eT("Dairy updated successfully!"),eo(!1),eh(null),eb(X),await eK(),setTimeout(()=>eT(""),3e3);else{let e=(await a.json()).error||"Failed to update dairy";eM({}),e.toLowerCase().includes("dairy name")&&e.toLowerCase().includes("already exists")||e.toLowerCase().includes("already exists")?eM({name:"This Dairy name already exists"}):eC(e)}}catch(e){console.error("Error updating dairy:",e),eC("Failed to update dairy")}finally{ef(!1)}}},eZ=async(e,t)=>{try{let a=localStorage.getItem("authToken"),r=await fetch("/api/user/dairy",{method:"PUT",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({id:e.id,status:t})});if(r.ok)eT(`Status updated to ${t}!`),await eK(),setTimeout(()=>eT(""),3e3);else{let e=await r.json();eC(e.error||"Failed to update status")}}catch(e){console.error("Error updating status:",e),eC("Failed to update status")}},e_=async e=>{try{let t=localStorage.getItem("authToken"),a=await fetch("/api/user/bmc",{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(a.ok)return((await a.json()).data||[]).filter(t=>t.dairyFarmId===e).map(e=>({id:e.id,name:e.name,bmcId:e.bmcId}));return[]}catch(e){return console.error("Error fetching BMCs:",e),[]}},e0=async e=>{eh(e);let t=await e_(e.id);eW(t),t.length>0?eq(!0):(window.selectedDairyIdForDelete=e.id,em(!0))},e1=async(e,t,a)=>{if(eg)try{let r=localStorage.getItem("authToken"),s=await fetch("/api/user/dairy",{method:"DELETE",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({id:eg.id,newDairyId:e,deleteAll:t,otp:a})}),l=await s.json();s.ok?(t?eT("Dairy and all related data deleted successfully!"):eT(`${l.data.transferredBMCs} BMC(s) transferred and dairy deleted successfully!`),eq(!1),eh(null),eW([]),await eK(),setTimeout(()=>eT(""),3e3)):eC(l.message||"Failed to delete dairy")}catch(e){console.error("Error deleting dairy:",e),eC("Failed to delete dairy")}},e2=async e=>{if(eg)try{eu(!0);let t=localStorage.getItem("authToken"),a=await fetch("/api/user/dairy",{method:"DELETE",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({id:eg.id,otp:e})});if(a.ok)eT("Dairy deleted successfully!"),em(!1),eh(null),await eK(),setTimeout(()=>eT(""),3e3);else{let e=await a.json();throw Error(e.error||"Failed to delete dairy")}}catch(e){throw console.error("Error deleting dairy:",e),e}finally{eu(!1)}},e5=(e,t)=>{if("dairyId"===e&&!ed){let e=t.replace(/^D-/i,"");t=`D-${e}`}eb(a=>({...a,[e]:t})),eF[e]&&eM(t=>({...t,[e]:""}))},e4=ea.filter(e=>{let t="all"===ej||e.status===ej,a=""===ev||e.name.toLowerCase().includes(ev.toLowerCase())||e.dairyId.toLowerCase().includes(ev.toLowerCase())||e.location?.toLowerCase().includes(ev.toLowerCase())||e.contactPerson?.toLowerCase().includes(ev.toLowerCase())||e.phone?.toLowerCase().includes(ev.toLowerCase())||e.email?.toLowerCase().includes(ev.toLowerCase());return t&&a});return((0,a.useEffect)(()=>{eK()},[eK]),(0,a.useEffect)(()=>{let e=e=>{eN(e.detail?.query||"")};return window.addEventListener("globalSearch",e),()=>window.removeEventListener("globalSearch",e)},[]),ee)?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"p-4 sm:p-6 lg:p-8 space-y-4 sm:space-y-6 lg:pb-8",children:[(0,t.jsx)(q.PageHeader,{title:et.dairyManagement.title,subtitle:et.dairyManagement.subtitle,icon:(0,t.jsx)(h.Milk,{className:"w-5 h-5 sm:w-6 sm:h-6 text-white"}),onRefresh:eK}),(0,t.jsx)(R.StatusMessage,{success:eS,error:ew}),ea.length>0&&(()=>{let e=ea.filter(e=>e.totalQuantity30d&&Number(e.totalQuantity30d)>0);if(0===e.length)return null;let a=[...e].sort((e,t)=>Number(t.totalQuantity30d||0)-Number(e.totalQuantity30d||0))[0],r=[...e].sort((e,t)=>Number(t.totalAmount30d||0)-Number(e.totalAmount30d||0))[0],s=[...e].sort((e,t)=>Number(t.weightedFat30d||0)-Number(e.weightedFat30d||0))[0],l=[...e].sort((e,t)=>Number(t.weightedSnf30d||0)-Number(e.weightedSnf30d||0))[0],i=[...e].sort((e,t)=>Number(t.totalCollections30d||0)-Number(e.totalCollections30d||0))[0],n=[...e].sort((e,t)=>Number(e.weightedWater30d||100)-Number(t.weightedWater30d||100))[0];return(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-3 sm:gap-4",children:[a&&(0,t.jsxs)("div",{className:"bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 p-4 rounded-lg border border-green-200 dark:border-green-700 cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>{eA("quantity"),eP(!0)},children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-green-900 dark:text-green-100",children:"Top Collection (30d)"}),(0,t.jsx)(S.Users,{className:"w-5 h-5 text-green-600 dark:text-green-400"})]}),(0,t.jsx)("p",{className:"text-lg font-bold text-green-800 dark:text-green-200",children:a.name}),(0,t.jsxs)("p",{className:"text-sm text-green-600 dark:text-green-400",children:[Number(a.totalQuantity30d||0).toFixed(2)," L"]})]}),r&&(0,t.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 p-4 rounded-lg border border-blue-200 dark:border-blue-700 cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>{eA("revenue"),eP(!0)},children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-blue-900 dark:text-blue-100",children:"Top Revenue (30d)"}),(0,t.jsx)(N.Building2,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})]}),(0,t.jsx)("p",{className:"text-lg font-bold text-blue-800 dark:text-blue-200",children:r.name}),(0,t.jsxs)("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:["₹",Number(r.totalAmount30d||0).toFixed(2)]})]}),s&&(0,t.jsxs)("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 p-4 rounded-lg border border-purple-200 dark:border-purple-700 cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>{eA("fat"),eP(!0)},children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-purple-900 dark:text-purple-100",children:"Best Quality (30d)"}),(0,t.jsx)(D.Eye,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})]}),(0,t.jsx)("p",{className:"text-lg font-bold text-purple-800 dark:text-purple-200",children:s.name}),(0,t.jsxs)("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:[Number(s.weightedFat30d||0).toFixed(2),"% Fat"]})]}),l&&(0,t.jsxs)("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 p-4 rounded-lg border border-orange-200 dark:border-orange-700 cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>{eA("snf"),eP(!0)},children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-orange-900 dark:text-orange-100",children:"Best SNF (30d)"}),(0,t.jsx)(T.TrendingUp,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})]}),(0,t.jsx)("p",{className:"text-lg font-bold text-orange-800 dark:text-orange-200",children:l.name}),(0,t.jsxs)("p",{className:"text-sm text-orange-600 dark:text-orange-400",children:[Number(l.weightedSnf30d||0).toFixed(2),"% SNF"]})]}),i&&(0,t.jsxs)("div",{className:"bg-gradient-to-br from-pink-50 to-pink-100 dark:from-pink-900/20 dark:to-pink-800/20 p-4 rounded-lg border border-pink-200 dark:border-pink-700 cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>{eA("collections"),eP(!0)},children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-pink-900 dark:text-pink-100",children:"Most Active (30d)"}),(0,t.jsx)(F.Award,{className:"w-5 h-5 text-pink-600 dark:text-pink-400"})]}),(0,t.jsx)("p",{className:"text-lg font-bold text-pink-800 dark:text-pink-200",children:i.name}),(0,t.jsxs)("p",{className:"text-sm text-pink-600 dark:text-pink-400",children:[Number(i.totalCollections30d||0)," Collections"]})]}),n&&(0,t.jsxs)("div",{className:"bg-gradient-to-br from-red-50 to-red-100 dark:from-red-900/20 dark:to-red-800/20 p-4 rounded-lg border border-red-200 dark:border-red-700 cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>{eA("water"),eP(!0)},children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-red-900 dark:text-red-100",children:"Most Water (30d)"}),(0,t.jsx)(M.Droplets,{className:"w-5 h-5 text-red-600 dark:text-red-400"})]}),(0,t.jsx)("p",{className:"text-lg font-bold text-red-800 dark:text-red-200",children:n.name}),(0,t.jsxs)("p",{className:"text-sm text-red-600 dark:text-red-400",children:[Number(n.weightedWater30d||0).toFixed(2),"% Water"]})]})]})})(),(0,t.jsx)(W.FilterControls,{icon:(0,t.jsx)(h.Milk,{className:"w-4 h-4 flex-shrink-0"}),showingText:`Showing ${e4.length} of ${ea.length} Dairies`,filterLabel:"Filter:",filterValue:ej,filterOptions:[{value:"all",label:"All Status"},{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"maintenance",label:"Maintenance"}],onFilterChange:e=>ek(e)}),es?(0,t.jsx)(E.LoadingSpinner,{}):e4.length>0?(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-6",children:e4.map(e=>(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm hover:shadow-lg transition-all duration-200 overflow-visible border border-gray-200 dark:border-gray-700 hover:border-blue-200 dark:hover:border-blue-700 relative z-10 hover:z-20",children:[(0,t.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 p-4 border-b border-gray-200 dark:border-gray-700 rounded-t-lg",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"p-2 bg-gradient-to-r from-blue-100 to-indigo-100 dark:from-blue-900/30 dark:to-indigo-900/30 rounded-lg flex-shrink-0",children:(0,t.jsx)(h.Milk,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white truncate",children:Y(e.name,ev)}),(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:Y(e.dairyId,ev)})]})]}),(0,t.jsx)(U.StatusDropdown,{currentStatus:e.status,onStatusChange:t=>eZ(e,t),options:[{status:"active",label:"Active",color:"bg-green-500",bgColor:"hover:bg-green-50 dark:hover:bg-green-900/30"},{status:"inactive",label:"Inactive",color:"bg-red-500",bgColor:"hover:bg-red-50 dark:hover:bg-red-900/30"},{status:"maintenance",label:"Maintenance",color:"bg-yellow-500",bgColor:"hover:bg-yellow-50 dark:hover:bg-yellow-900/30"}],compact:!0})]})}),(0,t.jsxs)("div",{className:"p-4 space-y-3",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(k.User,{className:"w-4 h-4 text-gray-500 flex-shrink-0"}),(0,t.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300 truncate",children:Y(e.contactPerson||"No Contact",ev)})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(f.Phone,{className:"w-4 h-4 text-gray-500 flex-shrink-0"}),(0,t.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300 truncate",children:Y(e.phone||"No Phone",ev)})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(p.MapPin,{className:"w-4 h-4 text-gray-500 flex-shrink-0"}),(0,t.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300 truncate",children:Y(e.location||"No Location",ev)})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(j.Mail,{className:"w-4 h-4 text-gray-500 flex-shrink-0"}),(0,t.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300 truncate",children:Y(e.email||"No Email",ev)})]})]}),(0,t.jsx)("div",{className:"border-t border-gray-200 dark:border-gray-700 my-3"}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide",children:"Last 30 Days"}),(0,t.jsx)(v.Calendar,{className:"w-4 h-4 text-gray-400"})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-blue-500"}),(0,t.jsx)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Collections"})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("div",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:Number(e.totalCollections30d||0)}),(0,t.jsxs)("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:[Number(e.totalQuantity30d||0).toFixed(2)," Liters"]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,t.jsxs)("div",{className:"bg-indigo-50 dark:bg-indigo-900/20 rounded-lg p-2 text-center",children:[(0,t.jsx)("div",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Fat"}),(0,t.jsxs)("div",{className:"text-sm font-bold text-indigo-600 dark:text-indigo-400",children:[Number(e.weightedFat30d||0).toFixed(2),"%"]})]}),(0,t.jsxs)("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-2 text-center",children:[(0,t.jsx)("div",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"SNF"}),(0,t.jsxs)("div",{className:"text-sm font-bold text-purple-600 dark:text-purple-400",children:[Number(e.weightedSnf30d||0).toFixed(2),"%"]})]}),(0,t.jsxs)("div",{className:"bg-pink-50 dark:bg-pink-900/20 rounded-lg p-2 text-center",children:[(0,t.jsx)("div",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"CLR"}),(0,t.jsx)("div",{className:"text-sm font-bold text-pink-600 dark:text-pink-400",children:Number(e.weightedClr30d||0).toFixed(1)})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between bg-emerald-50 dark:bg-emerald-900/20 rounded-lg p-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-emerald-500"}),(0,t.jsx)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Total Revenue"})]}),(0,t.jsxs)("div",{className:"text-lg font-bold text-emerald-600 dark:text-emerald-400",children:["₹",Number(e.totalAmount30d||0).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]}),(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 px-4 py-3 border-t border-gray-100 dark:border-gray-700 flex items-center justify-between gap-2 rounded-b-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{onClick:()=>eX(e),className:"p-2 text-gray-400 dark:text-gray-500 hover:text-green-600 dark:hover:text-green-400 transition-colors rounded-lg hover:bg-green-50 dark:hover:bg-green-900/30",title:"Edit",children:(0,t.jsx)(b.Edit3,{className:"w-4 h-4"})}),(0,t.jsx)("button",{onClick:()=>e0(e),className:"p-2 text-gray-400 dark:text-gray-500 hover:text-red-600 dark:hover:text-red-400 transition-colors rounded-lg hover:bg-red-50 dark:hover:bg-red-900/30",title:"Delete",children:(0,t.jsx)(w.Trash2,{className:"w-4 h-4"})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("button",{onClick:()=>{ez(e),eE(!0)},className:"flex items-center gap-1.5 px-2 py-1 rounded hover:bg-orange-50 dark:hover:bg-orange-900/20 transition-colors group",title:`View ${e.bmcCount||0} BMCs under ${e.name}`,children:[(0,t.jsx)(C.Factory,{className:"w-3.5 h-3.5 text-gray-400 group-hover:text-orange-500 transition-colors"}),(0,t.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-400 group-hover:text-orange-600 dark:group-hover:text-orange-400 font-medium",children:e.bmcCount||0})]}),(0,t.jsxs)("button",{onClick:()=>{ez(e),eB(!0)},className:"flex items-center gap-1.5 px-2 py-1 rounded hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors group",title:`View ${e.societyCount||0} societies under ${e.name}`,children:[(0,t.jsx)(N.Building2,{className:"w-3.5 h-3.5 text-gray-400 group-hover:text-blue-500 transition-colors"}),(0,t.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-400 group-hover:text-blue-600 dark:group-hover:text-blue-400 font-medium",children:e.societyCount||0})]}),(0,t.jsxs)("button",{onClick:()=>_.push(`/admin/dairy/${e.id}`),className:"flex items-center px-3 py-1.5 text-sm text-green-600 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/30 rounded-lg transition-colors",title:"View Details",children:[(0,t.jsx)(D.Eye,{className:"w-4 h-4 mr-1"}),(0,t.jsx)("span",{children:"View"})]})]})]})]},e.id))}):(0,t.jsx)(Q.EmptyState,{icon:(0,t.jsx)(h.Milk,{className:"w-12 h-12 sm:w-16 sm:h-16 text-gray-400"}),title:"No Dairies found",message:"all"===ej?"Get started by adding your first Dairy":"Try changing the filter to see more results",actionText:"all"===ej?"Add Your First Dairy":void 0,onAction:"all"===ej?()=>en(!0):void 0,showAction:"all"===ej})]}),(0,t.jsx)(J.default,{actions:[{icon:(0,t.jsx)(y.Plus,{className:"w-6 h-6 text-white"}),label:"Add Dairy",onClick:()=>{eM({}),eC(""),en(!0)},color:"bg-gradient-to-br from-blue-500 to-blue-600"}],directClick:!0}),(0,t.jsx)(O.FormModal,{isOpen:ei,onClose:()=>en(!1),title:et.dairyManagement.addNewDairy,maxWidth:"lg",children:(0,t.jsxs)("form",{onSubmit:eH,className:"space-y-4 sm:space-y-6",children:[(0,t.jsxs)(V.FormGrid,{children:[(0,t.jsx)(B.FormInput,{label:et.dairyManagement.dairyName,value:ey.name,onChange:e=>e5("name",e),placeholder:et.dairyManagement.enterDairyName,required:!0,error:eF.name}),(0,t.jsx)(B.FormInput,{label:et.dairyManagement.dairyId,value:ey.dairyId,onChange:e=>e5("dairyId",e),placeholder:"D-001",required:!0,error:eF.dairyId}),(0,t.jsxs)("div",{className:"sm:col-span-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:et.dairyManagement.password}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("input",{type:eQ?"text":"password",value:ey.password,onChange:e=>e5("password",e.target.value),placeholder:et.dairyManagement.enterSecurePassword,className:"form-input-custom w-full px-3 sm:px-4 py-2 sm:py-2.5 pr-10 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-emerald-500 dark:focus:ring-emerald-400 focus:border-emerald-500 dark:focus:border-emerald-400 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 transition-all duration-200 focus:outline-none"}),(0,t.jsx)("button",{type:"button",onClick:()=>eU(!eQ),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 transition-colors",title:eQ?"Hide password":"Show password",children:eQ?(0,t.jsx)(P.EyeOff,{className:"w-5 h-5"}):(0,t.jsx)(D.Eye,{className:"w-5 h-5"})})]}),(0,t.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Current password is pre-filled. Click eye icon to view or edit to change."})]}),(0,t.jsx)(B.FormInput,{label:et.dairyManagement.capacity,type:"number",value:ey.capacity,onChange:e=>e5("capacity",e),placeholder:et.dairyManagement.enterCapacity}),(0,t.jsx)(B.FormInput,{label:et.dairyManagement.contactPerson,value:ey.contactPerson,onChange:e=>e5("contactPerson",e),placeholder:et.dairyManagement.enterContactPerson}),(0,t.jsx)(B.FormInput,{label:et.dairyManagement.phone,type:"tel",value:ey.phone,onChange:e=>{e5("phone",(0,i.formatPhoneInput)(e))},onBlur:()=>{let e=(0,i.validatePhoneOnBlur)(ey.phone);e?eM(t=>({...t,phone:e})):eM(e=>({...e,phone:void 0}))},placeholder:et.dairyManagement.enterPhoneNumber,error:eF.phone}),(0,t.jsx)(B.FormInput,{label:et.dairyManagement.email,type:"email",value:ey.email,onChange:e=>e5("email",e),onBlur:()=>{let e=(0,n.validateEmailQuick)(ey.email);e?eM(t=>({...t,email:e})):eM(e=>({...e,email:void 0}))},placeholder:et.dairyManagement.enterEmail,error:eF.email}),(0,t.jsx)(B.FormInput,{label:et.dairyManagement.location,value:ey.location,onChange:e=>e5("location",e),placeholder:et.dairyManagement.enterLocation}),(0,t.jsx)($.FormSelect,{label:"Status",value:ey.status,onChange:e=>e5("status",e),options:[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"maintenance",label:"Maintenance"}]}),(0,t.jsx)(B.FormInput,{label:"Monthly Target (Liters)",type:"number",value:ey.monthlyTarget,onChange:e=>e5("monthlyTarget",e),placeholder:"Enter monthly target"})]}),(0,t.jsx)(z.FormActions,{onCancel:()=>en(!1),submitText:et.dairyManagement.addDairy,isLoading:ep,cancelText:et.common.cancel,loadingText:et.dairyManagement.addingDairy,submitIcon:(0,t.jsx)(y.Plus,{className:"w-4 h-4"})})]})}),(0,t.jsx)(O.FormModal,{isOpen:ed&&!!eg,onClose:()=>{eo(!1),eh(null),eb(X)},title:eg?`${et.common.edit} ${eg.name}`:et.common.edit,maxWidth:"lg",children:(0,t.jsxs)("form",{onSubmit:eY,className:"space-y-4 sm:space-y-6",children:[(0,t.jsxs)(V.FormGrid,{children:[(0,t.jsx)(B.FormInput,{label:et.dairyManagement.dairyName,value:ey.name,onChange:e=>e5("name",e),placeholder:et.dairyManagement.enterDairyName,required:!0,error:eF.name}),(0,t.jsx)(B.FormInput,{label:`${et.dairyManagement.dairyId} (Read-only)`,value:ey.dairyId,onChange:()=>{},readOnly:!0,disabled:!0}),(0,t.jsxs)("div",{className:"sm:col-span-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:et.dairyManagement.password}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("input",{type:eQ?"text":"password",value:ey.password,onChange:e=>e5("password",e.target.value),placeholder:"Enter password",className:"form-input-custom w-full px-3 sm:px-4 py-2 sm:py-2.5 pr-10 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-emerald-500 dark:focus:ring-emerald-400 focus:border-emerald-500 dark:focus:border-emerald-400 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 transition-all duration-200 focus:outline-none"}),(0,t.jsx)("button",{type:"button",onClick:()=>eU(!eQ),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 transition-colors",title:eQ?"Hide password":"Show password",children:eQ?(0,t.jsx)(P.EyeOff,{className:"w-5 h-5"}):(0,t.jsx)(D.Eye,{className:"w-5 h-5"})})]}),(0,t.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Current password is pre-filled. Click eye icon to view or edit to change."})]}),(0,t.jsx)(B.FormInput,{label:et.dairyManagement.capacity,type:"number",value:ey.capacity,onChange:e=>e5("capacity",e),placeholder:et.dairyManagement.enterCapacity}),(0,t.jsx)(B.FormInput,{label:et.dairyManagement.contactPerson,value:ey.contactPerson,onChange:e=>e5("contactPerson",e),placeholder:et.dairyManagement.enterContactPerson}),(0,t.jsx)(B.FormInput,{label:et.dairyManagement.phone,type:"tel",value:ey.phone,onChange:e=>{e5("phone",(0,i.formatPhoneInput)(e))},onBlur:()=>{let e=(0,i.validatePhoneOnBlur)(ey.phone);e?eM(t=>({...t,phone:e})):eM(e=>({...e,phone:void 0}))},placeholder:et.dairyManagement.enterPhoneNumber,error:eF.phone}),(0,t.jsx)(B.FormInput,{label:et.dairyManagement.email,type:"email",value:ey.email,onChange:e=>e5("email",e),onBlur:()=>{let e=(0,n.validateEmailQuick)(ey.email);e?eM(t=>({...t,email:e})):eM(e=>({...e,email:void 0}))},placeholder:et.dairyManagement.enterEmail,error:eF.email}),(0,t.jsx)(B.FormInput,{label:et.dairyManagement.location,value:ey.location,onChange:e=>e5("location",e),placeholder:et.dairyManagement.enterLocation}),(0,t.jsx)($.FormSelect,{label:"Status",value:ey.status,onChange:e=>e5("status",e),options:[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"maintenance",label:"Maintenance"}]}),(0,t.jsx)(B.FormInput,{label:"Monthly Target (Liters)",type:"number",value:ey.monthlyTarget,onChange:e=>e5("monthlyTarget",e),placeholder:"Enter monthly target"})]}),(0,t.jsx)(z.FormActions,{onCancel:()=>{eo(!1),eh(null),eb(X)},submitText:"Update Dairy",isLoading:ep,cancelText:et.common.cancel,loadingText:"Updating...",submitIcon:(0,t.jsx)(b.Edit3,{className:"w-4 h-4"})})]})}),(0,t.jsx)(G.default,{isOpen:ec&&!!eg,onClose:()=>{em(!1),eh(null)},onConfirm:e2,dairyName:eg?.name||"",loading:ex,bmcCount:eg?.bmcCount||0,societyCount:eg?.societyCount||0}),(0,t.jsx)(K.default,{isOpen:eL&&!!e$,onClose:()=>{eE(!1),ez(null)},onConfirm:()=>{eE(!1),_.push(`/admin/bmc?dairyFilter=${e$?.id}`),ez(null)},title:"Navigate to BMC Management",message:`View all BMCs from ${e$?.name} in the BMC Management page with filters applied.`,confirmText:"Go to BMC Management",cancelText:"Cancel"}),(0,t.jsx)(K.default,{isOpen:eO&&!!e$,onClose:()=>{eB(!1),ez(null)},onConfirm:()=>{eB(!1),_.push(`/admin/society?dairyFilter=${e$?.id}`),ez(null)},title:"Navigate to Society Management",message:`View all societies from ${e$?.name} in the Society Management page with filters applied.`,confirmText:"Go to Society Management",cancelText:"Cancel"}),(0,t.jsx)(H.default,{isOpen:eV,onClose:()=>{eq(!1),eh(null),eW([])},onConfirm:e1,bmcs:eR,dairies:ea,dairyName:eg?.name||"",currentDairyId:eg?.id||0,adminEmail:ee?.email||""}),eD&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(I.BarChart3,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"}),(0,t.jsxs)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:["quantity"===eI&&"Collection Volume - Last 30 Days","revenue"===eI&&"Revenue - Last 30 Days","fat"===eI&&"Average Fat % - Last 30 Days","snf"===eI&&"Average SNF % - Last 30 Days","collections"===eI&&"Number of Collections - Last 30 Days","water"===eI&&"Average Water % - Last 30 Days"]})]}),(0,t.jsx)("button",{onClick:()=>eP(!1),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:(0,t.jsx)(A.X,{className:"w-5 h-5 text-gray-500 dark:text-gray-400"})})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(e=ea.filter(e=>e.totalQuantity30d&&Number(e.totalQuantity30d)>0).map(e=>({name:e.name,dairyId:e.dairyId,value:"quantity"===eI?Number(e.totalQuantity30d||0):"revenue"===eI?Number(e.totalAmount30d||0):"fat"===eI?Number(e.weightedFat30d||0):"snf"===eI?Number(e.weightedSnf30d||0):"collections"===eI?Number(e.totalCollections30d||0):Number(e.weightedWater30d||0)})).sort((e,t)=>t.value-e.value),Z=()=>{switch(eI){case"quantity":return"#10b981";case"revenue":return"#3b82f6";case"fat":return"#8b5cf6";case"snf":return"#f97316";case"collections":return"#ec4899";case"water":return"#ef4444";default:return"#6b7280"}},e.length>0?(0,t.jsx)("div",{className:"w-full h-[500px]",children:(0,t.jsx)(g.ResponsiveContainer,{width:"100%",height:"100%",children:(0,t.jsxs)(d.LineChart,{data:e,margin:{top:5,right:30,left:20,bottom:80},children:[(0,t.jsx)(x.CartesianGrid,{strokeDasharray:"3 3",stroke:"#e5e7eb",className:"dark:stroke-gray-700"}),(0,t.jsx)(c.XAxis,{dataKey:"name",angle:-45,textAnchor:"end",height:100,interval:0,tick:{fontSize:11},stroke:"#6b7280",label:{value:"Dairy Name",position:"insideBottom",offset:-5,style:{fontSize:13,fontWeight:500,fill:"#9ca3af"}}}),(0,t.jsx)(m.YAxis,{label:{value:"revenue"===eI?"Revenue (₹)":"fat"===eI||"snf"===eI||"water"===eI?"Percentage (%)":"quantity"===eI?"Volume (L)":"Count",angle:-90,position:"insideLeft",style:{fontSize:13,fontWeight:500,fill:"#9ca3af"}},stroke:"#6b7280"}),(0,t.jsx)(u.Tooltip,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"0.5rem",color:"#fff",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1)"},formatter:e=>"revenue"===eI?["₹"+Number(e).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]:"fat"===eI||"snf"===eI||"water"===eI?[Number(e).toFixed(2)+"%"]:"quantity"===eI?[Number(e).toFixed(2)+" L"]:[Number(e)],labelFormatter:e=>`Dairy: ${e}`,cursor:{stroke:"#9ca3af",strokeWidth:1}}),(0,t.jsx)(o.Line,{type:"monotone",dataKey:"value",stroke:Z(),strokeWidth:2,dot:{fill:Z(),r:4},activeDot:{r:6},isAnimationActive:!0,name:"Value"})]})})}):(0,t.jsx)("div",{className:"flex items-center justify-center h-[500px]",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(I.BarChart3,{className:"w-16 h-16 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400 text-lg",children:"No data available for this metric"})]})}))}),(0,t.jsx)("div",{className:"border-t border-gray-200 dark:border-gray-700 p-4 bg-gray-50 dark:bg-gray-700/50",children:(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Showing performance metrics for all dairies over the last 30 days. Click the X to close this view."})})]})})]}):(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:(0,t.jsx)(L.FlowerSpinner,{})})}e.s(["default",()=>Z])}]);