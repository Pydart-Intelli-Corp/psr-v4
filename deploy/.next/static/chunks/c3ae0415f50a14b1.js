(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,100712,e=>{"use strict";var t=e.i(843476),a=e.i(271645),s=e.i(618566),r=e.i(833277),i=e.i(111110),n=e.i(931194),o=e.i(239616),l=e.i(346897),d=e.i(343432),c=e.i(284614),m=e.i(87316),h=e.i(607486),x=e.i(195116),u=e.i(878894),g=e.i(270756),p=e.i(834161);let y=(0,e.i(475254).default)("key-round",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);var b=e.i(327025),f=e.i(75505),w=e.i(463059),j=e.i(664659),k=e.i(178583),v=e.i(503116),N=e.i(107233),S=e.i(286536),C=e.i(269638),P=e.i(939544),I=e.i(25652),T=e.i(842009),M=e.i(217923),F=e.i(37727),A=e.i(129228),L=e.i(555706),$=e.i(785183),D=e.i(93230),U=e.i(872526),E=e.i(234239),z=e.i(731195);e.i(633999);var B=e.i(269111),O=e.i(998253),R=e.i(545292),V=e.i(506296),q=e.i(504767),W=e.i(154041),J=e.i(948828),Q=e.i(199083),G=e.i(818367),K=e.i(948168),Z=e.i(462201);e.i(137996);var _=e.i(641041),H=e.i(849686),X=e.i(105158),Y=e.i(59590),ee=e.i(963290),et=e.i(425091),ea=e.i(693541);let es={machineId:"",machineType:"",societyId:"",location:"",installationDate:"",operatorName:"",contactPhone:"",status:"active",notes:"",setAsMaster:!1,disablePasswordInheritance:!1};function er(){let e,er=(0,s.useRouter)(),ei=(0,s.useSearchParams)(),{user:en}=(0,r.useUser)(),{}=(0,i.useLanguage)(),[eo,el]=(0,a.useState)([]),[ed,ec]=(0,a.useState)([]),[em,eh]=(0,a.useState)([]),[ex,eu]=(0,a.useState)([]),[eg,ep]=(0,a.useState)([]),[ey,eb]=(0,a.useState)(!0),[ef,ew]=(0,a.useState)(!1),[ej,ek]=(0,a.useState)(!1),[ev,eN]=(0,a.useState)(!1),[eS,eC]=(0,a.useState)(!1),[eP,eI]=(0,a.useState)(!1),[eT,eM]=(0,a.useState)(!1),[eF,eA]=(0,a.useState)(!1),[eL,e$]=(0,a.useState)(null),[eD,eU]=(0,a.useState)([]),[eE,ez]=(0,a.useState)(!1),[eB,eO]=(0,a.useState)(""),[eR,eV]=(0,a.useState)(""),[eq,eW]=(0,a.useState)(""),[eJ,eQ]=(0,a.useState)(null),[eG,eK]=(0,a.useState)(es),[eZ,e_]=(0,a.useState)({userPassword:"",supervisorPassword:"",confirmUserPassword:"",confirmSupervisorPassword:""}),[eH,eX]=(0,a.useState)({userPassword:"",confirmUserPassword:"",supervisorPassword:"",confirmSupervisorPassword:""}),[eY,e0]=(0,a.useState)(!1),[e1,e4]=(0,a.useState)(""),[e2,e3]=(0,a.useState)("all"),[e5,e6]=(0,a.useState)([]),[e7,e9]=(0,a.useState)([]),[e8,te]=(0,a.useState)([]),[tt,ta]=(0,a.useState)([]),[ts,tr]=(0,a.useState)(""),[ti,tn]=(0,a.useState)(""),[to,tl]=(0,a.useState)({topCollector:null,mostTests:null,bestCleaning:null,mostCleaningSkip:null,activeToday:null,highestUptime:null}),[td,tc]=(0,a.useState)(!1),[tm,th]=(0,a.useState)("quantity"),[tx,tu]=(0,a.useState)([]),[tg,tp]=(0,a.useState)({}),[ty,tb]=(0,a.useState)(new Set),[tf,tw]=(0,a.useState)("folder"),[tj,tk]=(0,a.useState)(new Set),[tv,tN]=(0,a.useState)(new Set),[tS,tC]=(0,a.useState)(!1),[tP,tI]=(0,a.useState)(!1),[tT,tM]=(0,a.useState)(0),[tF,tA]=(0,a.useState)(!1),[tL,t$]=(0,a.useState)(!1),[tD,tU]=(0,a.useState)("active"),[tE,tz]=(0,a.useState)(!1),[tB,tO]=(0,a.useState)(null),[tR,tV]=(0,a.useState)(!1),[tq,tW]=(0,a.useState)(!1),[tJ,tQ]=(0,a.useState)(null),[tG,tK]=(0,a.useState)(null),[tZ,t_]=(0,a.useState)(!1),[tH,tX]=(0,a.useState)(!1),[tY,t0]=(0,a.useState)(!1),[t1,t4]=(0,a.useState)(new Set),[t2,t3]=(0,a.useState)(!1),[t5,t6]=(0,a.useState)(!1),[t7,t9]=(0,a.useState)(""),[t8,ae]=(0,a.useState)(""),[at,aa]=(0,a.useState)(!1),[as,ar]=(0,a.useState)(null),[ai,an]=(0,a.useState)(null),ao=e=>e?/^\d{6}$/.test(e)?"":"Password must be exactly 6 numbers":"",al=e=>{if(!e)return{pending:[],downloaded:[]};let t=e.split("|||"),a=[],s=[];return t.forEach(e=>{let[t,r,i]=e.split(":");t&&r&&i&&("pending"===i?a.push({channel:t,fileName:r}):"downloaded"===i&&s.push({channel:t,fileName:r}))}),{pending:a,downloaded:s}},ad=e=>{tQ(e),tK(null),t_(!1),tW(!0)},ac=async()=>{if(!tG)return void tr("Please select a machine to set as master");tX(!0),tr("");try{let e=localStorage.getItem("authToken");if(console.log("Token from localStorage:",e),console.log("Token type:",typeof e),console.log("Token length:",e?.length),!e)return void tr("Authentication token not found. Please login again.");let t=await fetch(`/api/user/machine/${tG}/set-master`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({setForAll:tZ})}),a=await t.json();t.ok?(tn("Master machine updated successfully"),tW(!1),await af(),setTimeout(()=>tn(""),3e3)):tr(a.error||a.message||"Failed to update master machine")}catch(e){console.error("Error updating master machine:",e),tr("Failed to update master machine")}finally{tX(!1)}},am=e=>{switch(e.toUpperCase()){case"COW":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";case"BUF":return"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200";case"MIX":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200"}},ah=async(e,t,a)=>{try{ez(!0);let s=localStorage.getItem("authToken");if(!s)return;let r=await fetch(`/api/user/ratechart/data?fileName=${encodeURIComponent(e)}&channel=${t}&societyId=${a}`,{headers:{Authorization:`Bearer ${s}`}}),i=await r.json();i.success?eU(i.data||[]):tr("string"==typeof i.error?i.error:i.error?.message||"Failed to fetch rate chart data")}catch(e){console.error("Error fetching rate chart data:",e),tr("Failed to fetch rate chart data")}finally{ez(!1)}},ax=(e,t,a)=>{e$({fileName:e,channel:t,societyId:a}),eA(!0),ah(e,t,a)},au=()=>{eA(!1),e$(null),eU([]),eO(""),eV(""),eW("")},ag=e=>{let t={};Object.entries(e).forEach(([e,a])=>{if("string"==typeof a){let s=a.replace(/\D/g,"").slice(0,6);t[e]=s}});let a={...eZ,...t};e_(a);let s=Object.keys(e)[0],r={...eH};if("userPassword"===s)r.userPassword=ao(a.userPassword),r.confirmUserPassword="";else if("confirmUserPassword"===s){let e=ao(a.confirmUserPassword);e?r.confirmUserPassword=e:a.userPassword&&a.confirmUserPassword&&a.userPassword!==a.confirmUserPassword?r.confirmUserPassword="Passwords do not match":r.confirmUserPassword="",r.userPassword=""}else if("supervisorPassword"===s)r.supervisorPassword=ao(a.supervisorPassword),r.confirmSupervisorPassword="";else if("confirmSupervisorPassword"===s){let e=ao(a.confirmSupervisorPassword);e?r.confirmSupervisorPassword=e:a.supervisorPassword&&a.confirmSupervisorPassword&&a.supervisorPassword!==a.confirmSupervisorPassword?r.confirmSupervisorPassword="Passwords do not match":r.confirmSupervisorPassword="",r.supervisorPassword=""}eX(r)},ap=(0,a.useCallback)(async()=>{try{let e=localStorage.getItem("authToken"),t=await fetch("/api/analytics/machine-performance",{headers:{Authorization:`Bearer ${e}`}});if(console.log("ðŸ“Š Performance Stats Response Status:",t.status),t.ok){let e=await t.json();console.log("ðŸ“Š Performance Stats Data:",e),tl(e)}else{let e=await t.json();console.error("âŒ Performance Stats Error:",e)}}catch(e){console.error("âŒ Error fetching performance stats:",e)}},[]),ay=(0,a.useCallback)(async e=>{try{let t=localStorage.getItem("authToken"),a=await fetch(`/api/analytics/machine-performance?graphData=true&metric=${e}`,{headers:{Authorization:`Bearer ${t}`}});if(a.ok){let e=await a.json();tu(e)}}catch(e){console.error("Error fetching graph data:",e),tu([])}},[]),ab=e=>{th(e),ay(e),tc(!0)},af=(0,a.useCallback)(async()=>{try{eb(!0);let e=localStorage.getItem("authToken");if(!e)return void er.push("/login");let t=await fetch("/api/user/machine",{headers:{Authorization:`Bearer ${e}`}});if(401===t.status){localStorage.removeItem("authToken"),er.push("/login");return}let a=await t.json();if(a.success){let e=(a.data||[]).sort((e,t)=>e.isMasterMachine&&!t.isMasterMachine?-1:!e.isMasterMachine&&t.isMasterMachine?1:e.id-t.id);el(e)}else tr("string"==typeof a.error?a.error:a.error?.message||"Failed to fetch machines")}catch(e){console.error("Error fetching machines:",e),tr("Failed to fetch machines")}finally{eb(!1)}},[er]),aw=(0,a.useCallback)(async()=>{try{ew(!0);let e=localStorage.getItem("authToken");if(!e)return;let t=await fetch("/api/user/society",{headers:{Authorization:`Bearer ${e}`}}),a=await t.json();a.success&&ec(a.data||[])}catch(e){console.error("Error fetching societies:",e)}finally{ew(!1)}},[]),aj=(0,a.useCallback)(async()=>{try{ek(!0);let e=localStorage.getItem("authToken");if(!e)return;let t=await fetch("/api/superadmin/machines",{headers:{Authorization:`Bearer ${e}`}}),a=await t.json();a.success&&ep(a.data.machines||[])}catch(e){console.error("Error fetching machine types:",e)}finally{ek(!1)}},[]),ak=(0,a.useCallback)(async()=>{try{let e=localStorage.getItem("authToken");if(!e)return;let t=await fetch("/api/user/dairy",{headers:{Authorization:`Bearer ${e}`}});if(t.ok){let e=await t.json();eh(e.data||[])}}catch(e){console.error("Error fetching dairies:",e)}},[]),av=(0,a.useCallback)(async()=>{try{let e=localStorage.getItem("authToken");if(!e)return;let t=await fetch("/api/user/bmc",{headers:{Authorization:`Bearer ${e}`}});if(t.ok){let e=await t.json();eu(e.data||[])}}catch(e){console.error("Error fetching BMCs:",e)}},[]);(0,a.useEffect)(()=>{en&&(af(),aw(),aj(),ak(),av(),ap())},[en,af,aw,aj,ak,av,ap]),(0,a.useEffect)(()=>{let e=e=>{e4(e.detail.query)};return window.addEventListener("globalSearch",e),()=>window.removeEventListener("globalSearch",e)},[]),(0,a.useEffect)(()=>{if(ti||ts){let e=setTimeout(()=>{tn(""),tr("")},5e3);return()=>clearTimeout(e)}},[ti,ts]),(0,a.useEffect)(()=>{if(e8.length>0&&tt.length>0){let e=eo.filter(e=>e8.includes(e.societyId?.toString()||"")).map(e=>e.id?.toString()||""),t=tt.filter(t=>e.includes(t));t.length!==tt.length&&ta(t)}},[e8,tt,eo]),(0,a.useEffect)(()=>{let e=ei.get("societyId"),t=ei.get("societyName"),a=ei.get("dairyFilter");e&&!e8.includes(e)&&(te([e]),t&&tn(`Filter Applied: ${decodeURIComponent(t)}`)),a&&!e5.includes(a)&&(e6([a]),tn("Filter Applied: Dairy"))},[]);let aN=async e=>{if(e.preventDefault(),!eG.machineId||!eG.machineId.trim()){tr("Please enter a machine ID."),tn("");return}if(!eG.machineType||!eG.machineType.trim()){tr("Please select a machine type."),tn("");return}if(!eG.societyId){tr("Please select a society for the machine."),tn("");return}if(eG.contactPhone&&eG.contactPhone.trim()){let e=(0,n.validateIndianPhone)(eG.contactPhone);if(!e.isValid){tp({...tg,contactPhone:e.error||"Invalid phone number"}),tr("Please fix the phone number error before saving."),tn("");return}}tp({}),e0(!0);try{let e=localStorage.getItem("authToken"),t=await fetch("/api/user/machine",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(eG)});if(t.ok)eN(!1),eK(es),tn("Machine created successfully"),tr(""),af();else{let e=(await t.json()).error||"Failed to create machine";tp({}),e.toLowerCase().includes("machine id")&&e.toLowerCase().includes("already exists")?e.toLowerCase().includes("in this society")?tp({machineId:"This Machine ID already exists in the selected society"}):tp({machineId:"This Machine ID already exists"}):e.toLowerCase().includes("machine type")&&e.toLowerCase().includes("already exists")?tp({machineType:"This Machine type already exists for this society"}):tr(e),tn("")}}catch(e){console.error("Error creating machine:",e),tr("Error creating machine. Please try again."),tn("")}finally{e0(!1)}},aS=async e=>{if(e.preventDefault(),eJ){if(!eG.machineId||!eG.machineId.trim()){tr("Please enter a machine ID."),tn("");return}if(!eG.machineType||!eG.machineType.trim()){tr("Please select a machine type."),tn("");return}if(!eG.societyId){tr("Please select a society for the machine."),tn("");return}if(eG.contactPhone&&eG.contactPhone.trim()){let e=(0,n.validateIndianPhone)(eG.contactPhone);if(!e.isValid){tp({...tg,contactPhone:e.error||"Invalid phone number"}),tr("Please fix the phone number error before saving."),tn("");return}}tp({}),e0(!0);try{let e=localStorage.getItem("authToken"),t=await fetch("/api/user/machine",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({id:eJ.id,...eG})});if(t.ok)eC(!1),eQ(null),eK(es),tn("Machine updated successfully"),tr(""),af();else{let e=(await t.json()).error||"Failed to update machine";tp({}),e.toLowerCase().includes("machine id")&&e.toLowerCase().includes("already exists")?e.toLowerCase().includes("in this society")?tp({machineId:"This Machine ID already exists in the selected society"}):tp({machineId:"This Machine ID already exists"}):e.toLowerCase().includes("machine type")&&e.toLowerCase().includes("already exists")?tp({machineType:"This Machine type already exists for this society"}):tr(e),tn("")}}catch(e){console.error("Error updating machine:",e),tr("Error updating machine. Please try again."),tn("")}finally{e0(!1)}}},aC=async()=>{if(eJ)try{e0(!0);let e=localStorage.getItem("authToken"),t=await fetch(`/api/user/machine?id=${eJ.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`}}),a=await t.json();a.success?(tn("Machine deleted successfully!"),await af(),eI(!1),eQ(null)):tr("string"==typeof a.error?a.error:a.error?.message||"Failed to delete machine")}catch(e){console.error("Error deleting machine:",e),tr("Failed to delete machine")}finally{e0(!1)}},aP=e=>{tN(t=>{let a=new Set(t);if(a.has(e)){a.delete(e),tC(!1);let t=aq.find(t=>t.id===e);if(t&&t.societyId){let s=t.societyId;aq.filter(e=>e.societyId===s).every(t=>t.id!==e&&a.has(t.id))||tk(e=>{let t=new Set(e);return t.delete(s),t})}}else{a.add(e);let t=aq.find(t=>t.id===e);if(t&&t.societyId){let s=t.societyId;aq.filter(e=>e.societyId===s).every(t=>t.id===e||a.has(t.id))&&tk(e=>{let t=new Set(e);return t.add(s),t})}Array.from(new Set(aq.map(e=>e.id))).every(t=>t===e||a.has(t))&&tC(!0)}return a})},aI=async()=>{if(0!==tv.size){tA(!1),t$(!0),tM(0);try{let e=localStorage.getItem("authToken");tM(10);let t=Array.from(tv);tM(20);let a=await fetch(`/api/user/machine?ids=${encodeURIComponent(JSON.stringify(t))}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`}});if(tM(60),a.ok)tM(80),await af(),tM(95),tN(new Set),tk(new Set),tC(!1),tn(`Successfully deleted ${t.length} machine(s)${"all"!==e2||e5.length>0||e7.length>0||e8.length>0?" from filtered results":""}`),tr(""),tM(100);else{let e=await a.json();tr(e.message||"Failed to delete selected machines"),tn("")}}catch(e){console.error("Error deleting machines:",e),tr("Error deleting selected machines"),tn("")}finally{t$(!1),tM(0)}}},aT=async e=>{if(0===tv.size)return;let t=e||tD;tI(!0),tM(0);try{let e=localStorage.getItem("authToken");tM(5);let a=Array.from(tv),s=a.length;tM(10),console.log(`ðŸ”„ Bulk updating ${s} machines to status: ${t}`),tM(30);let r=await fetch("/api/user/machine",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({bulkStatusUpdate:!0,machineIds:a,status:t})});if(tM(70),!r.ok){let e=await r.json();throw Error(e.error||"Failed to update machine status")}let i=await r.json(),n=i.data?.updated||s;tM(90),await af(),tM(100),tN(new Set),tk(new Set),tC(!1),console.log(`âœ… Successfully updated ${n} machines`),tn(`Successfully updated status to "${t}" for ${n} machine(s)${"all"!==e2||e5.length>0||e7.length>0||e8.length>0?" from filtered results":""}`),tr("")}catch(e){console.error("Error updating machine status:",e),tM(100),tr(e instanceof Error?e.message:"Error updating machine status. Please try again."),tn("")}finally{tI(!1)}};(0,a.useEffect)(()=>{let e=eo.filter(e=>{let t="all"===e2||e.status===e2,a=0===e8.length||e8.includes(e.societyId?.toString()||""),s=""===e1||e.machineId.toLowerCase().includes(e1.toLowerCase())||e.machineType.toLowerCase().includes(e1.toLowerCase())||e.societyName?.toLowerCase().includes(e1.toLowerCase())||e.societyIdentifier?.toLowerCase().includes(e1.toLowerCase())||e.location?.toLowerCase().includes(e1.toLowerCase())||e.operatorName?.toLowerCase().includes(e1.toLowerCase())||e.contactPhone?.toLowerCase().includes(e1.toLowerCase())||e.notes?.toLowerCase().includes(e1.toLowerCase());return t&&a&&s});if(tv.size>0){let t=new Set(e.map(e=>e.id)),a=new Set(Array.from(tv).filter(e=>t.has(e)));if(a.size!==tv.size){tN(a),tC(!1);let t=new Set(e.map(e=>e.societyId).filter(Boolean)),s=new Set;t.forEach(t=>{let r=e.filter(e=>e.societyId===t);r.every(e=>a.has(e.id))&&r.length>0&&s.add(t)}),tk(s)}}else tC(!1),tk(new Set)},[e2,e8,e1,eo,tv]);let aM=async(e,t)=>{tI(!0),tM(0);try{tM(10);let a=localStorage.getItem("authToken");tM(20);let s={id:e.id,machineId:e.machineId,machineType:e.machineType,societyId:e.societyId,location:e.location,installationDate:e.installationDate,operatorName:e.operatorName,contactPhone:e.contactPhone,status:t,notes:e.notes};tM(30);let r=await fetch("/api/user/machine",{method:"PUT",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify(s)});if(tM(60),tM(80),r.ok)tn(`Status updated to ${t}!`),await af(),tM(100),setTimeout(()=>tn(""),3e3);else{let e=(await r.json()).error||"Failed to update status";tM(100),tr(e),setTimeout(()=>tr(""),5e3)}}catch(e){console.error("Error updating status:",e),tM(100),tr("Failed to update status"),setTimeout(()=>tr(""),5e3)}finally{tI(!1)}},aF=(e,a,s,r)=>{let i=s&&""!==s.trim(),n=r&&""!==r.trim(),o=[],l=(0,t.jsx)(g.Lock,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),d="text-red-600 dark:text-red-400";return i&&(1===e?(o.push("User"),d="text-amber-600 dark:text-amber-400"):(o.push("User âœ“"),d="text-green-600 dark:text-green-400"),l=(0,t.jsx)(p.Key,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})),n&&(1===a?(o.push("Supervisor"),d="text-amber-600 dark:text-amber-400"):(o.push("Supervisor âœ“"),d="text-green-600 dark:text-green-400"),l=i?(0,t.jsx)(y,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}):(0,t.jsx)(g.Lock,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})),i&&n&&1===e&&1===a?(d="text-amber-600 dark:text-amber-400",l=(0,t.jsx)(y,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})):i&&n&&0===e&&0===a?(d="text-green-600 dark:text-green-400",l=(0,t.jsx)(y,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})):i&&n&&(1===e||1===a)&&(d="text-amber-600 dark:text-amber-400",l=(0,t.jsx)(y,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})),{icon:l,text:o.length>0?o.join(" | "):"No passwords",className:d}},aA=()=>{let e=new Date().toISOString().split("T")[0];eK({...es,installationDate:e}),eN(!0),tr(""),tn(""),tp({})},aL=e=>{eQ(e),eK({machineId:e.machineId,machineType:e.machineType,societyId:e.societyId.toString(),location:e.location||"",installationDate:e.installationDate||"",operatorName:e.operatorName||"",contactPhone:e.contactPhone||"",status:e.status,notes:e.notes||"",setAsMaster:!1,disablePasswordInheritance:!1}),tp({}),tr(""),eC(!0)},a$=e=>{eQ(e),eI(!0)},aD=e=>{eQ(e),e_({userPassword:"",supervisorPassword:"",confirmUserPassword:"",confirmSupervisorPassword:""}),eM(!0)},aU=()=>{eN(!1),eK(es),tr(""),tn(""),tp({})},aE=()=>{eC(!1),eQ(null),eK(es),tr(""),tn(""),tp({})},az=()=>{eM(!1),e_({userPassword:"",supervisorPassword:"",confirmUserPassword:"",confirmSupervisorPassword:""}),eX({userPassword:"",confirmUserPassword:"",supervisorPassword:"",confirmSupervisorPassword:""}),tr(""),tn(""),eQ(null),t0(!1),t4(new Set),t3(!1)},aB=e=>{an(e),t6(!0),t9(""),ae(""),ar(null)},aO=async e=>{if(e.preventDefault(),!ai||!t7)return void ae("Please enter your admin password");aa(!0),ae("");try{let e=localStorage.getItem("authToken");if(!e)return void er.push("/login");let t=await fetch(`/api/user/machine/${ai.id}/show-password`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({adminPassword:t7})});if(401===t.status){let e=await t.json();"Invalid admin password"===e.error?ae("Invalid admin password. Please try again."):(localStorage.removeItem("authToken"),er.push("/login"));return}if(!t.ok){let e=await t.json();ae(e.error||"Failed to retrieve passwords");return}let a=await t.json();ar({userPassword:a.data.userPassword,supervisorPassword:a.data.supervisorPassword}),t9("")}catch(e){console.error("Error retrieving passwords:",e),ae("Failed to retrieve passwords. Please try again.")}finally{aa(!1)}},aR=()=>{t6(!1),t9(""),ae(""),ar(null),an(null)},aV=async e=>{if(e.preventDefault(),eJ){if(tr(""),Object.values(eH).some(e=>""!==e))return void tr("Please fix password validation errors before submitting");if(!eZ.userPassword&&!eZ.supervisorPassword)return void tr("At least one password must be provided");if(eZ.userPassword&&!eZ.confirmUserPassword)return void tr("Please confirm the user password");if(eZ.userPassword&&eZ.confirmUserPassword&&eZ.userPassword!==eZ.confirmUserPassword)return void tr("User passwords do not match");if(eZ.supervisorPassword&&!eZ.confirmSupervisorPassword)return void tr("Please confirm the supervisor password");if(eZ.supervisorPassword&&eZ.confirmSupervisorPassword&&eZ.supervisorPassword!==eZ.confirmSupervisorPassword)return void tr("Supervisor passwords do not match");if(eZ.userPassword){let e=ao(eZ.userPassword);if(e)return void tr(`User password: ${e}`)}if(eZ.supervisorPassword){let e=ao(eZ.supervisorPassword);if(e)return void tr(`Supervisor password: ${e}`)}if(tY&&0===t1.size)return void tr("Please select at least one machine to apply passwords to");e0(!0),tr("");try{let e=localStorage.getItem("authToken");if(!e)return void er.push("/login");let t=await fetch(`/api/user/machine/${eJ.id}/password`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({userPassword:eZ.userPassword||null,supervisorPassword:eZ.supervisorPassword||null})});if(401===t.status){localStorage.removeItem("authToken"),er.push("/login");return}if(!t.ok){let e=await t.json(),a=e.error||e.message||"Failed to update passwords";tr(a),e0(!1);return}if(tY&&t1.size>0){let t=Array.from(t1).map(async t=>(await fetch(`/api/user/machine/${t}/password`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({userPassword:eZ.userPassword||null,supervisorPassword:eZ.supervisorPassword||null})})).ok);await Promise.all(t),tn(`Passwords updated for master machine and ${t1.size} other machine(s)!`)}else tn("Machine passwords updated successfully!");await af(),az(),setTimeout(()=>tn(""),3e3)}catch(e){console.error("Error updating passwords:",e),tr("Failed to update passwords. Please try again.")}finally{e0(!1)}}},aq=eo.filter(e=>{let t="all"===e2||e.status===e2,a=ed.find(t=>t.id===e.societyId),s=a?.bmc_id?ex.find(e=>e.id===a.bmc_id):null,r=s?.dairyFarmId?em.find(e=>e.id===s.dairyFarmId):null,i=0===e5.length||e5.includes(r?.id.toString()||""),n=0===e7.length||e7.includes(s?.id.toString()||""),o=0===e8.length||e8.includes(e.societyId?.toString()||""),l=0===tt.length||tt.includes(e.id?.toString()||""),d=e1.toLowerCase().trim(),c=""===d||[e.machineId,e.machineType,e.societyName,e.societyIdentifier,e.location,e.operatorName,e.contactPhone,e.notes].some(e=>e?.toString().toLowerCase().includes(d));return t&&i&&n&&o&&l&&c}),aW=(0,a.useMemo)(()=>{let e=new Set(eo.filter(e=>{let t="all"===e2||e.status===e2,a=0===tt.length||tt.includes(e.id?.toString()||""),s=e1.toLowerCase().trim(),r=""===s||[e.machineId,e.machineType,e.societyName,e.societyIdentifier,e.location,e.operatorName,e.contactPhone,e.notes].some(e=>e?.toString().toLowerCase().includes(s));return t&&a&&r}).map(e=>e.societyId).filter(Boolean));return ed.filter(t=>e.has(t.id))},[eo,ed,e1,e2,tt]);return(0,t.jsxs)(t.Fragment,{children:[tP&&(0,t.jsx)("div",{className:"fixed bottom-6 right-6 z-50 bg-white dark:bg-gray-800 rounded-lg shadow-2xl border border-gray-200 dark:border-gray-700 p-4 min-w-[320px] max-w-sm",children:(0,t.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)(B.FlowerSpinner,{size:24})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white mb-1",children:"Updating status..."}),(0,t.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-2",children:"Please wait"}),(0,t.jsx)("div",{className:"relative w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:(0,t.jsx)("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 to-cyan-500 transition-all duration-300 ease-out",style:{width:`${tT}%`}})}),(0,t.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 text-right",children:[tT,"%"]})]})]})}),(0,t.jsxs)("div",{className:"p-3 xs:p-4 sm:p-6 lg:p-8 space-y-3 xs:space-y-4 sm:space-y-6 lg:pb-8",children:[(0,t.jsx)(ee.ManagementPageHeader,{title:"Machine Management",subtitle:"Manage dairy equipment and machinery across societies",icon:(0,t.jsx)(o.Settings,{className:"w-5 h-5 sm:w-6 sm:h-6 text-white"}),onRefresh:af,onStatistics:()=>er.push("/admin/machine/statistics"),hasData:aq.length>0}),(0,t.jsx)(Q.StatusMessage,{success:ti,error:ts}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-3 sm:gap-4",children:[(0,t.jsxs)("div",{onClick:()=>to.topCollector&&ab("quantity"),className:`bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 p-4 rounded-lg border border-green-200 dark:border-green-700 ${to.topCollector?"hover:shadow-lg cursor-pointer":"opacity-60"} transition-shadow`,children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-green-900 dark:text-green-100",children:"Top Collector (30d)"}),(0,t.jsx)(P.Droplets,{className:"w-5 h-5 text-green-600 dark:text-green-400"})]}),to.topCollector?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-lg font-bold text-green-800 dark:text-green-200 truncate",children:to.topCollector.machine.machineId}),(0,t.jsx)("p",{className:"text-xs text-green-700 dark:text-green-300 truncate",children:to.topCollector.machine.machineType}),to.topCollector.machine.societyName&&(0,t.jsx)("p",{className:"text-xs text-green-600 dark:text-green-400 truncate",children:to.topCollector.machine.societyName}),(0,t.jsxs)("p",{className:"text-sm font-semibold text-green-600 dark:text-green-400 mt-1",children:[to.topCollector.totalQuantity.toFixed(2)," L"]})]}):(0,t.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"No data available"})]}),(0,t.jsxs)("div",{onClick:()=>to.mostTests&&ab("tests"),className:`bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 p-4 rounded-lg border border-purple-200 dark:border-purple-700 ${to.mostTests?"hover:shadow-lg cursor-pointer":"opacity-60"} transition-shadow`,children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-purple-900 dark:text-purple-100",children:"Most Tests (30d)"}),(0,t.jsx)(M.BarChart3,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})]}),to.mostTests?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-lg font-bold text-purple-800 dark:text-purple-200 truncate",children:to.mostTests.machine.machineId}),(0,t.jsx)("p",{className:"text-xs text-purple-700 dark:text-purple-300 truncate",children:to.mostTests.machine.machineType}),to.mostTests.machine.societyName&&(0,t.jsx)("p",{className:"text-xs text-purple-600 dark:text-purple-400 truncate",children:to.mostTests.machine.societyName}),(0,t.jsxs)("p",{className:"text-sm font-semibold text-purple-600 dark:text-purple-400 mt-1",children:[to.mostTests.totalTests," Tests"]})]}):(0,t.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"No data available"})]}),(0,t.jsxs)("div",{onClick:()=>to.bestCleaning&&ab("cleaning"),className:`bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 p-4 rounded-lg border border-orange-200 dark:border-orange-700 ${to.bestCleaning?"hover:shadow-lg cursor-pointer":"opacity-60"} transition-shadow`,children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-orange-900 dark:text-orange-100",children:"Best Cleaning (30d)"}),(0,t.jsx)(T.Award,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})]}),to.bestCleaning?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-lg font-bold text-orange-800 dark:text-orange-200 truncate",children:to.bestCleaning.machine.machineId}),(0,t.jsx)("p",{className:"text-xs text-orange-700 dark:text-orange-300 truncate",children:to.bestCleaning.machine.machineType}),to.bestCleaning.machine.societyName&&(0,t.jsx)("p",{className:"text-xs text-orange-600 dark:text-orange-400 truncate",children:to.bestCleaning.machine.societyName}),(0,t.jsxs)("p",{className:"text-sm font-semibold text-orange-600 dark:text-orange-400 mt-1",children:[to.bestCleaning.totalCleanings," Cleanings"]})]}):(0,t.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"No data available"})]}),(0,t.jsxs)("div",{onClick:()=>to.mostCleaningSkip&&ab("skip"),className:`bg-gradient-to-br from-red-50 to-red-100 dark:from-red-900/20 dark:to-red-800/20 p-4 rounded-lg border border-red-200 dark:border-red-700 ${to.mostCleaningSkip?"hover:shadow-lg cursor-pointer":"opacity-60"} transition-shadow`,children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-red-900 dark:text-red-100",children:"Most Cleaning Skip (30d)"}),(0,t.jsx)(u.AlertTriangle,{className:"w-5 h-5 text-red-600 dark:text-red-400"})]}),to.mostCleaningSkip?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-lg font-bold text-red-800 dark:text-red-200 truncate",children:to.mostCleaningSkip.machine.machineId}),(0,t.jsx)("p",{className:"text-xs text-red-700 dark:text-red-300 truncate",children:to.mostCleaningSkip.machine.machineType}),to.mostCleaningSkip.machine.societyName&&(0,t.jsx)("p",{className:"text-xs text-red-600 dark:text-red-400 truncate",children:to.mostCleaningSkip.machine.societyName}),(0,t.jsxs)("p",{className:"text-sm font-semibold text-red-600 dark:text-red-400 mt-1",children:[to.mostCleaningSkip.totalSkips," Skips"]})]}):(0,t.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"No data available"})]}),(0,t.jsxs)("div",{onClick:()=>to.activeToday&&ab("today"),className:`bg-gradient-to-br from-pink-50 to-pink-100 dark:from-pink-900/20 dark:to-pink-800/20 p-4 rounded-lg border border-pink-200 dark:border-pink-700 ${to.activeToday?"hover:shadow-lg cursor-pointer":"opacity-60"} transition-shadow`,children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-pink-900 dark:text-pink-100",children:"Active Today"}),(0,t.jsx)(v.Clock,{className:"w-5 h-5 text-pink-600 dark:text-pink-400"})]}),to.activeToday?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-lg font-bold text-pink-800 dark:text-pink-200 truncate",children:to.activeToday.machine.machineId}),(0,t.jsx)("p",{className:"text-xs text-pink-700 dark:text-pink-300 truncate",children:to.activeToday.machine.machineType}),to.activeToday.machine.societyName&&(0,t.jsx)("p",{className:"text-xs text-pink-600 dark:text-pink-400 truncate",children:to.activeToday.machine.societyName}),(0,t.jsxs)("p",{className:"text-sm font-semibold text-pink-600 dark:text-pink-400 mt-1",children:[to.activeToday.collectionsToday," Today"]})]}):(0,t.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"No data available"})]}),(0,t.jsxs)("div",{onClick:()=>to.highestUptime&&ab("uptime"),className:`bg-gradient-to-br from-indigo-50 to-indigo-100 dark:from-indigo-900/20 dark:to-indigo-800/20 p-4 rounded-lg border border-indigo-200 dark:border-indigo-700 ${to.highestUptime?"hover:shadow-lg cursor-pointer":"opacity-60"} transition-shadow`,children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-indigo-900 dark:text-indigo-100",children:"Highest Uptime (30d)"}),(0,t.jsx)(I.TrendingUp,{className:"w-5 h-5 text-indigo-600 dark:text-indigo-400"})]}),to.highestUptime?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-lg font-bold text-indigo-800 dark:text-indigo-200 truncate",children:to.highestUptime.machine.machineId}),(0,t.jsx)("p",{className:"text-xs text-indigo-700 dark:text-indigo-300 truncate",children:to.highestUptime.machine.machineType}),to.highestUptime.machine.societyName&&(0,t.jsx)("p",{className:"text-xs text-indigo-600 dark:text-indigo-400 truncate",children:to.highestUptime.machine.societyName}),(0,t.jsxs)("p",{className:"text-sm font-semibold text-indigo-600 dark:text-indigo-400 mt-1",children:[to.highestUptime.activeDays," Days"]})]}):(0,t.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"No data available"})]})]}),(0,t.jsx)(ea.StatsGrid,{allItems:eo,filteredItems:aq,hasFilters:"all"!==e2||e5.length>0||e7.length>0||e8.length>0||tt.length>0,onStatusFilterChange:e=>e3(e),currentStatusFilter:e2}),(0,t.jsx)(et.FilterDropdown,{statusFilter:e2,onStatusChange:e=>e3(e),dairyFilter:e5,onDairyChange:e=>e6(Array.isArray(e)?e:[e]),bmcFilter:e7,onBmcChange:e=>e9(Array.isArray(e)?e:[e]),societyFilter:e8,onSocietyChange:e=>te(Array.isArray(e)?e:[e]),machineFilter:tt,onMachineChange:e=>ta(Array.isArray(e)?e:[e]),dairies:em,bmcs:ex,societies:aW,machines:eo,filteredCount:aq.length,totalCount:eo.length,searchQuery:e1,onSearchChange:e4,icon:(0,t.jsx)(o.Settings,{className:"w-5 h-5"}),hideMainFilterButton:!0}),aq.length>0&&(0,t.jsxs)("div",{className:"flex flex-col xs:flex-row items-start xs:items-center justify-between gap-3 bg-white dark:bg-gray-800 p-3 sm:p-4 rounded-lg border border-gray-200 dark:border-gray-700",children:[(0,t.jsxs)("label",{className:"flex items-center space-x-3 cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",checked:tS,onChange:()=>{tS?(tN(new Set),tk(new Set),tC(!1)):(tN(new Set(aq.map(e=>e.id))),tk(new Set(aq.reduce((e,t)=>{let a=t.societyId||0;return e.includes(a)||e.push(a),e},[]))),tC(!0))},className:"w-4 h-4 text-green-600 bg-gray-100 border-gray-300 rounded focus:ring-green-500 dark:focus:ring-green-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"}),(0,t.jsxs)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Select All ",aq.length," ",1===aq.length?"machine":"machines",("all"!==e2||e5.length>0||e7.length>0||e8.length>0||tt.length>0)&&" (filtered)"]})]}),(0,t.jsx)("div",{className:"flex items-center gap-3",children:(0,t.jsx)(Y.ViewModeToggle,{viewMode:tf,onViewModeChange:tw,folderLabel:"Folder View",listLabel:"Grid View"})})]}),ey?(0,t.jsx)("div",{className:"flex items-center justify-center py-12 sm:py-20",children:(0,t.jsx)(B.FlowerSpinner,{size:40})}):aq.length>0?"folder"===tf?(0,t.jsx)("div",{className:"space-y-4",children:Object.values(aq.reduce((e,t)=>{let a=t.societyId||0,s=t.societyName||"Unassigned",r=t.societyIdentifier||"N/A";return e[a]||(e[a]={id:a,name:s,identifier:r,machines:[]}),e[a].machines.push(t),e},{})).sort((e,t)=>e.name.localeCompare(t.name)).map(e=>{let a=ty.has(e.id),s=e.machines.length,r=e.machines.filter(e=>"active"===e.status).length,i=e.machines.filter(e=>"inactive"===e.status).length,n=e.machines.filter(e=>"maintenance"===e.status).length,o=tj.has(e.id),h=e.machines.map(e=>e.id);return(0,t.jsxs)("div",{className:`relative bg-white dark:bg-gray-800 rounded-lg border-2 transition-colors hover:z-10 ${o?"border-blue-500 dark:border-blue-400":"border-gray-200 dark:border-gray-700"}`,children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{onClick:t=>{var a;t.stopPropagation(),a=e.id,tk(e=>{let t=new Set(e);return t.has(a)?(t.delete(a),tN(e=>{let t=new Set(e);return h.forEach(e=>t.delete(e)),tC(!1),t})):(t.add(a),tN(e=>{let t=new Set(e);return h.forEach(e=>t.add(e)),Array.from(new Set(aq.map(e=>e.id))).every(e=>t.has(e))&&tC(!0),t})),t})},className:"flex items-center justify-center p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors cursor-pointer",children:(0,t.jsx)("input",{type:"checkbox",checked:o,onChange:()=>{},className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600 cursor-pointer"})}),(0,t.jsxs)("button",{onClick:()=>{var t;return t=e.id,void tb(e=>{let a=new Set(e);return a.has(t)?a.delete(t):a.add(t),a})},className:"flex-1 flex items-center justify-between p-4 pl-0 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[a?(0,t.jsx)(j.ChevronDown,{className:"w-5 h-5 text-gray-500 dark:text-gray-400"}):(0,t.jsx)(w.ChevronRight,{className:"w-5 h-5 text-gray-500 dark:text-gray-400"}),a?(0,t.jsx)(f.FolderOpen,{className:"w-5 h-5 text-green-600 dark:text-green-400"}):(0,t.jsx)(b.Folder,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),(0,t.jsxs)("div",{className:"text-left",children:[(0,t.jsx)("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white",children:e.name}),(0,t.jsxs)("p",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400",children:["ID: ",e.identifier]})]})]}),(0,t.jsx)("div",{className:"flex items-center space-x-4",children:(0,t.jsx)("div",{className:"flex items-center space-x-2",children:(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2 text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:[(0,t.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-green-500"}),(0,t.jsx)("span",{children:r})]}),(0,t.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-red-500"}),(0,t.jsx)("span",{children:i})]}),n>0&&(0,t.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-blue-500"}),(0,t.jsx)("span",{children:n})]})]}),(0,t.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[s," ",1===s?"machine":"machines"]})]})})})]})]}),a&&(0,t.jsx)("div",{className:"border-t border-gray-200 dark:border-gray-700 p-4 bg-gray-50 dark:bg-gray-900/30",children:(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:e.machines.map(a=>{let s,r;return(0,t.jsx)("div",{className:"relative hover:z-20",children:(0,t.jsx)(G.ItemCard,{id:a.id,name:a.machineId,identifier:a.machineType,status:a.status,icon:(0,t.jsx)(x.Wrench,{className:"w-4 h-4 sm:w-5 sm:h-5 text-green-600 dark:text-green-400"}),showStatus:!0,badge:a.isMasterMachine?{text:"Master",color:"bg-gradient-to-r from-yellow-400 to-amber-500 text-gray-900 border-yellow-600",onClick:()=>ad(e.id)}:void 0,selectable:!0,selected:tv.has(a.id),onSelect:()=>aP(a.id),onPasswordSettings:()=>aD(a),searchQuery:e1,details:[...a.location?[{icon:(0,t.jsx)(l.MapPin,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),text:a.location}]:[],...a.operatorName?[{icon:(0,t.jsx)(c.User,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),text:a.operatorName}]:[],...a.contactPhone?[{icon:(0,t.jsx)(d.Phone,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),text:a.contactPhone}]:[],...a.installationDate?[{icon:(0,t.jsx)(m.Calendar,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),text:`Installed: ${new Date(a.installationDate).toLocaleDateString()}`}]:[],{icon:(0,t.jsx)("div",{className:"flex items-center gap-1",children:(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-blue-500"})}),text:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("span",{className:"text-xs font-medium text-blue-600 dark:text-blue-400",children:[a.totalCollections30d||0," Collections"]}),(0,t.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"|"}),(0,t.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:[(a.totalQuantity30d||0).toFixed(2)," L"]})]}),className:"text-blue-600 dark:text-blue-400"},...(()=>{let{pending:e,downloaded:s}=al(a.chartDetails),r=[];return e.length>0&&r.push({icon:(0,t.jsx)("div",{className:"flex items-center gap-1",children:(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-amber-500 dark:bg-amber-400 animate-pulse"})}),text:(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5",children:[(0,t.jsx)("span",{className:"text-xs font-medium text-amber-600 dark:text-amber-400",children:"Ready:"}),e.map((e,s)=>(0,t.jsx)("button",{onClick:()=>ax(e.fileName,e.channel,a.societyId),className:`px-1.5 py-0.5 rounded text-xs font-medium ${am(e.channel)} hover:opacity-80 transition-opacity cursor-pointer`,children:e.channel},s))]}),className:"text-amber-600 dark:text-amber-400"}),s.length>0&&r.push({icon:(0,t.jsx)(C.CheckCircle,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),text:(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5",children:[(0,t.jsx)("span",{className:"text-xs font-medium",children:"Downloaded:"}),s.map((e,s)=>(0,t.jsx)("button",{onClick:()=>ax(e.fileName,e.channel,a.societyId),className:`px-1.5 py-0.5 rounded text-xs font-medium ${am(e.channel)} hover:opacity-80 transition-opacity cursor-pointer`,children:e.channel},s))]}),className:"text-green-600 dark:text-green-400"}),r})(),(s=aF(a.statusU,a.statusS,a.userPassword,a.supervisorPassword),r=a.userPassword&&""!==a.userPassword.trim()||a.supervisorPassword&&""!==a.supervisorPassword.trim(),{icon:s.icon,text:r?(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{children:s.text}),(0,t.jsxs)("button",{onClick:e=>{e.stopPropagation(),aB(a)},className:"inline-flex items-center gap-1 px-2 py-0.5 text-xs font-medium bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-colors",children:[(0,t.jsx)(S.Eye,{className:"w-3 h-3"}),"Show"]})]}):s.text,className:s.className})],onEdit:()=>aL(a),onDelete:()=>a$(a),onView:()=>er.push(`/admin/machine/${a.id}`),onStatusChange:e=>aM(a,e),viewText:"View"})},a.id)})})})]},e.id)})}):(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-6",children:aq.map(e=>{let a,s;return(0,t.jsx)(G.ItemCard,{id:e.id,name:e.machineId,identifier:e.machineType,status:e.status,icon:(0,t.jsx)(x.Wrench,{className:"w-4 h-4 sm:w-5 sm:h-5 text-green-600 dark:text-green-400"}),showStatus:!0,badge:e.isMasterMachine?{text:"Master",color:"bg-gradient-to-r from-yellow-400 to-amber-500 text-gray-900 border-yellow-600",onClick:()=>ad(e.societyId)}:void 0,selectable:!0,selected:tv.has(e.id),onSelect:()=>aP(e.id),onPasswordSettings:()=>aD(e),searchQuery:e1,details:[...e.societyName?[{icon:(0,t.jsx)(h.Building2,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),text:e.societyIdentifier?`${e.societyName} (${e.societyIdentifier})`:e.societyName,highlight:!0}]:[],...e.location?[{icon:(0,t.jsx)(l.MapPin,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),text:e.location}]:[],...e.operatorName?[{icon:(0,t.jsx)(c.User,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),text:e.operatorName}]:[],...e.contactPhone?[{icon:(0,t.jsx)(d.Phone,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),text:e.contactPhone}]:[],...e.installationDate?[{icon:(0,t.jsx)(m.Calendar,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),text:`Installed: ${new Date(e.installationDate).toLocaleDateString()}`}]:[],{icon:(0,t.jsx)("div",{className:"flex items-center gap-1",children:(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-blue-500"})}),text:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("span",{className:"text-xs font-medium text-blue-600 dark:text-blue-400",children:[e.totalCollections30d||0," Collections"]}),(0,t.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"|"}),(0,t.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:[(e.totalQuantity30d||0).toFixed(2)," L"]})]}),className:"text-blue-600 dark:text-blue-400"},...(()=>{let{pending:a,downloaded:s}=al(e.chartDetails),r=[];return a.length>0&&r.push({icon:(0,t.jsx)("div",{className:"flex items-center gap-1",children:(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-amber-500 dark:bg-amber-400 animate-pulse"})}),text:(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5",children:[(0,t.jsx)("span",{className:"text-xs font-medium text-amber-600 dark:text-amber-400",children:"Ready:"}),a.map((a,s)=>(0,t.jsx)("button",{onClick:()=>ax(a.fileName,a.channel,e.societyId),className:`px-1.5 py-0.5 rounded text-xs font-medium ${am(a.channel)} hover:opacity-80 transition-opacity cursor-pointer`,children:a.channel},s))]}),className:"text-amber-600 dark:text-amber-400"}),s.length>0&&r.push({icon:(0,t.jsx)(C.CheckCircle,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),text:(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5",children:[(0,t.jsx)("span",{className:"text-xs font-medium",children:"Downloaded:"}),s.map((a,s)=>(0,t.jsx)("button",{onClick:()=>ax(a.fileName,a.channel,e.societyId),className:`px-1.5 py-0.5 rounded text-xs font-medium ${am(a.channel)} hover:opacity-80 transition-opacity cursor-pointer`,children:a.channel},s))]}),className:"text-green-600 dark:text-green-400"}),r})(),(a=aF(e.statusU,e.statusS,e.userPassword,e.supervisorPassword),s=e.userPassword&&""!==e.userPassword.trim()||e.supervisorPassword&&""!==e.supervisorPassword.trim(),{icon:a.icon,text:s?(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{children:a.text}),(0,t.jsxs)("button",{onClick:t=>{t.stopPropagation(),aB(e)},className:"inline-flex items-center gap-1 px-2 py-0.5 text-xs font-medium bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-colors",children:[(0,t.jsx)(S.Eye,{className:"w-3 h-3"}),"Show"]})]}):a.text,className:a.className})],onEdit:()=>aL(e),onDelete:()=>a$(e),onView:()=>er.push(`/admin/machine/${e.id}`),onStatusChange:t=>aM(e,t),viewText:"View"},e.id)})}):(0,t.jsx)(K.EmptyState,{icon:(0,t.jsx)(o.Settings,{className:"w-12 h-12 sm:w-16 sm:h-16 text-gray-400"}),title:"No machines found",message:"all"===e2?"You haven't added any machines yet. Click 'Add Machine' to get started.":`No machines found with status: ${e2}`,actionText:"all"===e2?"Add Your First Machine":void 0,onAction:"all"===e2?aA:void 0,showAction:"all"===e2})]}),(0,t.jsx)(O.FormModal,{isOpen:ev,onClose:aU,title:"Add New Machine",maxWidth:"lg",children:(0,t.jsxs)("form",{onSubmit:aN,className:"space-y-4 sm:space-y-6",children:[(0,t.jsxs)(W.FormGrid,{children:[(0,t.jsx)(R.FormInput,{label:"Machine ID",value:eG.machineId,onChange:e=>{let t=e.replace(/[^a-zA-Z0-9]/g,"").replace(/^([a-zA-Z])[a-zA-Z]+/,"$1").replace(/^([a-zA-Z])(\d*).*/,"$1$2").toUpperCase().slice(0,10);eK({...eG,machineId:t})},placeholder:"e.g., M2232, S3232",required:!0,error:tg.machineId,colSpan:2}),(0,t.jsx)(V.FormSelect,{label:"Machine Type",value:eG.machineType,onChange:e=>eK({...eG,machineType:e}),options:eg.map(e=>({value:e.machineType,label:e.machineType})),placeholder:"Select Machine Type",required:!0,disabled:ej,error:tg.machineType}),(0,t.jsx)(V.FormSelect,{label:"Society",value:eG.societyId,onChange:e=>{console.log("Society selected:",e,"Type:",typeof e),eK({...eG,societyId:e}),(e=>{if(console.log("checkMasterMachineStatus called with:",e),!e){tz(!1),tO(null),tV(!1);return}let t=eo.filter(t=>t.societyId===parseInt(e)),a=t.find(e=>e.isMasterMachine);console.log("Society machines:",t.length,"Master:",a?.machineId),tV(0===t.length),tz(!!a),tO(a?a.machineId:null),0===t.length?eK(e=>({...e,setAsMaster:!0})):eK(e=>({...e,setAsMaster:!1}))})(e)},options:ed.map(e=>({value:e.id,label:`${e.name} (${e.society_id})`})),placeholder:"Select Society",required:!0,disabled:ef,error:tg.societyId}),(0,t.jsx)(R.FormInput,{label:"Location",value:eG.location,onChange:e=>eK({...eG,location:e}),placeholder:"Installation location"}),(0,t.jsx)(R.FormInput,{label:"Installation Date",type:"date",value:eG.installationDate,onChange:e=>eK({...eG,installationDate:e})}),(0,t.jsx)(R.FormInput,{label:"Operator Name",value:eG.operatorName,onChange:e=>eK({...eG,operatorName:e}),placeholder:"Machine operator name"}),(0,t.jsx)(R.FormInput,{label:"Contact Phone",type:"tel",value:eG.contactPhone,onChange:e=>{let t=(0,n.formatPhoneInput)(e);eK({...eG,contactPhone:t})},onBlur:()=>{let e=(0,n.validatePhoneOnBlur)(eG.contactPhone);if(e)tp(t=>({...t,contactPhone:e}));else{let{contactPhone:e,...t}=tg;tp(t)}},placeholder:"Operator contact number",error:tg.contactPhone}),(0,t.jsx)(V.FormSelect,{label:"Status",value:eG.status,onChange:e=>eK({...eG,status:e}),options:[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"maintenance",label:"Under Maintenance"},{value:"suspended",label:"Suspended"}]}),(0,t.jsx)(R.FormInput,{label:"Notes",type:"text",value:eG.notes,onChange:e=>eK({...eG,notes:e}),placeholder:"Additional notes or comments...",colSpan:2}),""!==eG.societyId&&(0,t.jsx)("div",{className:"sm:col-span-2",children:(0,t.jsx)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("input",{type:"checkbox",id:"setAsMaster",checked:eG.setAsMaster,onChange:e=>eK({...eG,setAsMaster:e.target.checked}),disabled:tR,className:"mt-1 w-4 h-4 text-yellow-600 border-gray-300 rounded focus:ring-yellow-500 disabled:opacity-50"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("label",{htmlFor:"setAsMaster",className:"text-sm font-medium text-gray-900 dark:text-gray-100 cursor-pointer",children:"Set as Master Machine"}),tR?(0,t.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:"This is the first machine for this society and will automatically be set as master"}):tE&&eG.setAsMaster?(0,t.jsxs)("p",{className:"text-xs text-yellow-700 dark:text-yellow-400 mt-1 font-medium",children:["âš ï¸ Warning: This will replace the current master machine (",tB,") with this one"]}):(0,t.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:"Master machine passwords will be inherited by all machines in this society"})]})]})})}),""!==eG.societyId&&!eG.setAsMaster&&tE&&!tR&&(0,t.jsx)("div",{className:"sm:col-span-2",children:(0,t.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)("svg",{className:"w-5 h-5 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h4",{className:"text-sm font-semibold text-blue-900 dark:text-blue-100 mb-1",children:"Password Inheritance Enabled"}),(0,t.jsxs)("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:["This machine will automatically inherit user and supervisor passwords from the master machine (",(0,t.jsx)("strong",{children:tB}),"). The passwords will be set when the machine is created, and you can update them later if needed."]}),(0,t.jsxs)("div",{className:"mt-2 text-xs text-blue-600 dark:text-blue-400",children:[(0,t.jsx)("strong",{children:"Note:"})," Password status (enabled/disabled) will also be inherited from the master machine."]})]})]})})}),""!==eG.societyId&&!eG.setAsMaster&&tE&&!tR&&(0,t.jsx)("div",{className:"sm:col-span-2",children:(0,t.jsxs)("div",{className:"flex items-start gap-3 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[(0,t.jsx)("input",{type:"checkbox",id:"disablePasswordInheritance",checked:eG.disablePasswordInheritance,onChange:e=>eK({...eG,disablePasswordInheritance:e.target.checked}),className:"mt-1 w-4 h-4 text-primary-600 bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded focus:ring-primary-500 focus:ring-2"}),(0,t.jsxs)("label",{htmlFor:"disablePasswordInheritance",className:"flex-1 cursor-pointer",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-1",children:"Do not inherit passwords from master machine"}),(0,t.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Check this if you want to set passwords manually later instead of using the master machine's passwords"})]})]})}),""!==eG.societyId&&!eG.setAsMaster&&!tE&&!tR&&(0,t.jsx)("div",{className:"sm:col-span-2",children:(0,t.jsx)("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-300 dark:border-amber-700 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)("svg",{className:"w-5 h-5 text-amber-600 dark:text-amber-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h4",{className:"text-sm font-semibold text-amber-900 dark:text-amber-100 mb-1",children:"No Master Machine Found"}),(0,t.jsx)("p",{className:"text-xs text-amber-700 dark:text-amber-300",children:"This society has machines but no master machine is designated. Passwords will not be inherited automatically. Consider setting this machine as master or designate an existing machine as master first."})]})]})})})]}),(0,t.jsx)(J.FormError,{error:ts}),(0,t.jsx)(q.FormActions,{onCancel:aU,submitText:"Add Machine",isLoading:eY,isSubmitDisabled:!eG.machineId||!eG.machineType||!eG.societyId})]})}),(0,t.jsx)(O.FormModal,{isOpen:eS&&!!eJ,onClose:aE,title:"Edit Machine",maxWidth:"lg",children:(0,t.jsxs)("form",{onSubmit:aS,className:"space-y-4 sm:space-y-6",children:[(0,t.jsxs)(W.FormGrid,{children:[(0,t.jsx)(R.FormInput,{label:"Machine ID",value:eG.machineId,onChange:e=>eK({...eG,machineId:e}),placeholder:"e.g., M2232, S3232",required:!0,error:tg.machineId,colSpan:2}),(0,t.jsx)(V.FormSelect,{label:"Machine Type",value:eG.machineType,onChange:e=>eK({...eG,machineType:e}),options:eg.map(e=>({value:e.machineType,label:e.machineType})),placeholder:"Select Machine Type",required:!0,disabled:ej,error:tg.machineType}),(0,t.jsx)(V.FormSelect,{label:"Society",value:eG.societyId,onChange:e=>eK({...eG,societyId:e}),options:ed.map(e=>({value:e.id,label:`${e.name} (${e.society_id})`})),placeholder:"Select Society",required:!0,disabled:ef,error:tg.societyId}),(0,t.jsx)(R.FormInput,{label:"Location",value:eG.location,onChange:e=>eK({...eG,location:e}),placeholder:"Installation location"}),(0,t.jsx)(R.FormInput,{label:"Installation Date",type:"date",value:eG.installationDate,onChange:e=>eK({...eG,installationDate:e})}),(0,t.jsx)(R.FormInput,{label:"Operator Name",value:eG.operatorName,onChange:e=>eK({...eG,operatorName:e}),placeholder:"Machine operator name"}),(0,t.jsx)(R.FormInput,{label:"Contact Phone",type:"tel",value:eG.contactPhone,onChange:e=>{let t=(0,n.formatPhoneInput)(e);eK({...eG,contactPhone:t})},onBlur:()=>{let e=(0,n.validatePhoneOnBlur)(eG.contactPhone);if(e)tp(t=>({...t,contactPhone:e}));else{let{contactPhone:e,...t}=tg;tp(t)}},placeholder:"Operator contact number",error:tg.contactPhone}),(0,t.jsx)(V.FormSelect,{label:"Status",value:eG.status,onChange:e=>eK({...eG,status:e}),options:[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"maintenance",label:"Under Maintenance"},{value:"suspended",label:"Suspended"}]}),(0,t.jsx)(R.FormInput,{label:"Notes",type:"text",value:eG.notes,onChange:e=>eK({...eG,notes:e}),placeholder:"Additional notes or comments...",colSpan:2})]}),(0,t.jsx)(J.FormError,{error:ts}),(0,t.jsx)(q.FormActions,{onCancel:aE,submitText:"Update Machine",isLoading:eY,isSubmitDisabled:!eG.machineId||!eG.machineType||!eG.societyId})]})}),(0,t.jsx)(O.FormModal,{isOpen:eT&&!!eJ,onClose:az,title:`Password Settings - ${eJ?.machineId||""}`,children:(0,t.jsxs)("form",{onSubmit:aV,className:"space-y-4 sm:space-y-6",children:[(0,t.jsxs)(W.FormGrid,{children:[(0,t.jsx)(R.FormInput,{label:"User Password (6 digits)",type:"password",value:eZ.userPassword,onChange:e=>ag({userPassword:e}),placeholder:"Enter 6-digit code",maxLength:6,pattern:"[0-9]*",inputMode:"numeric",error:eH.userPassword,colSpan:2}),(0,t.jsx)(R.FormInput,{label:"Confirm User Password",type:"password",value:eZ.confirmUserPassword,onChange:e=>ag({confirmUserPassword:e}),placeholder:"Re-enter 6-digit code",maxLength:6,pattern:"[0-9]*",inputMode:"numeric",error:eH.confirmUserPassword,colSpan:2}),(0,t.jsx)(R.FormInput,{label:"Supervisor Password (6 digits)",type:"password",value:eZ.supervisorPassword,onChange:e=>ag({supervisorPassword:e}),placeholder:"Enter 6-digit code",maxLength:6,pattern:"[0-9]*",inputMode:"numeric",error:eH.supervisorPassword,colSpan:2}),(0,t.jsx)(R.FormInput,{label:"Confirm Supervisor Password",type:"password",value:eZ.confirmSupervisorPassword,onChange:e=>ag({confirmSupervisorPassword:e}),placeholder:"Re-enter 6-digit code",maxLength:6,pattern:"[0-9]*",inputMode:"numeric",error:eH.confirmSupervisorPassword,colSpan:2})]}),eJ?.isMasterMachine&&(0,t.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[(0,t.jsxs)("div",{className:"flex items-start gap-3 mb-4",children:[(0,t.jsx)("input",{type:"checkbox",id:"applyPasswordsToOthers",checked:tY,onChange:e=>{t0(e.target.checked),e.target.checked||(t4(new Set),t3(!1))},className:"mt-1 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("label",{htmlFor:"applyPasswordsToOthers",className:"text-sm font-medium text-gray-900 dark:text-gray-100 cursor-pointer",children:"Apply these passwords to other machines in this society"}),(0,t.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:"Select machines below to update their passwords with the same values"})]})]}),tY&&eJ&&(0,t.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 max-h-64 overflow-y-auto",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Select Machines (",t1.size," selected)"]}),(0,t.jsx)("button",{type:"button",onClick:()=>{let e=eo.filter(e=>e.societyId===eJ.societyId&&e.id!==eJ.id);t2?(t4(new Set),t3(!1)):(t4(new Set(e.map(e=>e.id))),t3(!0))},className:"text-xs text-blue-600 dark:text-blue-400 hover:underline",children:t2?"Deselect All":"Select All"})]}),(0,t.jsx)("div",{className:"space-y-2",children:eo.filter(e=>e.societyId===eJ.societyId&&e.id!==eJ.id).map(e=>(0,t.jsxs)("label",{className:"flex items-center gap-3 p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",checked:t1.has(e.id),onChange:t=>{let a=new Set(t1);t.target.checked?a.add(e.id):(a.delete(e.id),t3(!1)),t4(a)},className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:e.machineId}),(0,t.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.machineType})]})]},e.id))}),0===eo.filter(e=>e.societyId===eJ.societyId&&e.id!==eJ.id).length&&(0,t.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-4",children:"No other machines in this society"})]})]}),(0,t.jsx)(J.FormError,{error:ts}),(0,t.jsx)(q.FormActions,{onCancel:az,submitText:"Update Passwords",isLoading:eY,isSubmitDisabled:eY||Object.values(eH).some(e=>""!==e)||!eZ.userPassword&&!eZ.supervisorPassword||!!(eZ.userPassword&&!eZ.confirmUserPassword)||!!(eZ.supervisorPassword&&!eZ.confirmSupervisorPassword)||!!(!eZ.userPassword&&eZ.confirmUserPassword)||!!(!eZ.supervisorPassword&&eZ.confirmSupervisorPassword)})]})}),(0,t.jsx)(Z.ConfirmDeleteModal,{isOpen:eP&&!!eJ,onClose:()=>{eI(!1),eQ(null)},onConfirm:aC,title:"Delete Machine",itemName:eJ?.machineId||"",message:"Are you sure you want to permanently delete machine"}),(0,t.jsx)(O.FormModal,{isOpen:eF&&!!eL,onClose:au,title:`Rate Chart - ${eL?.channel||""} Channel`,maxWidth:"2xl",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"File Name"}),(0,t.jsx)("p",{className:"text-base font-semibold text-gray-900 dark:text-white",children:eL?.fileName})]}),(0,t.jsx)("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${am(eL?.channel||"")}`,children:eL?.channel})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-3 mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Search FAT"}),(0,t.jsx)("input",{type:"text",value:eB,onChange:e=>eO(e.target.value),placeholder:"e.g., 3.5",className:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Search SNF"}),(0,t.jsx)("input",{type:"text",value:eR,onChange:e=>eV(e.target.value),placeholder:"e.g., 8.5",className:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Search CLR"}),(0,t.jsx)("input",{type:"text",value:eq,onChange:e=>eW(e.target.value),placeholder:"e.g., 25.0",className:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]})]}),eE?(0,t.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,t.jsx)(B.FlowerSpinner,{})}):(e=eD.filter(e=>{let t=!eB||e.fat.toLowerCase().includes(eB.toLowerCase()),a=!eR||e.snf.toLowerCase().includes(eR.toLowerCase()),s=!eq||e.clr.toLowerCase().includes(eq.toLowerCase());return t&&a&&s})).length>0?(0,t.jsxs)("div",{className:"overflow-x-auto",children:[(0,t.jsxs)("table",{className:"w-full border-collapse",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-gray-100 dark:bg-gray-700",children:[(0,t.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider border border-gray-300 dark:border-gray-600",children:"FAT"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider border border-gray-300 dark:border-gray-600",children:"SNF"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider border border-gray-300 dark:border-gray-600",children:"CLR"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider border border-gray-300 dark:border-gray-600",children:"Rate"})]})}),(0,t.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:e.map((e,a)=>(0,t.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600",children:e.fat}),(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600",children:e.snf}),(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600",children:e.clr}),(0,t.jsxs)("td",{className:"px-4 py-3 text-sm font-semibold text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600",children:["â‚¹",e.rate]})]},a))})]}),(0,t.jsxs)("div",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400 text-right",children:["Showing ",e.length," of ",eD.length," records"]})]}):(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(k.FileText,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),(0,t.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:eB||eR||eq?"No matching records found":"No data available for this rate chart"})]}),(0,t.jsx)("div",{className:"flex justify-end pt-4",children:(0,t.jsx)("button",{onClick:au,className:"px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:"Close"})})]})}),(0,t.jsx)(O.FormModal,{isOpen:tq,onClose:()=>tW(!1),title:"Change Master Machine",maxWidth:"md",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)("svg",{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h4",{className:"text-sm font-semibold text-yellow-900 dark:text-yellow-100 mb-1",children:"About Master Machine"}),(0,t.jsx)("p",{className:"text-xs text-yellow-700 dark:text-yellow-300",children:"The master machine's passwords are inherited by all other machines in the society. Changing the master will update which machine's passwords are used as the default for new machines."})]})]})}),tJ&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Select New Master Machine ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsxs)("select",{value:tG||"",onChange:e=>tK(e.target.value?parseInt(e.target.value):null),className:"w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:[(0,t.jsx)("option",{value:"",children:"Select a machine"}),eo.filter(e=>e.societyId===tJ).map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.machineId," - ",e.machineType,e.isMasterMachine?" (Current Master)":""]},e.id))]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-3 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[(0,t.jsx)("input",{type:"checkbox",id:"setForAllMachines",checked:tZ,onChange:e=>t_(e.target.checked),className:"mt-1 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("label",{htmlFor:"setForAllMachines",className:"text-sm font-medium text-blue-900 dark:text-blue-100 cursor-pointer",children:"Apply master's passwords to all machines in society"}),(0,t.jsx)("p",{className:"text-xs text-blue-700 dark:text-blue-300 mt-1",children:"If checked, all machines in this society will be updated with the new master machine's passwords immediately."})]})]}),ts&&(0,t.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3",children:(0,t.jsx)("p",{className:"text-sm text-red-700 dark:text-red-300",children:ts})})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,t.jsx)("button",{onClick:()=>tW(!1),disabled:tH,className:"px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors disabled:opacity-50",children:"Cancel"}),(0,t.jsx)("button",{onClick:ac,disabled:tH||!tG,className:"px-4 py-2 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg hover:from-green-700 hover:to-emerald-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:tH?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("svg",{className:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Changing..."]}):"Change Master"})]})]})}),(0,t.jsx)(H.BulkDeleteConfirmModal,{isOpen:tF,itemCount:tv.size,itemType:"machine",onConfirm:aI,onClose:()=>tA(!1)}),(0,t.jsx)(_.BulkActionsToolbar,{selectedCount:tv.size,totalCount:eo.length,onBulkDelete:()=>tA(!0),onBulkStatusUpdate:aT,onClearSelection:()=>{tN(new Set),tk(new Set),tC(!1)},itemType:"machine",showStatusUpdate:!0,currentBulkStatus:tD,onBulkStatusChange:e=>tU(e)}),(0,t.jsx)(X.FloatingActionButton,{actions:[{icon:(0,t.jsx)(N.Plus,{className:"w-6 h-6 text-white"}),label:"Add Machine",onClick:aA,color:"bg-gradient-to-br from-blue-500 to-blue-600"}],directClick:!0}),(0,t.jsx)(O.FormModal,{isOpen:t5&&!!ai,onClose:aR,title:`View Passwords - ${ai?.machineId||""}`,children:as?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(C.CheckCircle,{className:"w-5 h-5 text-green-600 dark:text-green-400 flex-shrink-0 mt-0.5"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-green-800 dark:text-green-200 mb-1",children:"Passwords Retrieved Successfully"}),(0,t.jsxs)("p",{className:"text-xs text-green-700 dark:text-green-300",children:["Machine passwords for ",ai?.machineId]})]})]})}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,t.jsxs)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 flex items-center gap-2",children:[(0,t.jsx)(p.Key,{className:"w-4 h-4"}),"User Password"]})}),(0,t.jsx)("div",{className:"bg-white dark:bg-gray-900 rounded-md px-4 py-3 border border-gray-300 dark:border-gray-600",children:(0,t.jsx)("span",{className:"text-2xl font-mono font-bold text-gray-900 dark:text-white tracking-wider",children:as.userPassword||"Not Set"})})]}),(0,t.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,t.jsxs)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 flex items-center gap-2",children:[(0,t.jsx)(g.Lock,{className:"w-4 h-4"}),"Supervisor Password"]})}),(0,t.jsx)("div",{className:"bg-white dark:bg-gray-900 rounded-md px-4 py-3 border border-gray-300 dark:border-gray-600",children:(0,t.jsx)("span",{className:"text-2xl font-mono font-bold text-gray-900 dark:text-white tracking-wider",children:as.supervisorPassword||"Not Set"})})]})]}),(0,t.jsx)("div",{className:"flex gap-3 pt-2",children:(0,t.jsx)("button",{type:"button",onClick:aR,className:"flex-1 px-4 py-2.5 text-sm font-medium text-white bg-gradient-to-r from-blue-600 to-blue-700 rounded-lg hover:from-blue-700 hover:to-blue-800 transition-all",children:"Close"})})]}):(0,t.jsxs)("form",{onSubmit:aO,className:"space-y-4",children:[(0,t.jsx)("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(u.AlertTriangle,{className:"w-5 h-5 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-amber-800 dark:text-amber-200 mb-1",children:"Security Verification Required"}),(0,t.jsx)("p",{className:"text-xs text-amber-700 dark:text-amber-300",children:"Enter your admin password to view machine passwords. This action will be logged for security purposes."})]})]})}),(0,t.jsx)(R.FormInput,{label:"Admin Password",type:"password",value:t7,onChange:e=>t9(e),placeholder:"Enter your admin password",error:t8,required:!0}),(0,t.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,t.jsx)("button",{type:"button",onClick:aR,className:"flex-1 px-4 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors",children:"Cancel"}),(0,t.jsx)("button",{type:"submit",disabled:at||!t7,className:"flex-1 px-4 py-2.5 text-sm font-medium text-white bg-gradient-to-r from-blue-600 to-blue-700 rounded-lg hover:from-blue-700 hover:to-blue-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2",children:at?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Verifying..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(S.Eye,{className:"w-4 h-4"}),"View Passwords"]})})]})]})}),td&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>tc(!1),children:(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[(0,t.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:["quantity"===tm&&"Top 20 Machines by Quantity (Last 30 Days)","tests"===tm&&"Top 20 Machines by Total Tests (Last 30 Days)","cleaning"===tm&&"Top 20 Machines by Cleaning Count (Last 30 Days)","skip"===tm&&"Top 20 Machines by Cleaning Skip Count (Last 30 Days)","today"===tm&&"Most Active Machines Today","uptime"===tm&&"Top 20 Machines by Uptime Days (Last 30 Days)"]}),(0,t.jsx)("button",{onClick:()=>tc(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:(0,t.jsx)(F.X,{className:"w-6 h-6"})})]}),(0,t.jsx)("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-80px)]",children:tx.length>0?(0,t.jsx)(z.ResponsiveContainer,{width:"100%",height:400,children:(0,t.jsxs)(A.LineChart,{data:tx,children:[(0,t.jsx)(U.CartesianGrid,{strokeDasharray:"3 3"}),(0,t.jsx)($.XAxis,{dataKey:"label",angle:-45,textAnchor:"end",height:100,tick:{fontSize:12}}),(0,t.jsx)(D.YAxis,{}),(0,t.jsx)(E.Tooltip,{content:({active:e,payload:a})=>{if(e&&a&&a[0]){let e=a[0].payload;return(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-3 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700",children:[(0,t.jsx)("p",{className:"font-semibold text-gray-900 dark:text-white",children:e.machine.machineId}),(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.machine.machineType}),e.machine.societyName&&(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.machine.societyName}),(0,t.jsxs)("p",{className:"text-sm font-semibold text-blue-600 dark:text-blue-400 mt-1",children:["quantity"===tm&&`${e.value.toFixed(2)} L`,"tests"===tm&&`${e.value} Tests`,"cleaning"===tm&&`${e.value} Cleanings`,"skip"===tm&&`${e.value} Skips`,"today"===tm&&`${e.value} Collections Today`,"uptime"===tm&&`${e.value} Days Active`]})]})}return null}}),(0,t.jsx)(L.Line,{type:"monotone",dataKey:"value",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:4},activeDot:{r:6}})]})}):(0,t.jsx)("div",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:"No data available"})})]})})]})}e.s(["default",0,function(){return(0,t.jsx)(a.Suspense,{fallback:(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-500"})}),children:(0,t.jsx)(er,{})})}],100712)}]);