(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,21119,e=>{"use strict";var t=e.i(843476),a=e.i(271645),r=e.i(618566),s=e.i(833277),n=e.i(111110),l=e.i(350627),i=e.i(178583),d=e.i(569074);e.i(633999);var c=e.i(269111),o=e.i(199083),g=e.i(739122),h=e.i(948168),m=e.i(833472);e.i(137996);var x=e.i(641041),u=e.i(105158),y=e.i(185227),b=e.i(440160),p=e.i(998253),f=e.i(506296),j=e.i(504767);let k=({isOpen:e,onClose:r,societies:s,onUploadSuccess:l,onUploadError:i,onUploadStart:c,onUploadEnd:o,onProgressUpdate:g})=>{let{t:h}=(0,n.useLanguage)(),[m,x]=(0,a.useState)(null),[u,y]=(0,a.useState)([]),[k,N]=(0,a.useState)(""),[v,w]=(0,a.useState)(!1),C=e=>{g?.(e)},S=async e=>{if(e.preventDefault(),0===u.length||!k||!m)return void i("Please select at least one society, channel, and CSV file");w(!0),C(0),c?.();try{let e=localStorage.getItem("authToken");C(10);let t=new FormData;t.append("file",m),t.append("societyIds",u.join(",")),t.append("channel",k),C(30);let a=await fetch("/api/user/ratechart/upload",{method:"POST",headers:{Authorization:`Bearer ${e}`},body:t});C(70);let r=await a.json();if(C(90),r.success){C(100);let e=`Rate chart uploaded to ${u.length} ${1===u.length?"society":"societies"}! Total ${r.data.recordCount} records imported.`;l(e),M()}else i(r.message||"Failed to upload rate chart")}catch(e){console.error("Error uploading rate chart:",e),i("Error uploading rate chart. Please try again.")}finally{w(!1),C(0),o?.()}},M=()=>{x(null),y([]),N(""),r()};return(0,t.jsx)(p.FormModal,{isOpen:e,onClose:M,title:h.ratechartManagement.uploadRateChart,maxWidth:"lg",children:(0,t.jsxs)("form",{onSubmit:S,className:"space-y-4 sm:space-y-6",children:[(0,t.jsxs)("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[(0,t.jsxs)("h3",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2 text-sm",children:[h.ratechartManagement.csvFormatRequirements,":"]}),(0,t.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-xs text-blue-800 dark:text-blue-200",children:[(0,t.jsxs)("li",{children:[h.ratechartManagement.headersRequired,": CLR, FAT, SNF, RATE"]}),(0,t.jsxs)("li",{children:[h.ratechartManagement.clrDescription,": ",h.ratechartManagement.colorDegreeNumeric]}),(0,t.jsxs)("li",{children:[h.ratechartManagement.fatDescription,": ",h.ratechartManagement.fatPercentageNumeric]}),(0,t.jsxs)("li",{children:[h.ratechartManagement.snfDescription,": ",h.ratechartManagement.snfPercentageNumeric]}),(0,t.jsxs)("li",{children:[h.ratechartManagement.rateDescription,": ",h.ratechartManagement.ratePerLiterNumeric]}),(0,t.jsx)("li",{children:h.ratechartManagement.fileEncodingUTF8})]}),(0,t.jsxs)("button",{type:"button",onClick:()=>{let e=new Blob([`CLR,FAT,SNF,RATE
7,3,3,15
8,3,3.1,15.25
8,3,3.2,15.5
8,3,3.3,15.75
9,3,3.4,16
9,3,3.5,16.25
10,3,3.6,16.5`],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a"),a=URL.createObjectURL(e);t.setAttribute("href",a),t.setAttribute("download","ratechart_sample.csv"),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(a)},className:"mt-3 flex items-center text-xs text-blue-600 dark:text-blue-400 hover:underline",children:[(0,t.jsx)(b.Download,{className:"w-4 h-4 mr-1"}),h.ratechartManagement.downloadSampleCSV]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[h.ratechartManagement.selectSociety," ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)("button",{type:"button",onClick:()=>{u.length===s.length?y([]):y(s.map(e=>e.id))},className:"text-sm text-green-600 dark:text-green-400 hover:underline",children:u.length===s.length?h.common.clearAll:h.common.selectAll})]}),(0,t.jsx)("div",{className:"border border-gray-300 dark:border-gray-600 rounded-lg p-3 max-h-48 overflow-y-auto space-y-2",children:0===s.length?(0,t.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-2",children:h.ratechartManagement.noSocietiesAvailable}):s.map(e=>(0,t.jsxs)("label",{className:"flex items-center space-x-3 p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",checked:u.includes(e.id),onChange:()=>{var t;return t=e.id,void y(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},className:"w-4 h-4 text-green-600 border-gray-300 dark:border-gray-600 rounded focus:ring-green-500"}),(0,t.jsxs)("span",{className:"text-sm text-gray-900 dark:text-white",children:[e.name," (",e.society_id,")"]})]},e.id))}),u.length>0&&(0,t.jsxs)("p",{className:"mt-2 text-xs text-gray-600 dark:text-gray-400",children:[u.length," ",1===u.length?h.ratechartManagement.society:h.ratechartManagement.societies," ",h.common.selected]})]}),(0,t.jsx)(f.FormSelect,{label:h.ratechartManagement.milkChannel,value:k,onChange:e=>N(e),options:[{value:"COW",label:h.ratechartManagement.cow},{value:"BUF",label:h.ratechartManagement.buffalo},{value:"MIX",label:h.ratechartManagement.mixed}],placeholder:h.ratechartManagement.selectChannel,required:!0}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[h.ratechartManagement.csvFile," ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsxs)("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center hover:border-green-400 dark:hover:border-green-500 transition-colors",children:[(0,t.jsx)("input",{type:"file",accept:".csv",onChange:e=>{let t=e.target.files?.[0];if(t){if(!t.name.toLowerCase().endsWith(".csv"))return void i("Please select a CSV file");x(t)}},className:"hidden",id:"csv-upload"}),(0,t.jsxs)("label",{htmlFor:"csv-upload",className:"cursor-pointer flex flex-col items-center",children:[(0,t.jsx)(d.Upload,{className:"w-12 h-12 text-gray-400 mb-3"}),m?(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:m.name}),(0,t.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[(m.size/1024).toFixed(2)," KB"]})]}):(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:h.ratechartManagement.clickToUploadCSV}),(0,t.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:h.ratechartManagement.orDragAndDrop})]})]})]})]}),(0,t.jsx)(j.FormActions,{onCancel:M,submitText:`${h.common.upload} to ${u.length} ${1===u.length?h.ratechartManagement.society:h.ratechartManagement.societies}`,isLoading:v,isSubmitDisabled:0===u.length||!k||!m,submitType:"submit"})]})})};var N=e.i(727612),v=e.i(475254);let w=(0,v.default)("user-plus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),C=(0,v.default)("power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]),S=(0,v.default)("power-off",[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);var M=e.i(286536),I=e.i(16715),A=e.i(37727),F=e.i(323585),T=e.i(664659);let $=(0,v.default)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);var R=e.i(607486),E=e.i(269638),L=e.i(503116),B=e.i(462201);let O=(e,a)=>{if(!a)return e;let r=RegExp(`(${a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return e.split(r).map((e,a)=>r.test(e)?(0,t.jsx)("span",{className:"bg-yellow-200 dark:bg-yellow-800 px-0.5 rounded",children:e},a):e)};function U({chartId:e,fileName:r,channel:s,uploadedBy:d,createdAt:c,societies:o,status:g,isSelected:h,onToggleSelection:m,onDelete:x,onAssignSociety:u,onToggleStatus:y,onView:b,onResetDownload:p,onRemoveSociety:f,searchQuery:j=""}){let{t:k}=(0,n.useLanguage)(),[v,U]=a.default.useState(!1),[D,z]=a.default.useState(!1),[P,W]=a.default.useState(!1),[X,_]=a.default.useState(null),[q,V]=a.default.useState(null),[J,H]=a.default.useState(!1),K=a.default.useRef(null);return a.default.useEffect(()=>{(async()=>{if(0!==g){H(!0);try{let t=localStorage.getItem("authToken");if(!t)return;let a=await fetch(`/api/user/ratechart/download-status?chartId=${e}`,{headers:{Authorization:`Bearer ${t}`}}),r=await a.json();r.success&&V(r.data)}catch(e){console.error("Error fetching download status:",e)}finally{H(!1)}}})()},[e,g]),a.default.useEffect(()=>{let e=e=>{K.current&&!K.current.contains(e.target)&&U(!1)};return v&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[v]),(0,t.jsxs)("div",{className:`relative border rounded-xl p-5 transition-all duration-300 hover:shadow-lg ${h?"border-green-500 dark:border-green-400 bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/30 dark:to-emerald-900/30 shadow-md ring-2 ring-green-200 dark:ring-green-700":"border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 hover:border-green-300 dark:hover:border-green-600"}`,children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("input",{type:"checkbox",checked:h,onChange:m,className:"mt-1 w-4 h-4 text-green-600 dark:text-green-500 bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded focus:ring-green-500 dark:focus:ring-green-400 focus:ring-2 cursor-pointer transition-transform hover:scale-110"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(l.Receipt,{className:"w-4 h-4 text-gray-400 dark:text-gray-500 flex-shrink-0"}),(0,t.jsx)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 truncate",title:r,children:O(r,j)})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-md text-xs font-semibold ${"COW"===s?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300":"BUF"===s?"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300":"bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300"}`,children:O({COW:"COW",BUF:"BUFFALO",MIX:"MIXED",BUFFALO:"BUFFALO",MIXED:"MIXED"}[s]||s,j)}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:`inline-flex items-center px-2.5 py-0.5 rounded-md ${0===g?"bg-gray-50 dark:bg-gray-900/20 border border-gray-200 dark:border-gray-800":q?.allDownloaded?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":q?.totalMachines===0?"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800":"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800"}`,children:((e,a,r,s,n)=>{if(r)return(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-gray-400 dark:bg-gray-500 animate-pulse"}),(0,t.jsx)("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"Loading..."})]});if(0===e)return(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-gray-500 dark:bg-gray-400"}),(0,t.jsx)("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"Inactive"})]});if(a){let{allDownloaded:e,totalDownloaded:r,totalMachines:l}=a;if(0===l)return(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-amber-500 dark:bg-amber-400 animate-pulse"}),(0,t.jsx)("span",{className:"text-xs font-medium text-amber-600 dark:text-amber-400",children:"Ready"})]});let i="flex items-center gap-1.5",d=s?"cursor-pointer hover:opacity-80 transition-opacity":"";return e?(0,t.jsxs)("div",{className:`${i} ${d}`,onClick:s,children:[(0,t.jsx)(E.CheckCircle,{className:"w-3.5 h-3.5 text-green-600 dark:text-green-400"}),(0,t.jsxs)("span",{className:"text-xs font-medium text-green-600 dark:text-green-400",children:["Downloaded (",r,"/",l,")"]}),n&&(0,t.jsx)(T.ChevronDown,{className:"w-3 h-3 text-green-600 dark:text-green-400"})]}):(0,t.jsxs)("div",{className:`${i} ${d}`,onClick:s,children:[(0,t.jsx)(L.Clock,{className:"w-3.5 h-3.5 text-blue-600 dark:text-blue-400"}),(0,t.jsxs)("span",{className:"text-xs font-medium text-blue-600 dark:text-blue-400",children:["Pending (",r,"/",l,")"]}),n&&(0,t.jsx)(T.ChevronDown,{className:"w-3 h-3 text-blue-600 dark:text-blue-400"})]})}return(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-amber-500 dark:bg-amber-400 animate-pulse"}),(0,t.jsx)("span",{className:"text-xs font-medium text-amber-600 dark:text-amber-400",children:"Ready"})]})})(g,q,J,q&&q.totalMachines>0?()=>W(!P):void 0,!!(q&&q.totalMachines>0))}),P&&q&&q.totalMachines>0&&(0,t.jsxs)("div",{className:"absolute top-full left-0 mt-1 w-64 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 z-10 max-h-80 overflow-y-auto",children:[(0,t.jsxs)("div",{className:"px-3 py-2 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700 rounded-t-lg flex items-center justify-between",children:[(0,t.jsx)("div",{className:"flex-1 min-w-0",children:(0,t.jsxs)("h4",{className:"text-xs font-semibold text-gray-900 dark:text-gray-100 truncate",children:[q.totalDownloaded,"/",q.totalMachines," Downloaded"]})}),(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),W(!1)},className:"ml-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",children:(0,t.jsx)(A.X,{className:"w-3.5 h-3.5"})})]}),(0,t.jsx)("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:Object.entries(q.societies).map(([e,a])=>(0,t.jsxs)("div",{className:"p-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-1.5",children:[(0,t.jsx)("h5",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 truncate",children:e}),(0,t.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",children:[a.downloadedMachines,"/",a.totalMachines]})]}),a.machines.filter(e=>e.downloaded).length>0&&(0,t.jsxs)("div",{className:"mb-1.5",children:[(0,t.jsxs)("div",{className:"text-xs font-medium text-green-600 dark:text-green-400 mb-1 flex items-center gap-1",children:[(0,t.jsx)(E.CheckCircle,{className:"w-2.5 h-2.5"}),(0,t.jsx)("span",{children:"Done"})]}),(0,t.jsx)("div",{className:"space-y-0.5",children:a.machines.filter(e=>e.downloaded).map(e=>(0,t.jsxs)("div",{className:"text-xs bg-green-50 dark:bg-green-900/20 rounded px-1.5 py-1",children:[(0,t.jsx)("div",{className:"font-medium text-green-700 dark:text-green-300 truncate",children:e.machineId}),(0,t.jsxs)("div",{className:"text-[10px] text-green-600 dark:text-green-400 truncate",children:[e.machineType," • ",e.location]})]},e.id))})]}),a.machines.filter(e=>!e.downloaded).length>0&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"text-xs font-medium text-amber-600 dark:text-amber-400 mb-1 flex items-center gap-1",children:[(0,t.jsx)(L.Clock,{className:"w-2.5 h-2.5"}),(0,t.jsx)("span",{children:"Pending"})]}),(0,t.jsx)("div",{className:"space-y-0.5",children:a.machines.filter(e=>!e.downloaded).map(e=>(0,t.jsxs)("div",{className:"text-xs bg-amber-50 dark:bg-amber-900/20 rounded px-1.5 py-1",children:[(0,t.jsx)("div",{className:"font-medium text-amber-700 dark:text-amber-300 truncate",children:e.machineId}),(0,t.jsxs)("div",{className:"text-[10px] text-amber-600 dark:text-amber-400 truncate",children:[e.machineType," • ",e.location]})]},e.id))})]})]},e))})]})]})]})]})]}),(0,t.jsxs)("div",{className:"relative",ref:K,children:[(0,t.jsx)("button",{onClick:()=>U(!v),className:"p-1.5 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Actions",children:(0,t.jsx)(F.MoreVertical,{className:"w-5 h-5"})}),v&&(0,t.jsxs)("div",{className:"absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 z-50 py-1",children:[(0,t.jsxs)("button",{onClick:()=>{b(),U(!1)},className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[(0,t.jsx)(M.Eye,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"}),(0,t.jsxs)("span",{children:[k.common.view||"View"," ",k.ratechartManagement.rateChart]})]}),(0,t.jsxs)("button",{onClick:()=>{u(),U(!1)},className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[(0,t.jsx)(w,{className:"w-4 h-4 text-green-600 dark:text-green-400"}),(0,t.jsxs)("span",{children:[k.common.add," ",k.ratechartManagement.societies]})]}),(0,t.jsxs)("button",{onClick:()=>{p(),U(!1)},className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[(0,t.jsx)(I.RefreshCw,{className:"w-4 h-4 text-purple-600 dark:text-purple-400"}),(0,t.jsx)("span",{children:k.ratechartManagement.resetDownload})]}),(0,t.jsx)("button",{onClick:()=>{y(e,g),U(!1)},className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:1===g?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(S,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"}),(0,t.jsx)("span",{children:k.ratechartManagement.inactive})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(C,{className:"w-4 h-4 text-green-600 dark:text-green-400"}),(0,t.jsx)("span",{children:k.ratechartManagement.active})]})}),(0,t.jsx)("div",{className:"border-t border-gray-200 dark:border-gray-700 my-1"}),(0,t.jsxs)("button",{onClick:()=>{x(),U(!1)},className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",children:[(0,t.jsx)(N.Trash2,{className:"w-4 h-4"}),(0,t.jsx)("span",{children:k.common.delete})]})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4 mb-4 text-xs text-gray-500 dark:text-gray-400",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)(i.FileText,{className:"w-3.5 h-3.5"}),(0,t.jsx)("span",{children:d})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("span",{children:"•"}),(0,t.jsx)("span",{children:new Date(c).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]})]}),(0,t.jsxs)("div",{className:"relative bg-gray-50 dark:bg-gray-900/50 rounded-lg p-3 border border-gray-200 dark:border-gray-700 mb-3",children:[(0,t.jsxs)("button",{onClick:()=>z(!D),className:"w-full flex items-center justify-between text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100 transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(R.Building2,{className:"w-4 h-4 text-green-600 dark:text-green-400"}),(0,t.jsxs)("span",{children:[k.ratechartManagement.societies," (",o.length,")"]})]}),D?(0,t.jsx)($,{className:"w-4 h-4"}):(0,t.jsx)(T.ChevronDown,{className:"w-4 h-4"})]}),D&&(0,t.jsx)("div",{className:"absolute left-0 right-0 top-full mt-2 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-50 overflow-hidden max-h-64 overflow-y-auto",children:o.map(e=>(0,t.jsxs)("div",{className:"group flex items-center justify-between p-3 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors border-b border-gray-100 dark:border-gray-700 last:border-b-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center flex-shrink-0",children:(0,t.jsx)("span",{className:"text-xs font-bold text-green-700 dark:text-green-300",children:e.societyName.charAt(0).toUpperCase()})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 truncate",title:e.societyName,children:O(e.societyName,j)}),e.societyIdentifier&&(0,t.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:O(e.societyIdentifier,j)})]})]}),f&&o.length>1&&(0,t.jsx)("button",{onClick:()=>{_({chartRecordId:e.chartRecordId,societyId:e.societyId,societyName:e.societyName})},className:"ml-2 p-1.5 text-red-500 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-all opacity-0 group-hover:opacity-100",title:`Remove ${e.societyName}`,children:(0,t.jsx)(A.X,{className:"w-4 h-4"})})]},e.societyId))})]}),(0,t.jsx)(B.ConfirmDeleteModal,{isOpen:!!X,onClose:()=>_(null),onConfirm:()=>{X&&f&&(f(X.chartRecordId,X.societyId,X.societyName),2===o.length&&z(!1)),_(null)},itemName:X?.societyName||"",itemType:k.ratechartManagement.society,title:`${k.common.delete} ${k.ratechartManagement.society}`,message:k.common.confirm,confirmText:`${k.common.delete} ${k.ratechartManagement.society}`})]})}var D=e.i(761911),z=e.i(107233),P=e.i(878894);e.i(207221);var W=e.i(846932),X=e.i(88653);function _({isOpen:e,onClose:r,onAssign:s,fileName:l,currentSocieties:i,allSocieties:d}){let{t:c}=(0,n.useLanguage)(),[o,g]=(0,a.useState)(new Set),[h,m]=(0,a.useState)(!1),[x,u]=(0,a.useState)(null),[y,b]=(0,a.useState)(!1);if((0,a.useEffect)(()=>{e&&(g(new Set),u(null),b(!1))},[e]),!e)return null;let f=new Set(i.map(e=>e.societyId)),k=d.filter(e=>!f.has(e.id)),N=async(e=!1)=>{if(0!==o.size){m(!0);try{let t=await s(Array.from(o),e);if(t&&t.requiresConfirmation&&t.conflicts){u(t.conflicts),b(!0),m(!1);return}r()}catch(e){e&&"object"==typeof e&&"requiresConfirmation"in e&&"conflicts"in e?(u(e.conflicts),b(!0)):console.error("Error assigning societies:",e)}finally{m(!1)}}},v=()=>{b(!1),u(null)};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.FormModal,{isOpen:e,onClose:r,title:c.ratechartManagement.chartAssignedSuccessfully.split(" ")[0]+" "+c.ratechartManagement.societies,maxWidth:"2xl",children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl p-4 border border-green-200 dark:border-green-800",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-green-500 dark:bg-green-600 rounded-lg",children:(0,t.jsx)(D.Users,{className:"w-5 h-5 text-white"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-xs font-medium text-green-700 dark:text-green-300 mb-0.5",children:"Rate Chart File"}),(0,t.jsx)("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 truncate",title:l,children:l})]})]})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3 flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500"}),"Currently Assigned (",i.length,")"]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:i.map(e=>(0,t.jsx)("span",{className:"inline-flex items-center px-3 py-1.5 rounded-lg text-sm font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600",children:e.societyName},e.societyId))})]}),(0,t.jsx)("div",{className:"border-t border-gray-200 dark:border-gray-700"}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"}),"Available Societies (",k.length,")"]}),k.length>0&&(0,t.jsx)("button",{onClick:()=>{o.size===k.length?g(new Set):g(new Set(k.map(e=>e.id)))},className:"text-xs text-green-600 dark:text-green-400 hover:text-green-700 dark:hover:text-green-300 font-semibold transition-colors",children:o.size===k.length?"Deselect All":"Select All"})]}),0===k.length?(0,t.jsxs)("div",{className:"text-center py-12 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl",children:[(0,t.jsx)(D.Users,{className:"w-12 h-12 mx-auto mb-3 text-gray-400 dark:text-gray-500"}),(0,t.jsx)("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"All societies assigned"}),(0,t.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"All available societies already have this chart"})]}):(0,t.jsx)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden max-h-80 overflow-y-auto bg-gray-50 dark:bg-gray-900/50",children:(0,t.jsx)("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:k.map(e=>(0,t.jsxs)("label",{className:"flex items-center gap-3 p-4 hover:bg-white dark:hover:bg-gray-800 cursor-pointer transition-colors group",children:[(0,t.jsx)("input",{type:"checkbox",checked:o.has(e.id),onChange:()=>{var t;let a;return t=e.id,void((a=new Set(o)).has(t)?a.delete(t):a.add(t),g(a))},className:"w-4 h-4 text-green-600 dark:text-green-500 bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded focus:ring-green-500 dark:focus:ring-green-400 focus:ring-2 cursor-pointer transition-all"}),(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-green-100 to-emerald-100 dark:from-green-900/50 dark:to-emerald-900/50 flex items-center justify-center flex-shrink-0 group-hover:scale-110 transition-transform",children:(0,t.jsx)("span",{className:"text-xs font-bold text-green-700 dark:text-green-300",children:e.name.charAt(0).toUpperCase()})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 truncate",children:e.name}),(0,t.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:e.society_id})]})]},e.id))})}),o.size>0&&(0,t.jsxs)("div",{className:"mt-3 flex items-center gap-2 text-sm",children:[(0,t.jsx)("div",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-green-100 dark:bg-green-900/30",children:(0,t.jsx)("span",{className:"text-xs font-bold text-green-600 dark:text-green-400",children:o.size})}),(0,t.jsxs)("span",{className:"text-gray-700 dark:text-gray-300 font-medium",children:[o.size," ",1===o.size?"society":"societies"," selected"]})]})]}),(0,t.jsx)(j.FormActions,{onCancel:r,onSubmit:()=>N(!1),submitText:o.size>0?`Assign to ${o.size} ${1===o.size?"Society":"Societies"}`:"Select Societies",isLoading:h,isSubmitDisabled:0===o.size,loadingText:"Assigning...",submitIcon:(0,t.jsx)(z.Plus,{className:"w-4 h-4"}),submitType:"button"})]})}),(0,t.jsx)(X.AnimatePresence,{children:y&&x&&x.length>0&&(0,t.jsx)(W.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 dark:bg-black/80 flex items-center justify-center z-[10000] p-4",onClick:v,children:(0,t.jsx)(W.motion.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{type:"spring",damping:25,stiffness:300},className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md",onClick:e=>e.stopPropagation(),children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex items-start gap-4 mb-4",children:[(0,t.jsx)("div",{className:"flex-shrink-0 w-12 h-12 rounded-full bg-yellow-100 dark:bg-yellow-900/30 flex items-center justify-center",children:(0,t.jsx)(P.AlertTriangle,{className:"w-6 h-6 text-yellow-600 dark:text-yellow-400"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"text-lg font-bold text-gray-900 dark:text-gray-100 mb-1",children:"Replace Existing Charts?"}),(0,t.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["The following ",1===x.length?"society already has":"societies already have"," a rate chart assigned:"]})]})]}),(0,t.jsx)("div",{className:"space-y-2 mb-5 max-h-48 overflow-y-auto",children:x.map(e=>(0,t.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3",children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:e.societyName}),(0,t.jsxs)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-0.5",children:["Current: ",(0,t.jsx)("span",{className:"font-medium",children:e.currentFileName})]})]},e.societyId))}),(0,t.jsxs)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-6",children:["Do you want to replace ",1===x.length?"this chart":"these charts"," with the new one?"]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("button",{onClick:v,disabled:h,className:"flex-1 px-4 py-2.5 text-sm font-semibold text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-xl transition-colors disabled:opacity-50",children:"Cancel"}),(0,t.jsx)("button",{onClick:()=>{b(!1),N(!0)},disabled:h,className:"flex-1 px-4 py-2.5 text-sm font-semibold text-white bg-yellow-600 dark:bg-yellow-600 hover:bg-yellow-700 dark:hover:bg-yellow-500 rounded-xl transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:h?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Replacing..."]}):"Yes, Replace"})]})]})})})})]})}function q({isOpen:e,onClose:r,rateCharts:s}){let{t:i}=(0,n.useLanguage)(),[d,c]=(0,a.useState)("all");if(!e)return null;let o=s.filter(e=>"all"===d||e.channel===d),g=o.filter(e=>"COW"===e.channel),h=o.filter(e=>"BUF"===e.channel),m=o.filter(e=>"MIX"===e.channel);return(0,t.jsx)(p.FormModal,{isOpen:e,onClose:r,title:`${i.ratechartManagement.totalAssignments} (${s.length})`,maxWidth:"2xl",children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:i.ratechartManagement.allRateChartAssignments}),(0,t.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,t.jsxs)("button",{onClick:()=>c("all"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${"all"===d?"bg-blue-600 dark:bg-blue-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:[i.dashboard.all," (",s.length,")"]}),(0,t.jsxs)("button",{onClick:()=>c("COW"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${"COW"===d?"bg-green-600 dark:bg-green-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:[i.ratechartManagement.cow," (",s.filter(e=>"COW"===e.channel).length,")"]}),(0,t.jsxs)("button",{onClick:()=>c("BUF"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${"BUF"===d?"bg-blue-600 dark:bg-blue-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:[i.ratechartManagement.buf," (",s.filter(e=>"BUF"===e.channel).length,")"]}),(0,t.jsxs)("button",{onClick:()=>c("MIX"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${"MIX"===d?"bg-purple-600 dark:bg-purple-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:[i.ratechartManagement.mix," (",s.filter(e=>"MIX"===e.channel).length,")"]})]}),(0,t.jsx)("div",{className:"max-h-96 overflow-y-auto space-y-2 border border-gray-200 dark:border-gray-700 rounded-xl p-3 bg-gray-50 dark:bg-gray-900/50",children:0===o.length?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)(l.Receipt,{className:"w-12 h-12 mx-auto mb-3 text-gray-400 dark:text-gray-500"}),(0,t.jsx)("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:i.ratechartManagement.noAssignmentsFound}),(0,t.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:i.ratechartManagement.tryChangingFilter})]}):(0,t.jsxs)("div",{className:"space-y-4",children:[("all"===d||"COW"===d)&&g.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2",children:[(0,t.jsx)("span",{className:"inline-block w-2 h-2 rounded-full bg-green-500"}),i.ratechartManagement.cow," ",i.ratechartManagement.channel," (",g.length,")"]}),(0,t.jsx)("div",{className:"space-y-2",children:g.map(e=>(0,t.jsx)(V,{chart:e},e.id))})]}),("all"===d||"BUF"===d)&&h.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2",children:[(0,t.jsx)("span",{className:"inline-block w-2 h-2 rounded-full bg-blue-500"}),i.ratechartManagement.buffalo," ",i.ratechartManagement.channel," (",h.length,")"]}),(0,t.jsx)("div",{className:"space-y-2",children:h.map(e=>(0,t.jsx)(V,{chart:e},e.id))})]}),("all"===d||"MIX"===d)&&m.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2",children:[(0,t.jsx)("span",{className:"inline-block w-2 h-2 rounded-full bg-purple-500"}),i.ratechartManagement.mixed," ",i.ratechartManagement.channel," (",m.length,")"]}),(0,t.jsx)("div",{className:"space-y-2",children:m.map(e=>(0,t.jsx)(V,{chart:e},e.id))})]})]})}),(0,t.jsxs)("div",{className:"flex items-center justify-between pt-2 border-t border-gray-200 dark:border-gray-700",children:[(0,t.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[i.ratechartManagement.showing," ",o.length," ",i.ratechartManagement.of," ",s.length," ",i.ratechartManagement.assignments]}),(0,t.jsx)("button",{onClick:r,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 dark:bg-blue-500 rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 transition-colors",children:i.common.close})]})]})})}function V({chart:e}){var a;return(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-700 transition-colors",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:e.societyName}),(0,t.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",e.societyIdentifier,")"]}),(0,t.jsx)("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium border ${(e=>{switch(e){case"COW":return"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 border-green-200 dark:border-green-800";case"BUF":return"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 border-blue-200 dark:border-blue-800";case"MIX":return"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 border-yellow-200 dark:border-yellow-800";default:return"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 border-gray-200 dark:border-gray-700"}})(e.channel)}`,children:{COW:"COW",BUF:"BUFFALO",MIX:"MIXED",BUFFALO:"BUFFALO",MIXED:"MIXED"}[a=e.channel]||a}),e.shared_chart_id&&(0,t.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400 border border-purple-200 dark:border-purple-800",children:"Shared"})]}),(0,t.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 truncate",children:e.fileName})]}),(0,t.jsxs)("div",{className:"text-right ml-4 flex-shrink-0",children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:new Date(e.uploadedAt).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}),(0,t.jsxs)("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:[e.recordCount," records"]})]})]})}function J({show:e,onClose:r,onConfirm:s,chartId:l,fileName:i,channel:d,societies:o}){let{t:g}=(0,n.useLanguage)(),[h,m]=(0,a.useState)([]),[x,u]=(0,a.useState)(new Set),[y,b]=(0,a.useState)(!1),[k,N]=(0,a.useState)(!1),[v,w]=(0,a.useState)("all");(0,a.useEffect)(()=>{let t=async()=>{if(e){b(!0);try{let e=localStorage.getItem("authToken");if(!e)return;let t=await fetch(`/api/user/ratechart/data?chartId=${l}`,{headers:{Authorization:`Bearer ${e}`}});if(t.ok){let e=await t.json();m(e.data?.machines||[])}}catch(e){console.error("Error fetching machines:",e)}finally{b(!1)}}};e&&(t(),u(new Set),w("all"))},[e,l]);let C=async()=>{if(0!==x.size){N(!0);try{await s(Array.from(x)),r()}catch(e){console.error("Error resetting download:",e)}finally{N(!1)}}},S=h.filter(e=>"all"===v||o.find(t=>t.societyId===v&&t.societyName===e.societyName));return e?(0,t.jsx)(p.FormModal,{isOpen:e,onClose:r,title:`${g.common.reset} ${g.ratechartManagement.channelDownloadStatus}`,maxWidth:"2xl",children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsxs)("span",{className:`px-2.5 py-1 rounded-lg text-xs font-semibold ${"COW"===d?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300":"BUF"===d?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300"}`,children:[d," ",g.ratechartManagement.channel]})}),(0,t.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl p-4 border border-blue-200 dark:border-blue-800",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-blue-500 dark:bg-blue-600 rounded-lg",children:(0,t.jsx)(I.RefreshCw,{className:"w-5 h-5 text-white"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-xs font-medium text-blue-700 dark:text-blue-300 mb-0.5",children:g.ratechartManagement.rateChartFile}),(0,t.jsx)("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 truncate",title:i,children:i})]})]})}),(0,t.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[g.ratechartManagement.selectMachinesToReset," ",(0,t.jsxs)("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[d," ",g.ratechartManagement.channel]})," ",g.ratechartManagement.downloadStatusAllowRedownload," ",d," ",g.ratechartManagement.milkType,"."]}),(0,t.jsx)(f.FormSelect,{label:g.ratechartManagement.filterBySociety,value:v.toString(),onChange:e=>w("all"===e?"all":parseInt(e)),options:[{value:"all",label:g.ratechartManagement.allSocieties},...o.map(e=>({value:e.societyId.toString(),label:e.societyName}))]}),S.length>0&&(0,t.jsxs)("div",{className:"flex items-center justify-between pb-3 border-b border-gray-200 dark:border-gray-700",children:[(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer group",children:[(0,t.jsx)("input",{type:"checkbox",checked:x.size===S.length&&S.length>0,onChange:()=>{x.size===S.length?u(new Set):u(new Set(S.map(e=>e.id)))},className:"w-4 h-4 text-blue-600 dark:text-blue-500 bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500 dark:focus:ring-blue-400 focus:ring-2 cursor-pointer transition-all"}),(0,t.jsxs)("span",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",children:[g.common.selectAll," (",S.length,")"]})]}),x.size>0&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-blue-100 dark:bg-blue-900/30",children:(0,t.jsx)("span",{className:"text-xs font-bold text-blue-600 dark:text-blue-400",children:x.size})}),(0,t.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300 font-medium",children:"selected"})]})]}),(0,t.jsx)("div",{className:"max-h-80 overflow-y-auto space-y-2 border border-gray-200 dark:border-gray-700 rounded-xl p-3 bg-gray-50 dark:bg-gray-900/50",children:y?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,t.jsx)(c.FlowerSpinner,{size:32}),(0,t.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-3",children:g.ratechartManagement.loadingMachines})]}):0===S.length?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)(I.RefreshCw,{className:"w-12 h-12 mx-auto mb-3 text-gray-400 dark:text-gray-500"}),(0,t.jsx)("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:g.ratechartManagement.noMachinesFound}),(0,t.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:g.ratechartManagement.tryChangingSocietyFilter})]}):S.map(e=>(0,t.jsxs)("label",{className:`flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-all group ${x.has(e.id)?"border-blue-500 dark:border-blue-400 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 hover:border-blue-300 dark:hover:border-blue-600 hover:bg-blue-50/50 dark:hover:bg-blue-900/10"}`,children:[(0,t.jsx)("input",{type:"checkbox",checked:x.has(e.id),onChange:()=>{var t;return t=e.id,void u(e=>{let a=new Set(e);return a.has(t)?a.delete(t):a.add(t),a})},className:"w-4 h-4 text-blue-600 dark:text-blue-500 bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded focus:ring-blue-500 dark:focus:ring-blue-400 focus:ring-2 cursor-pointer transition-all"}),(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-100 to-indigo-100 dark:from-blue-900/50 dark:to-indigo-900/50 flex items-center justify-center flex-shrink-0 group-hover:scale-110 transition-transform",children:(0,t.jsx)("span",{className:"text-xs font-bold text-blue-700 dark:text-blue-300",children:e.machineId.charAt(0).toUpperCase()})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:e.machineId}),(0,t.jsx)("span",{className:"text-xs px-2 py-0.5 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded font-medium",children:e.machineType})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-1 text-xs",children:[(0,t.jsx)("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:e.societyName}),(0,t.jsx)("span",{className:"text-gray-400 dark:text-gray-500",children:"•"}),(0,t.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:e.societyIdentifier||`ID: ${e.societyId}`}),e.location&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"text-gray-400 dark:text-gray-500",children:"•"}),(0,t.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:e.location})]})]})]})]},e.id))}),(0,t.jsx)(j.FormActions,{onCancel:r,onSubmit:C,submitText:x.size>0?`${g.common.reset} ${d} ${g.ratechartManagement.download} (${x.size})`:g.ratechartManagement.selectMachines,isLoading:k,isSubmitDisabled:0===x.size,loadingText:`${g.ratechartManagement.resetting} ${d}...`,submitIcon:(0,t.jsx)(I.RefreshCw,{className:"w-4 h-4"}),submitType:"button"})]})}):null}var H=e.i(730888),K=e.i(429525);function Q(){let e,b=(0,r.useRouter)(),{user:p}=(0,s.useUser)(),{t:f}=(0,n.useLanguage)(),[j,N]=(0,a.useState)([]),[v,w]=(0,a.useState)([]),[C,S]=(0,a.useState)([]),[M,I]=(0,a.useState)([]),[A,F]=(0,a.useState)([]),[T,$]=(0,a.useState)(!0),[R,E]=(0,a.useState)(!1),[L,B]=(0,a.useState)(""),[O,D]=(0,a.useState)(""),[z,P]=(0,a.useState)(!1),[W,X]=(0,a.useState)(0),[V,Q]=(0,a.useState)([]),[Y,G]=(0,a.useState)([]),[Z,ee]=(0,a.useState)([]),[et,ea]=(0,a.useState)([]),[er,es]=(0,a.useState)("all"),[en,el]=(0,a.useState)(""),[ei,ed]=(0,a.useState)(new Set),[ec,eo]=(0,a.useState)(!1),[eg,eh]=(0,a.useState)(!1),[em,ex]=(0,a.useState)(!1),[eu,ey]=(0,a.useState)(!1),[eb,ep]=(0,a.useState)(null),[ef,ej]=(0,a.useState)(""),[ek,eN]=(0,a.useState)(!1),[ev,ew]=(0,a.useState)(null),[eC,eS]=(0,a.useState)("active"),[eM,eI]=(0,a.useState)(!1),[eA,eF]=(0,a.useState)(!1),[eT,e$]=(0,a.useState)(null),[eR,eE]=(0,a.useState)([]),[eL,eB]=(0,a.useState)(!1),[eO,eU]=(0,a.useState)(""),[eD,ez]=(0,a.useState)(""),[eP,eW]=(0,a.useState)(""),[eX,e_]=(0,a.useState)(!1),[eq,eV]=(0,a.useState)(null);(0,a.useEffect)(()=>{p&&"admin"!==p.role&&"super_admin"!==p.role&&b.push("/dashboard")},[p,b]);let eJ=(0,a.useCallback)(async()=>{try{$(!0);let e=localStorage.getItem("authToken");if(!e)return;let t=await fetch("/api/user/ratechart",{headers:{Authorization:`Bearer ${e}`}}),a=await t.json();a.success&&N(a.data||[])}catch(e){console.error("Error fetching rate charts:",e),D(f.ratechartManagement.failedToLoadCharts)}finally{$(!1)}},[]),eH=(0,a.useCallback)(async()=>{try{let e=localStorage.getItem("authToken");if(!e)return;let t=await fetch("/api/user/society",{headers:{Authorization:`Bearer ${e}`}}),a=await t.json();if(console.log("Societies API response:",a),a.success){let e=a.data||[];console.log("Societies list:",e),w(e)}}catch(e){console.error("Error fetching societies:",e)}},[]),eK=(0,a.useCallback)(async()=>{try{let e=localStorage.getItem("authToken");if(!e)return;let t=await fetch("/api/user/dairy",{headers:{Authorization:`Bearer ${e}`}});if(t.ok){let e=await t.json();S(e.data||[])}}catch(e){console.error("Error fetching dairies:",e)}},[]),eQ=(0,a.useCallback)(async()=>{try{let e=localStorage.getItem("authToken");if(!e)return;let t=await fetch("/api/user/bmc",{headers:{Authorization:`Bearer ${e}`}});if(t.ok){let e=await t.json();I(e.data||[])}}catch(e){console.error("Error fetching BMCs:",e)}},[]),eY=(0,a.useCallback)(async()=>{try{let e=localStorage.getItem("authToken");if(!e)return;let t=await fetch("/api/user/machine",{headers:{Authorization:`Bearer ${e}`}});if(t.ok){let e=await t.json();F(e.data||[])}}catch(e){console.error("Error fetching machines:",e)}},[]);(0,a.useEffect)(()=>{p&&(eJ(),eH(),eK(),eQ(),eY())},[p,eJ,eH,eK,eQ,eY]),(0,a.useEffect)(()=>{let e=e=>{el(e.detail?.query||"")};return window.addEventListener("globalSearch",e),()=>{window.removeEventListener("globalSearch",e)}},[]);let eG=async(e,t,a)=>{try{eB(!0);let r=localStorage.getItem("authToken");if(!r)return;let s=await fetch(`/api/user/ratechart/data?fileName=${encodeURIComponent(e)}&channel=${t}&societyId=${a}`,{headers:{Authorization:`Bearer ${r}`}}),n=await s.json();n.success?eE(n.data||[]):D("string"==typeof n.error?n.error:n.error?.message||f.ratechartManagement.failedToFetchData)}catch(e){console.error("Error fetching rate chart data:",e),D(f.ratechartManagement.failedToFetchData)}finally{eB(!1)}},eZ=()=>{eF(!1),e$(null),eE([]),eU(""),ez(""),eW("")},e0=async e=>{ep(e);let t=Object.values(e4).find(t=>t.chartRecordIds.includes(e)||t.chartId===e);t&&t.societies.length>0?ej(t.societies.map(e=>e.societyIdentifier||e.societyId.toString()).join(", ")):ej(""),ey(!0)},e1=async()=>{if(eb)try{let e=localStorage.getItem("authToken"),t=await fetch(`/api/user/ratechart/${eb}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`}}),a=await t.json();a.success?(B("Rate chart deleted successfully"),eJ(),setTimeout(()=>{B("")},5e3)):(D(a.message||"Failed to delete rate chart"),setTimeout(()=>{D("")},5e3))}catch(e){console.error("Error deleting rate chart:",e),D("Error deleting rate chart"),setTimeout(()=>{D("")},5e3)}finally{ey(!1),ep(null),ej("")}},e2=async(e,t)=>{try{let a=localStorage.getItem("authToken");if(!a)return;let r=+(1!==t),s=Object.values(e4).find(t=>t.chartId===e),n=s?.chartRecordIds||[e],l=await fetch("/api/user/ratechart/status",{method:"PATCH",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({chartIds:n,status:r})}),i=await l.json();i.success?(B(`${f.ratechartManagement.statusUpdatedSuccessfully} ${1===r?f.ratechartManagement.active.toLowerCase():f.ratechartManagement.inactive.toLowerCase()}`),eJ(),setTimeout(()=>{B("")},5e3)):(D(i.message||f.ratechartManagement.failedToUpdateStatus),setTimeout(()=>{D("")},5e3))}catch(e){console.error("Error updating status:",e),D(f.ratechartManagement.errorUpdatingStatus),setTimeout(()=>{D("")},5e3)}},e5=async e=>{try{let t=localStorage.getItem("authToken");if(!t)return;let a=Object.values(e4).filter(e=>e.chartRecordIds.some(e=>ei.has(e))),r=a.flatMap(e=>e.chartRecordIds),s=await fetch("/api/user/ratechart/status",{method:"PATCH",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({chartIds:r,status:+("active"===e)})}),n=await s.json();n.success?(B(`✅ ${a.length} ${f.ratechartManagement.bulkStatusUpdated} ${"active"===e?f.ratechartManagement.active.toLowerCase():f.ratechartManagement.inactive.toLowerCase()}`),setTimeout(()=>B(""),5e3),ed(new Set),eo(!1),await eJ()):(D(n.message||f.ratechartManagement.failedToUpdateStatus),setTimeout(()=>D(""),5e3))}catch(e){console.error("Error updating bulk status:",e),D(f.ratechartManagement.errorUpdatingStatus),setTimeout(()=>D(""),5e3)}},e3=j.filter(e=>{if("all"!==er)if("unique"===er){let t=j.some(t=>t.shared_chart_id===e.id);if(null!==e.shared_chart_id||t)return!1}else{var t;if((({COW:"COW",BUF:"BUFFALO",MIX:"MIXED",BUFFALO:"BUFFALO",MIXED:"MIXED"})[t=e.channel]||t)!==er)return!1}if(""!==en){let t=en.toLowerCase();if(!(e.societyName.toLowerCase().includes(t)||e.societyIdentifier.toLowerCase().includes(t)||e.channel.toLowerCase().includes(t)||e.fileName.toLowerCase().includes(t)||e.uploadedBy.toLowerCase().includes(t)))return!1}return!0}),e4=e3.filter(e=>null===e.shared_chart_id).reduce((e,t)=>(e[t.id]={chartId:t.id,fileName:t.fileName,channel:t.channel,uploadedBy:t.uploadedBy,createdAt:t.uploadedAt,recordCount:t.recordCount,status:t.status,societies:[],chartRecordIds:[t.id]},e[t.id].societies.push({societyId:t.societyId,societyName:t.societyName,societyIdentifier:t.societyIdentifier,chartRecordId:t.id}),e3.forEach(a=>{a.shared_chart_id===t.id&&(e[t.id].societies.push({societyId:a.societyId,societyName:a.societyName,societyIdentifier:a.societyIdentifier,chartRecordId:a.id}),e[t.id].chartRecordIds.push(a.id))}),e),{}),e6=Object.values(e4).filter(e=>e.societies.some(e=>{let t=v.find(t=>t.id===e.societyId);if(!t)return!1;let a=t.bmc_id?M.find(e=>e.id===t.bmc_id):null,r=a?.dairyFarmId?C.find(e=>e.id===a.dairyFarmId):null;return!!(0===V.length||V.includes(r?.id.toString()||""))&&!!(0===Y.length||Y.includes(a?.id.toString()||""))&&!!(0===Z.length||Z.includes(e.societyId.toString()))&&(!(et.length>0)||!!A.filter(t=>t.societyId===e.societyId).some(e=>et.includes(e.id.toString())))&&!0}));(0,a.useEffect)(()=>{if(ei.size>0){let e=new Set(e3.map(e=>e.id)),t=new Set(Array.from(ei).filter(t=>e.has(t)));t.size!==ei.size&&(ed(t),eo(!1))}},[Z,er,en,j]);let e7=async()=>{if(0!==ei.size){eh(!1),ex(!0),X(0);try{let e=localStorage.getItem("authToken");X(10);let t=Array.from(ei),a=t.map(t=>fetch(`/api/user/ratechart/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`}}));X(30),await Promise.all(a),X(70),await eJ(),X(95),ed(new Set),eo(!1),B(`Successfully deleted ${t.length} rate chart(s)`),D(""),X(100),setTimeout(()=>{B("")},5e3)}catch(e){console.error("Error deleting rate charts:",e),D("Error deleting selected rate charts"),setTimeout(()=>{D("")},5e3)}finally{ex(!1),X(0)}}},e9=async(e,t)=>{if(ev)try{let a=localStorage.getItem("authToken");if(!a)return;let r=await fetch("/api/user/ratechart/assign",{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({masterChartId:ev.chartId,societyIds:e,replaceExisting:t})}),s=await r.json();if(409===r.status&&s.requiresConfirmation)return{requiresConfirmation:!0,conflicts:s.conflicts};if(s.success){B(`Successfully assigned chart to ${s.data.assignedCount} ${1===s.data.assignedCount?"society":"societies"}`),setTimeout(()=>B(""),5e3),await eJ(),eN(!1),ew(null);return}D(s.message||"Failed to assign chart to societies"),setTimeout(()=>D(""),5e3)}catch(e){console.error("Error assigning chart to societies:",e),D("Error assigning chart to societies"),setTimeout(()=>D(""),5e3)}},e8=async e=>{if(eq)try{let t=localStorage.getItem("authToken");if(!t)return;let a=await fetch("/api/user/ratechart/reset-download",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({chartIds:eq.chartRecordIds||[eq.chartId],machineIds:e,channel:eq.channel})}),r=await a.json();if(r.success){let t=e.length,a=eq.fileName,r=eq.channel;B(`✅ Successfully reset ${r} channel download status for ${t} machine${t>1?"s":""}. Chart "${a}" can now be re-downloaded by selected machines.`),setTimeout(()=>B(""),6e3),e_(!1),eV(null)}else D(r.message||"Failed to reset download history"),setTimeout(()=>D(""),5e3)}catch(e){console.error("Error resetting download history:",e),D("❌ Error resetting download history. Please try again."),setTimeout(()=>D(""),5e3)}},te=async(e,t,a)=>{try{let r=localStorage.getItem("authToken");if(!r)return;let s=await fetch("/api/user/ratechart/remove-society",{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({chartId:e,societyId:t})}),n=await s.json();n.success?(B(`✅ Successfully removed ${a} from rate chart`),setTimeout(()=>B(""),5e3),N([]),await eJ()):(D(n.message||"Failed to remove society"),setTimeout(()=>D(""),5e3))}catch(e){console.error("Error removing society:",e),D("❌ Error removing society. Please try again."),setTimeout(()=>D(""),5e3)}},tt=j.filter(e=>null===e.shared_chart_id),ta=tt.filter(e=>!j.some(t=>t.shared_chart_id===e.id)).length,tr=j.length,ts=tt.filter(e=>"COW"===e.channel).length,tn=tt.filter(e=>"BUF"===e.channel).length,tl=tt.filter(e=>"MIX"===e.channel).length;return T?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsx)(c.FlowerSpinner,{size:48,isLoading:!0})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.LoadingSnackbar,{isVisible:z||em,message:em?f.ratechartManagement.deletingRateCharts:f.ratechartManagement.uploadingRateChart,submessage:em?f.ratechartManagement.pleaseWaitDeleting:f.ratechartManagement.pleaseWaitUploading,progress:W,showProgress:!0}),(0,t.jsxs)("div",{className:"p-4 sm:p-6 lg:p-8 space-y-4 sm:space-y-6 lg:pb-8",children:[(0,t.jsx)(H.default,{title:f.ratechartManagement.title,subtitle:f.ratechartManagement.subtitle,icon:(0,t.jsx)(l.Receipt,{className:"w-5 h-5 sm:w-6 sm:h-6"}),onRefresh:eJ}),(0,t.jsx)(o.StatusMessage,{success:L,error:O,onClose:()=>{B(""),D("")}}),(0,t.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-2 sm:gap-3",children:[(0,t.jsx)(g.StatsCard,{title:f.ratechartManagement.uniqueCharts,value:ta,icon:(0,t.jsx)(l.Receipt,{className:"w-4 h-4"}),color:"blue",onClick:()=>es("unique"),clickable:!0,isActive:"unique"===er}),(0,t.jsx)(g.StatsCard,{title:f.ratechartManagement.totalAssignments,value:tr,icon:(0,t.jsx)(l.Receipt,{className:"w-4 h-4"}),color:"gray",onClick:()=>{es("all"),eI(!0)},clickable:!0,isActive:"all"===er}),(0,t.jsx)(g.StatsCard,{title:f.ratechartManagement.cowCharts,value:ts,icon:(0,t.jsx)(l.Receipt,{className:"w-4 h-4"}),color:"green",onClick:()=>es("COW"),clickable:!0,isActive:"COW"===er}),(0,t.jsx)(g.StatsCard,{title:f.ratechartManagement.buffaloCharts,value:tn,icon:(0,t.jsx)(l.Receipt,{className:"w-4 h-4"}),color:"blue",onClick:()=>es("BUFFALO"),clickable:!0,isActive:"BUFFALO"===er}),(0,t.jsx)(g.StatsCard,{title:f.ratechartManagement.mixedCharts,value:tl,icon:(0,t.jsx)(l.Receipt,{className:"w-4 h-4"}),color:"yellow",onClick:()=>es("MIXED"),clickable:!0,isActive:"MIXED"===er})]}),(0,t.jsx)(K.default,{statusFilter:"all",onStatusChange:()=>{},dairyFilter:V,onDairyChange:e=>Q(Array.isArray(e)?e:[e]),bmcFilter:Y,onBmcChange:e=>G(Array.isArray(e)?e:[e]),societyFilter:Z,onSocietyChange:e=>ee(Array.isArray(e)?e:[e]),machineFilter:et,onMachineChange:e=>ea(Array.isArray(e)?e:[e]),channelFilter:er,onChannelChange:es,dairies:C,bmcs:M,societies:v,machines:A,filteredCount:e6.length,totalCount:j.length,searchQuery:en,onSearchChange:el,icon:(0,t.jsx)(l.Receipt,{className:"w-5 h-5"}),showChannelFilter:!0,hideMainFilterButton:!0}),ei.size>0&&(0,t.jsx)(x.BulkActionsToolbar,{selectedCount:e6.filter(e=>e.chartRecordIds.some(e=>ei.has(e))).length,totalCount:e6.length,onBulkDelete:()=>eh(!0),onClearSelection:()=>{ed(new Set),eo(!1)},itemType:"rate chart",showStatusUpdate:!0,currentBulkStatus:eC,onBulkStatusChange:e=>{eS(e),e5(e)},statusOptions:[{status:"active",label:f.ratechartManagement.active,color:"bg-green-500",bgColor:"hover:bg-green-50 dark:hover:bg-green-900/30"},{status:"inactive",label:f.ratechartManagement.inactive,color:"bg-red-500",bgColor:"hover:bg-red-50 dark:hover:bg-red-900/30"}]}),(0,t.jsx)("div",{className:"space-y-6",children:0===e6.length?(0,t.jsx)(h.EmptyState,{icon:(0,t.jsx)(l.Receipt,{className:"w-12 h-12"}),title:f.ratechartManagement.noRateChartsFound,message:f.ratechartManagement.uploadFirstChart,actionText:f.ratechartManagement.uploadRateChart,onAction:()=>E(!0),showAction:!0}):(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-4",children:e6.map(e=>{let a=e.chartRecordIds.every(e=>ei.has(e));return(0,t.jsx)(U,{chartId:e.chartId,fileName:e.fileName,channel:e.channel,uploadedBy:e.uploadedBy,createdAt:e.createdAt,societies:e.societies,status:e.status,isSelected:a,searchQuery:en,onToggleSelection:()=>{a?e.chartRecordIds.forEach(e=>{ed(t=>{let a=new Set(t);return a.delete(e),a})}):e.chartRecordIds.forEach(e=>{ed(t=>new Set(t).add(e))})},onAssignSociety:()=>{var t;return t=e.chartId,void(ew({chartId:t,fileName:e.fileName,societies:e.societies}),eN(!0))},onDelete:()=>e0(e.chartRecordIds[0]),onToggleStatus:e2,onView:()=>{var t,a,r;return t=e.fileName,void(e$({fileName:t,channel:a=e.channel,societyId:r=e.societies[0]?.societyId||0}),eF(!0),eG(t,a,r))},onResetDownload:()=>{var t,a,r,s,n;return t=e.chartId,a=e.fileName,r=e.channel,s=e.societies,n=e.chartRecordIds,void(eV({chartId:t,fileName:a,channel:r,societies:s.map(e=>({societyId:e.societyId,societyName:e.societyName})),chartRecordIds:n}),e_(!0))},onRemoveSociety:te},e.chartId)})})})]}),(0,t.jsx)(k,{isOpen:R,onClose:()=>E(!1),societies:v,onUploadSuccess:e=>{B(e),eJ(),setTimeout(()=>{B("")},5e3)},onUploadError:e=>{D(e),setTimeout(()=>{D("")},5e3)},onUploadStart:()=>P(!0),onUploadEnd:()=>P(!1),onProgressUpdate:e=>X(e)}),(0,t.jsx)(y.default,{isOpen:eg,onClose:()=>eh(!1),onConfirm:e7,itemCount:Object.values(e4).filter(e=>e.chartRecordIds.some(e=>ei.has(e))).length,itemType:"rate chart",hasFilters:Z.length>0||"all"!==er||""!==en,additionalInfo:(()=>{let e=Object.values(e4).filter(e=>e.chartRecordIds.some(e=>ei.has(e)));if(0!==e.length)return e.map(e=>{let t=e.societies.map(e=>e.societyIdentifier||e.societyId.toString()).join(", ");return`${e.fileName} (${e.channel}): ${t}`}).join(" | ")})()}),ev&&(0,t.jsx)(_,{isOpen:ek,onClose:()=>{eN(!1),ew(null)},onAssign:e9,chartId:ev.chartId,fileName:ev.fileName,currentSocieties:ev.societies,allSocieties:v}),(0,t.jsx)(q,{isOpen:eM,onClose:()=>eI(!1),rateCharts:j}),(0,t.jsx)(y.default,{isOpen:eu,onClose:()=>{ey(!1),ep(null),ej("")},onConfirm:e1,itemCount:1,itemType:"rate chart",additionalInfo:ef?`Assigned to society IDs: ${ef}`:void 0}),eA&&eT&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,t.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:["Rate Chart - ",eT.channel," Channel"]}),(0,t.jsx)("button",{onClick:eZ,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:(0,t.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,t.jsx)("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg mb-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"File Name"}),(0,t.jsx)("p",{className:"text-base font-semibold text-gray-900 dark:text-white",children:eT.fileName})]}),(0,t.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",children:eT.channel})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-3 mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Search FAT"}),(0,t.jsx)("input",{type:"text",value:eO,onChange:e=>eU(e.target.value),placeholder:"e.g., 3.5",className:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Search SNF"}),(0,t.jsx)("input",{type:"text",value:eD,onChange:e=>ez(e.target.value),placeholder:"e.g., 8.5",className:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Search CLR"}),(0,t.jsx)("input",{type:"text",value:eP,onChange:e=>eW(e.target.value),placeholder:"e.g., 25.0",className:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]})]}),(0,t.jsx)("div",{className:"overflow-auto max-h-[60vh]",children:eL?(0,t.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,t.jsx)(c.FlowerSpinner,{})}):(e=eR.filter(e=>{let t=!eO||e.fat.toLowerCase().includes(eO.toLowerCase()),a=!eD||e.snf.toLowerCase().includes(eD.toLowerCase()),r=!eP||e.clr.toLowerCase().includes(eP.toLowerCase());return t&&a&&r})).length>0?(0,t.jsxs)("div",{children:[(0,t.jsxs)("table",{className:"w-full border-collapse",children:[(0,t.jsx)("thead",{className:"sticky top-0 bg-gray-100 dark:bg-gray-700",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider border border-gray-300 dark:border-gray-600",children:"FAT"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider border border-gray-300 dark:border-gray-600",children:"SNF"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider border border-gray-300 dark:border-gray-600",children:"CLR"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider border border-gray-300 dark:border-gray-600",children:"Rate"})]})}),(0,t.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:e.map((e,a)=>(0,t.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600",children:e.fat}),(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600",children:e.snf}),(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600",children:e.clr}),(0,t.jsxs)("td",{className:"px-4 py-3 text-sm font-semibold text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600",children:["₹",e.rate]})]},a))})]}),(0,t.jsxs)("div",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400 text-right",children:["Showing ",e.length," of ",eR.length," records"]})]}):(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(i.FileText,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),(0,t.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:eO||eD||eP?"No matching records found":"No data available for this rate chart"})]})}),(0,t.jsx)("div",{className:"flex justify-end pt-4 border-t border-gray-200 dark:border-gray-700 mt-4",children:(0,t.jsx)("button",{onClick:eZ,className:"px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:"Close"})})]})})}),eq&&(0,t.jsx)(J,{show:eX,onClose:()=>{e_(!1),eV(null)},onConfirm:e8,chartId:eq.chartId,fileName:eq.fileName,channel:eq.channel,societies:eq.societies}),(0,t.jsx)(u.FloatingActionButton,{actions:[{icon:(0,t.jsx)(d.Upload,{className:"w-6 h-6 text-white"}),label:f.ratechartManagement.uploadRateChart,onClick:()=>E(!0),color:"bg-gradient-to-br from-green-500 to-green-600"}],directClick:!0})]})}e.s(["default",()=>Q],21119)}]);