{"version":3,"sources":["turbopack:///[project]/src/models/User.ts","turbopack:///[project]/src/lib/auth.ts","turbopack:///[project]/src/middleware/auth.ts","turbopack:///[project]/src/app/api/user/society/send-delete-otp/route.ts"],"sourcesContent":["import { DataTypes, Model, Sequelize } from 'sequelize';\r\nimport bcrypt from 'bcryptjs';\r\n\r\n// User roles in hierarchical order\r\nexport enum UserRole {\r\n  SUPER_ADMIN = 'super_admin',\r\n  ADMIN = 'admin',\r\n  DAIRY = 'dairy',\r\n  BMC = 'bmc',\r\n  SOCIETY = 'society',\r\n  FARMER = 'farmer'\r\n}\r\n\r\n// User status\r\nexport enum UserStatus {\r\n  PENDING = 'pending',\r\n  PENDING_APPROVAL = 'pending_approval', // Email verified, waiting for super admin approval\r\n  ACTIVE = 'active',\r\n  INACTIVE = 'inactive',\r\n  SUSPENDED = 'suspended'\r\n}\r\n\r\n// User attributes interface\r\nexport interface UserAttributes {\r\n  id?: number;\r\n  uid: string;\r\n  email: string;\r\n  password: string;\r\n  fullName: string;\r\n  role: UserRole;\r\n  status: UserStatus;\r\n  dbKey?: string; // For admins - their dedicated schema key\r\n  companyName?: string;\r\n  companyPincode?: string;\r\n  companyCity?: string;\r\n  companyState?: string;\r\n  parentId?: number; // Reference to parent user in hierarchy\r\n  isEmailVerified: boolean;\r\n  emailVerificationToken?: string;\r\n  emailVerificationExpires?: Date;\r\n  passwordResetToken?: string;\r\n  passwordResetExpires?: Date;\r\n  otpCode?: string;\r\n  otpExpires?: Date;\r\n  lastLogin?: Date;\r\n  loginAttempts: number;\r\n  lockUntil?: Date;\r\n  createdAt?: Date;\r\n  updatedAt?: Date;\r\n}\r\n\r\n// User model class\r\nclass User extends Model<UserAttributes> implements UserAttributes {\r\n  // Remove public class fields to avoid shadowing Sequelize getters/setters\r\n  declare id: number;\r\n  declare uid: string;\r\n  declare email: string;\r\n  declare password: string;\r\n  declare fullName: string;\r\n  declare role: UserRole;\r\n  declare status: UserStatus;\r\n  declare dbKey?: string;\r\n  declare companyName?: string;\r\n  declare companyPincode?: string;\r\n  declare companyCity?: string;\r\n  declare companyState?: string;\r\n  declare parentId?: number;\r\n  declare isEmailVerified: boolean;\r\n  declare emailVerificationToken?: string;\r\n  declare emailVerificationExpires?: Date;\r\n  declare passwordResetToken?: string;\r\n  declare passwordResetExpires?: Date;\r\n  declare otpCode?: string;\r\n  declare otpExpires?: Date;\r\n  declare lastLogin?: Date;\r\n  declare loginAttempts: number;\r\n  declare lockUntil?: Date;\r\n\r\n  // Timestamps\r\n  declare readonly createdAt: Date;\r\n  declare readonly updatedAt: Date;\r\n\r\n  // Instance methods\r\n  public async comparePassword(candidatePassword: string): Promise<boolean> {\r\n    return bcrypt.compare(candidatePassword, this.password);\r\n  }\r\n\r\n  public async incLoginAttempts(): Promise<void> {\r\n    // If we have a previous lock that has expired, restart at 1\r\n    if (this.lockUntil && this.lockUntil < new Date()) {\r\n      await this.update({\r\n        loginAttempts: 1,\r\n        lockUntil: undefined\r\n      });\r\n      return;\r\n    }\r\n\r\n    const updates: Partial<UserAttributes> = { loginAttempts: this.loginAttempts + 1 };\r\n\r\n    // Lock account after 5 failed attempts for 2 hours\r\n    if (this.loginAttempts + 1 >= 5 && !this.isLocked) {\r\n      updates.lockUntil = new Date(Date.now() + 2 * 60 * 60 * 1000); // 2 hours\r\n    }\r\n\r\n    await this.update(updates);\r\n  }\r\n\r\n  public async resetLoginAttempts(): Promise<void> {\r\n    await this.update({\r\n      loginAttempts: 0,\r\n      lockUntil: undefined\r\n    });\r\n  }\r\n\r\n  public get isLocked(): boolean {\r\n    return !!(this.lockUntil && this.lockUntil > new Date());\r\n  }\r\n\r\n\r\n\r\n  public canManageRole(targetRole: UserRole): boolean {\r\n    const roleHierarchy = [\r\n      UserRole.SUPER_ADMIN,\r\n      UserRole.ADMIN,\r\n      UserRole.DAIRY,\r\n      UserRole.BMC,\r\n      UserRole.SOCIETY,\r\n      UserRole.FARMER\r\n    ];\r\n\r\n    const currentRoleIndex = roleHierarchy.indexOf(this.role);\r\n    const targetRoleIndex = roleHierarchy.indexOf(targetRole);\r\n\r\n    return currentRoleIndex < targetRoleIndex;\r\n  }\r\n}\r\n\r\n// Initialize User model\r\nexport const initUserModel = (sequelize: Sequelize): typeof User => {\r\n  User.init(\r\n    {\r\n      id: {\r\n        type: DataTypes.INTEGER,\r\n        primaryKey: true,\r\n        autoIncrement: true,\r\n      },\r\n      uid: {\r\n        type: DataTypes.STRING(50),\r\n        allowNull: false,\r\n        unique: true,\r\n        validate: {\r\n          notEmpty: true,\r\n          len: [3, 50]\r\n        }\r\n      },\r\n      email: {\r\n        type: DataTypes.STRING(255),\r\n        allowNull: false,\r\n        unique: true,\r\n        validate: {\r\n          isEmail: true,\r\n          notEmpty: true\r\n        }\r\n      },\r\n      password: {\r\n        type: DataTypes.STRING(255),\r\n        allowNull: false,\r\n        validate: {\r\n          notEmpty: true,\r\n          len: [6, 255]\r\n        }\r\n      },\r\n      fullName: {\r\n        type: DataTypes.STRING(200),\r\n        allowNull: false,\r\n        validate: {\r\n          notEmpty: true,\r\n          len: [2, 200]\r\n        }\r\n      },\r\n      role: {\r\n        type: DataTypes.ENUM(...Object.values(UserRole)),\r\n        allowNull: false,\r\n        defaultValue: UserRole.FARMER\r\n      },\r\n      status: {\r\n        type: DataTypes.ENUM(...Object.values(UserStatus)),\r\n        allowNull: false,\r\n        defaultValue: UserStatus.PENDING\r\n      },\r\n      dbKey: {\r\n        type: DataTypes.STRING(50),\r\n        allowNull: true,\r\n        unique: true,\r\n        comment: 'Dedicated database schema key for admins'\r\n      },\r\n      companyName: {\r\n        type: DataTypes.STRING(255),\r\n        allowNull: true\r\n      },\r\n      companyPincode: {\r\n        type: DataTypes.STRING(10),\r\n        allowNull: true,\r\n        validate: {\r\n          len: [5, 10]\r\n        }\r\n      },\r\n      companyCity: {\r\n        type: DataTypes.STRING(100),\r\n        allowNull: true,\r\n        validate: {\r\n          len: [2, 100]\r\n        }\r\n      },\r\n      companyState: {\r\n        type: DataTypes.STRING(100),\r\n        allowNull: true,\r\n        validate: {\r\n          len: [2, 100]\r\n        }\r\n      },\r\n      parentId: {\r\n        type: DataTypes.INTEGER,\r\n        allowNull: true,\r\n        references: {\r\n          model: 'users',\r\n          key: 'id'\r\n        }\r\n      },\r\n      isEmailVerified: {\r\n        type: DataTypes.BOOLEAN,\r\n        allowNull: false,\r\n        defaultValue: false\r\n      },\r\n      emailVerificationToken: {\r\n        type: DataTypes.STRING(255),\r\n        allowNull: true\r\n      },\r\n      emailVerificationExpires: {\r\n        type: DataTypes.DATE,\r\n        allowNull: true\r\n      },\r\n      passwordResetToken: {\r\n        type: DataTypes.STRING(255),\r\n        allowNull: true\r\n      },\r\n      passwordResetExpires: {\r\n        type: DataTypes.DATE,\r\n        allowNull: true\r\n      },\r\n      otpCode: {\r\n        type: DataTypes.STRING(10),\r\n        allowNull: true\r\n      },\r\n      otpExpires: {\r\n        type: DataTypes.DATE,\r\n        allowNull: true\r\n      },\r\n      lastLogin: {\r\n        type: DataTypes.DATE,\r\n        allowNull: true\r\n      },\r\n      loginAttempts: {\r\n        type: DataTypes.INTEGER,\r\n        allowNull: false,\r\n        defaultValue: 0\r\n      },\r\n      lockUntil: {\r\n        type: DataTypes.DATE,\r\n        allowNull: true\r\n      }\r\n    },\r\n    {\r\n      sequelize,\r\n      modelName: 'User',\r\n      tableName: 'users',\r\n      timestamps: true,\r\n      hooks: {\r\n        beforeSave: async (user: User) => {\r\n          // Hash password if it's being modified\r\n          if (user.changed('password') && user.password) {\r\n            const salt = await bcrypt.genSalt(12);\r\n            user.password = await bcrypt.hash(user.password, salt);\r\n          }\r\n\r\n          // Generate UID if not provided\r\n          if (!user.uid && user.email) {\r\n            const timestamp = Date.now().toString().slice(-6);\r\n            const emailPrefix = user.email.substring(0, 3).toUpperCase();\r\n            user.uid = `${emailPrefix}${timestamp}`;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  );\r\n\r\n  // Define associations\r\n  User.hasMany(User, { \r\n    as: 'Children', \r\n    foreignKey: 'parentId',\r\n    onDelete: 'SET NULL'\r\n  });\r\n  \r\n  User.belongsTo(User, { \r\n    as: 'Parent', \r\n    foreignKey: 'parentId',\r\n    onDelete: 'SET NULL'\r\n  });\r\n\r\n  return User;\r\n};\r\n\r\nexport default User;","import jwt from 'jsonwebtoken';\r\nimport crypto from 'crypto';\r\nimport { UserRole } from '@/models/User';\r\n\r\n// JWT configuration\r\nconst JWT_SECRET = process.env.JWT_SECRET || 'your-super-secret-jwt-key';\r\nconst JWT_REFRESH_SECRET = process.env.JWT_REFRESH_SECRET || 'your-super-secret-refresh-jwt-key';\r\n\r\n// JWT payload interface\r\nexport interface JWTPayload {\r\n  id: number;\r\n  uid: string;\r\n  email: string;\r\n  role: UserRole | string; // Allow string for external auth entity types\r\n  dbKey?: string;\r\n  entityType?: 'society' | 'farmer' | 'dairy' | 'bmc'; // For external auth\r\n  schemaName?: string; // For external auth\r\n}\r\n\r\n// Generate JWT tokens\r\nexport const generateTokens = (user: JWTPayload) => {\r\n  const payload = {\r\n    id: user.id,\r\n    uid: user.uid,\r\n    email: user.email,\r\n    role: user.role,\r\n    dbKey: user.dbKey,\r\n    entityType: user.entityType,\r\n    schemaName: user.schemaName\r\n  };\r\n\r\n  const token = jwt.sign(payload, JWT_SECRET as string, {\r\n    expiresIn: '7d',\r\n    issuer: 'poornasree-equipments-cloud',\r\n    audience: 'psr-client'\r\n  });\r\n\r\n  const refreshToken = jwt.sign(payload, JWT_REFRESH_SECRET as string, {\r\n    expiresIn: '30d',\r\n    issuer: 'poornasree-equipments-cloud',\r\n    audience: 'psr-client'\r\n  });\r\n\r\n  return { token, refreshToken };\r\n};\r\n\r\n// Verify JWT token\r\nexport const verifyToken = (token: string): JWTPayload | null => {\r\n  try {\r\n    const decoded = jwt.verify(token, JWT_SECRET as string, {\r\n      issuer: 'poornasree-equipments-cloud',\r\n      audience: 'psr-client'\r\n    }) as JWTPayload;\r\n    return decoded;\r\n  } catch (error) {\r\n    console.error('JWT verification failed:', error);\r\n    return null;\r\n  }\r\n};\r\n\r\n// Verify refresh token\r\nexport const verifyRefreshToken = (token: string): JWTPayload | null => {\r\n  try {\r\n    const decoded = jwt.verify(token, JWT_REFRESH_SECRET as string, {\r\n      issuer: 'poornasree-equipments-cloud',\r\n      audience: 'psr-client'\r\n    }) as JWTPayload;\r\n    return decoded;\r\n  } catch (error) {\r\n    console.error('Refresh token verification failed:', error);\r\n    return null;\r\n  }\r\n};\r\n\r\n// Generate random token\r\nexport const generateRandomToken = (length: number = 32): string => {\r\n  return crypto.randomBytes(length).toString('hex');\r\n};\r\n\r\n// Generate OTP\r\nexport const generateOTP = (length: number = 6): string => {\r\n  const digits = '0123456789';\r\n  let otp = '';\r\n  for (let i = 0; i < length; i++) {\r\n    otp += digits[Math.floor(Math.random() * digits.length)];\r\n  }\r\n  return otp;\r\n};\r\n\r\n// Hash token for database storage\r\nexport const hashToken = (token: string): string => {\r\n  return crypto.createHash('sha256').update(token).digest('hex');\r\n};\r\n\r\n// Role hierarchy checker\r\nexport const canManageRole = (userRole: UserRole, targetRole: UserRole): boolean => {\r\n  const roleHierarchy: Record<UserRole, number> = {\r\n    [UserRole.SUPER_ADMIN]: 0,\r\n    [UserRole.ADMIN]: 1,\r\n    [UserRole.DAIRY]: 2,\r\n    [UserRole.BMC]: 3,\r\n    [UserRole.SOCIETY]: 4,\r\n    [UserRole.FARMER]: 5\r\n  };\r\n\r\n  return roleHierarchy[userRole] < roleHierarchy[targetRole];\r\n};\r\n\r\n// Get allowed roles for user\r\nexport const getAllowedRoles = (userRole: UserRole): UserRole[] => {\r\n  const allRoles = [\r\n    UserRole.SUPER_ADMIN,\r\n    UserRole.ADMIN,\r\n    UserRole.DAIRY,\r\n    UserRole.BMC,\r\n    UserRole.SOCIETY,\r\n    UserRole.FARMER\r\n  ];\r\n\r\n  const roleHierarchy: Record<UserRole, number> = {\r\n    [UserRole.SUPER_ADMIN]: 0,\r\n    [UserRole.ADMIN]: 1,\r\n    [UserRole.DAIRY]: 2,\r\n    [UserRole.BMC]: 3,\r\n    [UserRole.SOCIETY]: 4,\r\n    [UserRole.FARMER]: 5\r\n  };\r\n\r\n  const userLevel = roleHierarchy[userRole];\r\n  return allRoles.filter(role => roleHierarchy[role] > userLevel);\r\n};\r\n\r\n// Check if user is super admin\r\nexport const isSuperAdmin = (user: { email?: string; role?: UserRole }): boolean => {\r\n  const superAdminEmail = process.env.SUPER_ADMIN_USERNAME || 'admin';\r\n  return (\r\n    user.email === superAdminEmail || \r\n    user.role === UserRole.SUPER_ADMIN\r\n  );\r\n};\r\n\r\n// Validate password strength\r\nexport const validatePassword = (password: string): { \r\n  isValid: boolean; \r\n  errors: string[] \r\n} => {\r\n  const errors: string[] = [];\r\n  \r\n  if (password.length < 8) {\r\n    errors.push('Password must be at least 8 characters long');\r\n  }\r\n  \r\n  if (!/[A-Z]/.test(password)) {\r\n    errors.push('Password must contain at least one uppercase letter');\r\n  }\r\n  \r\n  if (!/[a-z]/.test(password)) {\r\n    errors.push('Password must contain at least one lowercase letter');\r\n  }\r\n  \r\n  if (!/\\d/.test(password)) {\r\n    errors.push('Password must contain at least one number');\r\n  }\r\n  \r\n  if (!/[!@#$%^&*()_+\\-=\\[\\]{};':\"\\\\|,.<>\\/?]/.test(password)) {\r\n    errors.push('Password must contain at least one special character');\r\n  }\r\n\r\n  return {\r\n    isValid: errors.length === 0,\r\n    errors\r\n  };\r\n};\r\n\r\n// Generate secure session ID\r\nexport const generateSessionId = (): string => {\r\n  return crypto.randomBytes(64).toString('hex');\r\n};\r\n\r\nconst authUtils = {\r\n  generateTokens,\r\n  verifyToken,\r\n  verifyRefreshToken,\r\n  generateRandomToken,\r\n  generateOTP,\r\n  hashToken,\r\n  canManageRole,\r\n  getAllowedRoles,\r\n  isSuperAdmin,\r\n  validatePassword,\r\n  generateSessionId\r\n};\r\n\r\nexport default authUtils;","import { NextRequest, NextResponse } from 'next/server';\r\nimport { verifyToken, JWTPayload } from '@/lib/auth';\r\nimport { UserRole } from '@/models/User';\r\n\r\n// Types for authentication middleware\r\n\r\nexport interface AuthenticatedRequest extends NextRequest {\r\n  user?: JWTPayload;\r\n}\r\n\r\n// Authentication middleware\r\nexport const authenticateToken = (req: NextRequest): { \r\n  success: boolean; \r\n  user?: JWTPayload; \r\n  error?: string \r\n} => {\r\n  try {\r\n    const authHeader = req.headers.get('authorization');\r\n    const token = authHeader?.split(' ')[1]; // Bearer TOKEN\r\n\r\n    if (!token) {\r\n      return { success: false, error: 'Access token required' };\r\n    }\r\n\r\n    const decoded = verifyToken(token);\r\n    if (!decoded) {\r\n      return { success: false, error: 'Invalid or expired token' };\r\n    }\r\n\r\n    return { success: true, user: decoded };\r\n  } catch {\r\n    return { success: false, error: 'Authentication failed' };\r\n  }\r\n};\r\n\r\n// Role-based authorization middleware\r\nexport const authorizeRole = (requiredRoles: UserRole[]) => {\r\n  return (user: JWTPayload): { success: boolean; error?: string } => {\r\n    if (!user) {\r\n      return { success: false, error: 'User not authenticated' };\r\n    }\r\n\r\n    if (!requiredRoles.includes(user.role as UserRole)) {\r\n      return { success: false, error: 'Insufficient permissions' };\r\n    }\r\n\r\n    return { success: true };\r\n  };\r\n};\r\n\r\n// Super Admin authorization\r\nexport const requireSuperAdmin = (user: JWTPayload): { success: boolean; error?: string } => {\r\n  if (!user) {\r\n    return { success: false, error: 'User not authenticated' };\r\n  }\r\n\r\n  if (user.role !== UserRole.SUPER_ADMIN && user.email !== (process.env.SUPER_ADMIN_USERNAME || 'admin')) {\r\n    return { success: false, error: 'Super Admin access required' };\r\n  }\r\n\r\n  return { success: true };\r\n};\r\n\r\n// Admin or higher authorization\r\nexport const requireAdmin = (user: JWTPayload): { success: boolean; error?: string } => {\r\n  if (!user) {\r\n    return { success: false, error: 'User not authenticated' };\r\n  }\r\n\r\n  const adminRoles = [UserRole.SUPER_ADMIN, UserRole.ADMIN];\r\n  if (!adminRoles.includes(user.role as UserRole)) {\r\n    return { success: false, error: 'Admin access required' };\r\n  }\r\n\r\n  return { success: true };\r\n};\r\n\r\n// Hierarchy-based authorization\r\nexport const requireHierarchyAccess = (targetUserId: number, currentUser: JWTPayload): {\r\n  success: boolean; \r\n  error?: string \r\n} => {\r\n  // Super admin can access everything\r\n  if (currentUser.role === UserRole.SUPER_ADMIN) {\r\n    return { success: true };\r\n  }\r\n\r\n  // Admin can access users in their schema\r\n  if (currentUser.role === UserRole.ADMIN && currentUser.dbKey) {\r\n    // Additional logic would be needed to check if targetUser belongs to admin's schema\r\n    return { success: true };\r\n  }\r\n\r\n  // For other roles, implement specific hierarchy checks\r\n  // This would require database queries to verify parent-child relationships\r\n  \r\n  return { success: false, error: 'Access denied' };\r\n};\r\n\r\n// Response helpers\r\nexport const createErrorResponse = (message: string, status: number = 400) => {\r\n  return NextResponse.json(\r\n    { \r\n      success: false, \r\n      error: { message, code: status.toString() },\r\n      timestamp: new Date().toISOString()\r\n    },\r\n    { status }\r\n  );\r\n};\r\n\r\nexport const createSuccessResponse = (data: unknown, message: string = 'Success', status: number = 200) => {\r\n  return NextResponse.json(\r\n    {\r\n      success: true,\r\n      message,\r\n      data,\r\n      timestamp: new Date().toISOString()\r\n    },\r\n    { status }\r\n  );\r\n};\r\n\r\n// Validation helper\r\nexport const validateRequiredFields = (\r\n  body: Record<string, unknown>, \r\n  requiredFields: string[]\r\n): { success: boolean; missing?: string[] } => {\r\n  const missing = requiredFields.filter(field => \r\n    !body[field] || (typeof body[field] === 'string' && body[field].trim() === '')\r\n  );\r\n\r\n  if (missing.length > 0) {\r\n    return { success: false, missing };\r\n  }\r\n\r\n  return { success: true };\r\n};\r\n\r\n// Rate limiting (basic implementation)\r\nconst rateLimitMap = new Map<string, { count: number; resetTime: number }>();\r\n\r\nexport const checkRateLimit = (\r\n  identifier: string, \r\n  maxRequests: number = 100, \r\n  windowMs: number = 15 * 60 * 1000 // 15 minutes\r\n): { success: boolean; resetTime?: number } => {\r\n  const now = Date.now();\r\n  const record = rateLimitMap.get(identifier);\r\n\r\n  if (!record || now > record.resetTime) {\r\n    // Reset or create new record\r\n    rateLimitMap.set(identifier, { count: 1, resetTime: now + windowMs });\r\n    return { success: true };\r\n  }\r\n\r\n  if (record.count >= maxRequests) {\r\n    return { success: false, resetTime: record.resetTime };\r\n  }\r\n\r\n  record.count++;\r\n  return { success: true };\r\n};\r\n\r\n// CORS headers\r\nexport const setCorsHeaders = (response: NextResponse) => {\r\n  response.headers.set('Access-Control-Allow-Origin', process.env.CLIENT_URL || '*');\r\n  response.headers.set('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS');\r\n  response.headers.set('Access-Control-Allow-Headers', 'Content-Type, Authorization');\r\n  response.headers.set('Access-Control-Allow-Credentials', 'true');\r\n  return response;\r\n};\r\n\r\nconst middleware = {\r\n  authenticateToken,\r\n  authorizeRole,\r\n  requireSuperAdmin,\r\n  requireAdmin,\r\n  requireHierarchyAccess,\r\n  createErrorResponse,\r\n  createSuccessResponse,\r\n  validateRequiredFields,\r\n  checkRateLimit,\r\n  setCorsHeaders\r\n};\r\n\r\nexport default middleware;","import { NextRequest } from 'next/server';\r\nimport { verifyToken } from '@/lib/auth';\r\nimport { createErrorResponse, createSuccessResponse } from '@/middleware/auth';\r\nimport { connectDB } from '@/lib/database';\r\nimport { generateOTP } from '@/lib/emailService';\r\nimport nodemailer from 'nodemailer';\r\n\r\n// Use global object to persist OTP store across hot reloads and module instances\r\ndeclare global {\r\n  var societyDeleteOtpStore: Map<string, { otp: string; expires: Date; societyId: number }> | undefined;\r\n}\r\n\r\n// Initialize global OTP store if it doesn't exist\r\nif (!global.societyDeleteOtpStore) {\r\n  global.societyDeleteOtpStore = new Map<string, { otp: string; expires: Date; societyId: number }>();\r\n}\r\n\r\nconst otpStore = global.societyDeleteOtpStore;\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const token = request.headers.get('authorization')?.replace('Bearer ', '');\r\n    if (!token) {\r\n      return createErrorResponse('Authentication required', 401);\r\n    }\r\n\r\n    const payload = verifyToken(token);\r\n    if (!payload || payload.role !== 'admin') {\r\n      return createErrorResponse('Admin access required', 403);\r\n    }\r\n\r\n    const body = await request.json();\r\n    const { societyId } = body;\r\n\r\n    if (!societyId) {\r\n      return createErrorResponse('Society ID is required', 400);\r\n    }\r\n\r\n    await connectDB();\r\n    const { getModels } = await import('@/models');\r\n    const { User } = getModels();\r\n\r\n    // Get admin details\r\n    const admin = await User.findByPk(payload.id);\r\n    if (!admin || !admin.email) {\r\n      return createErrorResponse('Admin email not found', 404);\r\n    }\r\n\r\n    // Generate OTP\r\n    const otp = generateOTP();\r\n    const expires = new Date(Date.now() + 10 * 60 * 1000); // 10 minutes\r\n\r\n    // Store OTP in memory\r\n    const otpKey = `${admin.id}_${societyId}`;\r\n    otpStore.set(otpKey, { otp, expires, societyId });\r\n\r\n    // Clean up expired OTPs\r\n    for (const [key, value] of otpStore.entries()) {\r\n      if (value.expires < new Date()) {\r\n        otpStore.delete(key);\r\n      }\r\n    }\r\n\r\n    // Send OTP email\r\n    try {\r\n      const emailConfig = {\r\n        host: process.env.SMTP_HOST || process.env.EMAIL_HOST || 'smtp.gmail.com',\r\n        port: parseInt(process.env.SMTP_PORT || process.env.EMAIL_PORT || '587'),\r\n        secure: (process.env.SMTP_SECURE || process.env.EMAIL_SECURE) === 'true',\r\n        auth: {\r\n          user: process.env.SMTP_USERNAME || process.env.EMAIL_USER,\r\n          pass: process.env.SMTP_PASSWORD || process.env.EMAIL_PASSWORD,\r\n        },\r\n      };\r\n\r\n      const transporter = nodemailer.createTransport(emailConfig);\r\n\r\n      const mailOptions = {\r\n        from: `\"Poornasree Equipments Cloud\" <${process.env.SMTP_USERNAME || process.env.EMAIL_USER}>`,\r\n        to: admin.email,\r\n        subject: '‚ö†Ô∏è CRITICAL: Society Deletion Confirmation Required',\r\n      html: `\r\n        <!DOCTYPE html>\r\n        <html>\r\n        <head>\r\n          <meta charset=\"UTF-8\">\r\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n          <style>\r\n            body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; }\r\n            .container { max-width: 600px; margin: 0 auto; padding: 20px; }\r\n            .header { background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); color: white; padding: 30px; border-radius: 10px 10px 0 0; text-align: center; }\r\n            .content { background: #f9fafb; padding: 30px; border: 2px solid #fee2e2; }\r\n            .otp-box { background: white; border: 3px dashed #dc2626; border-radius: 10px; padding: 20px; margin: 20px 0; text-align: center; }\r\n            .otp { font-size: 36px; font-weight: bold; color: #dc2626; letter-spacing: 8px; font-family: 'Courier New', monospace; }\r\n            .warning { background: #fef3c7; border-left: 4px solid #f59e0b; padding: 15px; margin: 20px 0; border-radius: 5px; }\r\n            .footer { background: #1f2937; color: #9ca3af; padding: 20px; text-align: center; font-size: 12px; border-radius: 0 0 10px 10px; }\r\n            .icon { font-size: 48px; margin-bottom: 10px; }\r\n          </style>\r\n        </head>\r\n        <body>\r\n          <div class=\"container\">\r\n            <div class=\"header\">\r\n              <div class=\"icon\">üö®</div>\r\n              <h1 style=\"margin: 0; font-size: 24px;\">CRITICAL DELETION REQUEST</h1>\r\n              <p style=\"margin: 10px 0 0 0; opacity: 0.95;\">Society & All Related Data</p>\r\n            </div>\r\n            \r\n            <div class=\"content\">\r\n              <p style=\"margin-top: 0; font-size: 16px;\">Hello <strong>${admin.fullName}</strong>,</p>\r\n              \r\n              <div class=\"warning\">\r\n                <strong style=\"color: #dc2626; font-size: 18px;\">‚ö†Ô∏è THIS ACTION CANNOT BE UNDONE!</strong>\r\n                <p style=\"margin: 10px 0 0 0;\">You are about to permanently delete a society and ALL associated data from your system.</p>\r\n              </div>\r\n\r\n              <p style=\"font-weight: 600; margin-bottom: 10px;\">The following data will be permanently deleted:</p>\r\n              <ul style=\"color: #666; font-size: 14px; margin: 10px 0;\">\r\n                <li>All farmers under this society</li>\r\n                <li>All machines linked to this society</li>\r\n                <li>All machine statistics</li>\r\n                <li>All machine corrections (admin & device saved)</li>\r\n                <li>All rate charts and rate chart data</li>\r\n                <li>All milk collections</li>\r\n                <li>All sales records</li>\r\n                <li>All dispatch records</li>\r\n                <li>All section pulse tracking data</li>\r\n              </ul>\r\n\r\n              <p style=\"font-weight: 600; margin-top: 25px;\">Your One-Time Verification Code:</p>\r\n              \r\n              <div class=\"otp-box\">\r\n                <p style=\"margin: 0; font-size: 14px; color: #666;\">OTP Code</p>\r\n                <div class=\"otp\">${otp}</div>\r\n                <p style=\"margin: 10px 0 0 0; font-size: 12px; color: #999;\">Valid for 10 minutes only</p>\r\n              </div>\r\n\r\n              <div style=\"background: #fee2e2; border-radius: 8px; padding: 15px; margin-top: 20px;\">\r\n                <p style=\"margin: 0; font-size: 13px; color: #991b1b;\">\r\n                  <strong>Security Notice:</strong> If you did not request this deletion, please ignore this email and contact your system administrator immediately.\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            <div class=\"footer\">\r\n              <p style=\"margin: 0;\">Poornasree Equipments Cloud</p>\r\n              <p style=\"margin: 5px 0;\">This is an automated security message. Please do not reply to this email.</p>\r\n            </div>\r\n          </div>\r\n        </body>\r\n        </html>\r\n      `\r\n    };\r\n\r\n      await transporter.sendMail(mailOptions);\r\n      console.log(`‚úÖ Delete confirmation OTP sent to ${admin.email} for society ${societyId}`);\r\n    } catch (emailError) {\r\n      console.error('Failed to send OTP email:', emailError);\r\n      return createErrorResponse('Failed to send OTP email', 500);\r\n    }\r\n\r\n    return createSuccessResponse(\r\n      { expiresIn: 600 }, // 10 minutes\r\n      'OTP sent to your email address'\r\n    );\r\n\r\n  } catch (error: unknown) {\r\n    console.error('Error sending delete OTP:', error);\r\n    return createErrorResponse('Failed to send OTP', 500);\r\n  }\r\n}\r\n\r\n// Export verification function for use in DELETE endpoint\r\nexport function verifyDeleteOTP(adminId: number, societyId: number, otp: string): boolean {\r\n  const otpKey = `${adminId}_${societyId}`;\r\n  console.log(`üîç Verifying OTP - Key: ${otpKey}, OTP: ${otp}`);\r\n  \r\n  const stored = otpStore.get(otpKey);\r\n\r\n  if (!stored) {\r\n    console.log(`‚ùå No OTP found in store for key: ${otpKey}`);\r\n    console.log(`üìã Available OTP keys:`, Array.from(otpStore.keys()));\r\n    return false;\r\n  }\r\n\r\n  if (stored.expires < new Date()) {\r\n    console.log(`‚ùå OTP expired for key: ${otpKey}`);\r\n    otpStore.delete(otpKey);\r\n    return false;\r\n  }\r\n\r\n  if (stored.otp !== otp) {\r\n    console.log(`‚ùå OTP mismatch - Expected: ${stored.otp}, Got: ${otp}`);\r\n    return false;\r\n  }\r\n\r\n  if (stored.societyId !== societyId) {\r\n    console.log(`‚ùå Society ID mismatch - Expected: ${stored.societyId}, Got: ${societyId}`);\r\n    return false;\r\n  }\r\n\r\n  // OTP is valid, delete it (one-time use)\r\n  console.log(`‚úÖ OTP verified successfully for key: ${otpKey}`);\r\n  otpStore.delete(otpKey);\r\n  return true;\r\n}\r\n"],"names":[],"mappings":"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"}