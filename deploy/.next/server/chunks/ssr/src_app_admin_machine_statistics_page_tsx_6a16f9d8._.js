module.exports=[153271,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(50944),e=a.i(941675),f=a.i(290669),g=a.i(724669);let h=(0,a.i(170106).default)("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]]);var i=a.i(321161),j=a.i(839761),k=a.i(400210),l=a.i(669520),m=a.i(284505);a.i(16707);var n=a.i(529784),o=a.i(195279),p=a.i(857032),q=a.i(960020),r=a.i(155486),r=r;a.i(152824);var s=a.i(780645),s=s,t=a.i(436355);function u(){let a=(0,d.useRouter)(),[u,v]=(0,c.useState)([]),[w,x]=(0,c.useState)(!0),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)(""),[C,D]=(0,c.useState)(""),[E,F]=(0,c.useState)("all"),[G,H]=(0,c.useState)("all"),[I,J]=(0,c.useState)("all"),[K,L]=(0,c.useState)("all"),[M,N]=(0,c.useState)(new Set),[O,P]=(0,c.useState)(!1),[Q,R]=(0,c.useState)(!1),[S,T]=(0,c.useState)(!1),U=(a,c)=>{if(!c.trim())return a;let d=RegExp(`(${c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi"),e=a.split(d);return(0,b.jsx)(b.Fragment,{children:e.map((a,c)=>d.test(a)?(0,b.jsx)("span",{className:"bg-yellow-200 dark:bg-yellow-800 px-0.5 rounded font-semibold",children:a},c):a)})},V=async()=>{try{x(!0);let b=localStorage.getItem("authToken");if(!b)return void a.push("/login");let c=await fetch("/api/user/machine/all-statistics",{headers:{Authorization:`Bearer ${b}`}}),d=await c.json();d.success?v(d.data.statistics||[]):z(d.message||"Failed to fetch statistics")}catch(a){console.error("Error fetching statistics:",a),z("Failed to fetch machine statistics")}finally{x(!1)}};(0,c.useEffect)(()=>{V()},[]),(0,c.useEffect)(()=>{let a=a=>{D(a.detail?.query||"")};return window.addEventListener("globalSearch",a),()=>{window.removeEventListener("globalSearch",a)}},[]);let W=(0,c.useMemo)(()=>Array.from(new Set(u.map(a=>a.society_name))).sort(),[u]),X=(0,c.useMemo)(()=>Array.from(new Set(u.map(a=>a.machine_type))).sort(),[u]),Y=(0,c.useMemo)(()=>Array.from(new Set(u.map(a=>a.statistics_date))).sort().reverse(),[u]),Z=(0,c.useMemo)(()=>u.filter(a=>{let b=""===C||a.machine_identifier.toLowerCase().includes(C.toLowerCase())||a.operator_name?.toLowerCase().includes(C.toLowerCase())||a.society_name.toLowerCase().includes(C.toLowerCase())||a.society_identifier.toLowerCase().includes(C.toLowerCase())||a.stats_machine_type.toLowerCase().includes(C.toLowerCase()),c="all"===E||a.society_name===E,d="all"===G||a.machine_type===G,e="all"===I||a.statistics_date===I,f="all"===K||a.auto_channel===K;return b&&c&&d&&e&&f}),[u,C,E,G,I,K]),$=(0,c.useMemo)(()=>{if(0===Z.length)return{totalTests:0,avgDailyCleaning:0,avgWeeklyCleaning:0,totalSkips:0,avgGain:0,enabledMachines:0};let a=Z.reduce((a,b)=>a+b.total_test,0),b=Z.reduce((a,b)=>a+b.daily_cleaning,0),c=Z.reduce((a,b)=>a+b.weekly_cleaning,0),d=Z.reduce((a,b)=>a+b.cleaning_skip,0),e=Z.reduce((a,b)=>a+b.gain,0),f=Z.filter(a=>"ENABLE"===a.auto_channel).length;return{totalTests:a,avgDailyCleaning:Math.round(b/Z.length),avgWeeklyCleaning:Math.round(c/Z.length),totalSkips:d,avgGain:Math.round(e/Z.length),enabledMachines:f}},[Z]);(0,c.useEffect)(()=>{if(0===Z.length)O&&P(!1),M.size>0&&N(new Set);else{let a=Z.every(a=>M.has(a.id))&&Z.length>0;O!==a&&P(a)}},[Z]);let _=async()=>{if(0!==M.size){R(!0),T(!1);try{let b=localStorage.getItem("authToken");if(!b)return void a.push("/login");let c=await fetch("/api/user/machine/statistics/delete",{method:"DELETE",headers:{Authorization:`Bearer ${b}`,"Content-Type":"application/json"},body:JSON.stringify({statisticIds:Array.from(M)})}),d=await c.json();d.success?(B(d.message||`Deleted ${M.size} statistics successfully`),N(new Set),P(!1),await V()):z(d.message||"Failed to delete statistics")}catch(a){console.error("Error deleting statistics:",a),z("Failed to delete statistics")}finally{R(!1),setTimeout(()=>{B(""),z("")},3e3)}}};return(0,b.jsxs)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 lg:pb-8",children:[(0,b.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,b.jsx)("div",{className:"px-4 sm:px-6 py-3 sm:py-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("button",{onClick:()=>a.back(),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center",children:(0,b.jsx)(k.ArrowLeft,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),(0,b.jsxs)("div",{className:"flex items-center gap-2 sm:gap-3 flex-1 min-w-0",children:[(0,b.jsx)("div",{className:"p-2 sm:p-3 bg-gradient-to-r from-green-600 to-emerald-600 rounded-lg sm:rounded-xl flex-shrink-0",children:(0,b.jsx)(f.Activity,{className:"w-5 h-5 sm:w-6 sm:h-6 text-white"})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("h1",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Machine Statistics"}),(0,b.jsx)("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400 truncate",children:"Combined operational data from all machines"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 sm:gap-3",children:[(0,b.jsxs)("button",{onClick:V,className:"flex items-center justify-center px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors shadow-sm",children:[(0,b.jsx)(l.RefreshCw,{className:"w-4 h-4 mr-2"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Refresh"})]}),(0,b.jsxs)("button",{onClick:()=>{if(0===Z.length){z("No data to download"),setTimeout(()=>z(""),3e3);return}let a=new Blob([["Machine ID,Operator Name,Society,Society ID,Machine Type,Total Tests,Daily Cleaning,Weekly Cleaning,Cleaning Skips,Gain,Auto Channel,Date,Time,Created At",...Z.map(a=>[a.machine_identifier,a.operator_name||"",a.society_name,a.society_identifier,a.stats_machine_type,a.total_test,a.daily_cleaning,a.weekly_cleaning,a.cleaning_skip,a.gain,a.auto_channel,a.statistics_date,a.statistics_time,new Date(a.created_at).toLocaleString()]).map(a=>a.map(a=>`"${a}"`).join(","))].join("\n")],{type:"text/csv"}),b=window.URL.createObjectURL(a),c=document.createElement("a");c.href=b,c.download=`machine-statistics-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(b),B("Statistics downloaded successfully"),setTimeout(()=>B(""),3e3)},disabled:0===Z.length,className:"flex items-center justify-center px-4 sm:px-6 py-2.5 text-sm bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg hover:from-green-700 hover:to-emerald-700 transition-all duration-200 shadow-lg shadow-green-500/25 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:from-green-600 disabled:hover:to-emerald-600",children:[(0,b.jsx)(m.Download,{className:"w-4 h-4 mr-2"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Download"})]})]})]})})}),(0,b.jsx)("div",{className:"p-4 sm:p-6 lg:p-8 space-y-4 sm:space-y-6",children:(0,b.jsxs)("div",{className:"max-w-[1920px] mx-auto space-y-6",children:[(0,b.jsx)(o.StatusMessage,{success:A,error:y}),!w&&Z.length>0&&(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[(0,b.jsx)(p.StatsCard,{title:"Total Tests",value:$.totalTests.toLocaleString(),icon:(0,b.jsx)(g.TrendingUp,{className:"w-4 h-4"}),color:"blue"}),(0,b.jsx)(p.StatsCard,{title:"Daily Clean",value:$.avgDailyCleaning.toString(),icon:(0,b.jsx)(f.Activity,{className:"w-4 h-4"}),color:"green"}),(0,b.jsx)(p.StatsCard,{title:"Weekly Clean",value:$.avgWeeklyCleaning.toString(),icon:(0,b.jsx)(f.Activity,{className:"w-4 h-4"}),color:"blue"}),(0,b.jsx)(p.StatsCard,{title:"Total Skips",value:$.totalSkips.toString(),icon:(0,b.jsx)(h,{className:"w-4 h-4"}),color:"yellow"}),(0,b.jsx)(p.StatsCard,{title:"Avg Gain",value:$.avgGain.toString(),icon:(0,b.jsx)(g.TrendingUp,{className:"w-4 h-4"}),color:"blue"}),(0,b.jsx)(p.StatsCard,{title:"Enabled",value:`${$.enabledMachines}/${Z.length}`,icon:(0,b.jsx)(i.Settings,{className:"w-4 h-4"}),color:"green"})]}),(0,b.jsx)(s.default,{societyFilter:E,onSocietyChange:F,machineTypeFilter:G,onMachineTypeChange:H,dateFilter:I,onDateChange:J,autoChannelFilter:K,onAutoChannelChange:L,societies:W,machineTypes:X,dates:Y,filteredCount:Z.length,totalCount:u.length,searchQuery:C,onSearchChange:D,icon:(0,b.jsx)(j.BarChart3,{className:"w-5 h-5"})}),w?(0,b.jsx)("div",{className:"flex justify-center items-center py-20",children:(0,b.jsx)(n.FlowerSpinner,{})}):0===Z.length?(0,b.jsx)(q.EmptyState,{icon:(0,b.jsx)(f.Activity,{className:"w-12 h-12"}),title:"No Statistics Found",message:"all"!==E||"all"!==G||"all"!==I||"all"!==K||""!==C?"Try adjusting your filters":"No machine statistics available yet"}):(0,b.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:[(0,b.jsx)("div",{children:(0,b.jsxs)("table",{className:"w-full table-fixed",children:[(0,b.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-3 py-3 text-center w-[5%]",children:(0,b.jsx)("input",{type:"checkbox",checked:O,onChange:()=>{O?(N(new Set),P(!1)):(N(new Set(Z.map(a=>a.id))),P(!0))},className:"w-4 h-4 text-green-600 bg-gray-100 border-gray-300 rounded focus:ring-green-500 dark:focus:ring-green-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"})}),(0,b.jsx)("th",{className:"px-2 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider w-[10%]",children:"Machine"}),(0,b.jsx)("th",{className:"px-2 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider w-[10%]",children:"Society"}),(0,b.jsx)("th",{className:"px-2 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider w-[9%]",children:"Type"}),(0,b.jsx)("th",{className:"px-2 py-3 text-right text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider w-[7%]",children:"Tests"}),(0,b.jsx)("th",{className:"px-2 py-3 text-right text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider w-[6%]",children:"Daily"}),(0,b.jsx)("th",{className:"px-2 py-3 text-right text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider w-[6%]",children:"Weekly"}),(0,b.jsx)("th",{className:"px-2 py-3 text-right text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider w-[6%]",children:"Skips"}),(0,b.jsx)("th",{className:"px-2 py-3 text-right text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider w-[6%]",children:"Gain"}),(0,b.jsx)("th",{className:"px-2 py-3 text-center text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider w-[6%]",children:"Auto"}),(0,b.jsx)("th",{className:"px-2 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider w-[12%]",children:"Date"}),(0,b.jsx)("th",{className:"px-2 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider w-[12%]",children:"Time"})]})}),(0,b.jsx)("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:Z.map(a=>(0,b.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[(0,b.jsx)("td",{className:"px-3 py-3 text-center",children:(0,b.jsx)("input",{type:"checkbox",checked:M.has(a.id),onChange:()=>{var b;let c;return b=a.id,void((c=new Set(M)).has(b)?c.delete(b):c.add(b),N(c))},className:"w-4 h-4 text-green-600 bg-gray-100 border-gray-300 rounded focus:ring-green-500 dark:focus:ring-green-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"})}),(0,b.jsx)("td",{className:"px-2 py-3",children:(0,b.jsxs)("div",{className:"flex flex-col min-w-0",children:[(0,b.jsx)("span",{className:"text-xs font-medium text-gray-900 dark:text-gray-100 break-words",children:U(a.machine_identifier,C)}),a.operator_name&&(0,b.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 break-words",children:U(a.operator_name,C)})]})}),(0,b.jsx)("td",{className:"px-2 py-3",children:(0,b.jsxs)("div",{className:"flex flex-col min-w-0",children:[(0,b.jsx)("span",{className:"text-xs text-gray-900 dark:text-gray-100 break-words",children:U(a.society_name,C)}),(0,b.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 break-words",children:U(a.society_identifier,C)})]})}),(0,b.jsx)("td",{className:"px-2 py-3 text-xs text-gray-700 dark:text-gray-300",children:U(a.stats_machine_type,C)}),(0,b.jsx)("td",{className:"px-2 py-3 text-right",children:(0,b.jsx)(r.default,{variant:"blue",children:a.total_test.toLocaleString()})}),(0,b.jsx)("td",{className:"px-2 py-3 text-right",children:(0,b.jsx)(r.default,{variant:"green",children:a.daily_cleaning})}),(0,b.jsx)("td",{className:"px-2 py-3 text-right",children:(0,b.jsx)(r.default,{variant:"purple",children:a.weekly_cleaning})}),(0,b.jsx)("td",{className:"px-2 py-3 text-right",children:(0,b.jsx)(r.default,{variant:a.cleaning_skip>0?"orange":"gray",children:a.cleaning_skip})}),(0,b.jsx)("td",{className:"px-2 py-3 text-right",children:(0,b.jsx)(r.default,{variant:"indigo",children:a.gain})}),(0,b.jsx)("td",{className:"px-2 py-3 text-center",children:(0,b.jsx)(r.default,{variant:"ENABLE"===a.auto_channel?"emerald":"red",children:"ENABLE"===a.auto_channel?"ON":"OFF"})}),(0,b.jsx)("td",{className:"px-2 py-3",children:(0,b.jsxs)("span",{className:"flex items-center gap-1 text-xs text-gray-600 dark:text-gray-400",children:[(0,b.jsx)(e.Calendar,{className:"w-3 h-3 flex-shrink-0"}),(0,b.jsx)("span",{className:"whitespace-nowrap",children:a.statistics_date})]})}),(0,b.jsx)("td",{className:"px-2 py-3 text-xs text-gray-600 dark:text-gray-400 whitespace-nowrap",children:a.statistics_time})]},a.id))})]})}),(0,b.jsx)("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-700 border-t border-gray-200 dark:border-gray-600",children:(0,b.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Showing ",(0,b.jsx)("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:Z.length})," ","of"," ",(0,b.jsx)("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:u.length})," ","statistics records"]})})]}),(0,b.jsx)(t.BulkActionsToolbar,{selectedCount:M.size,totalCount:u.length,onBulkDelete:()=>T(!0),onClearSelection:()=>{N(new Set),P(!1)},itemType:"statistic",showStatusUpdate:!1}),S&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 flex items-center justify-center z-50 p-4",children:(0,b.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-md w-full p-6",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Delete Statistics"}),(0,b.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-6",children:["Are you sure you want to delete ",M.size," statistic",1!==M.size?"s":"","? This action cannot be undone."]}),(0,b.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,b.jsx)("button",{onClick:()=>T(!1),disabled:Q,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),(0,b.jsx)("button",{onClick:_,disabled:Q,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 dark:bg-red-500 rounded-lg hover:bg-red-700 dark:hover:bg-red-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:Q?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(n.FlowerSpinner,{size:16}),"Deleting..."]}):"Delete"})]})]})})]})})]})}a.s(["default",()=>u],153271)}];

//# sourceMappingURL=src_app_admin_machine_statistics_page_tsx_6a16f9d8._.js.map