module.exports=[274643,46532,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(633508),e=a.i(73570),f=a.i(781560),g=a.i(692759),h=a.i(104416);function i({isOpen:a,onClose:i,onConfirm:j,dairyName:k,loading:l=!1,bmcCount:m=0,societyCount:n=0,farmerCount:o=0,collectionCount:p=0,machineCount:q=0}){let[r,s]=(0,c.useState)("confirm"),[t,u]=(0,c.useState)(["","","","","",""]),[v,w]=(0,c.useState)(!1),[x,y]=(0,c.useState)(""),z=(0,c.useRef)([]),A=async()=>{try{w(!0),y("");let a=window.selectedDairyIdForDelete;if(!a)return void y("Dairy ID not found. Please try again.");let b=await fetch("/api/user/dairy/send-delete-otp",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({dairyId:a})}),c=await b.json();if(!b.ok)throw Error(c.error||"Failed to send OTP");s("otp"),setTimeout(()=>z.current[0]?.focus(),100)}catch(a){y(a instanceof Error?a.message:"Failed to send OTP")}finally{w(!1)}},B=a=>{a.preventDefault();let b=a.clipboardData.getData("text").slice(0,6);if(!/^\d+$/.test(b))return;let c=[...t];b.split("").forEach((a,b)=>{b<6&&(c[b]=a)}),u(c);let d=c.findIndex(a=>!a);-1!==d?z.current[d]?.focus():z.current[5]?.focus()},C=async()=>{let a=t.join("");if(6!==a.length)return void y("Please enter the complete 6-digit OTP");try{await j(a),D()}catch(a){y(a instanceof Error?a.message:"Invalid or expired OTP"),u(["","","","","",""]),z.current[0]?.focus()}},D=()=>{s("confirm"),u(["","","","","",""]),y(""),i()};return a?(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:(0,b.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full overflow-hidden",children:[(0,b.jsxs)("div",{className:"bg-gradient-to-r from-red-500 to-red-600 px-6 py-4 flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"p-2 bg-white/20 rounded-lg",children:(0,b.jsx)(f.Trash2,{className:"w-5 h-5 text-white"})}),(0,b.jsx)("h3",{className:"text-lg font-semibold text-white",children:"confirm"===r?"Delete Dairy":"Verify OTP"})]}),(0,b.jsx)("button",{onClick:D,disabled:l||v,className:"text-white/80 hover:text-white transition-colors disabled:opacity-50",children:(0,b.jsx)(d.X,{className:"w-5 h-5"})})]}),(0,b.jsx)("div",{className:"p-6",children:"confirm"===r?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-4",children:(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)(e.AlertTriangle,{className:"w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-red-900 dark:text-red-100 mb-1",children:"Warning: This action cannot be undone"}),(0,b.jsx)("p",{className:"text-sm text-red-700 dark:text-red-300",children:"Deleting this dairy will permanently remove:"})]})]})}),(0,b.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,b.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[(0,b.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Dairy Name"}),(0,b.jsx)("p",{className:"font-semibold text-gray-900 dark:text-gray-100",children:k})]}),(0,b.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[(0,b.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"The following data will be deleted:"}),(0,b.jsxs)("ul",{className:"space-y-1 text-sm text-gray-700 dark:text-gray-300",children:[m>0&&(0,b.jsxs)("li",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full"}),m," BMC",m>1?"s":""]}),n>0&&(0,b.jsxs)("li",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full"}),n," societ",n>1?"ies":"y"]}),o>0&&(0,b.jsxs)("li",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full"}),o," farmer",o>1?"s":""," and their data"]}),p>0&&(0,b.jsxs)("li",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full"}),p," collection record",p>1?"s":""]}),q>0&&(0,b.jsxs)("li",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full"}),q," machine",q>1?"s":""," and settings"]}),0===m&&0===n&&0===o&&0===p&&0===q&&(0,b.jsxs)("li",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full"}),"The dairy details only"]})]})]})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("button",{onClick:D,disabled:l||v,className:"flex-1 px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50",children:"Cancel"}),(0,b.jsx)("button",{onClick:A,disabled:l||v,className:"flex-1 px-4 py-2.5 bg-gradient-to-r from-red-500 to-red-600 rounded-lg font-medium text-white hover:from-red-600 hover:to-red-700 transition-all disabled:opacity-50 flex items-center justify-center gap-2",children:v?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Sending OTP..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(g.Send,{className:"w-4 h-4"}),"Send OTP"]})})]})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-6",children:(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)(h.ShieldCheck,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-blue-900 dark:text-blue-100 mb-1",children:"OTP Sent to Your Email"}),(0,b.jsx)("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:"Please enter the 6-digit OTP to confirm deletion. The code will expire in 10 minutes."})]})]})}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Enter OTP Code"}),(0,b.jsx)("div",{className:"flex gap-2 justify-center",children:t.map((a,c)=>(0,b.jsx)("input",{ref:a=>{z.current[c]=a},type:"text",inputMode:"numeric",maxLength:1,value:a,onChange:a=>((a,b)=>{if(b.length>1&&(b=b[0]),!/^\d*$/.test(b))return;let c=[...t];c[a]=b,u(c),b&&a<5&&z.current[a+1]?.focus()})(c,a.target.value),onKeyDown:a=>{"Backspace"===a.key&&!t[c]&&c>0&&z.current[c-1]?.focus()},onPaste:0===c?B:void 0,className:"w-12 h-14 text-center text-xl font-bold border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:border-red-500 focus:ring-2 focus:ring-red-500/20 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",disabled:l},c))}),x&&(0,b.jsx)("p",{className:"text-sm text-red-600 dark:text-red-400 mt-2 text-center",children:x})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("button",{onClick:()=>{s("confirm"),u(["","","","","",""]),y("")},disabled:l,className:"flex-1 px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50",children:"Back"}),(0,b.jsx)("button",{onClick:C,disabled:l||t.some(a=>!a),className:"flex-1 px-4 py-2.5 bg-gradient-to-r from-red-500 to-red-600 rounded-lg font-medium text-white hover:from-red-600 hover:to-red-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:l?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Deleting..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(f.Trash2,{className:"w-4 h-4"}),"Delete Dairy"]})})]})]})})]})}):null}a.s(["default",()=>i],274643);var j=a.i(267900),k=a.i(992258);function l({isOpen:a,onClose:f,onConfirm:g,bmcs:h,dairies:i,dairyName:l,currentDairyId:m,adminEmail:n=""}){let[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(["","","","","",""]),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(""),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)(!1),C=(0,c.useRef)([]),D=i.filter(a=>a.id!==m);(0,c.useEffect)(()=>{a||(p(null),r(!1),t(["","","","","",""]),v(!1),x(""),z(!1),B(!1))},[a]),(0,c.useEffect)(()=>{y&&C.current[0]&&C.current[0]?.focus()},[y]);let E=async()=>{B(!0),x("");try{let a=localStorage.getItem("authToken"),b=await fetch("/api/user/dairy/send-delete-otp",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({dairyId:m})}),c=await b.json();c.success?(v(!0),z(!0),x("")):x(c.message||"Failed to send OTP")}catch(a){console.error("Error sending OTP:",a),x("Failed to send OTP. Please try again.")}finally{B(!1)}},F=()=>{if(q)if(u){let a=s.join("");if(6!==a.length)return void x("Please enter complete 6-digit OTP");g(null,!0,a)}else E();else{if(!o)return;if(u){let a=s.join("");if(6!==a.length)return void x("Please enter complete 6-digit OTP");g(o,!1,a)}else E()}},G=s.every(a=>""!==a);return a?(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[9999] flex items-center justify-center p-4",children:(0,b.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center",children:(0,b.jsx)(e.AlertTriangle,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),(0,b.jsx)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Delete Dairy - Action Required"})]}),(0,b.jsx)("button",{onClick:f,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:(0,b.jsx)(d.X,{className:"w-5 h-5 text-gray-500 dark:text-gray-400"})})]}),(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsxs)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:[(0,b.jsxs)("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[(0,b.jsx)("strong",{children:"Warning:"})," This dairy has ",(0,b.jsx)("strong",{children:h.length})," BMC",1!==h.length?"s":""," under it."]}),(0,b.jsx)("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mt-2",children:"You must either transfer these BMCs to another dairy or delete everything."})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:["BMCs under ",(0,b.jsx)("strong",{children:l}),":"]}),(0,b.jsx)("div",{className:"max-h-32 overflow-y-auto bg-gray-50 dark:bg-gray-900/50 rounded-lg p-3 space-y-1",children:h.map(a=>(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300",children:[(0,b.jsx)(j.Building2,{className:"w-4 h-4 text-blue-500"}),(0,b.jsxs)("span",{children:[a.name," (",a.bmcId,")"]})]},a.id))})]}),(0,b.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:(0,b.jsxs)("label",{className:"flex items-start gap-3 cursor-pointer group",children:[(0,b.jsx)("input",{type:"checkbox",checked:q,onChange:a=>{var b;r(b=a.target.checked),b&&p(null),t(["","","","","",""]),v(!1),x(""),z(!1),B(!1)},className:"mt-0.5 w-4 h-4 text-red-600 border-red-300 rounded focus:ring-red-500 focus:ring-2 cursor-pointer"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-sm font-semibold text-red-700 dark:text-red-300",children:"Delete All Data (Permanent)"}),(0,b.jsx)("span",{className:"px-2 py-0.5 bg-red-600 text-white text-xs font-bold rounded-full",children:"DANGER"})]}),(0,b.jsxs)("p",{className:"text-sm text-red-800 dark:text-red-200 mt-1",children:["Delete all BMCs, societies, farmers, machines, machine statistics, machine corrections, rate charts, collections, sales, dispatches, and section pulse data under this dairy.",(0,b.jsx)("strong",{className:"block mt-1",children:"This action cannot be undone!"})]}),q&&(0,b.jsxs)("div",{className:"mt-3 p-3 bg-red-100 dark:bg-red-900/40 rounded-lg",children:[(0,b.jsx)("p",{className:"text-xs font-bold text-red-900 dark:text-red-100 mb-2",children:"⚠️ The following will be permanently deleted:"}),(0,b.jsxs)("ul",{className:"text-sm text-red-800 dark:text-red-200 mt-2 space-y-1 list-disc list-inside",children:[(0,b.jsxs)("li",{children:[h.length," BMC",1!==h.length?"s":""]}),(0,b.jsx)("li",{children:"All societies under these BMCs"}),(0,b.jsx)("li",{children:"All farmers under these societies"}),(0,b.jsx)("li",{children:"All machines linked to these societies"}),(0,b.jsx)("li",{children:"All machine statistics"}),(0,b.jsx)("li",{children:"All machine corrections (admin & device saved)"}),(0,b.jsx)("li",{children:"All rate charts and rate chart data"}),(0,b.jsx)("li",{children:"All milk collection records"}),(0,b.jsx)("li",{children:"All milk sales records"}),(0,b.jsx)("li",{children:"All milk dispatch records"}),(0,b.jsx)("li",{children:"All section pulse tracking data"}),(0,b.jsxs)("li",{children:["Dairy: ",(0,b.jsx)("strong",{children:l})]})]})]})]})]})}),!q&&(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Select New Dairy for BMC Transfer:"}),(0,b.jsxs)("select",{value:o||"",onChange:a=>p(Number(a.target.value)),className:"w-full px-4 py-2.5 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,b.jsx)("option",{value:"",children:"-- Select a dairy --"}),D.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]}),0===D.length&&(0,b.jsx)("p",{className:"text-sm text-orange-600 dark:text-orange-400",children:"No other dairies available. You must delete all data instead."})]}),u&&(0,b.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(k.Mail,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),(0,b.jsxs)("p",{className:"text-sm font-semibold text-blue-900 dark:text-blue-100",children:["OTP sent to: ",n]})]}),(0,b.jsxs)("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:["Please enter the 6-digit verification code to confirm ",q?"deletion":"transfer and deletion",":"]}),(0,b.jsx)("div",{className:"flex gap-2 justify-center",onPaste:a=>{a.preventDefault();let b=a.clipboardData.getData("text").slice(0,6);if(!/^\d+$/.test(b))return;let c=[...s];b.split("").forEach((a,b)=>{b<6&&(c[b]=a)}),t(c);let d=Math.min(b.length,5);C.current[d]?.focus()},children:s.map((a,c)=>(0,b.jsx)("input",{ref:a=>{C.current[c]=a},type:"text",maxLength:1,value:a,onChange:a=>((a,b)=>{if(b&&!/^\d$/.test(b))return;let c=[...s];c[a]=b,t(c),x(""),b&&a<5&&C.current[a+1]?.focus()})(c,a.target.value),onKeyDown:a=>{"Backspace"===a.key&&!s[c]&&c>0&&C.current[c-1]?.focus()},className:"w-12 h-12 text-center text-xl font-bold bg-white dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900 dark:text-gray-100"},c))}),w&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-red-600 dark:text-red-400 text-sm",children:[(0,b.jsx)(e.AlertTriangle,{className:"w-4 h-4"}),(0,b.jsx)("span",{children:w})]}),(0,b.jsx)("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:"OTP is valid for 10 minutes. Didn't receive it? Close and try again."})]})]}),(0,b.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 p-6 bg-gray-50 dark:bg-gray-900/50 flex flex-col sm:flex-row gap-3 justify-end",children:[(0,b.jsx)("button",{onClick:f,className:"px-6 py-2.5 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 border border-gray-300 dark:border-gray-600 rounded-lg font-medium transition-colors",children:"Cancel"}),q?(0,b.jsx)("button",{onClick:F,disabled:A||u&&!G,className:"px-6 py-2.5 bg-red-600 hover:bg-red-700 disabled:bg-red-400 disabled:cursor-not-allowed text-white rounded-lg font-medium transition-colors flex items-center gap-2",children:A?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Sending OTP..."]}):u?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(e.AlertTriangle,{className:"w-4 h-4"}),"Verify OTP & Delete All"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k.Mail,{className:"w-4 h-4"}),"Send OTP & Confirm Delete"]})}):(0,b.jsx)("button",{onClick:F,disabled:!o||A||u&&!G,className:"px-6 py-2.5 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg font-medium transition-colors flex items-center gap-2",children:A?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Sending OTP..."]}):u?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(e.AlertTriangle,{className:"w-4 h-4"}),"Verify OTP & Transfer"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k.Mail,{className:"w-4 h-4"}),"Send OTP & Confirm Transfer"]})})]})]})}):null}a.s(["default",()=>l],46532)}];

//# sourceMappingURL=src_components_modals_DeleteDairyModal_tsx_3fba6134._.js.map