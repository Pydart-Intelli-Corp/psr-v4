module.exports=[291245,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(50944),e=a.i(346271),f=a.i(262036),g=a.i(104720),h=a.i(626112),i=a.i(410227),j=a.i(790166),k=a.i(284505),l=a.i(170106);let m=(0,l.default)("file-down",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);var n=a.i(724669),o=a.i(839761),p=a.i(669520),q=a.i(781560),r=a.i(992258),s=a.i(932596),t=a.i(277894),u=a.i(99611);a.i(16707);var v=a.i(529784);a.i(152824);var w=a.i(668610),x=a.i(603430),y=a.i(195279),z=a.i(436355),A=a.i(913795);a.i(935112);var B=a.i(633508),C=a.i(692759);function D({isOpen:a,onClose:d,onSend:g,defaultEmail:h="",recordCount:i=0,reportType:j="Report"}){let[k,l]=(0,c.useState)(""),[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)("");return(0,c.useEffect)(()=>{a&&h&&l(h)},[a,h]),f.AnimatePresence,a&&(e.motion.div,e.motion.div,r.Mail,B.X,r.Mail,m?b.Fragment:(b.Fragment,C.Send)),null}let E=(a,c)=>{if(!a&&0!==a)return a||"";if(!c)return a;let d=a.toString(),e=RegExp(`(${c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return d.split(e).map((a,c)=>e.test(a)?(0,b.jsx)("span",{className:"bg-yellow-200 dark:bg-yellow-800 px-0.5 rounded",children:a},c):a)},F=a=>({ch1:"COW",ch2:"BUFFALO",ch3:"MIXED",CH1:"COW",CH2:"BUFFALO",CH3:"MIXED",COW:"COW",BUFFALO:"BUFFALO",MIXED:"MIXED",cow:"COW",buffalo:"BUFFALO",mixed:"MIXED",BUF:"BUFFALO",MIX:"MIXED"})[a]||a.toUpperCase();function G({globalSearch:a="",initialSocietyId:d=null,initialSocietyName:e=null,initialFromDate:f=null,initialToDate:g=null,initialBmcFilter:i=null,initialMachineFilter:j=null}){console.log("CollectionReports received props:",{initialSocietyId:d,initialSocietyName:e,initialFromDate:f,initialToDate:g,initialMachineFilter:j});let[l,B]=(0,c.useState)([]),[C,G]=(0,c.useState)([]),[H,I]=(0,c.useState)({totalCollections:0,totalQuantity:0,totalAmount:0,averageRate:0,weightedFat:0,weightedSnf:0,weightedClr:0}),[J,K]=(0,c.useState)(!0),[L,M]=(0,c.useState)("");(0,c.useEffect)(()=>{void 0!==a&&M(a)},[a]);let N=(0,c.useMemo)(()=>a||L,[a,L]),[O,P]=(0,c.useState)(""),[Q,R]=(0,c.useState)(""),[S,T]=(0,c.useState)(""),[U,V]=(0,c.useState)("all"),[W,X]=(0,c.useState)("all"),[Y,Z]=(0,c.useState)([]),[$,_]=(0,c.useState)([]),[aa,ab]=(0,c.useState)([]),[ac,ad]=(0,c.useState)([]),[ae,af]=(0,c.useState)([]),[ag,ah]=(0,c.useState)([]),[ai,aj]=(0,c.useState)([]),[ak,al]=(0,c.useState)([]),[am,an]=(0,c.useState)([]),[ao,ap]=(0,c.useState)([]),[aq,ar]=(0,c.useState)(!1),[as,at]=(0,c.useState)(null),[au,av]=(0,c.useState)(!1),[aw,ax]=(0,c.useState)(""),[ay,az]=(0,c.useState)(""),[aA,aB]=(0,c.useState)(new Set),[aC,aD]=(0,c.useState)(!1),[aE,aF]=(0,c.useState)(!1),[aG,aH]=(0,c.useState)(!1),[aI,aJ]=(0,c.useState)(""),[aK,aL]=(0,c.useState)(!1),[aM,aN]=(0,c.useState)("");(0,c.useEffect)(()=>{if(d){let a=ak.find(a=>a.society_id===d);if(a&&!aa.includes(a.id.toString())&&(ab([a.id.toString()]),e)){let a=`Filter Applied: ${decodeURIComponent(e)}`;f&&g&&(a+=` • Date: ${f} to ${g}`),ax(a),setTimeout(()=>ax(""),5e3)}}},[ak]),(0,c.useEffect)(()=>{if(j&&am.length>0){let a=am.find(a=>a.machineId===j);a&&!ac.includes(a.id.toString())&&(console.log("Setting machineFilter to machine:",a.machineId,"ID:",a.id),ad([a.id.toString()]),ax(`Filter Applied: Machine ${a.machineId}`),setTimeout(()=>ax(""),5e3))}},[am]),(0,c.useEffect)(()=>{f&&(console.log("Setting dateFromFilter to:",f),R(f)),g&&(console.log("Setting dateToFilter to:",g),T(g)),i&&(console.log("Setting bmcFilter to:",i),_([i]))},[f,g,i]),(0,c.useEffect)(()=>{(async()=>{try{let a=localStorage.getItem("authToken");if(!a)return;let b=await fetch("/api/user/profile",{headers:{Authorization:`Bearer ${a}`}});if(b.ok){let a=(await b.json()).email||"";aN(a)}}catch(a){console.error("Error fetching admin email:",a)}})()},[]),(0,c.useEffect)(()=>{console.log("Current filter states:",{dateFromFilter:Q,dateToFilter:S,societyFilter:aa,recordsCount:l.length,filteredCount:C.length})},[Q,S,aa,l.length,C.length]),(0,c.useEffect)(()=>{(async()=>{try{let a=localStorage.getItem("authToken");if(!a)return;let b=await fetch("/api/user/dairy",{headers:{Authorization:`Bearer ${a}`}});if(b.ok){let a=await b.json();ah(a.data||[])}let c=await fetch("/api/user/bmc",{headers:{Authorization:`Bearer ${a}`}});if(c.ok){let a=await c.json();aj(a.data||[])}let d=await fetch("/api/user/society",{headers:{Authorization:`Bearer ${a}`}});if(d.ok){let a=await d.json();al(a.data||[])}let e=await fetch("/api/user/machine",{headers:{Authorization:`Bearer ${a}`}});if(e.ok){let a=await e.json();an(a.data||[])}let f=await fetch("/api/user/farmer",{headers:{Authorization:`Bearer ${a}`}});if(f.ok){let a=await f.json();ap(a.data||[])}}catch(a){console.error("Error fetching dairies/BMCs/societies/machines/farmers:",a)}})()},[]);let aO=(0,c.useMemo)(()=>{if(!ag.length||!l.length)return ag;let a=new Set(l.filter(a=>a.dairy_id).map(a=>a.dairy_id));return ag.filter(b=>a.has(b.id))},[ag,l]),aP=(0,c.useMemo)(()=>{if(!ai.length||!l.length)return ai;let a=new Set(l.filter(a=>a.bmc_id).map(a=>a.bmc_id));return ai.filter(b=>a.has(b.id))},[ai,l]),aQ=(0,c.useMemo)(()=>{if(!l.length)return[];let a=new Set(l.filter(a=>a.society_id).map(a=>a.society_id));if(ak.length>0)return ak.filter(b=>a.has(b.society_id));let b=new Map;return l.forEach(a=>{a.society_id&&!b.has(a.society_id)&&b.set(a.society_id,{society_id:a.society_id,society_name:a.society_name||a.society_id})}),Array.from(b.values()).map((a,b)=>({id:b+1,name:a.society_name,society_id:a.society_id,bmc_id:void 0}))},[l,ak]),aR=(0,c.useMemo)(()=>{if(!am.length||!l.length)return am;let a=new Set(l.filter(a=>a.machine_id).map(a=>a.machine_id));return am.filter(b=>a.has(b.machineId)).map(a=>({...a,collectionCount:l.filter(b=>b.machine_id===a.machineId).length}))},[am,l]),aS=(0,c.useMemo)(()=>{if(!ao.length||!l.length)return ao;let a=new Set(l.filter(a=>a.farmer_id).map(a=>a.farmer_id));return ao.filter(b=>a.has(b.farmerId))},[ao,l]),aT=async a=>{if(as){av(!0);try{let b=localStorage.getItem("authToken"),c=await fetch("/api/user/reports/collections/delete",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify({recordId:as,password:a})}),d=await c.json();if(!c.ok)throw Error(d.error||"Failed to delete record");ax("Collection record deleted successfully"),setTimeout(()=>ax(""),5e3),aX()}catch(a){throw console.error("Delete error:",a),az(a instanceof Error?a.message:"Failed to delete record"),setTimeout(()=>az(""),5e3),a}finally{av(!1),at(null)}}},aU=()=>{aB(new Set),aD(!1)},aV=async a=>{aF(!1),aH(!0);try{let b=localStorage.getItem("authToken"),c=Array.from(aA).map(c=>fetch("/api/user/reports/collections/delete",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify({recordId:c,password:a})}).then(async a=>{if(!a.ok){let b=await a.json();throw Error(b.message||"Delete failed")}return a.json()})),d=await Promise.allSettled(c),e=d.filter(a=>"fulfilled"===a.status).length,f=d.filter(a=>"rejected"===a.status).length;if(e>0)ax(`Successfully deleted ${e} record(s)${f>0?`. ${f} failed.`:""}`),setTimeout(()=>ax(""),5e3),aX(),aU();else{let a=d.find(a=>"rejected"===a.status),b=a?.reason?.message||"Failed to delete selected records";az(b),setTimeout(()=>az(""),5e3)}}catch(a){console.error("Bulk delete error:",a),az(a instanceof Error?a.message:"Failed to delete selected records"),setTimeout(()=>az(""),5e3)}finally{aH(!1),aJ("")}},aW=(0,c.useCallback)(a=>{let b=a.reduce((a,b)=>a+parseFloat(b.quantity||"0"),0),c=a.reduce((a,b)=>a+parseFloat(b.total_amount||"0"),0),d=a.reduce((a,b)=>a+parseFloat(b.rate_per_liter||"0"),0),e=a.length>0?d/a.length:0,f=a.reduce((a,b)=>a+parseFloat(b.quantity||"0")*parseFloat(b.fat_percentage||"0"),0),g=a.reduce((a,b)=>a+parseFloat(b.quantity||"0")*parseFloat(b.snf_percentage||"0"),0),h=a.reduce((a,b)=>a+parseFloat(b.quantity||"0")*parseFloat(b.clr_value||"0"),0),i=b>0?f/b:0,j=b>0?g/b:0,k=b>0?h/b:0;I({totalCollections:a.length,totalQuantity:parseFloat(b.toFixed(2)),totalAmount:parseFloat(c.toFixed(2)),averageRate:parseFloat(e.toFixed(2)),weightedFat:parseFloat(i.toFixed(2)),weightedSnf:parseFloat(j.toFixed(2)),weightedClr:parseFloat(k.toFixed(2))})},[]),aX=(0,c.useCallback)(async(a=!0)=>{let b=localStorage.getItem("authToken");if(b)try{a&&K(!0);let c=await fetch("/api/user/reports/collections",{headers:{Authorization:`Bearer ${b}`}});if(c.ok){let a=await c.json();B(b=>JSON.stringify(b)!==JSON.stringify(a)?(aW(a),a):b)}}catch(a){console.error("Error fetching collection data:",a)}finally{a&&K(!1)}},[aW]);(0,c.useEffect)(()=>{aX(!0);let a=setInterval(()=>{aX(!1)},1e3);return()=>clearInterval(a)},[aX]),(0,c.useEffect)(()=>{let a=l;if(Y.length>0){let b=Y.map(a=>{let b=ag.find(b=>b.id.toString()===a);return b?.id}).filter(Boolean);b.length>0&&(a=a.filter(a=>void 0!==a.dairy_id&&b.includes(a.dairy_id)))}if($.length>0){let b=$.map(a=>{let b=ai.find(b=>b.id.toString()===a);return b?.id}).filter(Boolean);b.length>0&&(a=a.filter(a=>void 0!==a.bmc_id&&b.includes(a.bmc_id)))}if("all"!==U&&(a="morning"===U?a.filter(a=>["MR","MX","morning"].includes(a.shift_type)):"evening"===U?a.filter(a=>["EV","EX","evening"].includes(a.shift_type)):a.filter(a=>a.shift_type===U)),Array.isArray(aa)&&aa.length>0){let b=aa.map(a=>{let b=aQ.find(b=>b.id.toString()===a);return b?.society_id}).filter(Boolean);b.length>0&&(a=a.filter(a=>b.includes(a.society_id)))}if(ac.length>0){let b=ac.map(a=>aR.find(b=>b.id.toString()===a)?.machineId).filter(Boolean);b.length>0&&(a=a.filter(a=>b.includes(a.machine_id)))}if(ae.length>0){let b=ae.map(a=>aS.find(b=>b.id.toString()===a)?.farmerId).filter(Boolean);b.length>0&&(a=a.filter(a=>b.includes(a.farmer_id)))}if("all"!==W&&(a=a.filter(a=>F(a.channel)===W)),O&&(a=a.filter(a=>a.collection_date===O)),Q&&(a=a.filter(a=>a.collection_date>=Q)),S&&(a=a.filter(a=>a.collection_date<=S)),N){let b=N.toLowerCase();a=a.filter(a=>{let c=["MR","MX"].includes(a.shift_type)||a.shift_type?.toLowerCase()==="morning"?"Morning":["EV","EX"].includes(a.shift_type)||a.shift_type?.toLowerCase()==="evening"?"Evening":a.shift_type;return[a.farmer_id,a.farmer_name,a.society_id,a.society_name,a.bmc_name,a.dairy_name,a.machine_id,a.machine_type,a.machine_version,a.channel,F(a.channel),a.collection_date,a.collection_time,a.shift_type,c,a.quantity,a.fat_percentage,a.snf_percentage,a.clr_value,a.protein_percentage,a.lactose_percentage,a.salt_percentage,a.water_percentage,a.temperature,a.rate_per_liter,a.total_amount,a.bonus].some(a=>a?.toString().toLowerCase().includes(b))})}G(a),aW(a)},[a,L,O,Q,S,U,W,aa,ac,ae,Y,$,l,aQ,aR,aS,ag,ai,aW]);let aY=async a=>{if(!a||!a.includes("@"))throw Error("Please enter a valid email address");try{let b=Q&&S?`${Q} To ${S}`:O||"All Dates",c=new Date().toLocaleString("en-IN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),d=C.map(a=>[a.collection_date,a.collection_time,a.channel,a.shift_type,`${a.machine_id} (${a.machine_type})`,a.society_name||"",a.farmer_id||"",a.farmer_name||"",a.fat_percentage,a.snf_percentage,a.clr_value,a.water_percentage,a.rate_per_liter,a.quantity,a.total_amount,a.bonus]),e=[["POORNASREE EQUIPMENTS MILK COLLECTION REPORT"],["Admin Report with Weighted Averages"],[],["Report Generated:",c],["Date Range:",b],["Total Collections:",H.totalCollections],["Total Quantity (L):",H.totalQuantity.toFixed(2)],["Total Amount (₹):",H.totalAmount.toFixed(2)],["Average Rate (₹/L):",H.averageRate.toFixed(2)],["Weighted FAT (%):",H.weightedFat.toFixed(2)],["Weighted SNF (%):",H.weightedSnf.toFixed(2)],["Weighted CLR:",H.weightedClr.toFixed(2)],[],["Date","Time","Channel","Shift","Machine","Society","Farmer ID","Farmer Name","Fat (%)","SNF (%)","CLR","Water (%)","Rate (₹/L)","Quantity (L)","Total Amount (₹)","Incentive"],...d].map(a=>a.join(",")).join("\n"),f=new s.default({orientation:"landscape",unit:"mm",format:"a4"});f.addImage("/fulllogo.png","PNG",14,8,0,12),f.setFontSize(14),f.setFont("helvetica","bold"),f.text("Daily Collection Report - LactoConnect Milk Collection System",148.5,15,{align:"center"}),f.setFontSize(9),f.setFont("helvetica","normal"),f.text(`Date From ${b}`,148.5,21,{align:"center"}),f.setFontSize(10),f.setFont("helvetica","bold"),f.text("DETAILED COLLECTION DATA",148.5,28,{align:"center"});let g=C.map((a,b)=>[(b+1).toString(),a.collection_date,a.collection_time,F(a.channel),a.shift_type,`${a.machine_id} (${a.machine_type})`,`${a.society_name} (${a.society_id})`,a.farmer_id,a.farmer_name||"",a.fat_percentage,a.snf_percentage,a.clr_value,a.water_percentage,a.rate_per_liter,a.quantity,a.total_amount,a.bonus]);(0,t.default)(f,{startY:32,head:[["SI No","Date","Time","Channel","Shift","Machine","Society","Farmer ID","Farmer Name","Fat (%)","SNF (%)","CLR","Water (%)","Rate","Quantity (L)","Total Amount","Incentive"]],body:g,theme:"grid",styles:{fontSize:6,cellPadding:1,halign:"center"},headStyles:{fillColor:[255,255,255],textColor:[0,0,0],fontStyle:"bold",fontSize:7,lineWidth:.5,lineColor:[0,0,0]},bodyStyles:{lineWidth:.3,lineColor:[200,200,200]},columnStyles:{0:{cellWidth:10},8:{halign:"left"}}});let h=f.lastAutoTable.finalY+8;f.setFontSize(11),f.setFont("helvetica","bold"),f.text("WEIGHTED AVERAGES",14,h),f.setFontSize(9),f.setFont("helvetica","normal");let i=h+6;f.text(`Weighted Fat      : ${H.weightedFat.toFixed(2)}`,14,i),i+=5,f.text(`Weighted SNF      : ${H.weightedSnf.toFixed(2)}`,14,i),i+=5,f.text(`Weighted CLR      : ${H.weightedClr.toFixed(2)}`,14,i),i+=8,f.setFont("helvetica","bold"),f.text("OVERALL SUMMARY",14,i),f.setFont("helvetica","normal"),i+=6,f.text(`Total Collections  : ${H.totalCollections}`,14,i),i+=5,f.text(`Total Quantity (L) : ${H.totalQuantity.toFixed(2)}`,14,i),i+=5,f.text(`Total Amount       : ${H.totalAmount.toFixed(2)}`,14,i),f.setFontSize(11),f.setFont("helvetica","bold"),f.text("REPORT NOTES",283,h,{align:"right"}),f.setFontSize(9),f.setFont("helvetica","normal");let j=h+6;f.text("Prepared by: POORNASREE EQUIPMENTS",283,j,{align:"right"}),j+=5,f.text("Contact: marketing@poornasree.com",283,j,{align:"right"}),j+=8,f.setFont("helvetica","bold"),f.text("POORNASREE EQUIPMENTS",283,j,{align:"right"}),f.setFont("helvetica","normal"),j+=5,f.text("Thank you for using LactoConnect",283,j,{align:"right"}),j+=5,f.text("For support, visit: www.poornasree.com",283,j,{align:"right"});let k=f.output("datauristring").split(",")[1],l=localStorage.getItem("authToken"),m=await fetch("/api/user/reports/send-email",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({email:a,csvContent:e,pdfContent:k,reportType:"Collection Report",dateRange:b,stats:H})});if(!m.ok){let a=await m.json().catch(()=>({}));throw Error(a.error||"Failed to send email")}ax(`Report sent successfully to ${a}`),setTimeout(()=>ax(""),5e3)}catch(a){throw console.error("Error sending email:",a),a}};return J?(0,b.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,b.jsx)(v.FlowerSpinner,{size:48})}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-7 gap-3",children:[(0,b.jsx)(u.default,{title:"Total Collections",value:H.totalCollections,icon:(0,b.jsx)(h.Droplet,{className:"w-full h-full"}),color:"blue"}),(0,b.jsx)(u.default,{title:"Total Quantity (L)",value:H.totalQuantity,icon:(0,b.jsx)(o.BarChart3,{className:"w-full h-full"}),color:"green"}),(0,b.jsx)(u.default,{title:"Total Amount (₹)",value:`₹${H.totalAmount.toFixed(2)}`,icon:(0,b.jsx)(n.TrendingUp,{className:"w-full h-full"}),color:"yellow"}),(0,b.jsx)(u.default,{title:"Avg Rate (₹/L)",value:`₹${H.averageRate.toFixed(2)}`,icon:(0,b.jsx)(o.BarChart3,{className:"w-full h-full"}),color:"gray"}),(0,b.jsx)(u.default,{title:"Weighted FAT (%)",value:H.weightedFat.toFixed(2),icon:(0,b.jsx)(o.BarChart3,{className:"w-full h-full"}),color:"blue"}),(0,b.jsx)(u.default,{title:"Weighted SNF (%)",value:H.weightedSnf.toFixed(2),icon:(0,b.jsx)(o.BarChart3,{className:"w-full h-full"}),color:"green"}),(0,b.jsx)(u.default,{title:"Weighted CLR",value:H.weightedClr.toFixed(2),icon:(0,b.jsx)(o.BarChart3,{className:"w-full h-full"}),color:"red"})]}),(0,b.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 sm:p-6",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Showing ",C.length," of ",l.length," records"]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)("button",{onClick:()=>{let a;V("all"),Z([]),_([]),ab([]),ad([]),af([]),P(""),R(""),T(""),X("all"),M(""),a=new CustomEvent("globalSearch",{detail:{query:""}}),window.dispatchEvent(a),aX()},className:"flex items-center justify-center gap-2 px-3 py-2 bg-psr-primary-600 text-white rounded-lg hover:bg-psr-primary-700 transition-colors text-sm shadow-sm hover:shadow-md",children:[(0,b.jsx)(p.RefreshCw,{className:"w-4 h-4"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Refresh"})]}),(0,b.jsxs)("button",{onClick:()=>{if(0===C.length)return;let a=Q&&S?`${Q} To ${S}`:O||"All Dates",b=new Date().toLocaleString("en-IN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),c=new Blob([["Admin Report - LactoConnect Milk Collection System",`Date From ${a}`,"","DETAILED COLLECTION DATA","","Date,Time,Channel,Shift,Machine,Society,Farmer ID,Farmer Name,Fat (%),SNF (%),CLR,Water (%),Rate,Quantity (L),Total Amount,Incentive",...C.map(a=>[a.collection_date,a.collection_time,a.channel,a.shift_type,`${a.machine_id} (${a.machine_type})`,`${a.society_name} (${a.society_id})`,a.farmer_id,a.farmer_name,a.fat_percentage,a.snf_percentage,a.clr_value,a.water_percentage,a.rate_per_liter,a.quantity,a.total_amount,a.bonus]).map(a=>a.join(",")),"","","OVERALL SUMMARY",`Total Collections:,${H.totalCollections}`,`Total Quantity (L):,${H.totalQuantity.toFixed(2)}`,`Overall Weighted Fat (%):,${H.weightedFat.toFixed(2)}`,`Overall Weighted SNF (%):,${H.weightedSnf.toFixed(2)}`,`Overall Weighted CLR:,${H.weightedClr.toFixed(2)}`,`Total Amount (Rs):,${H.totalAmount.toFixed(2)}`,`Overall Average Rate (Rs/L):,${H.averageRate.toFixed(2)}`,"","Thank you","Poornasree Equipments",`Generated on: ${b}`].join("\n")],{type:"text/csv"}),d=window.URL.createObjectURL(c),e=document.createElement("a");e.href=d,e.download=`collection-report-${new Date().toISOString().split("T")[0]}.csv`,e.click()},className:"flex items-center justify-center gap-2 px-3 py-2 bg-psr-green-600 text-white rounded-lg hover:bg-psr-green-700 transition-colors text-sm shadow-sm hover:shadow-md",children:[(0,b.jsx)(k.Download,{className:"w-4 h-4"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"CSV"})]}),(0,b.jsxs)("button",{onClick:()=>{if(0===C.length)return;let a=new s.default({orientation:"landscape",unit:"mm",format:"a4"}),b=Q&&S?`${Q} To ${S}`:O?`${O} To ${O}`:"All Dates";a.addImage("/fulllogo.png","PNG",14,8,0,12),a.setFontSize(14),a.setFont("helvetica","bold"),a.text("Daily Collection Report - LactoConnect Milk Collection System",148.5,15,{align:"center"}),a.setFontSize(9),a.setFont("helvetica","normal"),a.text(`Date From ${b}`,148.5,21,{align:"center"}),a.setFontSize(10),a.setFont("helvetica","bold"),a.text("DETAILED COLLECTION DATA",148.5,28,{align:"center"});let c=C.map((a,b)=>[(b+1).toString(),a.collection_date,a.collection_time,F(a.channel),a.shift_type,`${a.machine_id} (${a.machine_type})`,`${a.society_name} (${a.society_id})`,a.farmer_id,a.farmer_name||"",a.fat_percentage,a.snf_percentage,a.clr_value,a.water_percentage,a.rate_per_liter,a.quantity,a.total_amount,a.bonus]);(0,t.default)(a,{startY:32,head:[["SI No","Date","Time","Channel","Shift","Machine","Society","Farmer ID","Farmer Name","Fat (%)","SNF (%)","CLR","Water (%)","Rate","Quantity (L)","Total Amount","Incentive"]],body:c,theme:"grid",styles:{fontSize:6,cellPadding:1,halign:"center"},headStyles:{fillColor:[255,255,255],textColor:[0,0,0],fontStyle:"bold",fontSize:7,lineWidth:.5,lineColor:[0,0,0]},bodyStyles:{lineWidth:.3,lineColor:[200,200,200]},columnStyles:{0:{cellWidth:10},8:{halign:"left"}}});let d=a.lastAutoTable.finalY+8;a.setFontSize(11),a.setFont("helvetica","bold"),a.text("WEIGHTED AVERAGES",14,d),a.setFontSize(9),a.setFont("helvetica","normal");let e=d+6;a.text(`Weighted Fat      : ${H.weightedFat.toFixed(2)}`,14,e),e+=5,a.text(`Weighted SNF      : ${H.weightedSnf.toFixed(2)}`,14,e),e+=5,a.text(`Weighted CLR      : ${H.weightedClr.toFixed(2)}`,14,e),e+=8,a.setFont("helvetica","bold"),a.text("OVERALL SUMMARY",14,e),a.setFont("helvetica","normal"),e+=6,a.text(`Total Collections  : ${H.totalCollections}`,14,e),e+=5,a.text(`Total Quantity (L) : ${H.totalQuantity.toFixed(2)}`,14,e),e+=5,a.text(`Total Amount       : ${H.totalAmount.toFixed(2)}`,14,e),a.setFontSize(11),a.setFont("helvetica","bold"),a.text("REPORT NOTES",283,d,{align:"right"}),a.setFontSize(9),a.setFont("helvetica","normal");let f=d+6;a.text("Prepared by: POORNASREE EQUIPMENTS",283,f,{align:"right"}),f+=5,a.text("Contact: marketing@poornasree.com",283,f,{align:"right"}),f+=8,a.setFont("helvetica","bold"),a.text("POORNASREE EQUIPMENTS",283,f,{align:"right"}),a.setFont("helvetica","normal"),f+=5,a.text("Thank you for using LactoConnect",283,f,{align:"right"}),f+=5,a.text("For support, visit: www.poornasree.com",283,f,{align:"right"}),a.save(`collection-report-${new Date().toISOString().split("T")[0]}.pdf`)},className:"flex items-center justify-center gap-2 px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm shadow-sm hover:shadow-md",children:[(0,b.jsx)(m,{className:"w-4 h-4"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"PDF"})]}),(0,b.jsxs)("button",{onClick:()=>aL(!0),className:"flex items-center justify-center gap-2 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm shadow-sm hover:shadow-md",children:[(0,b.jsx)(r.Mail,{className:"w-4 h-4"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Send Mail"})]})]})]}),(0,b.jsx)(w.FilterDropdown,{statusFilter:U,onStatusChange:V,dairyFilter:Y,onDairyChange:a=>Z(Array.isArray(a)?a:[a]),bmcFilter:$,onBmcChange:a=>_(Array.isArray(a)?a:[a]),societyFilter:aa,onSocietyChange:a=>ab(Array.isArray(a)?a:[a]),machineFilter:ac,onMachineChange:a=>ad(Array.isArray(a)?a:[a]),farmerFilter:ae,onFarmerChange:a=>af(Array.isArray(a)?a:[a]),dairies:aO,bmcs:aP,societies:aQ,machines:aR,farmers:aS,filteredCount:C.length,totalCount:l.length,searchQuery:L,onSearchChange:M,icon:(0,b.jsx)(h.Droplet,{className:"w-5 h-5"}),dateFilter:O,onDateChange:P,dateFromFilter:Q,onDateFromChange:R,dateToFilter:S,onDateToChange:T,channelFilter:W,onChannelChange:X,showDateFilter:!0,showChannelFilter:!0,showShiftFilter:!0,showMachineFilter:!0,hideMainFilterButton:!0})]})}),(0,b.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:(0,b.jsx)("div",{className:"overflow-auto max-h-[600px]",tabIndex:0,children:(0,b.jsxs)("table",{className:"w-auto min-w-full table-auto",children:[(0,b.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700 sticky top-0 z-10",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-4 py-3 text-center",children:(0,b.jsx)("input",{type:"checkbox",checked:aC,onChange:()=>{aC?(aB(new Set),aD(!1)):(aB(new Set(C.map(a=>a.id))),aD(!0))},className:"w-4 h-4 text-emerald-600 bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-emerald-500 dark:focus:ring-emerald-400 cursor-pointer"})}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Date & Time"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Farmer"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Society"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Machine"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Shift"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Channel"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Fat %"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"SNF %"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"CLR"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Protein %"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Lactose %"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Salt %"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Water %"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Temp (°C)"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Rate/L"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Bonus"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Qty (L)"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Amount"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Action"})]})}),(0,b.jsx)("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:0===C.length?(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:20,className:"px-4 py-8 text-center text-gray-500 dark:text-gray-400",children:"No collection records found"})}):C.map(a=>(0,b.jsxs)("tr",{className:`transition-colors ${aA.has(a.id)?"bg-emerald-50 dark:bg-emerald-900/20 hover:bg-emerald-100 dark:hover:bg-emerald-900/30":"hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:[(0,b.jsx)("td",{className:"px-4 py-3 text-center",children:(0,b.jsx)("input",{type:"checkbox",checked:aA.has(a.id),onChange:()=>{var b;let c;return b=a.id,void((c=new Set(aA)).has(b)?c.delete(b):c.add(b),aB(c),aD(c.size===C.length&&C.length>0))},className:"w-4 h-4 text-emerald-600 bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-emerald-500 dark:focus:ring-emerald-400 cursor-pointer"})}),(0,b.jsxs)("td",{className:"px-4 py-3 text-sm text-center text-gray-900 dark:text-white whitespace-nowrap",children:[(0,b.jsx)("div",{children:E(a.collection_date,N)}),(0,b.jsx)("div",{className:"text-xs text-gray-500",children:a.collection_time})]}),(0,b.jsxs)("td",{className:"px-4 py-3 text-sm text-center text-gray-900 dark:text-white whitespace-nowrap",children:[(0,b.jsx)("div",{className:"font-medium",children:E(a.farmer_name,N)}),(0,b.jsxs)("div",{className:"text-xs text-gray-500",children:["ID: ",E(a.farmer_id,N)]})]}),(0,b.jsxs)("td",{className:"px-4 py-3 text-sm text-center text-gray-900 dark:text-white whitespace-nowrap",children:[(0,b.jsx)("div",{className:"font-medium",children:E(a.society_name,N)}),(0,b.jsxs)("div",{className:"text-xs text-gray-500",children:["ID: ",E(a.society_id,N)]})]}),(0,b.jsxs)("td",{className:"px-4 py-3 text-sm text-center text-gray-900 dark:text-white whitespace-nowrap",children:[(0,b.jsx)("div",{className:"font-medium",children:E(a.machine_id,N)}),(0,b.jsx)("div",{className:"text-xs text-gray-500",children:E(a.machine_type,N)})]}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-center",children:(0,b.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${["MR","MX","morning"].includes(a.shift_type?.toUpperCase()==="MORNING"?"morning":a.shift_type)?"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400":["EV","EX","evening"].includes(a.shift_type?.toUpperCase()==="EVENING"?"evening":a.shift_type)?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400":"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400"}`,children:E(["MR","MX"].includes(a.shift_type)||a.shift_type?.toLowerCase()==="morning"?"Morning":["EV","EX"].includes(a.shift_type)||a.shift_type?.toLowerCase()==="evening"?"Evening":a.shift_type,N)})}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-center",children:(0,b.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${"COW"===F(a.channel)?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400":"BUFFALO"===F(a.channel)?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400"}`,children:E(F(a.channel),N)})}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-center text-gray-900 dark:text-white",children:E(parseFloat(a.fat_percentage).toFixed(2),N)}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-center text-gray-900 dark:text-white",children:E(parseFloat(a.snf_percentage).toFixed(2),N)}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-center text-gray-900 dark:text-white",children:E(parseFloat(a.clr_value).toFixed(2),N)}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-center text-gray-900 dark:text-white",children:E(parseFloat(a.protein_percentage).toFixed(2),N)}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-center text-gray-900 dark:text-white",children:E(parseFloat(a.lactose_percentage).toFixed(2),N)}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-center text-gray-900 dark:text-white",children:E(parseFloat(a.salt_percentage).toFixed(2),N)}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-center text-gray-900 dark:text-white",children:E(parseFloat(a.water_percentage).toFixed(2),N)}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-center text-gray-900 dark:text-white",children:E(parseFloat(a.temperature).toFixed(2),N)}),(0,b.jsxs)("td",{className:"px-4 py-3 text-sm text-center text-gray-900 dark:text-white",children:["₹",E(parseFloat(a.rate_per_liter).toFixed(2),N)]}),(0,b.jsxs)("td",{className:"px-4 py-3 text-sm text-center text-gray-900 dark:text-white",children:["₹",E(parseFloat(a.bonus).toFixed(2),N)]}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-center font-medium text-gray-900 dark:text-white",children:E(parseFloat(a.quantity).toFixed(2),N)}),(0,b.jsxs)("td",{className:"px-4 py-3 text-sm text-center font-medium text-green-600 dark:text-green-400",children:["₹",E(parseFloat(a.total_amount).toFixed(2),N)]}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-center",children:(0,b.jsx)("button",{onClick:()=>{at(a.id),ar(!0)},className:"p-1 text-red-600 hover:text-red-800 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors",title:"Delete record",children:(0,b.jsx)(q.Trash2,{className:"w-4 h-4"})})})]},a.id))})]})})}),(0,b.jsx)(A.default,{isOpen:aq,onClose:()=>ar(!1),onConfirm:aT,title:"Delete Collection Record",message:"Enter your admin password to confirm deletion. This action cannot be undone and will be logged for security purposes."}),(0,b.jsx)(A.default,{isOpen:aE,onClose:()=>{aF(!1),aJ("")},onConfirm:aV,title:`Delete ${aA.size} Collection Record${aA.size>1?"s":""}`,message:`Enter your admin password to confirm deletion of ${aA.size} selected record(s). This action cannot be undone and will be logged for security purposes.`}),(0,b.jsx)(z.BulkActionsToolbar,{selectedCount:aA.size,totalCount:C.length,onBulkDelete:()=>{0!==aA.size&&aF(!0)},onClearSelection:aU,itemType:"record",showStatusUpdate:!1}),(0,b.jsx)(x.LoadingSnackbar,{isVisible:au||aG,message:aG?`Deleting ${aA.size} Records`:"Deleting Record",submessage:"Verifying credentials and removing data...",showProgress:!1}),(0,b.jsx)(D,{isOpen:aK,onClose:()=>aL(!1),onSend:aY,defaultEmail:aM,recordCount:C.length,reportType:"Collection Report"}),(0,b.jsx)(y.StatusMessage,{success:aw,error:ay,onClose:()=>{ax(""),az("")}})]})}let H=(0,l.default)("package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]),I=(a,c)=>{if(!a&&0!==a)return a||"";if(!c)return a;let d=a.toString(),e=RegExp(`(${c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return d.split(e).map((a,c)=>e.test(a)?(0,b.jsx)("span",{className:"bg-yellow-200 dark:bg-yellow-800 px-0.5 rounded",children:a},c):a)},J=a=>({ch1:"COW",ch2:"BUFFALO",ch3:"MIXED",CH1:"COW",CH2:"BUFFALO",CH3:"MIXED",COW:"COW",BUFFALO:"BUFFALO",MIXED:"MIXED",cow:"COW",buffalo:"BUFFALO",mixed:"MIXED",BUF:"BUFFALO",MIX:"MIXED"})[a]||a.toUpperCase();function K({globalSearch:a=""}){let[d,e]=(0,c.useState)([]),[f,g]=(0,c.useState)([]),[h,j]=(0,c.useState)({totalDispatches:0,totalQuantity:0,totalAmount:0,averageRate:0,weightedFat:0,weightedSnf:0,weightedClr:0}),[l,B]=(0,c.useState)(!0),[C,E]=(0,c.useState)("");(0,c.useEffect)(()=>{void 0!==a&&E(a)},[a]);let F=(0,c.useMemo)(()=>a||C,[a,C]),[G,K]=(0,c.useState)(""),[L,M]=(0,c.useState)(""),[N,O]=(0,c.useState)(""),[P,Q]=(0,c.useState)("all"),[R,S]=(0,c.useState)("all"),[T,U]=(0,c.useState)([]),[V,W]=(0,c.useState)([]),[X,Y]=(0,c.useState)([]),[Z,$]=(0,c.useState)([]),[_,aa]=(0,c.useState)([]),[ab,ac]=(0,c.useState)([]),[ad,ae]=(0,c.useState)(!1),[af,ag]=(0,c.useState)(null),[ah,ai]=(0,c.useState)(!1),[aj,ak]=(0,c.useState)(""),[al,am]=(0,c.useState)(""),[an,ao]=(0,c.useState)(new Set),[ap,aq]=(0,c.useState)(!1),[ar,as]=(0,c.useState)(!1),[at,au]=(0,c.useState)(!1),[av,aw]=(0,c.useState)(""),[ax,ay]=(0,c.useState)(!1),[az,aA]=(0,c.useState)(""),[aB,aC]=(0,c.useState)([]),[aD,aE]=(0,c.useState)([]);(0,c.useEffect)(()=>{(async()=>{try{let a=localStorage.getItem("authToken");if(!a)return;let b=await fetch("/api/user/dairy",{headers:{Authorization:`Bearer ${a}`}});if(b.ok){let a=await b.json();aa(a.data||[])}let c=await fetch("/api/user/bmc",{headers:{Authorization:`Bearer ${a}`}});if(c.ok){let a=await c.json();ac(a.data||[])}let d=await fetch("/api/user/society",{headers:{Authorization:`Bearer ${a}`}});if(d.ok){let a=await d.json();aC(a.data||[])}let e=await fetch("/api/user/machine",{headers:{Authorization:`Bearer ${a}`}});if(e.ok){let a=await e.json();aE(a.data||[])}}catch(a){console.error("Error fetching dairies/BMCs/Societies/Machines:",a)}})()},[]);let aF=(0,c.useMemo)(()=>{if(!_.length||!d.length)return _;let a=new Set(d.filter(a=>a.dairy_id).map(a=>a.dairy_id));return _.filter(b=>a.has(b.id))},[_,d]),aG=async a=>{if(af){ai(!0);try{let b=localStorage.getItem("authToken"),c=await fetch("/api/user/reports/dispatches/delete",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify({recordId:af,password:a})}),d=await c.json();if(!c.ok)throw Error(d.error||"Failed to delete record");ak("Dispatch record deleted successfully"),setTimeout(()=>ak(""),5e3),aM()}catch(a){throw console.error("Delete error:",a),am(a instanceof Error?a.message:"Failed to delete record"),setTimeout(()=>am(""),5e3),a}finally{ai(!1),ag(null)}}},aH=()=>{ao(new Set),aq(!1)},aI=async a=>{as(!1),au(!0);try{let b=localStorage.getItem("authToken"),c=Array.from(an).map(c=>fetch("/api/user/reports/dispatches/delete",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify({recordId:c,password:a})}).then(async a=>{if(!a.ok){let b=await a.json();throw Error(b.message||"Delete failed")}return a.json()})),d=await Promise.allSettled(c),e=d.filter(a=>"fulfilled"===a.status).length,f=d.filter(a=>"rejected"===a.status).length;if(e>0)ak(`Successfully deleted ${e} record(s)${f>0?`. ${f} failed.`:""}`),setTimeout(()=>ak(""),5e3),aM(),aH();else{let a=d.find(a=>"rejected"===a.status),b=a?.reason?.message||"Failed to delete selected records";am(b),setTimeout(()=>am(""),5e3)}}catch(a){console.error("Bulk delete error:",a),am(a instanceof Error?a.message:"Failed to delete selected records"),setTimeout(()=>am(""),5e3)}finally{au(!1),aw("")}},aJ=(0,c.useMemo)(()=>{if(!aB.length||!d.length)return aB;let a=new Set(d.filter(a=>a.society_id).map(a=>a.society_id));return aB.filter(b=>a.has(b.society_id))},[aB,d]),aK=(0,c.useMemo)(()=>{if(!aD.length||!d.length)return aD;let a=new Set(d.filter(a=>a.machine_id).map(a=>a.machine_id));return aD.filter(b=>a.has(b.machineId)).map(a=>({...a,collectionCount:d.filter(b=>b.machine_id===a.machineId).length}))},[aD,d]),aL=(0,c.useCallback)(a=>{let b=a.reduce((a,b)=>a+parseFloat(b.quantity||"0"),0),c=a.reduce((a,b)=>a+parseFloat(b.total_amount||"0"),0),d=a.reduce((a,b)=>a+parseFloat(b.rate_per_liter||"0"),0),e=a.length>0?d/a.length:0,f=a.reduce((a,b)=>a+parseFloat(b.quantity||"0")*parseFloat(b.fat_percentage||"0"),0),g=a.reduce((a,b)=>a+parseFloat(b.quantity||"0")*parseFloat(b.snf_percentage||"0"),0),h=a.reduce((a,b)=>a+parseFloat(b.quantity||"0")*parseFloat(b.clr_value||"0"),0),i=b>0?f/b:0,k=b>0?g/b:0,l=b>0?h/b:0;j({totalDispatches:a.length,totalQuantity:parseFloat(b.toFixed(2)),totalAmount:parseFloat(c.toFixed(2)),averageRate:parseFloat(e.toFixed(2)),weightedFat:parseFloat(i.toFixed(2)),weightedSnf:parseFloat(k.toFixed(2)),weightedClr:parseFloat(l.toFixed(2))})},[]),aM=(0,c.useCallback)(async(a=!0)=>{let b=localStorage.getItem("authToken");if(b)try{a&&B(!0);let c=await fetch("/api/user/reports/dispatches",{headers:{Authorization:`Bearer ${b}`}});if(c.ok){let a=await c.json();e(b=>JSON.stringify(b)!==JSON.stringify(a)?(aL(a),a):b)}}catch(a){console.error("Error fetching dispatch data:",a)}finally{a&&B(!1)}},[aL]);(0,c.useEffect)(()=>{aM(!0);let a=setInterval(()=>{aM(!1)},1e3);return()=>clearInterval(a)},[aM]),(0,c.useEffect)(()=>{(async()=>{try{let a=localStorage.getItem("authToken");if(!a)return;let b=await fetch("/api/user/profile",{headers:{Authorization:`Bearer ${a}`}});if(b.ok){let a=(await b.json()).email||"";aA(a)}}catch(a){console.error("Error fetching admin email:",a)}})()},[]),(0,c.useEffect)(()=>{let a=d;if(T.length>0){let b=T.map(a=>_.find(b=>b.id.toString()===a)?.id).filter(Boolean);b.length>0&&(a=a.filter(a=>a.dairy_id&&b.includes(a.dairy_id)))}if(V.length>0){let b=V.map(a=>ab.find(b=>b.id.toString()===a)?.id).filter(Boolean);b.length>0&&(a=a.filter(a=>a.bmc_id&&b.includes(a.bmc_id)))}if("all"!==P&&(a="morning"===P?a.filter(a=>["MR","MX","morning"].includes(a.shift_type)):"evening"===P?a.filter(a=>["EV","EX","evening"].includes(a.shift_type)):a.filter(a=>a.shift_type===P)),Array.isArray(X)&&X.length>0){let b=X.map(a=>{let b=aJ.find(b=>b.id.toString()===a);return b?.society_id}).filter(Boolean);b.length>0&&(a=a.filter(a=>b.includes(a.society_id)))}if(Z.length>0){let b=Z.map(a=>aK.find(b=>b.id.toString()===a)?.machineId).filter(Boolean);b.length>0&&(a=a.filter(a=>b.includes(a.machine_id)))}if("all"!==R&&(a=a.filter(a=>J(a.channel)===R)),G&&(a=a.filter(a=>a.dispatch_date===G)),L&&(a=a.filter(a=>a.dispatch_date>=L)),N&&(a=a.filter(a=>a.dispatch_date<=N)),F){let b=F.toLowerCase();a=a.filter(a=>{let c=["MR","MX"].includes(a.shift_type)||a.shift_type?.toLowerCase()==="morning"?"Morning":["EV","EX"].includes(a.shift_type)||a.shift_type?.toLowerCase()==="evening"?"Evening":a.shift_type;return[a.dispatch_id,a.society_id,a.society_name,a.bmc_name,a.dairy_name,a.machine_id,a.machine_type,a.machine_version,a.channel,J(a.channel),a.dispatch_date,a.dispatch_time,a.shift_type,c,a.quantity,a.fat_percentage,a.snf_percentage,a.clr_value,a.rate_per_liter,a.total_amount].some(a=>a?.toString().toLowerCase().includes(b))})}g(a),aL(a)},[a,C,G,L,N,P,R,X,Z,T,V,d,aJ,aK,_,ab,aL]);let aN=async a=>{if(!a||!a.includes("@"))throw Error("Please enter a valid email address");try{let b=L&&N?`${L} To ${N}`:G||"All Dates",c=new Date().toLocaleString("en-IN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),d=f.map(a=>[a.dispatch_date,a.dispatch_time,a.channel,a.shift_type,`${a.machine_id} (${a.machine_type})`,a.society_name||"",a.fat_percentage,a.snf_percentage,a.clr_value,a.rate_per_liter,a.quantity,a.total_amount]),e=[["POORNASREE EQUIPMENTS MILK DISPATCH REPORT"],["Admin Report with Weighted Averages"],[],["Report Generated:",c],["Date Range:",b],["Total Dispatches:",h.totalDispatches],["Total Quantity (L):",h.totalQuantity.toFixed(2)],["Total Amount (₹):",h.totalAmount.toFixed(2)],["Average Rate (₹/L):",h.averageRate.toFixed(2)],["Weighted FAT (%):",h.weightedFat.toFixed(2)],["Weighted SNF (%):",h.weightedSnf.toFixed(2)],["Weighted CLR:",h.weightedClr.toFixed(2)],[],["Date","Time","Channel","Shift","Machine","Society","Fat (%)","SNF (%)","CLR","Rate (₹/L)","Quantity (L)","Total Amount (₹)"],...d].map(a=>a.join(",")).join("\n"),g=new s.default({orientation:"landscape",unit:"mm",format:"a4"});g.addImage("/fulllogo.png","PNG",14,8,0,12),g.setFontSize(14),g.setFont("helvetica","bold"),g.text("Daily Dispatch Report - LactoConnect Milk Dispatch System",148.5,15,{align:"center"}),g.setFontSize(9),g.setFont("helvetica","normal"),g.text(`Date From ${b}`,148.5,21,{align:"center"}),g.setFontSize(10),g.setFont("helvetica","bold"),g.text("DETAILED DISPATCH DATA",148.5,28,{align:"center"});let i=f.map((a,b)=>[(b+1).toString(),a.dispatch_date,a.dispatch_time,J(a.channel),a.shift_type,`${a.machine_id} (${a.machine_type})`,`${a.society_name} (${a.society_id})`,a.fat_percentage,a.snf_percentage,a.clr_value,a.rate_per_liter,a.quantity,a.total_amount]);(0,t.default)(g,{startY:32,head:[["SI No","Date","Time","Channel","Shift","Machine","Society","Fat (%)","SNF (%)","CLR","Rate","Quantity (L)","Total Amount"]],body:i,theme:"grid",styles:{fontSize:7,cellPadding:1.5,halign:"center"},headStyles:{fillColor:[255,255,255],textColor:[0,0,0],fontStyle:"bold",fontSize:8,lineWidth:.5,lineColor:[0,0,0]},bodyStyles:{lineWidth:.3,lineColor:[200,200,200]},columnStyles:{0:{cellWidth:12}}});let j=g.lastAutoTable.finalY+8;g.setFontSize(11),g.setFont("helvetica","bold"),g.text("WEIGHTED AVERAGES",14,j),g.setFontSize(9),g.setFont("helvetica","normal");let k=j+6;g.text(`Weighted Fat      : ${h.weightedFat.toFixed(2)}`,14,k),k+=5,g.text(`Weighted SNF      : ${h.weightedSnf.toFixed(2)}`,14,k),k+=5,g.text(`Weighted CLR      : ${h.weightedClr.toFixed(2)}`,14,k),k+=8,g.setFont("helvetica","bold"),g.text("OVERALL SUMMARY",14,k),g.setFont("helvetica","normal"),k+=6,g.text(`Total Dispatches   : ${h.totalDispatches}`,14,k),k+=5,g.text(`Total Quantity (L) : ${h.totalQuantity.toFixed(2)}`,14,k),k+=5,g.text(`Total Amount       : ${h.totalAmount.toFixed(2)}`,14,k),g.setFontSize(11),g.setFont("helvetica","bold"),g.text("REPORT NOTES",283,j,{align:"right"}),g.setFontSize(9),g.setFont("helvetica","normal");let l=j+6;g.text("Prepared by: POORNASREE EQUIPMENTS",283,l,{align:"right"}),l+=5,g.text("Contact: marketing@poornasree.com",283,l,{align:"right"}),l+=8,g.setFont("helvetica","bold"),g.text("POORNASREE EQUIPMENTS",283,l,{align:"right"}),g.setFont("helvetica","normal"),l+=5,g.text("Thank you for using LactoConnect",283,l,{align:"right"}),l+=5,g.text("For support, visit: www.poornasree.com",283,l,{align:"right"});let m=g.output("datauristring").split(",")[1],n=localStorage.getItem("authToken"),o=await fetch("/api/user/reports/send-email",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({email:a,csvContent:e,pdfContent:m,reportType:"Dispatch Report",dateRange:b,stats:h})});if(!o.ok){let a=await o.json().catch(()=>({}));throw Error(a.error||"Failed to send email")}ak(`Report sent successfully to ${a}`),setTimeout(()=>ak(""),5e3)}catch(a){throw console.error("Error sending email:",a),a}};return l?(0,b.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,b.jsx)(v.FlowerSpinner,{size:48})}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-7 gap-3",children:[(0,b.jsx)(u.default,{title:"Total Dispatches",value:h.totalDispatches,icon:(0,b.jsx)(i.Truck,{className:"w-full h-full"}),color:"green"}),(0,b.jsx)(u.default,{title:"Total Quantity (L)",value:h.totalQuantity,icon:(0,b.jsx)(H,{className:"w-full h-full"}),color:"blue"}),(0,b.jsx)(u.default,{title:"Total Amount (₹)",value:`₹${h.totalAmount.toFixed(2)}`,icon:(0,b.jsx)(n.TrendingUp,{className:"w-full h-full"}),color:"yellow"}),(0,b.jsx)(u.default,{title:"Avg Rate (₹/L)",value:`₹${h.averageRate.toFixed(2)}`,icon:(0,b.jsx)(o.BarChart3,{className:"w-full h-full"}),color:"gray"}),(0,b.jsx)(u.default,{title:"Weighted FAT (%)",value:h.weightedFat.toFixed(2),icon:(0,b.jsx)(o.BarChart3,{className:"w-full h-full"}),color:"blue"}),(0,b.jsx)(u.default,{title:"Weighted SNF (%)",value:h.weightedSnf.toFixed(2),icon:(0,b.jsx)(o.BarChart3,{className:"w-full h-full"}),color:"green"}),(0,b.jsx)(u.default,{title:"Weighted CLR",value:h.weightedClr.toFixed(2),icon:(0,b.jsx)(o.BarChart3,{className:"w-full h-full"}),color:"red"})]}),(0,b.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 sm:p-6",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Showing ",f.length," of ",d.length," records"]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)("button",{onClick:()=>{let a;Q("all"),U([]),W([]),Y([]),$([]),K(""),M(""),O(""),S("all"),E(""),a=new CustomEvent("globalSearch",{detail:{query:""}}),window.dispatchEvent(a),aM()},className:"flex items-center justify-center gap-2 px-3 py-2 bg-psr-primary-600 text-white rounded-lg hover:bg-psr-primary-700 transition-colors text-sm shadow-sm hover:shadow-md",children:[(0,b.jsx)(p.RefreshCw,{className:"w-4 h-4"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Refresh"})]}),(0,b.jsxs)("button",{onClick:()=>{if(0===f.length)return;let a=L&&N?`${L} To ${N}`:G||"All Dates",b=new Date().toLocaleString("en-IN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),c=new Blob([["Admin Report - LactoConnect Milk Dispatch System",`Date From ${a}`,"","DETAILED DISPATCH DATA","","Date,Time,Channel,Shift,Machine,Society,Fat (%),SNF (%),CLR,Rate,Quantity (L),Total Amount",...f.map(a=>[a.dispatch_date,a.dispatch_time,a.channel,a.shift_type,`${a.machine_id} (${a.machine_type})`,`${a.society_name} (${a.society_id})`,a.fat_percentage,a.snf_percentage,a.clr_value,a.rate_per_liter,a.quantity,a.total_amount]).map(a=>a.join(",")),"","","OVERALL SUMMARY",`Total Dispatches:,${h.totalDispatches}`,`Total Quantity (L):,${h.totalQuantity.toFixed(2)}`,`Overall Weighted Fat (%):,${h.weightedFat.toFixed(2)}`,`Overall Weighted SNF (%):,${h.weightedSnf.toFixed(2)}`,`Overall Weighted CLR:,${h.weightedClr.toFixed(2)}`,`Total Amount (Rs):,${h.totalAmount.toFixed(2)}`,`Overall Average Rate (Rs/L):,${h.averageRate.toFixed(2)}`,"","Thank you","Poornasree Equipments",`Generated on: ${b}`].join("\n")],{type:"text/csv"}),d=window.URL.createObjectURL(c),e=document.createElement("a");e.href=d,e.download=`dispatch-report-${new Date().toISOString().split("T")[0]}.csv`,e.click()},className:"flex items-center justify-center gap-2 px-3 py-2 bg-psr-green-600 text-white rounded-lg hover:bg-psr-green-700 transition-colors text-sm shadow-sm hover:shadow-md",children:[(0,b.jsx)(k.Download,{className:"w-4 h-4"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"CSV"})]}),(0,b.jsxs)("button",{onClick:()=>{if(0===f.length)return;let a=new s.default({orientation:"landscape",unit:"mm",format:"a4"}),b=L&&N?`${L} To ${N}`:G?`${G} To ${G}`:"All Dates";a.addImage("/fulllogo.png","PNG",14,8,0,12),a.setFontSize(14),a.setFont("helvetica","bold"),a.text("Daily Dispatch Report - LactoConnect Milk Dispatch System",148.5,15,{align:"center"}),a.setFontSize(9),a.setFont("helvetica","normal"),a.text(`Date From ${b}`,148.5,21,{align:"center"}),a.setFontSize(10),a.setFont("helvetica","bold"),a.text("DETAILED DISPATCH DATA",148.5,28,{align:"center"});let c=f.map((a,b)=>[(b+1).toString(),a.dispatch_date,a.dispatch_time,J(a.channel),a.shift_type,`${a.machine_id} (${a.machine_type})`,`${a.society_name} (${a.society_id})`,a.fat_percentage,a.snf_percentage,a.clr_value,a.rate_per_liter,a.quantity,a.total_amount]);(0,t.default)(a,{startY:32,head:[["SI No","Date","Time","Channel","Shift","Machine","Society","Fat (%)","SNF (%)","CLR","Rate","Quantity (L)","Total Amount"]],body:c,theme:"grid",styles:{fontSize:7,cellPadding:1.5,halign:"center"},headStyles:{fillColor:[255,255,255],textColor:[0,0,0],fontStyle:"bold",fontSize:8,lineWidth:.5,lineColor:[0,0,0]},bodyStyles:{lineWidth:.3,lineColor:[200,200,200]},columnStyles:{0:{cellWidth:12}}});let d=a.lastAutoTable.finalY+8;a.setFontSize(11),a.setFont("helvetica","bold"),a.text("WEIGHTED AVERAGES",14,d),a.setFontSize(9),a.setFont("helvetica","normal");let e=d+6;a.text(`Weighted Fat      : ${h.weightedFat.toFixed(2)}`,14,e),e+=5,a.text(`Weighted SNF      : ${h.weightedSnf.toFixed(2)}`,14,e),e+=5,a.text(`Weighted CLR      : ${h.weightedClr.toFixed(2)}`,14,e),e+=8,a.setFont("helvetica","bold"),a.text("OVERALL SUMMARY",14,e),a.setFont("helvetica","normal"),e+=6,a.text(`Total Dispatches   : ${h.totalDispatches}`,14,e),e+=5,a.text(`Total Quantity (L) : ${h.totalQuantity.toFixed(2)}`,14,e),e+=5,a.text(`Total Amount       : ${h.totalAmount.toFixed(2)}`,14,e),a.setFontSize(11),a.setFont("helvetica","bold"),a.text("REPORT NOTES",283,d,{align:"right"}),a.setFontSize(9),a.setFont("helvetica","normal");let g=d+6;a.text("Prepared by: POORNASREE EQUIPMENTS",283,g,{align:"right"}),g+=5,a.text("Contact: marketing@poornasree.com",283,g,{align:"right"}),g+=8,a.setFont("helvetica","bold"),a.text("POORNASREE EQUIPMENTS",283,g,{align:"right"}),a.setFont("helvetica","normal"),g+=5,a.text("Thank you for using LactoConnect",283,g,{align:"right"}),g+=5,a.text("For support, visit: www.poornasree.com",283,g,{align:"right"}),a.save(`dispatch-report-${new Date().toISOString().split("T")[0]}.pdf`)},className:"flex items-center justify-center gap-2 px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm shadow-sm hover:shadow-md",children:[(0,b.jsx)(m,{className:"w-4 h-4"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"PDF"})]}),(0,b.jsxs)("button",{onClick:()=>ay(!0),className:"flex items-center justify-center gap-2 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm shadow-sm hover:shadow-md",children:[(0,b.jsx)(r.Mail,{className:"w-4 h-4"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Send Mail"})]})]})]}),(0,b.jsx)(w.FilterDropdown,{statusFilter:P,onStatusChange:Q,dairyFilter:T,onDairyChange:a=>U(Array.isArray(a)?a:[a]),bmcFilter:V,onBmcChange:a=>W(Array.isArray(a)?a:[a]),societyFilter:X,onSocietyChange:a=>Y(Array.isArray(a)?a:[a]),machineFilter:Z,onMachineChange:a=>$(Array.isArray(a)?a:[a]),dairies:aF,bmcs:ab,societies:aJ,machines:aK,filteredCount:f.length,totalCount:d.length,searchQuery:C,onSearchChange:E,icon:(0,b.jsx)(i.Truck,{className:"w-5 h-5"}),dateFilter:G,onDateChange:K,dateFromFilter:L,onDateFromChange:M,dateToFilter:N,onDateToChange:O,channelFilter:R,onChannelChange:S,showDateFilter:!0,showChannelFilter:!0,showShiftFilter:!0,showMachineFilter:!0,hideMainFilterButton:!0})]})}),(0,b.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:(0,b.jsx)("div",{className:"overflow-auto max-h-[600px]",tabIndex:0,children:(0,b.jsxs)("table",{className:"w-auto min-w-full table-auto",children:[(0,b.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700 sticky top-0 z-10",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-4 py-3 text-center",children:(0,b.jsx)("input",{type:"checkbox",checked:ap,onChange:()=>{ap?(ao(new Set),aq(!1)):(ao(new Set(f.map(a=>a.id))),aq(!0))},className:"w-4 h-4 text-emerald-600 bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-emerald-500 dark:focus:ring-emerald-400 cursor-pointer"})}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Date & Time"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Dispatch ID"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Society"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Shift"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Channel"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Machine"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Fat %"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"SNF %"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"CLR"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Rate/L"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Qty (L)"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Amount"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Action"})]})}),(0,b.jsx)("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:0===f.length?(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:14,className:"px-4 py-8 text-center text-gray-500 dark:text-gray-400",children:"No dispatch records found"})}):f.map(a=>(0,b.jsx)(c.default.Fragment,{children:(0,b.jsxs)("tr",{className:`transition-colors ${an.has(a.id)?"bg-emerald-50 dark:bg-emerald-900/20 hover:bg-emerald-100 dark:hover:bg-emerald-900/30":"hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:[(0,b.jsx)("td",{className:"px-4 py-3 text-center",children:(0,b.jsx)("input",{type:"checkbox",checked:an.has(a.id),onChange:()=>{var b;let c;return b=a.id,void((c=new Set(an)).has(b)?c.delete(b):c.add(b),ao(c),aq(c.size===f.length&&f.length>0))},className:"w-4 h-4 text-emerald-600 bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-emerald-500 dark:focus:ring-emerald-400 cursor-pointer"})}),(0,b.jsxs)("td",{className:"px-4 py-3 text-sm text-center text-gray-900 dark:text-white whitespace-nowrap",children:[(0,b.jsx)("div",{children:I(a.dispatch_date,F)}),(0,b.jsx)("div",{className:"text-xs text-gray-500",children:a.dispatch_time})]}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-center font-medium text-gray-900 dark:text-white",children:I(a.dispatch_id,F)}),(0,b.jsxs)("td",{className:"px-4 py-3 text-sm text-center text-gray-900 dark:text-white whitespace-nowrap",children:[(0,b.jsx)("div",{className:"font-medium",children:I(a.society_name,F)}),(0,b.jsxs)("div",{className:"text-xs text-gray-500",children:["ID: ",I(a.society_id,F)]})]}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-center",children:(0,b.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${["MR","MX"].includes(a.shift_type)||a.shift_type?.toLowerCase()==="morning"?"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400":["EV","EX"].includes(a.shift_type)||a.shift_type?.toLowerCase()==="evening"?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400":"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400"}`,children:I(["MR","MX"].includes(a.shift_type)||a.shift_type?.toLowerCase()==="morning"?"Morning":["EV","EX"].includes(a.shift_type)||a.shift_type?.toLowerCase()==="evening"?"Evening":a.shift_type,F)})}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-center",children:(0,b.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${"COW"===J(a.channel)?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400":"BUFFALO"===J(a.channel)?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400"}`,children:I(J(a.channel),F)})}),(0,b.jsxs)("td",{className:"px-4 py-3 text-sm text-center text-gray-900 dark:text-white whitespace-nowrap",children:[(0,b.jsx)("div",{className:"font-medium",children:I(a.machine_id||"N/A",F)}),(0,b.jsx)("div",{className:"text-xs text-gray-500",children:I(a.machine_type,F)})]}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-center text-gray-900 dark:text-white",children:I(parseFloat(a.fat_percentage).toFixed(2),F)}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-center text-gray-900 dark:text-white",children:I(parseFloat(a.snf_percentage).toFixed(2),F)}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-center text-gray-900 dark:text-white",children:I(parseFloat(a.clr_value).toFixed(2),F)}),(0,b.jsxs)("td",{className:"px-4 py-3 text-sm text-center text-gray-900 dark:text-white",children:["₹",I(parseFloat(a.rate_per_liter).toFixed(2),F)]}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-center font-medium text-gray-900 dark:text-white",children:I(parseFloat(a.quantity).toFixed(2),F)}),(0,b.jsxs)("td",{className:"px-4 py-3 text-sm text-center font-medium text-green-600 dark:text-green-400",children:["₹",I(parseFloat(a.total_amount).toFixed(2),F)]}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-center",children:(0,b.jsx)("button",{onClick:()=>{ag(a.id),ae(!0)},className:"p-1 text-red-600 hover:text-red-800 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors",title:"Delete record",children:(0,b.jsx)(q.Trash2,{className:"w-4 h-4"})})})]})},a.id))})]})})}),(0,b.jsx)(A.default,{isOpen:ad,onClose:()=>ae(!1),onConfirm:aG,title:"Delete Dispatch Record",message:"Enter your admin password to confirm deletion. This action cannot be undone and will be logged for security purposes."}),(0,b.jsx)(A.default,{isOpen:ar,onClose:()=>{as(!1),aw("")},onConfirm:aI,title:`Delete ${an.size} Dispatch Record${an.size>1?"s":""}`,message:`Enter your admin password to confirm deletion of ${an.size} selected record(s). This action cannot be undone and will be logged for security purposes.`}),(0,b.jsx)(z.BulkActionsToolbar,{selectedCount:an.size,totalCount:f.length,onBulkDelete:()=>{0!==an.size&&as(!0)},onClearSelection:aH,itemType:"record",showStatusUpdate:!1}),(0,b.jsx)(x.LoadingSnackbar,{isVisible:ah||at,message:at?`Deleting ${an.size} Records`:"Deleting Record",submessage:"Verifying credentials and removing data...",showProgress:!1}),(0,b.jsx)(D,{isOpen:ax,onClose:()=>ay(!1),onSend:aN,defaultEmail:az,recordCount:f.length,reportType:"Dispatch Report"}),(0,b.jsx)(y.StatusMessage,{success:aj,error:al,onClose:()=>{ak(""),am("")}})]})}var L=a.i(538784);let M=(a,c)=>{if(!a&&0!==a)return a||"";if(!c)return a;let d=a.toString(),e=RegExp(`(${c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return d.split(e).map((a,c)=>e.test(a)?(0,b.jsx)("span",{className:"bg-yellow-200 dark:bg-yellow-800 px-0.5 rounded",children:a},c):a)},N=a=>({ch1:"COW",ch2:"BUFFALO",ch3:"MIXED",CH1:"COW",CH2:"BUFFALO",CH3:"MIXED",COW:"COW",BUFFALO:"BUFFALO",MIXED:"MIXED",cow:"COW",buffalo:"BUFFALO",mixed:"MIXED",BUF:"BUFFALO",MIX:"MIXED"})[a]||a.toUpperCase();function O({globalSearch:a=""}){let[d,e]=(0,c.useState)([]),[f,g]=(0,c.useState)([]),[h,i]=(0,c.useState)({totalSales:0,totalQuantity:0,totalAmount:0,averageRate:0}),[l,B]=(0,c.useState)(!0),[C,E]=(0,c.useState)("");(0,c.useEffect)(()=>{void 0!==a&&E(a)},[a]);let F=(0,c.useMemo)(()=>a||C,[a,C]),[G,H]=(0,c.useState)(""),[I,J]=(0,c.useState)(""),[K,O]=(0,c.useState)(""),[P,Q]=(0,c.useState)("all"),[R,S]=(0,c.useState)("all"),[T,U]=(0,c.useState)([]),[V,W]=(0,c.useState)([]),[X,Y]=(0,c.useState)([]),[Z,$]=(0,c.useState)([]),[_,aa]=(0,c.useState)([]),[ab,ac]=(0,c.useState)([]),[ad,ae]=(0,c.useState)(!1),[af,ag]=(0,c.useState)(null),[ah,ai]=(0,c.useState)(!1),[aj,ak]=(0,c.useState)(""),[al,am]=(0,c.useState)(""),[an,ao]=(0,c.useState)(new Set),[ap,aq]=(0,c.useState)(!1),[ar,as]=(0,c.useState)(!1),[at,au]=(0,c.useState)(!1),[av,aw]=(0,c.useState)(""),[ax,ay]=(0,c.useState)(!1),[az,aA]=(0,c.useState)(""),[aB,aC]=(0,c.useState)([]),[aD,aE]=(0,c.useState)([]);(0,c.useEffect)(()=>{(async()=>{try{let a=localStorage.getItem("authToken");if(!a)return;let b=await fetch("/api/user/dairy",{headers:{Authorization:`Bearer ${a}`}});if(b.ok){let a=await b.json();aa(a.data||[])}let c=await fetch("/api/user/bmc",{headers:{Authorization:`Bearer ${a}`}});if(c.ok){let a=await c.json();ac(a.data||[])}let d=await fetch("/api/user/society",{headers:{Authorization:`Bearer ${a}`}});if(d.ok){let a=await d.json();aC(a.data||[])}let e=await fetch("/api/user/machine",{headers:{Authorization:`Bearer ${a}`}});if(e.ok){let a=await e.json();aE(a.data||[])}}catch(a){console.error("Error fetching dairies/BMCs/Societies/Machines:",a)}})()},[]);let aF=(0,c.useMemo)(()=>{if(!_.length||!d.length)return _;let a=new Set(d.filter(a=>a.dairy_id).map(a=>a.dairy_id));return _.filter(b=>a.has(b.id))},[_,d]),aG=async a=>{if(af){ai(!0);try{let b=localStorage.getItem("authToken"),c=await fetch("/api/user/reports/sales/delete",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify({recordId:af,password:a})}),d=await c.json();if(!c.ok)throw Error(d.error||"Failed to delete record");ak("Sales record deleted successfully"),setTimeout(()=>ak(""),5e3),aM()}catch(a){throw console.error("Delete error:",a),am(a instanceof Error?a.message:"Failed to delete record"),setTimeout(()=>am(""),5e3),a}finally{ai(!1),ag(null)}}},aH=()=>{ao(new Set),aq(!1)},aI=async a=>{as(!1),au(!0);try{let b=localStorage.getItem("authToken"),c=Array.from(an).map(c=>fetch("/api/user/reports/sales/delete",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify({recordId:c,password:a})}).then(async a=>{if(!a.ok){let b=await a.json();throw Error(b.message||"Delete failed")}return a.json()})),d=await Promise.allSettled(c),e=d.filter(a=>"fulfilled"===a.status).length,f=d.filter(a=>"rejected"===a.status).length;if(e>0)ak(`Successfully deleted ${e} record(s)${f>0?`. ${f} failed.`:""}`),setTimeout(()=>ak(""),5e3),aM(),aH();else{let a=d.find(a=>"rejected"===a.status),b=a?.reason?.message||"Failed to delete selected records";am(b),setTimeout(()=>am(""),5e3)}}catch(a){console.error("Bulk delete error:",a),am(a instanceof Error?a.message:"Failed to delete selected records"),setTimeout(()=>am(""),5e3)}finally{au(!1),aw("")}},aJ=(0,c.useMemo)(()=>{if(!aB.length||!d.length)return aB;let a=new Set(d.filter(a=>a.society_id).map(a=>a.society_id));return aB.filter(b=>a.has(b.society_id))},[aB,d]),aK=(0,c.useMemo)(()=>{if(!aD.length||!d.length)return aD;let a=new Set(d.filter(a=>a.machine_id).map(a=>a.machine_id));return aD.filter(b=>a.has(b.machineId)).map(a=>({...a,collectionCount:d.filter(b=>b.machine_id===a.machineId).length}))},[aD,d]),aL=(0,c.useCallback)(a=>{let b=a.reduce((a,b)=>a+parseFloat(b.quantity||"0"),0),c=a.reduce((a,b)=>a+parseFloat(b.total_amount||"0"),0),d=a.reduce((a,b)=>a+parseFloat(b.rate_per_liter||"0"),0),e=a.length>0?d/a.length:0;i({totalSales:a.length,totalQuantity:parseFloat(b.toFixed(2)),totalAmount:parseFloat(c.toFixed(2)),averageRate:parseFloat(e.toFixed(2))})},[]),aM=(0,c.useCallback)(async(a=!0)=>{let b=localStorage.getItem("authToken");if(b)try{a&&B(!0);let c=await fetch("/api/user/reports/sales",{headers:{Authorization:`Bearer ${b}`}});if(c.ok){let a=await c.json();e(b=>JSON.stringify(b)!==JSON.stringify(a)?(aL(a),a):b)}}catch(a){console.error("Error fetching sales data:",a)}finally{a&&B(!1)}},[aL]);(0,c.useEffect)(()=>{aM(!0);let a=setInterval(()=>{aM(!1)},1e3);return()=>clearInterval(a)},[aM]),(0,c.useEffect)(()=>{(async()=>{try{let a=localStorage.getItem("authToken");if(!a)return;let b=await fetch("/api/user/profile",{headers:{Authorization:`Bearer ${a}`}});if(b.ok){let a=(await b.json()).email||"";aA(a)}}catch(a){console.error("Error fetching admin email:",a)}})()},[]),(0,c.useEffect)(()=>{let a=d;if(T.length>0){let b=T.map(a=>_.find(b=>b.id.toString()===a)?.id).filter(Boolean);b.length>0&&(a=a.filter(a=>a.dairy_id&&b.includes(a.dairy_id)))}if(V.length>0){let b=V.map(a=>ab.find(b=>b.id.toString()===a)?.id).filter(Boolean);b.length>0&&(a=a.filter(a=>a.bmc_id&&b.includes(a.bmc_id)))}if("all"!==P&&(a="morning"===P?a.filter(a=>["MR","MX"].includes(a.shift_type)):"evening"===P?a.filter(a=>["EV","EX"].includes(a.shift_type)):a.filter(a=>a.shift_type===P)),Array.isArray(X)&&X.length>0){let b=X.map(a=>{let b=aJ.find(b=>b.id.toString()===a);return b?.society_id}).filter(Boolean);b.length>0&&(a=a.filter(a=>b.includes(a.society_id)))}if(Z.length>0){let b=Z.map(a=>aK.find(b=>b.id.toString()===a)?.machineId).filter(Boolean);b.length>0&&(a=a.filter(a=>b.includes(a.machine_id)))}if("all"!==R&&(a=a.filter(a=>N(a.channel)===R)),G&&(a=a.filter(a=>a.sales_date===G)),I&&(a=a.filter(a=>a.sales_date>=I)),K&&(a=a.filter(a=>a.sales_date<=K)),F){let b=F.toLowerCase();a=a.filter(a=>{let c=["MR","MX"].includes(a.shift_type)||a.shift_type?.toLowerCase()==="morning"?"Morning":["EV","EX"].includes(a.shift_type)||a.shift_type?.toLowerCase()==="evening"?"Evening":a.shift_type;return[a.count,a.society_id,a.society_name,a.bmc_name,a.dairy_name,a.machine_id,a.machine_type,a.machine_version,a.channel,N(a.channel),a.sales_date,a.sales_time,a.shift_type,c,a.quantity,a.rate_per_liter,a.total_amount].some(a=>a?.toString().toLowerCase().includes(b))})}g(a),aL(a)},[a,C,G,I,K,P,R,X,Z,T,V,d,aJ,aK,_,ab,aL]);let aN=async a=>{if(!a||!a.includes("@"))throw Error("Please enter a valid email address");try{let b=I&&K?`${I} To ${K}`:G||"All Dates",c=new Date().toLocaleString("en-IN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),d=f.map(a=>[a.count,a.sales_date,a.sales_time,a.channel,a.shift_type,`${a.machine_id} (${a.machine_type})`,a.society_name||"",a.quantity,a.rate_per_liter,a.total_amount]),e=[["POORNASREE EQUIPMENTS MILK SALES REPORT"],["Admin Report with Sales Summary"],[],["Report Generated:",c],["Date Range:",b],["Total Sales:",h.totalSales],["Total Quantity (L):",h.totalQuantity.toFixed(2)],["Total Amount (₹):",h.totalAmount.toFixed(2)],["Average Rate (₹/L):",h.averageRate.toFixed(2)],[],["Count","Date","Time","Channel","Shift","Machine","Society","Quantity (L)","Rate (₹/L)","Total Amount (₹)"],...d].map(a=>a.join(",")).join("\n"),g=new s.default({orientation:"landscape",unit:"mm",format:"a4"});g.addImage("/fulllogo.png","PNG",14,8,0,12),g.setFontSize(14),g.setFont("helvetica","bold"),g.text("Daily Sales Report - LactoConnect Milk Sales System",148.5,15,{align:"center"}),g.setFontSize(9),g.setFont("helvetica","normal"),g.text(`Date From ${b}`,148.5,21,{align:"center"}),g.setFontSize(10),g.setFont("helvetica","bold"),g.text("DETAILED SALES DATA",148.5,28,{align:"center"});let i=f.map((a,b)=>[(b+1).toString(),a.count,a.sales_date,a.sales_time,N(a.channel),a.shift_type,`${a.machine_id} (${a.machine_type})`,`${a.society_name} (${a.society_id})`,a.quantity,a.rate_per_liter,a.total_amount]);(0,t.default)(g,{startY:32,head:[["SI No","Count","Date","Time","Channel","Shift","Machine","Society","Quantity (L)","Rate","Total Amount"]],body:i,theme:"grid",styles:{fontSize:7,cellPadding:1.5,halign:"center"},headStyles:{fillColor:[255,255,255],textColor:[0,0,0],fontStyle:"bold",fontSize:8,lineWidth:.5,lineColor:[0,0,0]},bodyStyles:{lineWidth:.3,lineColor:[200,200,200]},columnStyles:{0:{cellWidth:12}}});let j=g.lastAutoTable.finalY+8;g.setFontSize(11),g.setFont("helvetica","bold"),g.text("OVERALL SUMMARY",14,j),g.setFont("helvetica","normal");let k=j+6;g.text(`Total Sales        : ${h.totalSales}`,14,k),k+=5,g.text(`Total Quantity (L) : ${h.totalQuantity.toFixed(2)}`,14,k),k+=5,g.text(`Total Amount       : ${h.totalAmount.toFixed(2)}`,14,k),k+=5,g.text(`Average Rate       : ${h.averageRate.toFixed(2)}`,14,k),g.setFontSize(11),g.setFont("helvetica","bold"),g.text("REPORT NOTES",283,j,{align:"right"}),g.setFontSize(9),g.setFont("helvetica","normal");let l=j+6;g.text("Prepared by: POORNASREE EQUIPMENTS",283,l,{align:"right"}),l+=5,g.text("Contact: marketing@poornasree.com",283,l,{align:"right"}),l+=8,g.setFont("helvetica","bold"),g.text("POORNASREE EQUIPMENTS",283,l,{align:"right"}),g.setFont("helvetica","normal"),l+=5,g.text("Thank you for using LactoConnect",283,l,{align:"right"}),l+=5,g.text("For support, visit: www.poornasree.com",283,l,{align:"right"});let m=g.output("datauristring").split(",")[1],n=localStorage.getItem("authToken"),o=await fetch("/api/user/reports/send-email",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({email:a,csvContent:e,pdfContent:m,reportType:"Sales Report",dateRange:b,stats:h})});if(!o.ok){let a=await o.json().catch(()=>({}));throw Error(a.error||"Failed to send email")}ak(`Report sent successfully to ${a}`),setTimeout(()=>ak(""),5e3)}catch(a){throw console.error("Error sending email:",a),a}};return l?(0,b.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,b.jsx)(v.FlowerSpinner,{size:48})}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-4 gap-3",children:[(0,b.jsx)(u.default,{title:"Total Sales",value:h.totalSales,icon:(0,b.jsx)(L.ShoppingCart,{className:"w-full h-full"}),color:"blue"}),(0,b.jsx)(u.default,{title:"Total Quantity (L)",value:h.totalQuantity,icon:(0,b.jsx)(o.BarChart3,{className:"w-full h-full"}),color:"green"}),(0,b.jsx)(u.default,{title:"Total Amount (₹)",value:`₹${h.totalAmount.toFixed(2)}`,icon:(0,b.jsx)(j.DollarSign,{className:"w-full h-full"}),color:"yellow"}),(0,b.jsx)(u.default,{title:"Avg Rate (₹/L)",value:`₹${h.averageRate.toFixed(2)}`,icon:(0,b.jsx)(n.TrendingUp,{className:"w-full h-full"}),color:"gray"})]}),(0,b.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 sm:p-6",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Showing ",f.length," of ",d.length," records"]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)("button",{onClick:()=>{let a;Q("all"),U([]),W([]),Y([]),$([]),H(""),J(""),O(""),S("all"),E(""),a=new CustomEvent("globalSearch",{detail:{query:""}}),window.dispatchEvent(a),aM()},className:"flex items-center justify-center gap-2 px-3 py-2 bg-psr-primary-600 text-white rounded-lg hover:bg-psr-primary-700 transition-colors text-sm shadow-sm hover:shadow-md",children:[(0,b.jsx)(p.RefreshCw,{className:"w-4 h-4"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Refresh"})]}),(0,b.jsxs)("button",{onClick:()=>{if(0===f.length)return;let a=I&&K?`${I} To ${K}`:G||"All Dates",b=new Date().toLocaleString("en-IN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),c=new Blob([["Admin Report - LactoConnect Milk Sales System",`Date From ${a}`,"","DETAILED SALES DATA","","Date,Time,Channel,Machine,Society,Rate,Quantity (L),Total Amount",...f.map(a=>[a.sales_date,a.sales_time,a.channel,`${a.machine_id} (${a.machine_type})`,`${a.society_name} (${a.society_id})`,a.rate_per_liter,a.quantity,a.total_amount]).map(a=>a.join(",")),"","","OVERALL SUMMARY",`Total Sales:,${h.totalSales}`,`Total Quantity (L):,${h.totalQuantity.toFixed(2)}`,`Total Amount (Rs):,${h.totalAmount.toFixed(2)}`,`Overall Average Rate (Rs/L):,${h.averageRate.toFixed(2)}`,"","Thank you","Poornasree Equipments",`Generated on: ${b}`].join("\n")],{type:"text/csv"}),d=window.URL.createObjectURL(c),e=document.createElement("a");e.href=d,e.download=`sales-report-${new Date().toISOString().split("T")[0]}.csv`,e.click()},className:"flex items-center justify-center gap-2 px-3 py-2 bg-psr-green-600 text-white rounded-lg hover:bg-psr-green-700 transition-colors text-sm shadow-sm hover:shadow-md",children:[(0,b.jsx)(k.Download,{className:"w-4 h-4"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"CSV"})]}),(0,b.jsxs)("button",{onClick:()=>{if(0===f.length)return;let a=new s.default({orientation:"landscape",unit:"mm",format:"a4"}),b=I&&K?`${I} To ${K}`:G?`${G} To ${G}`:"All Dates";a.addImage("/fulllogo.png","PNG",14,8,0,12),a.setFontSize(14),a.setFont("helvetica","bold"),a.text("Daily Sales Report - LactoConnect Milk Sales System",148.5,15,{align:"center"}),a.setFontSize(9),a.setFont("helvetica","normal"),a.text(`Date From ${b}`,148.5,21,{align:"center"}),a.setFontSize(10),a.setFont("helvetica","bold"),a.text("DETAILED SALES DATA",148.5,28,{align:"center"});let c=f.map((a,b)=>[(b+1).toString(),a.sales_date,a.sales_time,N(a.channel),`${a.machine_id} (${a.machine_type})`,`${a.society_name} (${a.society_id})`,a.rate_per_liter,a.quantity,a.total_amount]);(0,t.default)(a,{startY:32,head:[["SI No","Date","Time","Channel","Machine","Society","Rate","Quantity (L)","Total Amount"]],body:c,theme:"grid",styles:{fontSize:8,cellPadding:2,halign:"center"},headStyles:{fillColor:[255,255,255],textColor:[0,0,0],fontStyle:"bold",fontSize:9,lineWidth:.5,lineColor:[0,0,0]},bodyStyles:{lineWidth:.3,lineColor:[200,200,200]},columnStyles:{0:{cellWidth:15}}});let d=a.lastAutoTable.finalY+8;a.setFontSize(11),a.setFont("helvetica","bold"),a.text("OVERALL SUMMARY",14,d),a.setFont("helvetica","normal"),a.setFontSize(9);let e=d+6;a.text(`Total Sales        : ${h.totalSales}`,14,e),e+=5,a.text(`Total Quantity (L) : ${h.totalQuantity.toFixed(2)}`,14,e),e+=5,a.text(`Total Amount       : ${h.totalAmount.toFixed(2)}`,14,e),e+=5,a.text(`Avg Rate (Rs/L)    : ${h.averageRate.toFixed(2)}`,14,e),a.setFontSize(11),a.setFont("helvetica","bold"),a.text("REPORT NOTES",283,d,{align:"right"}),a.setFontSize(9),a.setFont("helvetica","normal");let g=d+6;a.text("Prepared by: POORNASREE EQUIPMENTS",283,g,{align:"right"}),g+=5,a.text("Contact: marketing@poornasree.com",283,g,{align:"right"}),g+=8,a.setFont("helvetica","bold"),a.text("POORNASREE EQUIPMENTS",283,g,{align:"right"}),a.setFont("helvetica","normal"),g+=5,a.text("Thank you for using LactoConnect",283,g,{align:"right"}),g+=5,a.text("For support, visit: www.poornasree.com",283,g,{align:"right"}),a.save(`sales-report-${new Date().toISOString().split("T")[0]}.pdf`)},className:"flex items-center justify-center gap-2 px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm shadow-sm hover:shadow-md",children:[(0,b.jsx)(m,{className:"w-4 h-4"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"PDF"})]}),(0,b.jsxs)("button",{onClick:()=>ay(!0),className:"flex items-center justify-center gap-2 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm shadow-sm hover:shadow-md",children:[(0,b.jsx)(r.Mail,{className:"w-4 h-4"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Send Mail"})]})]})]}),(0,b.jsx)(w.FilterDropdown,{statusFilter:P,onStatusChange:Q,dairyFilter:T,onDairyChange:a=>U(Array.isArray(a)?a:[a]),bmcFilter:V,onBmcChange:a=>W(Array.isArray(a)?a:[a]),societyFilter:X,onSocietyChange:a=>Y(Array.isArray(a)?a:[a]),machineFilter:Z,onMachineChange:a=>$(Array.isArray(a)?a:[a]),dairies:aF,bmcs:ab,societies:aJ,machines:aK,filteredCount:f.length,totalCount:d.length,searchQuery:C,onSearchChange:E,icon:(0,b.jsx)(j.DollarSign,{className:"w-5 h-5"}),dateFilter:G,onDateChange:H,dateFromFilter:I,onDateFromChange:J,dateToFilter:K,onDateToChange:O,channelFilter:R,onChannelChange:S,showDateFilter:!0,showChannelFilter:!0,showShiftFilter:!0,showMachineFilter:!0,hideMainFilterButton:!0})]})}),(0,b.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:(0,b.jsx)("div",{className:"overflow-auto max-h-[600px]",tabIndex:0,children:(0,b.jsxs)("table",{className:"w-auto min-w-full table-auto",children:[(0,b.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700 sticky top-0 z-10",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-4 py-3 text-center",children:(0,b.jsx)("input",{type:"checkbox",checked:ap,onChange:()=>{ap?(ao(new Set),aq(!1)):(ao(new Set(f.map(a=>a.id))),aq(!0))},className:"w-4 h-4 text-emerald-600 bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-emerald-500 dark:focus:ring-emerald-400 cursor-pointer"})}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Date & Time"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Count"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Society"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Shift"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Channel"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Machine"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Rate/L"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Qty (L)"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Amount"}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider whitespace-nowrap",children:"Action"})]})}),(0,b.jsx)("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:0===f.length?(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:11,className:"px-4 py-8 text-center text-gray-500 dark:text-gray-400",children:"No sales records found"})}):f.map(a=>(0,b.jsx)(c.default.Fragment,{children:(0,b.jsxs)("tr",{className:`transition-colors ${an.has(a.id)?"bg-emerald-50 dark:bg-emerald-900/20 hover:bg-emerald-100 dark:hover:bg-emerald-900/30":"hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:[(0,b.jsx)("td",{className:"px-4 py-3 text-center",children:(0,b.jsx)("input",{type:"checkbox",checked:an.has(a.id),onChange:()=>{var b;let c;return b=a.id,void((c=new Set(an)).has(b)?c.delete(b):c.add(b),ao(c),aq(c.size===f.length&&f.length>0))},className:"w-4 h-4 text-emerald-600 bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-emerald-500 dark:focus:ring-emerald-400 cursor-pointer"})}),(0,b.jsxs)("td",{className:"px-4 py-3 text-sm text-center text-gray-900 dark:text-white whitespace-nowrap",children:[(0,b.jsx)("div",{children:M(a.sales_date,F)}),(0,b.jsx)("div",{className:"text-xs text-gray-500",children:a.sales_time})]}),(0,b.jsxs)("td",{className:"px-4 py-3 text-sm text-center font-medium text-gray-900 dark:text-white",children:["#",M(a.count,F)]}),(0,b.jsxs)("td",{className:"px-4 py-3 text-sm text-center text-gray-900 dark:text-white whitespace-nowrap",children:[(0,b.jsx)("div",{className:"font-medium",children:M(a.society_name,F)}),(0,b.jsxs)("div",{className:"text-xs text-gray-500",children:["ID: ",M(a.society_id,F)]})]}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-center",children:(0,b.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${["MR","MX"].includes(a.shift_type)||a.shift_type?.toLowerCase()==="morning"?"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400":["EV","EX"].includes(a.shift_type)||a.shift_type?.toLowerCase()==="evening"?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400":"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400"}`,children:M(["MR","MX"].includes(a.shift_type)||a.shift_type?.toLowerCase()==="morning"?"Morning":["EV","EX"].includes(a.shift_type)||a.shift_type?.toLowerCase()==="evening"?"Evening":a.shift_type,F)})}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-center",children:(0,b.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${"COW"===N(a.channel)?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400":"BUFFALO"===N(a.channel)?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400"}`,children:M(N(a.channel),F)})}),(0,b.jsxs)("td",{className:"px-4 py-3 text-sm text-center text-gray-900 dark:text-white whitespace-nowrap",children:[(0,b.jsx)("div",{className:"font-medium",children:M(a.machine_id||"N/A",F)}),(0,b.jsx)("div",{className:"text-xs text-gray-500",children:M(a.machine_type,F)})]}),(0,b.jsxs)("td",{className:"px-4 py-3 text-sm text-center text-gray-900 dark:text-white",children:["₹",M(parseFloat(a.rate_per_liter).toFixed(2),F)]}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-center font-medium text-gray-900 dark:text-white",children:M(parseFloat(a.quantity).toFixed(2),F)}),(0,b.jsxs)("td",{className:"px-4 py-3 text-sm text-center font-medium text-green-600 dark:text-green-400",children:["₹",M(parseFloat(a.total_amount).toFixed(2),F)]}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-center",children:(0,b.jsx)("button",{onClick:()=>{ag(a.id),ae(!0)},className:"p-1 text-red-600 hover:text-red-800 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors",title:"Delete record",children:(0,b.jsx)(q.Trash2,{className:"w-4 h-4"})})})]})},a.id))})]})})}),(0,b.jsx)(A.default,{isOpen:ad,onClose:()=>ae(!1),onConfirm:aG,title:"Delete Sales Record",message:"Enter your admin password to confirm deletion. This action cannot be undone and will be logged for security purposes."}),(0,b.jsx)(A.default,{isOpen:ar,onClose:()=>{as(!1),aw("")},onConfirm:aI,title:`Delete ${an.size} Sales Record${an.size>1?"s":""}`,message:`Enter your admin password to confirm deletion of ${an.size} selected record(s). This action cannot be undone and will be logged for security purposes.`}),(0,b.jsx)(z.BulkActionsToolbar,{selectedCount:an.size,totalCount:f.length,onBulkDelete:()=>{0!==an.size&&as(!0)},onClearSelection:aH,itemType:"record",showStatusUpdate:!1}),(0,b.jsx)(x.LoadingSnackbar,{isVisible:ah||at,message:at?`Deleting ${an.size} Records`:"Deleting Record",submessage:"Verifying credentials and removing data...",showProgress:!1}),(0,b.jsx)(D,{isOpen:ax,onClose:()=>ay(!1),onSend:aN,defaultEmail:az,recordCount:f.length,reportType:"Sales Report"}),(0,b.jsx)(y.StatusMessage,{success:aj,error:al,onClose:()=>{ak(""),am("")}})]})}let P=[{id:"collection",label:"Collection",icon:h.Droplet,color:"text-blue-600 dark:text-blue-400",gradient:"from-blue-600 to-cyan-600"},{id:"dispatch",label:"Dispatch",icon:i.Truck,color:"text-green-600 dark:text-green-400",gradient:"from-green-600 to-emerald-600"},{id:"sales",label:"Sales",icon:j.DollarSign,color:"text-purple-600 dark:text-purple-400",gradient:"from-purple-600 to-pink-600"}];function Q(){let a=(0,d.useSearchParams)(),[h,i]=(0,c.useState)("collection"),[j,k]=(0,c.useState)(""),[l,m]=(0,c.useState)(null),[n,o]=(0,c.useState)(null),[p,q]=(0,c.useState)(null),[r,s]=(0,c.useState)(null),[t,u]=(0,c.useState)(null),[v,w]=(0,c.useState)(null);return(0,c.useEffect)(()=>{let b=a.get("societyId"),c=a.get("societyName"),d=a.get("fromDate"),e=a.get("toDate"),f=a.get("bmcFilter"),g=a.get("machineFilter");console.log("Reports Page - URL Params:",{societyId:b,societyName:c,fromDate:d,toDate:e,machineFilter:g}),b&&(m(b),o(c)),d&&(console.log("Setting initialFromDate:",d),q(d)),e&&(console.log("Setting initialToDate:",e),s(e)),f&&(console.log("Setting initialBmcFilter:",f),u(f)),g&&(console.log("Setting initialMachineFilter:",g),w(g))},[]),(0,c.useEffect)(()=>{let a=a=>{k(a.detail.query)};return window.addEventListener("globalSearch",a),()=>{window.removeEventListener("globalSearch",a)}},[]),(0,b.jsxs)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[(0,b.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,b.jsx)("div",{className:"px-4 sm:px-6 lg:px-8 py-4 sm:py-6",children:(0,b.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"p-2 sm:p-3 bg-gradient-to-br from-green-600 to-emerald-600 rounded-xl shadow-lg",children:(0,b.jsx)(g.FileText,{className:"w-5 h-5 sm:w-6 sm:h-6 text-white"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white",children:"Reports"}),(0,b.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1 hidden sm:block",children:"View and analyze data"})]})]}),(0,b.jsx)("div",{className:"inline-flex bg-psr-green-50 dark:bg-gray-800 rounded-xl p-1 shadow-inner",children:P.map(a=>{let c=a.icon,d=h===a.id;return(0,b.jsxs)("button",{onClick:()=>i(a.id),className:`
                      relative flex items-center gap-2 px-4 sm:px-6 py-2 sm:py-2.5 rounded-lg font-medium
                      transition-all duration-200
                      ${d?"bg-psr-green-600 dark:bg-psr-green-700 text-white shadow-md":"text-gray-600 dark:text-gray-400 hover:text-psr-green-600 dark:hover:text-psr-green-400"}
                    `,children:[(0,b.jsx)(c,{className:"w-4 h-4 sm:w-5 sm:h-5"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:a.label})]},a.id)})})]})})}),(0,b.jsx)("div",{className:"px-4 sm:px-6 lg:px-8 py-6",children:(0,b.jsx)(f.AnimatePresence,{mode:"wait",children:(0,b.jsx)(e.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2},children:(()=>{switch(console.log("Rendering with date filters:",{initialFromDate:p,initialToDate:r,initialBmcFilter:t,initialMachineFilter:v}),h){case"collection":return(0,b.jsx)(G,{globalSearch:j,initialSocietyId:l,initialSocietyName:n,initialFromDate:p,initialToDate:r,initialBmcFilter:t,initialMachineFilter:v},"collection");case"dispatch":return(0,b.jsx)(K,{globalSearch:j},"dispatch");case"sales":return(0,b.jsx)(O,{globalSearch:j},"sales");default:return null}})()},h)})})]})}function R(){return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-500"})}),children:(0,b.jsx)(Q,{})})}a.s(["default",()=>R,"dynamic",0,"force-dynamic"],291245)}];

//# sourceMappingURL=src_app_admin_reports_page_tsx_24776585._.js.map