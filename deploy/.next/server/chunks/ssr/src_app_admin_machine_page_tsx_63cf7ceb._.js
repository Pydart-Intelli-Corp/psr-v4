module.exports=[347441,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(50944),e=a.i(835475),f=a.i(550194),g=a.i(346158),h=a.i(321161),i=a.i(124987),j=a.i(963519),k=a.i(546842),l=a.i(941675),m=a.i(267900),n=a.i(879808),o=a.i(73570),p=a.i(943108),q=a.i(481402);let r=(0,a.i(170106).default)("key-round",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);var s=a.i(492596),t=a.i(296101),u=a.i(50522),v=a.i(405784),w=a.i(104720),x=a.i(641710),y=a.i(915618),z=a.i(177156),A=a.i(816201),B=a.i(923821),C=a.i(724669),D=a.i(93518),E=a.i(839761),F=a.i(633508),G=a.i(457431),H=a.i(677924),I=a.i(758042),J=a.i(994222),K=a.i(54419),L=a.i(659854),M=a.i(48662);a.i(16707);var N=a.i(529784),O=a.i(981189),P=a.i(651963),Q=a.i(851068),R=a.i(796182),S=a.i(110724),T=a.i(688238),U=a.i(195279),V=a.i(291691),W=a.i(960020),X=a.i(604126);a.i(152824);var Y=a.i(436355),Z=a.i(771829),$=a.i(715867),_=a.i(297030),aa=a.i(840602),ab=a.i(668610),ac=a.i(690163);let ad={machineId:"",machineType:"",societyId:"",location:"",installationDate:"",operatorName:"",contactPhone:"",status:"active",notes:"",setAsMaster:!1,disablePasswordInheritance:!1};function ae(){let a,ae=(0,d.useRouter)(),af=(0,d.useSearchParams)(),{user:ag}=(0,e.useUser)(),{}=(0,f.useLanguage)(),[ah,ai]=(0,c.useState)([]),[aj,ak]=(0,c.useState)([]),[al,am]=(0,c.useState)([]),[an,ao]=(0,c.useState)([]),[ap,aq]=(0,c.useState)([]),[ar,as]=(0,c.useState)(!0),[at,au]=(0,c.useState)(!1),[av,aw]=(0,c.useState)(!1),[ax,ay]=(0,c.useState)(!1),[az,aA]=(0,c.useState)(!1),[aB,aC]=(0,c.useState)(!1),[aD,aE]=(0,c.useState)(!1),[aF,aG]=(0,c.useState)(!1),[aH,aI]=(0,c.useState)(null),[aJ,aK]=(0,c.useState)([]),[aL,aM]=(0,c.useState)(!1),[aN,aO]=(0,c.useState)(""),[aP,aQ]=(0,c.useState)(""),[aR,aS]=(0,c.useState)(""),[aT,aU]=(0,c.useState)(null),[aV,aW]=(0,c.useState)(ad),[aX,aY]=(0,c.useState)({userPassword:"",supervisorPassword:"",confirmUserPassword:"",confirmSupervisorPassword:""}),[aZ,a$]=(0,c.useState)({userPassword:"",confirmUserPassword:"",supervisorPassword:"",confirmSupervisorPassword:""}),[a_,a0]=(0,c.useState)(!1),[a1,a2]=(0,c.useState)(""),[a3,a4]=(0,c.useState)("all"),[a5,a6]=(0,c.useState)([]),[a7,a8]=(0,c.useState)([]),[a9,ba]=(0,c.useState)([]),[bb,bc]=(0,c.useState)([]),[bd,be]=(0,c.useState)(""),[bf,bg]=(0,c.useState)(""),[bh,bi]=(0,c.useState)({topCollector:null,mostTests:null,bestCleaning:null,mostCleaningSkip:null,activeToday:null,highestUptime:null}),[bj,bk]=(0,c.useState)(!1),[bl,bm]=(0,c.useState)("quantity"),[bn,bo]=(0,c.useState)([]),[bp,bq]=(0,c.useState)({}),[br,bs]=(0,c.useState)(new Set),[bt,bu]=(0,c.useState)("folder"),[bv,bw]=(0,c.useState)(new Set),[bx,by]=(0,c.useState)(new Set),[bz,bA]=(0,c.useState)(!1),[bB,bC]=(0,c.useState)(!1),[bD,bE]=(0,c.useState)(0),[bF,bG]=(0,c.useState)(!1),[bH,bI]=(0,c.useState)(!1),[bJ,bK]=(0,c.useState)("active"),[bL,bM]=(0,c.useState)(!1),[bN,bO]=(0,c.useState)(null),[bP,bQ]=(0,c.useState)(!1),[bR,bS]=(0,c.useState)(!1),[bT,bU]=(0,c.useState)(null),[bV,bW]=(0,c.useState)(null),[bX,bY]=(0,c.useState)(!1),[bZ,b$]=(0,c.useState)(!1),[b_,b0]=(0,c.useState)(!1),[b1,b2]=(0,c.useState)(new Set),[b3,b4]=(0,c.useState)(!1),[b5,b6]=(0,c.useState)(!1),[b7,b8]=(0,c.useState)(""),[b9,ca]=(0,c.useState)(""),[cb,cc]=(0,c.useState)(!1),[cd,ce]=(0,c.useState)(null),[cf,cg]=(0,c.useState)(null),ch=a=>a?/^\d{6}$/.test(a)?"":"Password must be exactly 6 numbers":"",ci=a=>{if(!a)return{pending:[],downloaded:[]};let b=a.split("|||"),c=[],d=[];return b.forEach(a=>{let[b,e,f]=a.split(":");b&&e&&f&&("pending"===f?c.push({channel:b,fileName:e}):"downloaded"===f&&d.push({channel:b,fileName:e}))}),{pending:c,downloaded:d}},cj=a=>{bU(a),bW(null),bY(!1),bS(!0)},ck=async()=>{if(!bV)return void be("Please select a machine to set as master");b$(!0),be("");try{let a=localStorage.getItem("authToken");if(console.log("Token from localStorage:",a),console.log("Token type:",typeof a),console.log("Token length:",a?.length),!a)return void be("Authentication token not found. Please login again.");let b=await fetch(`/api/user/machine/${bV}/set-master`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({setForAll:bX})}),c=await b.json();b.ok?(bg("Master machine updated successfully"),bS(!1),await ct(),setTimeout(()=>bg(""),3e3)):be(c.error||c.message||"Failed to update master machine")}catch(a){console.error("Error updating master machine:",a),be("Failed to update master machine")}finally{b$(!1)}},cl=a=>{switch(a.toUpperCase()){case"COW":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";case"BUF":return"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200";case"MIX":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200"}},cm=async(a,b,c)=>{try{aM(!0);let d=localStorage.getItem("authToken");if(!d)return;let e=await fetch(`/api/user/ratechart/data?fileName=${encodeURIComponent(a)}&channel=${b}&societyId=${c}`,{headers:{Authorization:`Bearer ${d}`}}),f=await e.json();f.success?aK(f.data||[]):be("string"==typeof f.error?f.error:f.error?.message||"Failed to fetch rate chart data")}catch(a){console.error("Error fetching rate chart data:",a),be("Failed to fetch rate chart data")}finally{aM(!1)}},cn=(a,b,c)=>{aI({fileName:a,channel:b,societyId:c}),aG(!0),cm(a,b,c)},co=()=>{aG(!1),aI(null),aK([]),aO(""),aQ(""),aS("")},cp=a=>{let b={};Object.entries(a).forEach(([a,c])=>{if("string"==typeof c){let d=c.replace(/\D/g,"").slice(0,6);b[a]=d}});let c={...aX,...b};aY(c);let d=Object.keys(a)[0],e={...aZ};if("userPassword"===d)e.userPassword=ch(c.userPassword),e.confirmUserPassword="";else if("confirmUserPassword"===d){let a=ch(c.confirmUserPassword);a?e.confirmUserPassword=a:c.userPassword&&c.confirmUserPassword&&c.userPassword!==c.confirmUserPassword?e.confirmUserPassword="Passwords do not match":e.confirmUserPassword="",e.userPassword=""}else if("supervisorPassword"===d)e.supervisorPassword=ch(c.supervisorPassword),e.confirmSupervisorPassword="";else if("confirmSupervisorPassword"===d){let a=ch(c.confirmSupervisorPassword);a?e.confirmSupervisorPassword=a:c.supervisorPassword&&c.confirmSupervisorPassword&&c.supervisorPassword!==c.confirmSupervisorPassword?e.confirmSupervisorPassword="Passwords do not match":e.confirmSupervisorPassword="",e.supervisorPassword=""}a$(e)},cq=(0,c.useCallback)(async()=>{try{let a=localStorage.getItem("authToken"),b=await fetch("/api/analytics/machine-performance",{headers:{Authorization:`Bearer ${a}`}});if(console.log("ðŸ“Š Performance Stats Response Status:",b.status),b.ok){let a=await b.json();console.log("ðŸ“Š Performance Stats Data:",a),bi(a)}else{let a=await b.json();console.error("âŒ Performance Stats Error:",a)}}catch(a){console.error("âŒ Error fetching performance stats:",a)}},[]),cr=(0,c.useCallback)(async a=>{try{let b=localStorage.getItem("authToken"),c=await fetch(`/api/analytics/machine-performance?graphData=true&metric=${a}`,{headers:{Authorization:`Bearer ${b}`}});if(c.ok){let a=await c.json();bo(a)}}catch(a){console.error("Error fetching graph data:",a),bo([])}},[]),cs=a=>{bm(a),cr(a),bk(!0)},ct=(0,c.useCallback)(async()=>{try{as(!0);let a=localStorage.getItem("authToken");if(!a)return void ae.push("/login");let b=await fetch("/api/user/machine",{headers:{Authorization:`Bearer ${a}`}});if(401===b.status){localStorage.removeItem("authToken"),ae.push("/login");return}let c=await b.json();if(c.success){let a=(c.data||[]).sort((a,b)=>a.isMasterMachine&&!b.isMasterMachine?-1:!a.isMasterMachine&&b.isMasterMachine?1:a.id-b.id);ai(a)}else be("string"==typeof c.error?c.error:c.error?.message||"Failed to fetch machines")}catch(a){console.error("Error fetching machines:",a),be("Failed to fetch machines")}finally{as(!1)}},[ae]),cu=(0,c.useCallback)(async()=>{try{au(!0);let a=localStorage.getItem("authToken");if(!a)return;let b=await fetch("/api/user/society",{headers:{Authorization:`Bearer ${a}`}}),c=await b.json();c.success&&ak(c.data||[])}catch(a){console.error("Error fetching societies:",a)}finally{au(!1)}},[]),cv=(0,c.useCallback)(async()=>{try{aw(!0);let a=localStorage.getItem("authToken");if(!a)return;let b=await fetch("/api/superadmin/machines",{headers:{Authorization:`Bearer ${a}`}}),c=await b.json();c.success&&aq(c.data.machines||[])}catch(a){console.error("Error fetching machine types:",a)}finally{aw(!1)}},[]),cw=(0,c.useCallback)(async()=>{try{let a=localStorage.getItem("authToken");if(!a)return;let b=await fetch("/api/user/dairy",{headers:{Authorization:`Bearer ${a}`}});if(b.ok){let a=await b.json();am(a.data||[])}}catch(a){console.error("Error fetching dairies:",a)}},[]),cx=(0,c.useCallback)(async()=>{try{let a=localStorage.getItem("authToken");if(!a)return;let b=await fetch("/api/user/bmc",{headers:{Authorization:`Bearer ${a}`}});if(b.ok){let a=await b.json();ao(a.data||[])}}catch(a){console.error("Error fetching BMCs:",a)}},[]);(0,c.useEffect)(()=>{ag&&(ct(),cu(),cv(),cw(),cx(),cq())},[ag,ct,cu,cv,cw,cx,cq]),(0,c.useEffect)(()=>{let a=a=>{a2(a.detail.query)};return window.addEventListener("globalSearch",a),()=>window.removeEventListener("globalSearch",a)},[]),(0,c.useEffect)(()=>{if(bf||bd){let a=setTimeout(()=>{bg(""),be("")},5e3);return()=>clearTimeout(a)}},[bf,bd]),(0,c.useEffect)(()=>{if(a9.length>0&&bb.length>0){let a=ah.filter(a=>a9.includes(a.societyId?.toString()||"")).map(a=>a.id?.toString()||""),b=bb.filter(b=>a.includes(b));b.length!==bb.length&&bc(b)}},[a9,bb,ah]),(0,c.useEffect)(()=>{let a=af.get("societyId"),b=af.get("societyName"),c=af.get("dairyFilter");a&&!a9.includes(a)&&(ba([a]),b&&bg(`Filter Applied: ${decodeURIComponent(b)}`)),c&&!a5.includes(c)&&(a6([c]),bg("Filter Applied: Dairy"))},[]);let cy=async a=>{if(a.preventDefault(),!aV.machineId||!aV.machineId.trim()){be("Please enter a machine ID."),bg("");return}if(!aV.machineType||!aV.machineType.trim()){be("Please select a machine type."),bg("");return}if(!aV.societyId){be("Please select a society for the machine."),bg("");return}if(aV.contactPhone&&aV.contactPhone.trim()){let a=(0,g.validateIndianPhone)(aV.contactPhone);if(!a.isValid){bq({...bp,contactPhone:a.error||"Invalid phone number"}),be("Please fix the phone number error before saving."),bg("");return}}bq({}),a0(!0);try{let a=localStorage.getItem("authToken"),b=await fetch("/api/user/machine",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(aV)});if(b.ok)ay(!1),aW(ad),bg("Machine created successfully"),be(""),ct();else{let a=(await b.json()).error||"Failed to create machine";bq({}),a.toLowerCase().includes("machine id")&&a.toLowerCase().includes("already exists")?a.toLowerCase().includes("in this society")?bq({machineId:"This Machine ID already exists in the selected society"}):bq({machineId:"This Machine ID already exists"}):a.toLowerCase().includes("machine type")&&a.toLowerCase().includes("already exists")?bq({machineType:"This Machine type already exists for this society"}):be(a),bg("")}}catch(a){console.error("Error creating machine:",a),be("Error creating machine. Please try again."),bg("")}finally{a0(!1)}},cz=async a=>{if(a.preventDefault(),aT){if(!aV.machineId||!aV.machineId.trim()){be("Please enter a machine ID."),bg("");return}if(!aV.machineType||!aV.machineType.trim()){be("Please select a machine type."),bg("");return}if(!aV.societyId){be("Please select a society for the machine."),bg("");return}if(aV.contactPhone&&aV.contactPhone.trim()){let a=(0,g.validateIndianPhone)(aV.contactPhone);if(!a.isValid){bq({...bp,contactPhone:a.error||"Invalid phone number"}),be("Please fix the phone number error before saving."),bg("");return}}bq({}),a0(!0);try{let a=localStorage.getItem("authToken"),b=await fetch("/api/user/machine",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({id:aT.id,...aV})});if(b.ok)aA(!1),aU(null),aW(ad),bg("Machine updated successfully"),be(""),ct();else{let a=(await b.json()).error||"Failed to update machine";bq({}),a.toLowerCase().includes("machine id")&&a.toLowerCase().includes("already exists")?a.toLowerCase().includes("in this society")?bq({machineId:"This Machine ID already exists in the selected society"}):bq({machineId:"This Machine ID already exists"}):a.toLowerCase().includes("machine type")&&a.toLowerCase().includes("already exists")?bq({machineType:"This Machine type already exists for this society"}):be(a),bg("")}}catch(a){console.error("Error updating machine:",a),be("Error updating machine. Please try again."),bg("")}finally{a0(!1)}}},cA=async()=>{if(aT)try{a0(!0);let a=localStorage.getItem("authToken"),b=await fetch(`/api/user/machine?id=${aT.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}}),c=await b.json();c.success?(bg("Machine deleted successfully!"),await ct(),aC(!1),aU(null)):be("string"==typeof c.error?c.error:c.error?.message||"Failed to delete machine")}catch(a){console.error("Error deleting machine:",a),be("Failed to delete machine")}finally{a0(!1)}},cB=a=>{by(b=>{let c=new Set(b);if(c.has(a)){c.delete(a),bA(!1);let b=cR.find(b=>b.id===a);if(b&&b.societyId){let d=b.societyId;cR.filter(a=>a.societyId===d).every(b=>b.id!==a&&c.has(b.id))||bw(a=>{let b=new Set(a);return b.delete(d),b})}}else{c.add(a);let b=cR.find(b=>b.id===a);if(b&&b.societyId){let d=b.societyId;cR.filter(a=>a.societyId===d).every(b=>b.id===a||c.has(b.id))&&bw(a=>{let b=new Set(a);return b.add(d),b})}Array.from(new Set(cR.map(a=>a.id))).every(b=>b===a||c.has(b))&&bA(!0)}return c})},cC=async()=>{if(0!==bx.size){bG(!1),bI(!0),bE(0);try{let a=localStorage.getItem("authToken");bE(10);let b=Array.from(bx);bE(20);let c=await fetch(`/api/user/machine?ids=${encodeURIComponent(JSON.stringify(b))}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}});if(bE(60),c.ok)bE(80),await ct(),bE(95),by(new Set),bw(new Set),bA(!1),bg(`Successfully deleted ${b.length} machine(s)${"all"!==a3||a5.length>0||a7.length>0||a9.length>0?" from filtered results":""}`),be(""),bE(100);else{let a=await c.json();be(a.message||"Failed to delete selected machines"),bg("")}}catch(a){console.error("Error deleting machines:",a),be("Error deleting selected machines"),bg("")}finally{bI(!1),bE(0)}}},cD=async a=>{if(0===bx.size)return;let b=a||bJ;bC(!0),bE(0);try{let a=localStorage.getItem("authToken");bE(5);let c=Array.from(bx),d=c.length;bE(10),console.log(`ðŸ”„ Bulk updating ${d} machines to status: ${b}`),bE(30);let e=await fetch("/api/user/machine",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({bulkStatusUpdate:!0,machineIds:c,status:b})});if(bE(70),!e.ok){let a=await e.json();throw Error(a.error||"Failed to update machine status")}let f=await e.json(),g=f.data?.updated||d;bE(90),await ct(),bE(100),by(new Set),bw(new Set),bA(!1),console.log(`âœ… Successfully updated ${g} machines`),bg(`Successfully updated status to "${b}" for ${g} machine(s)${"all"!==a3||a5.length>0||a7.length>0||a9.length>0?" from filtered results":""}`),be("")}catch(a){console.error("Error updating machine status:",a),bE(100),be(a instanceof Error?a.message:"Error updating machine status. Please try again."),bg("")}finally{bC(!1)}};(0,c.useEffect)(()=>{let a=ah.filter(a=>{let b="all"===a3||a.status===a3,c=0===a9.length||a9.includes(a.societyId?.toString()||""),d=""===a1||a.machineId.toLowerCase().includes(a1.toLowerCase())||a.machineType.toLowerCase().includes(a1.toLowerCase())||a.societyName?.toLowerCase().includes(a1.toLowerCase())||a.societyIdentifier?.toLowerCase().includes(a1.toLowerCase())||a.location?.toLowerCase().includes(a1.toLowerCase())||a.operatorName?.toLowerCase().includes(a1.toLowerCase())||a.contactPhone?.toLowerCase().includes(a1.toLowerCase())||a.notes?.toLowerCase().includes(a1.toLowerCase());return b&&c&&d});if(bx.size>0){let b=new Set(a.map(a=>a.id)),c=new Set(Array.from(bx).filter(a=>b.has(a)));if(c.size!==bx.size){by(c),bA(!1);let b=new Set(a.map(a=>a.societyId).filter(Boolean)),d=new Set;b.forEach(b=>{let e=a.filter(a=>a.societyId===b);e.every(a=>c.has(a.id))&&e.length>0&&d.add(b)}),bw(d)}}else bA(!1),bw(new Set)},[a3,a9,a1,ah,bx]);let cE=async(a,b)=>{bC(!0),bE(0);try{bE(10);let c=localStorage.getItem("authToken");bE(20);let d={id:a.id,machineId:a.machineId,machineType:a.machineType,societyId:a.societyId,location:a.location,installationDate:a.installationDate,operatorName:a.operatorName,contactPhone:a.contactPhone,status:b,notes:a.notes};bE(30);let e=await fetch("/api/user/machine",{method:"PUT",headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"},body:JSON.stringify(d)});if(bE(60),bE(80),e.ok)bg(`Status updated to ${b}!`),await ct(),bE(100),setTimeout(()=>bg(""),3e3);else{let a=(await e.json()).error||"Failed to update status";bE(100),be(a),setTimeout(()=>be(""),5e3)}}catch(a){console.error("Error updating status:",a),bE(100),be("Failed to update status"),setTimeout(()=>be(""),5e3)}finally{bC(!1)}},cF=(a,c,d,e)=>{let f=d&&""!==d.trim(),g=e&&""!==e.trim(),h=[],i=(0,b.jsx)(p.Lock,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),j="text-red-600 dark:text-red-400";return f&&(1===a?(h.push("User"),j="text-amber-600 dark:text-amber-400"):(h.push("User âœ“"),j="text-green-600 dark:text-green-400"),i=(0,b.jsx)(q.Key,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})),g&&(1===c?(h.push("Supervisor"),j="text-amber-600 dark:text-amber-400"):(h.push("Supervisor âœ“"),j="text-green-600 dark:text-green-400"),i=f?(0,b.jsx)(r,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}):(0,b.jsx)(p.Lock,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})),f&&g&&1===a&&1===c?(j="text-amber-600 dark:text-amber-400",i=(0,b.jsx)(r,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})):f&&g&&0===a&&0===c?(j="text-green-600 dark:text-green-400",i=(0,b.jsx)(r,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})):f&&g&&(1===a||1===c)&&(j="text-amber-600 dark:text-amber-400",i=(0,b.jsx)(r,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})),{icon:i,text:h.length>0?h.join(" | "):"No passwords",className:j}},cG=()=>{let a=new Date().toISOString().split("T")[0];aW({...ad,installationDate:a}),ay(!0),be(""),bg(""),bq({})},cH=a=>{aU(a),aW({machineId:a.machineId,machineType:a.machineType,societyId:a.societyId.toString(),location:a.location||"",installationDate:a.installationDate||"",operatorName:a.operatorName||"",contactPhone:a.contactPhone||"",status:a.status,notes:a.notes||"",setAsMaster:!1,disablePasswordInheritance:!1}),bq({}),be(""),aA(!0)},cI=a=>{aU(a),aC(!0)},cJ=a=>{aU(a),aY({userPassword:"",supervisorPassword:"",confirmUserPassword:"",confirmSupervisorPassword:""}),aE(!0)},cK=()=>{ay(!1),aW(ad),be(""),bg(""),bq({})},cL=()=>{aA(!1),aU(null),aW(ad),be(""),bg(""),bq({})},cM=()=>{aE(!1),aY({userPassword:"",supervisorPassword:"",confirmUserPassword:"",confirmSupervisorPassword:""}),a$({userPassword:"",confirmUserPassword:"",supervisorPassword:"",confirmSupervisorPassword:""}),be(""),bg(""),aU(null),b0(!1),b2(new Set),b4(!1)},cN=a=>{cg(a),b6(!0),b8(""),ca(""),ce(null)},cO=async a=>{if(a.preventDefault(),!cf||!b7)return void ca("Please enter your admin password");cc(!0),ca("");try{let a=localStorage.getItem("authToken");if(!a)return void ae.push("/login");let b=await fetch(`/api/user/machine/${cf.id}/show-password`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({adminPassword:b7})});if(401===b.status){let a=await b.json();"Invalid admin password"===a.error?ca("Invalid admin password. Please try again."):(localStorage.removeItem("authToken"),ae.push("/login"));return}if(!b.ok){let a=await b.json();ca(a.error||"Failed to retrieve passwords");return}let c=await b.json();ce({userPassword:c.data.userPassword,supervisorPassword:c.data.supervisorPassword}),b8("")}catch(a){console.error("Error retrieving passwords:",a),ca("Failed to retrieve passwords. Please try again.")}finally{cc(!1)}},cP=()=>{b6(!1),b8(""),ca(""),ce(null),cg(null)},cQ=async a=>{if(a.preventDefault(),aT){if(be(""),Object.values(aZ).some(a=>""!==a))return void be("Please fix password validation errors before submitting");if(!aX.userPassword&&!aX.supervisorPassword)return void be("At least one password must be provided");if(aX.userPassword&&!aX.confirmUserPassword)return void be("Please confirm the user password");if(aX.userPassword&&aX.confirmUserPassword&&aX.userPassword!==aX.confirmUserPassword)return void be("User passwords do not match");if(aX.supervisorPassword&&!aX.confirmSupervisorPassword)return void be("Please confirm the supervisor password");if(aX.supervisorPassword&&aX.confirmSupervisorPassword&&aX.supervisorPassword!==aX.confirmSupervisorPassword)return void be("Supervisor passwords do not match");if(aX.userPassword){let a=ch(aX.userPassword);if(a)return void be(`User password: ${a}`)}if(aX.supervisorPassword){let a=ch(aX.supervisorPassword);if(a)return void be(`Supervisor password: ${a}`)}if(b_&&0===b1.size)return void be("Please select at least one machine to apply passwords to");a0(!0),be("");try{let a=localStorage.getItem("authToken");if(!a)return void ae.push("/login");let b=await fetch(`/api/user/machine/${aT.id}/password`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({userPassword:aX.userPassword||null,supervisorPassword:aX.supervisorPassword||null})});if(401===b.status){localStorage.removeItem("authToken"),ae.push("/login");return}if(!b.ok){let a=await b.json(),c=a.error||a.message||"Failed to update passwords";be(c),a0(!1);return}if(b_&&b1.size>0){let b=Array.from(b1).map(async b=>(await fetch(`/api/user/machine/${b}/password`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({userPassword:aX.userPassword||null,supervisorPassword:aX.supervisorPassword||null})})).ok);await Promise.all(b),bg(`Passwords updated for master machine and ${b1.size} other machine(s)!`)}else bg("Machine passwords updated successfully!");await ct(),cM(),setTimeout(()=>bg(""),3e3)}catch(a){console.error("Error updating passwords:",a),be("Failed to update passwords. Please try again.")}finally{a0(!1)}}},cR=ah.filter(a=>{let b="all"===a3||a.status===a3,c=aj.find(b=>b.id===a.societyId),d=c?.bmc_id?an.find(a=>a.id===c.bmc_id):null,e=d?.dairyFarmId?al.find(a=>a.id===d.dairyFarmId):null,f=0===a5.length||a5.includes(e?.id.toString()||""),g=0===a7.length||a7.includes(d?.id.toString()||""),h=0===a9.length||a9.includes(a.societyId?.toString()||""),i=0===bb.length||bb.includes(a.id?.toString()||""),j=a1.toLowerCase().trim(),k=""===j||[a.machineId,a.machineType,a.societyName,a.societyIdentifier,a.location,a.operatorName,a.contactPhone,a.notes].some(a=>a?.toString().toLowerCase().includes(j));return b&&f&&g&&h&&i&&k}),cS=(0,c.useMemo)(()=>{let a=new Set(ah.filter(a=>{let b="all"===a3||a.status===a3,c=0===bb.length||bb.includes(a.id?.toString()||""),d=a1.toLowerCase().trim(),e=""===d||[a.machineId,a.machineType,a.societyName,a.societyIdentifier,a.location,a.operatorName,a.contactPhone,a.notes].some(a=>a?.toString().toLowerCase().includes(d));return b&&c&&e}).map(a=>a.societyId).filter(Boolean));return aj.filter(b=>a.has(b.id))},[ah,aj,a1,a3,bb]);return(0,b.jsxs)(b.Fragment,{children:[bB&&(0,b.jsx)("div",{className:"fixed bottom-6 right-6 z-50 bg-white dark:bg-gray-800 rounded-lg shadow-2xl border border-gray-200 dark:border-gray-700 p-4 min-w-[320px] max-w-sm",children:(0,b.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,b.jsx)("div",{className:"flex-shrink-0",children:(0,b.jsx)(N.FlowerSpinner,{size:24})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white mb-1",children:"Updating status..."}),(0,b.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-2",children:"Please wait"}),(0,b.jsx)("div",{className:"relative w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:(0,b.jsx)("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 to-cyan-500 transition-all duration-300 ease-out",style:{width:`${bD}%`}})}),(0,b.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 text-right",children:[bD,"%"]})]})]})}),(0,b.jsxs)("div",{className:"p-3 xs:p-4 sm:p-6 lg:p-8 space-y-3 xs:space-y-4 sm:space-y-6 lg:pb-8",children:[(0,b.jsx)(aa.ManagementPageHeader,{title:"Machine Management",subtitle:"Manage dairy equipment and machinery across societies",icon:(0,b.jsx)(h.Settings,{className:"w-5 h-5 sm:w-6 sm:h-6 text-white"}),onRefresh:ct,onStatistics:()=>ae.push("/admin/machine/statistics"),hasData:cR.length>0}),(0,b.jsx)(U.StatusMessage,{success:bf,error:bd}),(0,b.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-3 sm:gap-4",children:[(0,b.jsxs)("div",{onClick:()=>bh.topCollector&&cs("quantity"),className:`bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 p-4 rounded-lg border border-green-200 dark:border-green-700 ${bh.topCollector?"hover:shadow-lg cursor-pointer":"opacity-60"} transition-shadow`,children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-green-900 dark:text-green-100",children:"Top Collector (30d)"}),(0,b.jsx)(B.Droplets,{className:"w-5 h-5 text-green-600 dark:text-green-400"})]}),bh.topCollector?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{className:"text-lg font-bold text-green-800 dark:text-green-200 truncate",children:bh.topCollector.machine.machineId}),(0,b.jsx)("p",{className:"text-xs text-green-700 dark:text-green-300 truncate",children:bh.topCollector.machine.machineType}),bh.topCollector.machine.societyName&&(0,b.jsx)("p",{className:"text-xs text-green-600 dark:text-green-400 truncate",children:bh.topCollector.machine.societyName}),(0,b.jsxs)("p",{className:"text-sm font-semibold text-green-600 dark:text-green-400 mt-1",children:[bh.topCollector.totalQuantity.toFixed(2)," L"]})]}):(0,b.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"No data available"})]}),(0,b.jsxs)("div",{onClick:()=>bh.mostTests&&cs("tests"),className:`bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 p-4 rounded-lg border border-purple-200 dark:border-purple-700 ${bh.mostTests?"hover:shadow-lg cursor-pointer":"opacity-60"} transition-shadow`,children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-purple-900 dark:text-purple-100",children:"Most Tests (30d)"}),(0,b.jsx)(E.BarChart3,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})]}),bh.mostTests?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{className:"text-lg font-bold text-purple-800 dark:text-purple-200 truncate",children:bh.mostTests.machine.machineId}),(0,b.jsx)("p",{className:"text-xs text-purple-700 dark:text-purple-300 truncate",children:bh.mostTests.machine.machineType}),bh.mostTests.machine.societyName&&(0,b.jsx)("p",{className:"text-xs text-purple-600 dark:text-purple-400 truncate",children:bh.mostTests.machine.societyName}),(0,b.jsxs)("p",{className:"text-sm font-semibold text-purple-600 dark:text-purple-400 mt-1",children:[bh.mostTests.totalTests," Tests"]})]}):(0,b.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"No data available"})]}),(0,b.jsxs)("div",{onClick:()=>bh.bestCleaning&&cs("cleaning"),className:`bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 p-4 rounded-lg border border-orange-200 dark:border-orange-700 ${bh.bestCleaning?"hover:shadow-lg cursor-pointer":"opacity-60"} transition-shadow`,children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-orange-900 dark:text-orange-100",children:"Best Cleaning (30d)"}),(0,b.jsx)(D.Award,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})]}),bh.bestCleaning?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{className:"text-lg font-bold text-orange-800 dark:text-orange-200 truncate",children:bh.bestCleaning.machine.machineId}),(0,b.jsx)("p",{className:"text-xs text-orange-700 dark:text-orange-300 truncate",children:bh.bestCleaning.machine.machineType}),bh.bestCleaning.machine.societyName&&(0,b.jsx)("p",{className:"text-xs text-orange-600 dark:text-orange-400 truncate",children:bh.bestCleaning.machine.societyName}),(0,b.jsxs)("p",{className:"text-sm font-semibold text-orange-600 dark:text-orange-400 mt-1",children:[bh.bestCleaning.totalCleanings," Cleanings"]})]}):(0,b.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"No data available"})]}),(0,b.jsxs)("div",{onClick:()=>bh.mostCleaningSkip&&cs("skip"),className:`bg-gradient-to-br from-red-50 to-red-100 dark:from-red-900/20 dark:to-red-800/20 p-4 rounded-lg border border-red-200 dark:border-red-700 ${bh.mostCleaningSkip?"hover:shadow-lg cursor-pointer":"opacity-60"} transition-shadow`,children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-red-900 dark:text-red-100",children:"Most Cleaning Skip (30d)"}),(0,b.jsx)(o.AlertTriangle,{className:"w-5 h-5 text-red-600 dark:text-red-400"})]}),bh.mostCleaningSkip?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{className:"text-lg font-bold text-red-800 dark:text-red-200 truncate",children:bh.mostCleaningSkip.machine.machineId}),(0,b.jsx)("p",{className:"text-xs text-red-700 dark:text-red-300 truncate",children:bh.mostCleaningSkip.machine.machineType}),bh.mostCleaningSkip.machine.societyName&&(0,b.jsx)("p",{className:"text-xs text-red-600 dark:text-red-400 truncate",children:bh.mostCleaningSkip.machine.societyName}),(0,b.jsxs)("p",{className:"text-sm font-semibold text-red-600 dark:text-red-400 mt-1",children:[bh.mostCleaningSkip.totalSkips," Skips"]})]}):(0,b.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"No data available"})]}),(0,b.jsxs)("div",{onClick:()=>bh.activeToday&&cs("today"),className:`bg-gradient-to-br from-pink-50 to-pink-100 dark:from-pink-900/20 dark:to-pink-800/20 p-4 rounded-lg border border-pink-200 dark:border-pink-700 ${bh.activeToday?"hover:shadow-lg cursor-pointer":"opacity-60"} transition-shadow`,children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-pink-900 dark:text-pink-100",children:"Active Today"}),(0,b.jsx)(x.Clock,{className:"w-5 h-5 text-pink-600 dark:text-pink-400"})]}),bh.activeToday?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{className:"text-lg font-bold text-pink-800 dark:text-pink-200 truncate",children:bh.activeToday.machine.machineId}),(0,b.jsx)("p",{className:"text-xs text-pink-700 dark:text-pink-300 truncate",children:bh.activeToday.machine.machineType}),bh.activeToday.machine.societyName&&(0,b.jsx)("p",{className:"text-xs text-pink-600 dark:text-pink-400 truncate",children:bh.activeToday.machine.societyName}),(0,b.jsxs)("p",{className:"text-sm font-semibold text-pink-600 dark:text-pink-400 mt-1",children:[bh.activeToday.collectionsToday," Today"]})]}):(0,b.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"No data available"})]}),(0,b.jsxs)("div",{onClick:()=>bh.highestUptime&&cs("uptime"),className:`bg-gradient-to-br from-indigo-50 to-indigo-100 dark:from-indigo-900/20 dark:to-indigo-800/20 p-4 rounded-lg border border-indigo-200 dark:border-indigo-700 ${bh.highestUptime?"hover:shadow-lg cursor-pointer":"opacity-60"} transition-shadow`,children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-indigo-900 dark:text-indigo-100",children:"Highest Uptime (30d)"}),(0,b.jsx)(C.TrendingUp,{className:"w-5 h-5 text-indigo-600 dark:text-indigo-400"})]}),bh.highestUptime?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{className:"text-lg font-bold text-indigo-800 dark:text-indigo-200 truncate",children:bh.highestUptime.machine.machineId}),(0,b.jsx)("p",{className:"text-xs text-indigo-700 dark:text-indigo-300 truncate",children:bh.highestUptime.machine.machineType}),bh.highestUptime.machine.societyName&&(0,b.jsx)("p",{className:"text-xs text-indigo-600 dark:text-indigo-400 truncate",children:bh.highestUptime.machine.societyName}),(0,b.jsxs)("p",{className:"text-sm font-semibold text-indigo-600 dark:text-indigo-400 mt-1",children:[bh.highestUptime.activeDays," Days"]})]}):(0,b.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"No data available"})]})]}),(0,b.jsx)(ac.StatsGrid,{allItems:ah,filteredItems:cR,hasFilters:"all"!==a3||a5.length>0||a7.length>0||a9.length>0||bb.length>0,onStatusFilterChange:a=>a4(a),currentStatusFilter:a3}),(0,b.jsx)(ab.FilterDropdown,{statusFilter:a3,onStatusChange:a=>a4(a),dairyFilter:a5,onDairyChange:a=>a6(Array.isArray(a)?a:[a]),bmcFilter:a7,onBmcChange:a=>a8(Array.isArray(a)?a:[a]),societyFilter:a9,onSocietyChange:a=>ba(Array.isArray(a)?a:[a]),machineFilter:bb,onMachineChange:a=>bc(Array.isArray(a)?a:[a]),dairies:al,bmcs:an,societies:cS,machines:ah,filteredCount:cR.length,totalCount:ah.length,searchQuery:a1,onSearchChange:a2,icon:(0,b.jsx)(h.Settings,{className:"w-5 h-5"}),hideMainFilterButton:!0}),cR.length>0&&(0,b.jsxs)("div",{className:"flex flex-col xs:flex-row items-start xs:items-center justify-between gap-3 bg-white dark:bg-gray-800 p-3 sm:p-4 rounded-lg border border-gray-200 dark:border-gray-700",children:[(0,b.jsxs)("label",{className:"flex items-center space-x-3 cursor-pointer",children:[(0,b.jsx)("input",{type:"checkbox",checked:bz,onChange:()=>{bz?(by(new Set),bw(new Set),bA(!1)):(by(new Set(cR.map(a=>a.id))),bw(new Set(cR.reduce((a,b)=>{let c=b.societyId||0;return a.includes(c)||a.push(c),a},[]))),bA(!0))},className:"w-4 h-4 text-green-600 bg-gray-100 border-gray-300 rounded focus:ring-green-500 dark:focus:ring-green-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"}),(0,b.jsxs)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Select All ",cR.length," ",1===cR.length?"machine":"machines",("all"!==a3||a5.length>0||a7.length>0||a9.length>0||bb.length>0)&&" (filtered)"]})]}),(0,b.jsx)("div",{className:"flex items-center gap-3",children:(0,b.jsx)(_.ViewModeToggle,{viewMode:bt,onViewModeChange:bu,folderLabel:"Folder View",listLabel:"Grid View"})})]}),ar?(0,b.jsx)("div",{className:"flex items-center justify-center py-12 sm:py-20",children:(0,b.jsx)(N.FlowerSpinner,{size:40})}):cR.length>0?"folder"===bt?(0,b.jsx)("div",{className:"space-y-4",children:Object.values(cR.reduce((a,b)=>{let c=b.societyId||0,d=b.societyName||"Unassigned",e=b.societyIdentifier||"N/A";return a[c]||(a[c]={id:c,name:d,identifier:e,machines:[]}),a[c].machines.push(b),a},{})).sort((a,b)=>a.name.localeCompare(b.name)).map(a=>{let c=br.has(a.id),d=a.machines.length,e=a.machines.filter(a=>"active"===a.status).length,f=a.machines.filter(a=>"inactive"===a.status).length,g=a.machines.filter(a=>"maintenance"===a.status).length,h=bv.has(a.id),m=a.machines.map(a=>a.id);return(0,b.jsxs)("div",{className:`relative bg-white dark:bg-gray-800 rounded-lg border-2 transition-colors hover:z-10 ${h?"border-blue-500 dark:border-blue-400":"border-gray-200 dark:border-gray-700"}`,children:[(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)("div",{onClick:b=>{var c;b.stopPropagation(),c=a.id,bw(a=>{let b=new Set(a);return b.has(c)?(b.delete(c),by(a=>{let b=new Set(a);return m.forEach(a=>b.delete(a)),bA(!1),b})):(b.add(c),by(a=>{let b=new Set(a);return m.forEach(a=>b.add(a)),Array.from(new Set(cR.map(a=>a.id))).every(a=>b.has(a))&&bA(!0),b})),b})},className:"flex items-center justify-center p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors cursor-pointer",children:(0,b.jsx)("input",{type:"checkbox",checked:h,onChange:()=>{},className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600 cursor-pointer"})}),(0,b.jsxs)("button",{onClick:()=>{var b;return b=a.id,void bs(a=>{let c=new Set(a);return c.has(b)?c.delete(b):c.add(b),c})},className:"flex-1 flex items-center justify-between p-4 pl-0 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[c?(0,b.jsx)(v.ChevronDown,{className:"w-5 h-5 text-gray-500 dark:text-gray-400"}):(0,b.jsx)(u.ChevronRight,{className:"w-5 h-5 text-gray-500 dark:text-gray-400"}),c?(0,b.jsx)(t.FolderOpen,{className:"w-5 h-5 text-green-600 dark:text-green-400"}):(0,b.jsx)(s.Folder,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),(0,b.jsxs)("div",{className:"text-left",children:[(0,b.jsx)("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white",children:a.name}),(0,b.jsxs)("p",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400",children:["ID: ",a.identifier]})]})]}),(0,b.jsx)("div",{className:"flex items-center space-x-4",children:(0,b.jsx)("div",{className:"flex items-center space-x-2",children:(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2 text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:[(0,b.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,b.jsx)("div",{className:"w-2 h-2 rounded-full bg-green-500"}),(0,b.jsx)("span",{children:e})]}),(0,b.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,b.jsx)("div",{className:"w-2 h-2 rounded-full bg-red-500"}),(0,b.jsx)("span",{children:f})]}),g>0&&(0,b.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,b.jsx)("div",{className:"w-2 h-2 rounded-full bg-blue-500"}),(0,b.jsx)("span",{children:g})]})]}),(0,b.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[d," ",1===d?"machine":"machines"]})]})})})]})]}),c&&(0,b.jsx)("div",{className:"border-t border-gray-200 dark:border-gray-700 p-4 bg-gray-50 dark:bg-gray-900/30",children:(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:a.machines.map(c=>{let d,e;return(0,b.jsx)("div",{className:"relative hover:z-20",children:(0,b.jsx)(V.ItemCard,{id:c.id,name:c.machineId,identifier:c.machineType,status:c.status,icon:(0,b.jsx)(n.Wrench,{className:"w-4 h-4 sm:w-5 sm:h-5 text-green-600 dark:text-green-400"}),showStatus:!0,badge:c.isMasterMachine?{text:"Master",color:"bg-gradient-to-r from-yellow-400 to-amber-500 text-gray-900 border-yellow-600",onClick:()=>cj(a.id)}:void 0,selectable:!0,selected:bx.has(c.id),onSelect:()=>cB(c.id),onPasswordSettings:()=>cJ(c),searchQuery:a1,details:[...c.location?[{icon:(0,b.jsx)(i.MapPin,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),text:c.location}]:[],...c.operatorName?[{icon:(0,b.jsx)(k.User,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),text:c.operatorName}]:[],...c.contactPhone?[{icon:(0,b.jsx)(j.Phone,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),text:c.contactPhone}]:[],...c.installationDate?[{icon:(0,b.jsx)(l.Calendar,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),text:`Installed: ${new Date(c.installationDate).toLocaleDateString()}`}]:[],{icon:(0,b.jsx)("div",{className:"flex items-center gap-1",children:(0,b.jsx)("div",{className:"w-2 h-2 rounded-full bg-blue-500"})}),text:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("span",{className:"text-xs font-medium text-blue-600 dark:text-blue-400",children:[c.totalCollections30d||0," Collections"]}),(0,b.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"|"}),(0,b.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:[(c.totalQuantity30d||0).toFixed(2)," L"]})]}),className:"text-blue-600 dark:text-blue-400"},...(()=>{let{pending:a,downloaded:d}=ci(c.chartDetails),e=[];return a.length>0&&e.push({icon:(0,b.jsx)("div",{className:"flex items-center gap-1",children:(0,b.jsx)("div",{className:"w-2 h-2 rounded-full bg-amber-500 dark:bg-amber-400 animate-pulse"})}),text:(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5",children:[(0,b.jsx)("span",{className:"text-xs font-medium text-amber-600 dark:text-amber-400",children:"Ready:"}),a.map((a,d)=>(0,b.jsx)("button",{onClick:()=>cn(a.fileName,a.channel,c.societyId),className:`px-1.5 py-0.5 rounded text-xs font-medium ${cl(a.channel)} hover:opacity-80 transition-opacity cursor-pointer`,children:a.channel},d))]}),className:"text-amber-600 dark:text-amber-400"}),d.length>0&&e.push({icon:(0,b.jsx)(A.CheckCircle,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),text:(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5",children:[(0,b.jsx)("span",{className:"text-xs font-medium",children:"Downloaded:"}),d.map((a,d)=>(0,b.jsx)("button",{onClick:()=>cn(a.fileName,a.channel,c.societyId),className:`px-1.5 py-0.5 rounded text-xs font-medium ${cl(a.channel)} hover:opacity-80 transition-opacity cursor-pointer`,children:a.channel},d))]}),className:"text-green-600 dark:text-green-400"}),e})(),(d=cF(c.statusU,c.statusS,c.userPassword,c.supervisorPassword),e=c.userPassword&&""!==c.userPassword.trim()||c.supervisorPassword&&""!==c.supervisorPassword.trim(),{icon:d.icon,text:e?(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{children:d.text}),(0,b.jsxs)("button",{onClick:a=>{a.stopPropagation(),cN(c)},className:"inline-flex items-center gap-1 px-2 py-0.5 text-xs font-medium bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-colors",children:[(0,b.jsx)(z.Eye,{className:"w-3 h-3"}),"Show"]})]}):d.text,className:d.className})],onEdit:()=>cH(c),onDelete:()=>cI(c),onView:()=>ae.push(`/admin/machine/${c.id}`),onStatusChange:a=>cE(c,a),viewText:"View"})},c.id)})})})]},a.id)})}):(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-6",children:cR.map(a=>{let c,d;return(0,b.jsx)(V.ItemCard,{id:a.id,name:a.machineId,identifier:a.machineType,status:a.status,icon:(0,b.jsx)(n.Wrench,{className:"w-4 h-4 sm:w-5 sm:h-5 text-green-600 dark:text-green-400"}),showStatus:!0,badge:a.isMasterMachine?{text:"Master",color:"bg-gradient-to-r from-yellow-400 to-amber-500 text-gray-900 border-yellow-600",onClick:()=>cj(a.societyId)}:void 0,selectable:!0,selected:bx.has(a.id),onSelect:()=>cB(a.id),onPasswordSettings:()=>cJ(a),searchQuery:a1,details:[...a.societyName?[{icon:(0,b.jsx)(m.Building2,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),text:a.societyIdentifier?`${a.societyName} (${a.societyIdentifier})`:a.societyName,highlight:!0}]:[],...a.location?[{icon:(0,b.jsx)(i.MapPin,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),text:a.location}]:[],...a.operatorName?[{icon:(0,b.jsx)(k.User,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),text:a.operatorName}]:[],...a.contactPhone?[{icon:(0,b.jsx)(j.Phone,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),text:a.contactPhone}]:[],...a.installationDate?[{icon:(0,b.jsx)(l.Calendar,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),text:`Installed: ${new Date(a.installationDate).toLocaleDateString()}`}]:[],{icon:(0,b.jsx)("div",{className:"flex items-center gap-1",children:(0,b.jsx)("div",{className:"w-2 h-2 rounded-full bg-blue-500"})}),text:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("span",{className:"text-xs font-medium text-blue-600 dark:text-blue-400",children:[a.totalCollections30d||0," Collections"]}),(0,b.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"|"}),(0,b.jsxs)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:[(a.totalQuantity30d||0).toFixed(2)," L"]})]}),className:"text-blue-600 dark:text-blue-400"},...(()=>{let{pending:c,downloaded:d}=ci(a.chartDetails),e=[];return c.length>0&&e.push({icon:(0,b.jsx)("div",{className:"flex items-center gap-1",children:(0,b.jsx)("div",{className:"w-2 h-2 rounded-full bg-amber-500 dark:bg-amber-400 animate-pulse"})}),text:(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5",children:[(0,b.jsx)("span",{className:"text-xs font-medium text-amber-600 dark:text-amber-400",children:"Ready:"}),c.map((c,d)=>(0,b.jsx)("button",{onClick:()=>cn(c.fileName,c.channel,a.societyId),className:`px-1.5 py-0.5 rounded text-xs font-medium ${cl(c.channel)} hover:opacity-80 transition-opacity cursor-pointer`,children:c.channel},d))]}),className:"text-amber-600 dark:text-amber-400"}),d.length>0&&e.push({icon:(0,b.jsx)(A.CheckCircle,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),text:(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5",children:[(0,b.jsx)("span",{className:"text-xs font-medium",children:"Downloaded:"}),d.map((c,d)=>(0,b.jsx)("button",{onClick:()=>cn(c.fileName,c.channel,a.societyId),className:`px-1.5 py-0.5 rounded text-xs font-medium ${cl(c.channel)} hover:opacity-80 transition-opacity cursor-pointer`,children:c.channel},d))]}),className:"text-green-600 dark:text-green-400"}),e})(),(c=cF(a.statusU,a.statusS,a.userPassword,a.supervisorPassword),d=a.userPassword&&""!==a.userPassword.trim()||a.supervisorPassword&&""!==a.supervisorPassword.trim(),{icon:c.icon,text:d?(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{children:c.text}),(0,b.jsxs)("button",{onClick:b=>{b.stopPropagation(),cN(a)},className:"inline-flex items-center gap-1 px-2 py-0.5 text-xs font-medium bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-colors",children:[(0,b.jsx)(z.Eye,{className:"w-3 h-3"}),"Show"]})]}):c.text,className:c.className})],onEdit:()=>cH(a),onDelete:()=>cI(a),onView:()=>ae.push(`/admin/machine/${a.id}`),onStatusChange:b=>cE(a,b),viewText:"View"},a.id)})}):(0,b.jsx)(W.EmptyState,{icon:(0,b.jsx)(h.Settings,{className:"w-12 h-12 sm:w-16 sm:h-16 text-gray-400"}),title:"No machines found",message:"all"===a3?"You haven't added any machines yet. Click 'Add Machine' to get started.":`No machines found with status: ${a3}`,actionText:"all"===a3?"Add Your First Machine":void 0,onAction:"all"===a3?cG:void 0,showAction:"all"===a3})]}),(0,b.jsx)(O.FormModal,{isOpen:ax,onClose:cK,title:"Add New Machine",maxWidth:"lg",children:(0,b.jsxs)("form",{onSubmit:cy,className:"space-y-4 sm:space-y-6",children:[(0,b.jsxs)(S.FormGrid,{children:[(0,b.jsx)(P.FormInput,{label:"Machine ID",value:aV.machineId,onChange:a=>{let b=a.replace(/[^a-zA-Z0-9]/g,"").replace(/^([a-zA-Z])[a-zA-Z]+/,"$1").replace(/^([a-zA-Z])(\d*).*/,"$1$2").toUpperCase().slice(0,10);aW({...aV,machineId:b})},placeholder:"e.g., M2232, S3232",required:!0,error:bp.machineId,colSpan:2}),(0,b.jsx)(Q.FormSelect,{label:"Machine Type",value:aV.machineType,onChange:a=>aW({...aV,machineType:a}),options:ap.map(a=>({value:a.machineType,label:a.machineType})),placeholder:"Select Machine Type",required:!0,disabled:av,error:bp.machineType}),(0,b.jsx)(Q.FormSelect,{label:"Society",value:aV.societyId,onChange:a=>{console.log("Society selected:",a,"Type:",typeof a),aW({...aV,societyId:a}),(a=>{if(console.log("checkMasterMachineStatus called with:",a),!a){bM(!1),bO(null),bQ(!1);return}let b=ah.filter(b=>b.societyId===parseInt(a)),c=b.find(a=>a.isMasterMachine);console.log("Society machines:",b.length,"Master:",c?.machineId),bQ(0===b.length),bM(!!c),bO(c?c.machineId:null),0===b.length?aW(a=>({...a,setAsMaster:!0})):aW(a=>({...a,setAsMaster:!1}))})(a)},options:aj.map(a=>({value:a.id,label:`${a.name} (${a.society_id})`})),placeholder:"Select Society",required:!0,disabled:at,error:bp.societyId}),(0,b.jsx)(P.FormInput,{label:"Location",value:aV.location,onChange:a=>aW({...aV,location:a}),placeholder:"Installation location"}),(0,b.jsx)(P.FormInput,{label:"Installation Date",type:"date",value:aV.installationDate,onChange:a=>aW({...aV,installationDate:a})}),(0,b.jsx)(P.FormInput,{label:"Operator Name",value:aV.operatorName,onChange:a=>aW({...aV,operatorName:a}),placeholder:"Machine operator name"}),(0,b.jsx)(P.FormInput,{label:"Contact Phone",type:"tel",value:aV.contactPhone,onChange:a=>{let b=(0,g.formatPhoneInput)(a);aW({...aV,contactPhone:b})},onBlur:()=>{let a=(0,g.validatePhoneOnBlur)(aV.contactPhone);if(a)bq(b=>({...b,contactPhone:a}));else{let{contactPhone:a,...b}=bp;bq(b)}},placeholder:"Operator contact number",error:bp.contactPhone}),(0,b.jsx)(Q.FormSelect,{label:"Status",value:aV.status,onChange:a=>aW({...aV,status:a}),options:[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"maintenance",label:"Under Maintenance"},{value:"suspended",label:"Suspended"}]}),(0,b.jsx)(P.FormInput,{label:"Notes",type:"text",value:aV.notes,onChange:a=>aW({...aV,notes:a}),placeholder:"Additional notes or comments...",colSpan:2}),""!==aV.societyId&&(0,b.jsx)("div",{className:"sm:col-span-2",children:(0,b.jsx)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("input",{type:"checkbox",id:"setAsMaster",checked:aV.setAsMaster,onChange:a=>aW({...aV,setAsMaster:a.target.checked}),disabled:bP,className:"mt-1 w-4 h-4 text-yellow-600 border-gray-300 rounded focus:ring-yellow-500 disabled:opacity-50"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("label",{htmlFor:"setAsMaster",className:"text-sm font-medium text-gray-900 dark:text-gray-100 cursor-pointer",children:"Set as Master Machine"}),bP?(0,b.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:"This is the first machine for this society and will automatically be set as master"}):bL&&aV.setAsMaster?(0,b.jsxs)("p",{className:"text-xs text-yellow-700 dark:text-yellow-400 mt-1 font-medium",children:["âš ï¸ Warning: This will replace the current master machine (",bN,") with this one"]}):(0,b.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:"Master machine passwords will be inherited by all machines in this society"})]})]})})}),""!==aV.societyId&&!aV.setAsMaster&&bL&&!bP&&(0,b.jsx)("div",{className:"sm:col-span-2",children:(0,b.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"flex-shrink-0",children:(0,b.jsx)("svg",{className:"w-5 h-5 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold text-blue-900 dark:text-blue-100 mb-1",children:"Password Inheritance Enabled"}),(0,b.jsxs)("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:["This machine will automatically inherit user and supervisor passwords from the master machine (",(0,b.jsx)("strong",{children:bN}),"). The passwords will be set when the machine is created, and you can update them later if needed."]}),(0,b.jsxs)("div",{className:"mt-2 text-xs text-blue-600 dark:text-blue-400",children:[(0,b.jsx)("strong",{children:"Note:"})," Password status (enabled/disabled) will also be inherited from the master machine."]})]})]})})}),""!==aV.societyId&&!aV.setAsMaster&&bL&&!bP&&(0,b.jsx)("div",{className:"sm:col-span-2",children:(0,b.jsxs)("div",{className:"flex items-start gap-3 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[(0,b.jsx)("input",{type:"checkbox",id:"disablePasswordInheritance",checked:aV.disablePasswordInheritance,onChange:a=>aW({...aV,disablePasswordInheritance:a.target.checked}),className:"mt-1 w-4 h-4 text-primary-600 bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded focus:ring-primary-500 focus:ring-2"}),(0,b.jsxs)("label",{htmlFor:"disablePasswordInheritance",className:"flex-1 cursor-pointer",children:[(0,b.jsx)("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-1",children:"Do not inherit passwords from master machine"}),(0,b.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Check this if you want to set passwords manually later instead of using the master machine's passwords"})]})]})}),""!==aV.societyId&&!aV.setAsMaster&&!bL&&!bP&&(0,b.jsx)("div",{className:"sm:col-span-2",children:(0,b.jsx)("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-300 dark:border-amber-700 rounded-lg p-4",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"flex-shrink-0",children:(0,b.jsx)("svg",{className:"w-5 h-5 text-amber-600 dark:text-amber-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold text-amber-900 dark:text-amber-100 mb-1",children:"No Master Machine Found"}),(0,b.jsx)("p",{className:"text-xs text-amber-700 dark:text-amber-300",children:"This society has machines but no master machine is designated. Passwords will not be inherited automatically. Consider setting this machine as master or designate an existing machine as master first."})]})]})})})]}),(0,b.jsx)(T.FormError,{error:bd}),(0,b.jsx)(R.FormActions,{onCancel:cK,submitText:"Add Machine",isLoading:a_,isSubmitDisabled:!aV.machineId||!aV.machineType||!aV.societyId})]})}),(0,b.jsx)(O.FormModal,{isOpen:az&&!!aT,onClose:cL,title:"Edit Machine",maxWidth:"lg",children:(0,b.jsxs)("form",{onSubmit:cz,className:"space-y-4 sm:space-y-6",children:[(0,b.jsxs)(S.FormGrid,{children:[(0,b.jsx)(P.FormInput,{label:"Machine ID",value:aV.machineId,onChange:a=>aW({...aV,machineId:a}),placeholder:"e.g., M2232, S3232",required:!0,error:bp.machineId,colSpan:2}),(0,b.jsx)(Q.FormSelect,{label:"Machine Type",value:aV.machineType,onChange:a=>aW({...aV,machineType:a}),options:ap.map(a=>({value:a.machineType,label:a.machineType})),placeholder:"Select Machine Type",required:!0,disabled:av,error:bp.machineType}),(0,b.jsx)(Q.FormSelect,{label:"Society",value:aV.societyId,onChange:a=>aW({...aV,societyId:a}),options:aj.map(a=>({value:a.id,label:`${a.name} (${a.society_id})`})),placeholder:"Select Society",required:!0,disabled:at,error:bp.societyId}),(0,b.jsx)(P.FormInput,{label:"Location",value:aV.location,onChange:a=>aW({...aV,location:a}),placeholder:"Installation location"}),(0,b.jsx)(P.FormInput,{label:"Installation Date",type:"date",value:aV.installationDate,onChange:a=>aW({...aV,installationDate:a})}),(0,b.jsx)(P.FormInput,{label:"Operator Name",value:aV.operatorName,onChange:a=>aW({...aV,operatorName:a}),placeholder:"Machine operator name"}),(0,b.jsx)(P.FormInput,{label:"Contact Phone",type:"tel",value:aV.contactPhone,onChange:a=>{let b=(0,g.formatPhoneInput)(a);aW({...aV,contactPhone:b})},onBlur:()=>{let a=(0,g.validatePhoneOnBlur)(aV.contactPhone);if(a)bq(b=>({...b,contactPhone:a}));else{let{contactPhone:a,...b}=bp;bq(b)}},placeholder:"Operator contact number",error:bp.contactPhone}),(0,b.jsx)(Q.FormSelect,{label:"Status",value:aV.status,onChange:a=>aW({...aV,status:a}),options:[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"maintenance",label:"Under Maintenance"},{value:"suspended",label:"Suspended"}]}),(0,b.jsx)(P.FormInput,{label:"Notes",type:"text",value:aV.notes,onChange:a=>aW({...aV,notes:a}),placeholder:"Additional notes or comments...",colSpan:2})]}),(0,b.jsx)(T.FormError,{error:bd}),(0,b.jsx)(R.FormActions,{onCancel:cL,submitText:"Update Machine",isLoading:a_,isSubmitDisabled:!aV.machineId||!aV.machineType||!aV.societyId})]})}),(0,b.jsx)(O.FormModal,{isOpen:aD&&!!aT,onClose:cM,title:`Password Settings - ${aT?.machineId||""}`,children:(0,b.jsxs)("form",{onSubmit:cQ,className:"space-y-4 sm:space-y-6",children:[(0,b.jsxs)(S.FormGrid,{children:[(0,b.jsx)(P.FormInput,{label:"User Password (6 digits)",type:"password",value:aX.userPassword,onChange:a=>cp({userPassword:a}),placeholder:"Enter 6-digit code",maxLength:6,pattern:"[0-9]*",inputMode:"numeric",error:aZ.userPassword,colSpan:2}),(0,b.jsx)(P.FormInput,{label:"Confirm User Password",type:"password",value:aX.confirmUserPassword,onChange:a=>cp({confirmUserPassword:a}),placeholder:"Re-enter 6-digit code",maxLength:6,pattern:"[0-9]*",inputMode:"numeric",error:aZ.confirmUserPassword,colSpan:2}),(0,b.jsx)(P.FormInput,{label:"Supervisor Password (6 digits)",type:"password",value:aX.supervisorPassword,onChange:a=>cp({supervisorPassword:a}),placeholder:"Enter 6-digit code",maxLength:6,pattern:"[0-9]*",inputMode:"numeric",error:aZ.supervisorPassword,colSpan:2}),(0,b.jsx)(P.FormInput,{label:"Confirm Supervisor Password",type:"password",value:aX.confirmSupervisorPassword,onChange:a=>cp({confirmSupervisorPassword:a}),placeholder:"Re-enter 6-digit code",maxLength:6,pattern:"[0-9]*",inputMode:"numeric",error:aZ.confirmSupervisorPassword,colSpan:2})]}),aT?.isMasterMachine&&(0,b.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[(0,b.jsxs)("div",{className:"flex items-start gap-3 mb-4",children:[(0,b.jsx)("input",{type:"checkbox",id:"applyPasswordsToOthers",checked:b_,onChange:a=>{b0(a.target.checked),a.target.checked||(b2(new Set),b4(!1))},className:"mt-1 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("label",{htmlFor:"applyPasswordsToOthers",className:"text-sm font-medium text-gray-900 dark:text-gray-100 cursor-pointer",children:"Apply these passwords to other machines in this society"}),(0,b.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:"Select machines below to update their passwords with the same values"})]})]}),b_&&aT&&(0,b.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 max-h-64 overflow-y-auto",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsxs)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Select Machines (",b1.size," selected)"]}),(0,b.jsx)("button",{type:"button",onClick:()=>{let a=ah.filter(a=>a.societyId===aT.societyId&&a.id!==aT.id);b3?(b2(new Set),b4(!1)):(b2(new Set(a.map(a=>a.id))),b4(!0))},className:"text-xs text-blue-600 dark:text-blue-400 hover:underline",children:b3?"Deselect All":"Select All"})]}),(0,b.jsx)("div",{className:"space-y-2",children:ah.filter(a=>a.societyId===aT.societyId&&a.id!==aT.id).map(a=>(0,b.jsxs)("label",{className:"flex items-center gap-3 p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer",children:[(0,b.jsx)("input",{type:"checkbox",checked:b1.has(a.id),onChange:b=>{let c=new Set(b1);b.target.checked?c.add(a.id):(c.delete(a.id),b4(!1)),b2(c)},className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:a.machineId}),(0,b.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:a.machineType})]})]},a.id))}),0===ah.filter(a=>a.societyId===aT.societyId&&a.id!==aT.id).length&&(0,b.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-4",children:"No other machines in this society"})]})]}),(0,b.jsx)(T.FormError,{error:bd}),(0,b.jsx)(R.FormActions,{onCancel:cM,submitText:"Update Passwords",isLoading:a_,isSubmitDisabled:a_||Object.values(aZ).some(a=>""!==a)||!aX.userPassword&&!aX.supervisorPassword||!!(aX.userPassword&&!aX.confirmUserPassword)||!!(aX.supervisorPassword&&!aX.confirmSupervisorPassword)||!!(!aX.userPassword&&aX.confirmUserPassword)||!!(!aX.supervisorPassword&&aX.confirmSupervisorPassword)})]})}),(0,b.jsx)(X.ConfirmDeleteModal,{isOpen:aB&&!!aT,onClose:()=>{aC(!1),aU(null)},onConfirm:cA,title:"Delete Machine",itemName:aT?.machineId||"",message:"Are you sure you want to permanently delete machine"}),(0,b.jsx)(O.FormModal,{isOpen:aF&&!!aH,onClose:co,title:`Rate Chart - ${aH?.channel||""} Channel`,maxWidth:"2xl",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"File Name"}),(0,b.jsx)("p",{className:"text-base font-semibold text-gray-900 dark:text-white",children:aH?.fileName})]}),(0,b.jsx)("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${cl(aH?.channel||"")}`,children:aH?.channel})]})}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-3 mb-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Search FAT"}),(0,b.jsx)("input",{type:"text",value:aN,onChange:a=>aO(a.target.value),placeholder:"e.g., 3.5",className:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Search SNF"}),(0,b.jsx)("input",{type:"text",value:aP,onChange:a=>aQ(a.target.value),placeholder:"e.g., 8.5",className:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Search CLR"}),(0,b.jsx)("input",{type:"text",value:aR,onChange:a=>aS(a.target.value),placeholder:"e.g., 25.0",className:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]})]}),aL?(0,b.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,b.jsx)(N.FlowerSpinner,{})}):(a=aJ.filter(a=>{let b=!aN||a.fat.toLowerCase().includes(aN.toLowerCase()),c=!aP||a.snf.toLowerCase().includes(aP.toLowerCase()),d=!aR||a.clr.toLowerCase().includes(aR.toLowerCase());return b&&c&&d})).length>0?(0,b.jsxs)("div",{className:"overflow-x-auto",children:[(0,b.jsxs)("table",{className:"w-full border-collapse",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"bg-gray-100 dark:bg-gray-700",children:[(0,b.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider border border-gray-300 dark:border-gray-600",children:"FAT"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider border border-gray-300 dark:border-gray-600",children:"SNF"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider border border-gray-300 dark:border-gray-600",children:"CLR"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider border border-gray-300 dark:border-gray-600",children:"Rate"})]})}),(0,b.jsx)("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:a.map((a,c)=>(0,b.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600",children:a.fat}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600",children:a.snf}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600",children:a.clr}),(0,b.jsxs)("td",{className:"px-4 py-3 text-sm font-semibold text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600",children:["â‚¹",a.rate]})]},c))})]}),(0,b.jsxs)("div",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400 text-right",children:["Showing ",a.length," of ",aJ.length," records"]})]}):(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)(w.FileText,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),(0,b.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:aN||aP||aR?"No matching records found":"No data available for this rate chart"})]}),(0,b.jsx)("div",{className:"flex justify-end pt-4",children:(0,b.jsx)("button",{onClick:co,className:"px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:"Close"})})]})}),(0,b.jsx)(O.FormModal,{isOpen:bR,onClose:()=>bS(!1),title:"Change Master Machine",maxWidth:"md",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"flex-shrink-0",children:(0,b.jsx)("svg",{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold text-yellow-900 dark:text-yellow-100 mb-1",children:"About Master Machine"}),(0,b.jsx)("p",{className:"text-xs text-yellow-700 dark:text-yellow-300",children:"The master machine's passwords are inherited by all other machines in the society. Changing the master will update which machine's passwords are used as the default for new machines."})]})]})}),bT&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Select New Master Machine ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsxs)("select",{value:bV||"",onChange:a=>bW(a.target.value?parseInt(a.target.value):null),className:"w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:[(0,b.jsx)("option",{value:"",children:"Select a machine"}),ah.filter(a=>a.societyId===bT).map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.machineId," - ",a.machineType,a.isMasterMachine?" (Current Master)":""]},a.id))]})]}),(0,b.jsxs)("div",{className:"flex items-start gap-3 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[(0,b.jsx)("input",{type:"checkbox",id:"setForAllMachines",checked:bX,onChange:a=>bY(a.target.checked),className:"mt-1 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("label",{htmlFor:"setForAllMachines",className:"text-sm font-medium text-blue-900 dark:text-blue-100 cursor-pointer",children:"Apply master's passwords to all machines in society"}),(0,b.jsx)("p",{className:"text-xs text-blue-700 dark:text-blue-300 mt-1",children:"If checked, all machines in this society will be updated with the new master machine's passwords immediately."})]})]}),bd&&(0,b.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3",children:(0,b.jsx)("p",{className:"text-sm text-red-700 dark:text-red-300",children:bd})})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,b.jsx)("button",{onClick:()=>bS(!1),disabled:bZ,className:"px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors disabled:opacity-50",children:"Cancel"}),(0,b.jsx)("button",{onClick:ck,disabled:bZ||!bV,className:"px-4 py-2 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg hover:from-green-700 hover:to-emerald-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:bZ?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("svg",{className:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[(0,b.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,b.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Changing..."]}):"Change Master"})]})]})}),(0,b.jsx)(Z.BulkDeleteConfirmModal,{isOpen:bF,itemCount:bx.size,itemType:"machine",onConfirm:cC,onClose:()=>bG(!1)}),(0,b.jsx)(Y.BulkActionsToolbar,{selectedCount:bx.size,totalCount:ah.length,onBulkDelete:()=>bG(!0),onBulkStatusUpdate:cD,onClearSelection:()=>{by(new Set),bw(new Set),bA(!1)},itemType:"machine",showStatusUpdate:!0,currentBulkStatus:bJ,onBulkStatusChange:a=>bK(a)}),(0,b.jsx)($.FloatingActionButton,{actions:[{icon:(0,b.jsx)(y.Plus,{className:"w-6 h-6 text-white"}),label:"Add Machine",onClick:cG,color:"bg-gradient-to-br from-blue-500 to-blue-600"}],directClick:!0}),(0,b.jsx)(O.FormModal,{isOpen:b5&&!!cf,onClose:cP,title:`View Passwords - ${cf?.machineId||""}`,children:cd?(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(A.CheckCircle,{className:"w-5 h-5 text-green-600 dark:text-green-400 flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h4",{className:"text-sm font-medium text-green-800 dark:text-green-200 mb-1",children:"Passwords Retrieved Successfully"}),(0,b.jsxs)("p",{className:"text-xs text-green-700 dark:text-green-300",children:["Machine passwords for ",cf?.machineId]})]})]})}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,b.jsxs)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 flex items-center gap-2",children:[(0,b.jsx)(q.Key,{className:"w-4 h-4"}),"User Password"]})}),(0,b.jsx)("div",{className:"bg-white dark:bg-gray-900 rounded-md px-4 py-3 border border-gray-300 dark:border-gray-600",children:(0,b.jsx)("span",{className:"text-2xl font-mono font-bold text-gray-900 dark:text-white tracking-wider",children:cd.userPassword||"Not Set"})})]}),(0,b.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,b.jsxs)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 flex items-center gap-2",children:[(0,b.jsx)(p.Lock,{className:"w-4 h-4"}),"Supervisor Password"]})}),(0,b.jsx)("div",{className:"bg-white dark:bg-gray-900 rounded-md px-4 py-3 border border-gray-300 dark:border-gray-600",children:(0,b.jsx)("span",{className:"text-2xl font-mono font-bold text-gray-900 dark:text-white tracking-wider",children:cd.supervisorPassword||"Not Set"})})]})]}),(0,b.jsx)("div",{className:"flex gap-3 pt-2",children:(0,b.jsx)("button",{type:"button",onClick:cP,className:"flex-1 px-4 py-2.5 text-sm font-medium text-white bg-gradient-to-r from-blue-600 to-blue-700 rounded-lg hover:from-blue-700 hover:to-blue-800 transition-all",children:"Close"})})]}):(0,b.jsxs)("form",{onSubmit:cO,className:"space-y-4",children:[(0,b.jsx)("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-4",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(o.AlertTriangle,{className:"w-5 h-5 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h4",{className:"text-sm font-medium text-amber-800 dark:text-amber-200 mb-1",children:"Security Verification Required"}),(0,b.jsx)("p",{className:"text-xs text-amber-700 dark:text-amber-300",children:"Enter your admin password to view machine passwords. This action will be logged for security purposes."})]})]})}),(0,b.jsx)(P.FormInput,{label:"Admin Password",type:"password",value:b7,onChange:a=>b8(a),placeholder:"Enter your admin password",error:b9,required:!0}),(0,b.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,b.jsx)("button",{type:"button",onClick:cP,className:"flex-1 px-4 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors",children:"Cancel"}),(0,b.jsx)("button",{type:"submit",disabled:cb||!b7,className:"flex-1 px-4 py-2.5 text-sm font-medium text-white bg-gradient-to-r from-blue-600 to-blue-700 rounded-lg hover:from-blue-700 hover:to-blue-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2",children:cb?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Verifying..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(z.Eye,{className:"w-4 h-4"}),"View Passwords"]})})]})]})}),bj&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>bk(!1),children:(0,b.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden",onClick:a=>a.stopPropagation(),children:[(0,b.jsxs)("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[(0,b.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:["quantity"===bl&&"Top 20 Machines by Quantity (Last 30 Days)","tests"===bl&&"Top 20 Machines by Total Tests (Last 30 Days)","cleaning"===bl&&"Top 20 Machines by Cleaning Count (Last 30 Days)","skip"===bl&&"Top 20 Machines by Cleaning Skip Count (Last 30 Days)","today"===bl&&"Most Active Machines Today","uptime"===bl&&"Top 20 Machines by Uptime Days (Last 30 Days)"]}),(0,b.jsx)("button",{onClick:()=>bk(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:(0,b.jsx)(F.X,{className:"w-6 h-6"})})]}),(0,b.jsx)("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-80px)]",children:bn.length>0?(0,b.jsx)(M.ResponsiveContainer,{width:"100%",height:400,children:(0,b.jsxs)(G.LineChart,{data:bn,children:[(0,b.jsx)(K.CartesianGrid,{strokeDasharray:"3 3"}),(0,b.jsx)(I.XAxis,{dataKey:"label",angle:-45,textAnchor:"end",height:100,tick:{fontSize:12}}),(0,b.jsx)(J.YAxis,{}),(0,b.jsx)(L.Tooltip,{content:({active:a,payload:c})=>{if(a&&c&&c[0]){let a=c[0].payload;return(0,b.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-3 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700",children:[(0,b.jsx)("p",{className:"font-semibold text-gray-900 dark:text-white",children:a.machine.machineId}),(0,b.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:a.machine.machineType}),a.machine.societyName&&(0,b.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:a.machine.societyName}),(0,b.jsxs)("p",{className:"text-sm font-semibold text-blue-600 dark:text-blue-400 mt-1",children:["quantity"===bl&&`${a.value.toFixed(2)} L`,"tests"===bl&&`${a.value} Tests`,"cleaning"===bl&&`${a.value} Cleanings`,"skip"===bl&&`${a.value} Skips`,"today"===bl&&`${a.value} Collections Today`,"uptime"===bl&&`${a.value} Days Active`]})]})}return null}}),(0,b.jsx)(H.Line,{type:"monotone",dataKey:"value",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:4},activeDot:{r:6}})]})}):(0,b.jsx)("div",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:"No data available"})})]})})]})}a.s(["default",0,function(){return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-500"})}),children:(0,b.jsx)(ae,{})})}],347441)}];

//# sourceMappingURL=src_app_admin_machine_page_tsx_63cf7ceb._.js.map