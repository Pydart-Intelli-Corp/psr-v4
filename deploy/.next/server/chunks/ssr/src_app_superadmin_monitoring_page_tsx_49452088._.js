module.exports=[942178,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(50944),e=a.i(346271),f=a.i(262036),g=a.i(290669),h=a.i(724669),i=a.i(292e3),j=a.i(816201),k=a.i(641710),l=a.i(660246),m=a.i(369012),n=a.i(669520),o=a.i(781560),p=a.i(400210),q=a.i(244494);let r=(0,a.i(170106).default)("server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);var s=a.i(371727);a.s(["default",0,()=>{let a=(0,d.useRouter)(),[t,u]=(0,c.useState)([]),[v,w]=(0,c.useState)(null),[x,y]=(0,c.useState)(!1),[z,A]=(0,c.useState)({}),[B,C]=(0,c.useState)(!0),[D,E]=(0,c.useState)("5m"),F=(0,c.useCallback)(async()=>{try{let a=localStorage.getItem("adminToken"),b=new URLSearchParams;if(z.category&&b.append("category",z.category),z.dbKey&&b.append("dbKey",z.dbKey),z.societyId&&b.append("societyId",z.societyId),b.append("limit","100"),"all"!==D){let a=new Date,c="1m"===D?1:"5m"===D?5:"15m"===D?15:60,d=new Date(a.getTime()-60*c*1e3);b.append("since",d.toISOString())}let c=await fetch(`/api/superadmin/monitoring/requests?${b.toString()}`,{headers:{Authorization:`Bearer ${a}`}});if(c.ok){let a=await c.json();u(a.data||[])}let d=new URLSearchParams;if(z.category&&d.append("category",z.category),"all"!==D){let a=new Date,b="1m"===D?1:"5m"===D?5:"15m"===D?15:60,c=new Date(a.getTime()-60*b*1e3);d.append("since",c.toISOString())}let e=await fetch(`/api/superadmin/monitoring/stats?${d.toString()}`,{headers:{Authorization:`Bearer ${a}`}});if(e.ok){let a=await e.json();w(a.data)}}catch(a){console.error("Error fetching monitoring data:",a)}},[z,D]);(0,c.useEffect)(()=>{if(!B)return;console.log("ðŸŽ¯ Setting up SSE connection...");let a=new EventSource("/api/superadmin/monitoring/stream");return a.onopen=()=>{console.log("âœ… SSE Connected"),y(!0)},a.onmessage=a=>{try{console.log("ðŸ“¨ SSE Message received:",a.data);let b=JSON.parse(a.data);if("connected"===b.type)return void console.log("ðŸŽ¯ SSE Connection confirmed");if("heartbeat"===b.type)return void console.log("ðŸ’“ SSE Heartbeat");if("request"===b.type){console.log("ðŸ“Š New request received:",b.data);let a=b.data;if(z.category&&a.category!==z.category)return void console.log("ðŸš« Request filtered out by category");if(z.dbKey&&a.dbKey!==z.dbKey)return void console.log("ðŸš« Request filtered out by dbKey");if(z.societyId&&a.societyId!==z.societyId)return void console.log("ðŸš« Request filtered out by societyId");console.log("âœ… Adding request to list"),u(b=>[a,...b].slice(0,100)),F()}}catch(a){console.error("Error parsing SSE data:",a)}},a.onerror=a=>{console.log("âŒ SSE Error:",a),console.log("âŒ SSE Disconnected"),y(!1)},()=>{console.log("ðŸ”Œ Closing SSE connection"),a.close(),y(!1)}},[B,z,F]),(0,c.useEffect)(()=>{let b,c;b=localStorage.getItem("adminToken"),c=localStorage.getItem("userRole"),b&&"super_admin"===c?F():a.push("/superadmin")},[a]);let G=async()=>{if(confirm("Are you sure you want to clear all request logs?"))try{let a=localStorage.getItem("adminToken");await fetch("/api/superadmin/monitoring/requests",{method:"DELETE",headers:{Authorization:`Bearer ${a}`}}),u([]),F()}catch(a){console.error("Error clearing logs:",a)}},H=async()=>{try{console.log("ðŸ§ª Triggering test request...");let a=await fetch("/api/BAB1568/FarmerInfo/GetLatestFarmerInfo?InputString=S-2121%7CECOD-G%7CLE2.00%7CM00000003%7CC00001");console.log("ðŸ§ª Test request completed:",a.status),setTimeout(()=>{F()},500)}catch(a){console.error("Error triggering test request:",a)}},I=a=>{let b={external:"bg-purple-100 text-purple-800 border-purple-300",admin:"bg-blue-100 text-blue-800 border-blue-300",farmer:"bg-green-100 text-green-800 border-green-300",machine:"bg-orange-100 text-orange-800 border-orange-300",auth:"bg-red-100 text-red-800 border-red-300",other:"bg-gray-100 text-gray-800 border-gray-300"};return b[a]||b.other};return(0,b.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 p-6",children:(0,b.jsxs)("div",{className:"max-w-[1800px] mx-auto",children:[(0,b.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("button",{onClick:()=>a.push("/superadmin/dashboard"),className:"p-2 hover:bg-white rounded-lg transition-colors",children:(0,b.jsx)(p.ArrowLeft,{className:"w-5 h-5"})}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[(0,b.jsx)(g.Activity,{className:"w-8 h-8 text-blue-600"}),"Live API Monitor"]}),(0,b.jsx)("p",{className:"text-gray-600 mt-1",children:"Real-time endpoint tracking and analytics"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 px-4 py-2 bg-white rounded-lg border",children:[(0,b.jsx)("div",{className:`w-2 h-2 rounded-full ${x?"bg-green-500 animate-pulse":"bg-gray-400"}`}),(0,b.jsx)("span",{className:"text-sm font-medium",children:x?"Live":"Disconnected"})]}),(0,b.jsxs)("button",{onClick:()=>C(!B),className:`px-4 py-2 rounded-lg border font-medium transition-colors ${B?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300"}`,children:[(0,b.jsx)(s.Radio,{className:"w-4 h-4 inline mr-2"}),B?"Live Mode":"Paused"]}),(0,b.jsxs)("button",{onClick:F,className:"px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,b.jsx)(n.RefreshCw,{className:"w-4 h-4 inline mr-2"}),"Refresh"]}),(0,b.jsxs)("button",{onClick:H,className:"px-4 py-2 bg-green-50 text-green-600 border border-green-200 rounded-lg hover:bg-green-100 transition-colors",title:"Trigger a test API request",children:[(0,b.jsx)(g.Activity,{className:"w-4 h-4 inline mr-2"}),"Test"]}),(0,b.jsxs)("button",{onClick:G,className:"px-4 py-2 bg-red-50 text-red-600 border border-red-200 rounded-lg hover:bg-red-100 transition-colors",children:[(0,b.jsx)(o.Trash2,{className:"w-4 h-4 inline mr-2"}),"Clear"]})]})]}),v&&(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[(0,b.jsx)(e.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Total Requests"}),(0,b.jsx)("p",{className:"text-3xl font-bold text-gray-900 mt-1",children:v.total})]}),(0,b.jsx)("div",{className:"p-3 bg-blue-100 rounded-lg",children:(0,b.jsx)(g.Activity,{className:"w-6 h-6 text-blue-600"})})]})}),(0,b.jsx)(e.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Avg Response Time"}),(0,b.jsxs)("p",{className:"text-3xl font-bold text-gray-900 mt-1",children:[v.avgResponseTime.toFixed(0),(0,b.jsx)("span",{className:"text-lg text-gray-600 ml-1",children:"ms"})]})]}),(0,b.jsx)("div",{className:"p-3 bg-green-100 rounded-lg",children:(0,b.jsx)(k.Clock,{className:"w-6 h-6 text-green-600"})})]})}),(0,b.jsx)(e.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Error Rate"}),(0,b.jsxs)("p",{className:"text-3xl font-bold text-gray-900 mt-1",children:[v.errorRate.toFixed(1),(0,b.jsx)("span",{className:"text-lg text-gray-600 ml-1",children:"%"})]})]}),(0,b.jsx)("div",{className:`p-3 rounded-lg ${v.errorRate>10?"bg-red-100":"bg-yellow-100"}`,children:(0,b.jsx)(i.AlertCircle,{className:`w-6 h-6 ${v.errorRate>10?"text-red-600":"text-yellow-600"}`})})]})}),(0,b.jsx)(e.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Success Rate"}),(0,b.jsxs)("p",{className:"text-3xl font-bold text-gray-900 mt-1",children:[(100-v.errorRate).toFixed(1),(0,b.jsx)("span",{className:"text-lg text-gray-600 ml-1",children:"%"})]})]}),(0,b.jsx)("div",{className:"p-3 bg-emerald-100 rounded-lg",children:(0,b.jsx)(j.CheckCircle,{className:"w-6 h-6 text-emerald-600"})})]})})]}),(0,b.jsx)("div",{className:"bg-white rounded-xl p-4 border border-gray-200 mb-6",children:(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(m.Filter,{className:"w-4 h-4 text-gray-600"}),(0,b.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Filters:"})]}),(0,b.jsxs)("select",{value:z.category||"",onChange:a=>A({...z,category:a.target.value||void 0}),className:"px-3 py-1.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,b.jsx)("option",{value:"",children:"All Categories"}),(0,b.jsx)("option",{value:"external",children:"External APIs"}),(0,b.jsx)("option",{value:"admin",children:"Admin APIs"}),(0,b.jsx)("option",{value:"farmer",children:"Farmer APIs"}),(0,b.jsx)("option",{value:"machine",children:"Machine APIs"}),(0,b.jsx)("option",{value:"auth",children:"Authentication"}),(0,b.jsx)("option",{value:"other",children:"Other"})]}),(0,b.jsxs)("select",{value:D,onChange:a=>E(a.target.value),className:"px-3 py-1.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,b.jsx)("option",{value:"1m",children:"Last 1 minute"}),(0,b.jsx)("option",{value:"5m",children:"Last 5 minutes"}),(0,b.jsx)("option",{value:"15m",children:"Last 15 minutes"}),(0,b.jsx)("option",{value:"1h",children:"Last 1 hour"}),(0,b.jsx)("option",{value:"all",children:"All time"})]}),(z.category||z.dbKey||z.societyId)&&(0,b.jsx)("button",{onClick:()=>A({}),className:"px-3 py-1.5 text-sm text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:"Clear Filters"})]})}),v&&Object.keys(v.byCategory).length>0&&(0,b.jsxs)("div",{className:"bg-white rounded-xl p-6 border border-gray-200 mb-6",children:[(0,b.jsxs)("h2",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[(0,b.jsx)(h.TrendingUp,{className:"w-5 h-5 text-blue-600"}),"Category Breakdown"]}),(0,b.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:Object.entries(v.byCategory).map(([a,c])=>(0,b.jsxs)("div",{className:`p-4 rounded-lg border ${I(a)} cursor-pointer hover:shadow-md transition-shadow`,onClick:()=>A({...z,category:a}),children:[(0,b.jsx)("p",{className:"text-2xl font-bold",children:c}),(0,b.jsx)("p",{className:"text-sm capitalize mt-1",children:a})]},a))})]}),v&&Object.keys(v.byEndpoint).length>0&&(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[(0,b.jsxs)("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[(0,b.jsxs)("h2",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[(0,b.jsx)(r,{className:"w-5 h-5 text-blue-600"}),"Top Endpoints"]}),(0,b.jsx)("div",{className:"space-y-2",children:Object.entries(v.byEndpoint).sort(([,a],[,b])=>b-a).slice(0,5).map(([a,c])=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,b.jsx)("span",{className:"text-sm font-mono text-gray-700 truncate",children:a}),(0,b.jsx)("span",{className:"text-sm font-bold text-gray-900 ml-2",children:c})]},a))})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[(0,b.jsxs)("h2",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[(0,b.jsx)(l.Users,{className:"w-5 h-5 text-blue-600"}),"Top Societies"]}),(0,b.jsxs)("div",{className:"space-y-2",children:[Object.entries(v.bySociety).sort(([,a],[,b])=>b-a).slice(0,5).map(([a,c])=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>A({...z,societyId:a}),children:[(0,b.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:["Society ",a]}),(0,b.jsx)("span",{className:"text-sm font-bold text-gray-900",children:c})]},a)),0===Object.keys(v.bySociety).length&&(0,b.jsx)("p",{className:"text-sm text-gray-500 text-center py-4",children:"No society data"})]})]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:[(0,b.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,b.jsxs)("h2",{className:"text-lg font-bold text-gray-900 flex items-center gap-2",children:[(0,b.jsx)(q.Globe,{className:"w-5 h-5 text-blue-600"}),"Recent Requests (",t.length,")"]})}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Time"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Method"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Endpoint"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Society"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Time"}),(0,b.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"IP"})]})}),(0,b.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:(0,b.jsxs)(f.AnimatePresence,{children:[0===t.length&&(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:8,className:"px-6 py-8 text-center text-gray-500",children:"No requests yet. Waiting for API calls..."})}),t.map(a=>{var c;return(0,b.jsxs)(e.motion.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"hover:bg-gray-50 transition-colors",children:[(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(a.timestamp).toLocaleTimeString()}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,b.jsx)("span",{className:`px-2 py-1 text-xs font-medium rounded ${"GET"===a.method?"bg-green-100 text-green-800":"POST"===a.method?"bg-blue-100 text-blue-800":"PUT"===a.method?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:a.method})}),(0,b.jsx)("td",{className:"px-6 py-4 text-sm text-gray-900 font-mono truncate max-w-xs",children:a.endpoint}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,b.jsx)("span",{className:`px-2 py-1 text-xs font-medium rounded border ${I(a.category)}`,children:a.category})}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a.societyId?`S-${a.societyId}`:"-"}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,b.jsx)("span",{className:`text-sm font-bold ${(c=a.statusCode)<300?"text-green-600":c<400?"text-blue-600":c<500?"text-yellow-600":"text-red-600"}`,children:a.statusCode})}),(0,b.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[a.responseTime,"ms"]}),(0,b.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 font-mono",children:a.ip||"-"})]},a.id)})]})})]})})]})]})})}],942178)}];

//# sourceMappingURL=src_app_superadmin_monitoring_page_tsx_49452088._.js.map