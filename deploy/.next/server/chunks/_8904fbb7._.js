module.exports=[48798,e=>{"use strict";var t=e.i(89171);function r(e,a,n=200){return t.NextResponse.json({success:!0,message:e,data:a},{status:n})}function a(e,r=400,n){return t.NextResponse.json({success:!1,message:"Error occurred",error:e,data:n},{status:r})}e.s(["createErrorResponse",()=>a,"createSuccessResponse",()=>r])},209462,e=>{"use strict";var t=e.i(747909),r=e.i(174017),a=e.i(996250),n=e.i(759756),i=e.i(561916),s=e.i(114444),o=e.i(837092),l=e.i(869741),d=e.i(316795),c=e.i(487718),u=e.i(995169),p=e.i(47587),h=e.i(666012),R=e.i(570101),E=e.i(626937),f=e.i(10372),w=e.i(193695);e.i(52474);var m=e.i(600220),v=e.i(79832),_=e.i(84168),g=e.i(48798);async function y(t,r){try{let a=t.headers.get("authorization")?.replace("Bearer ","");if(!a)return(0,g.createErrorResponse)("Authentication required",401);let n=(0,v.verifyToken)(a);if(!n)return(0,g.createErrorResponse)("Invalid token",401);if("admin"!==n.role)return(0,g.createErrorResponse)("Admin access required",403);let{id:i}=await r.params,s=await (0,_.connectDB)();if(!s)return(0,g.createErrorResponse)("Database connection failed",500);let{User:o}=await e.A(121985).then(e=>e.getModels()),l=await o.findByPk(n.id);if(!l||!l.dbKey)return(0,g.createErrorResponse)("Admin schema not found",404);let d=l.fullName.replace(/[^a-zA-Z0-9]/g,"").toLowerCase(),c=`${d}_${l.dbKey.toLowerCase()}`,u=await s.transaction();try{let[e]=await s.query(`
        SELECT id, shared_chart_id FROM ${c}.rate_charts
        WHERE id = :id
      `,{replacements:{id:i},transaction:u});if(!e||0===e.length)return await u.rollback(),(0,g.createErrorResponse)("Rate chart not found",404);let t=e[0],r=null===t.shared_chart_id;if(r){let[e]=await s.query(`
          SELECT id FROM ${c}.rate_charts
          WHERE id = :id OR shared_chart_id = :id
        `,{replacements:{id:i},transaction:u}),t=e.map(e=>e.id);t.length>0&&await s.query(`
            DELETE FROM ${c}.rate_chart_download_history
            WHERE rate_chart_id IN (${t.join(",")})
          `,{transaction:u}),await s.query(`
          DELETE FROM ${c}.rate_charts
          WHERE shared_chart_id = :id
        `,{replacements:{id:i},transaction:u}),await s.query(`
          DELETE FROM ${c}.rate_chart_data
          WHERE rate_chart_id = :id
        `,{replacements:{id:i},transaction:u})}else await s.query(`
          DELETE FROM ${c}.rate_chart_download_history
          WHERE rate_chart_id = :id
        `,{replacements:{id:i},transaction:u});return await s.query(`
        DELETE FROM ${c}.rate_charts
        WHERE id = :id
      `,{replacements:{id:i},transaction:u}),await u.commit(),console.log(`ðŸ—‘ï¸  Rate chart ${i} deleted successfully${r?" (including all shared references)":""}`),(0,g.createSuccessResponse)("Rate chart deleted successfully",null)}catch(e){throw await u.rollback(),e}}catch(e){return console.error("Error deleting rate chart:",e),(0,g.createErrorResponse)("Failed to delete rate chart",500)}}e.s(["DELETE",()=>y],671534);var C=e.i(671534);let x=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/user/ratechart/[id]/route",pathname:"/api/user/ratechart/[id]",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/user/ratechart/[id]/route.ts",nextConfigOutput:"",userland:C}),{workAsyncStorage:A,workUnitAsyncStorage:T,serverHooks:O}=x;function N(){return(0,a.patchFetch)({workAsyncStorage:A,workUnitAsyncStorage:T})}async function b(e,t,a){x.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/user/ratechart/[id]/route";v=v.replace(/\/index$/,"")||"/";let _=await x.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!_)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:g,params:y,nextConfig:C,parsedUrl:A,isDraftMode:T,prerenderManifest:O,routerServerContext:N,isOnDemandRevalidate:b,revalidateOnlyGenerated:P,resolvedPathname:H,clientReferenceManifest:M,serverActionsManifest:S}=_,q=(0,l.normalizeAppPath)(v),D=!!(O.dynamicRoutes[q]||O.routes[H]),$=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,A,!1):t.end("This page could not be found"),null);if(D&&!T){let e=!!O.routes[H],t=O.dynamicRoutes[q];if(t&&!1===t.fallback&&!e){if(C.experimental.adapterPath)return await $();throw new w.NoFallbackError}}let k=null;!D||x.isDev||T||(k="/index"===(k=H)?"/":k);let I=!0===x.isDev||!D,F=D&&!I;S&&M&&(0,s.setReferenceManifestsSingleton)({page:v,clientReferenceManifest:M,serverActionsManifest:S,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:S})});let U=e.method||"GET",L=(0,i.getTracer)(),j=L.getActiveScopeSpan(),K={params:y,prerenderManifest:O,renderOpts:{experimental:{authInterrupts:!!C.experimental.authInterrupts},cacheComponents:!!C.cacheComponents,supportsDynamicResponse:I,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:C.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>x.onRequestError(e,t,a,N)},sharedContext:{buildId:g}},W=new d.NodeNextRequest(e),B=new d.NodeNextResponse(t),z=c.NextRequestAdapter.fromNodeNextRequest(W,(0,c.signalFromNodeResponse)(t));try{let s=async e=>x.handle(z,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=L.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${U} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${U} ${v}`)}),o=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var i,l;let d=async({previousCacheEntry:r})=>{try{if(!o&&b&&P&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await s(n);e.fetchMetrics=K.renderOpts.fetchMetrics;let l=K.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let d=K.renderOpts.collectedTags;if(!D)return await (0,h.sendResponse)(W,B,i,K.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,R.toNodeOutgoingHttpHeaders)(i.headers);d&&(t[f.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,a=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:m.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await x.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:b})},N),t}},c=await x.handleResponse({req:e,nextConfig:C,cacheKey:k,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:O,isRoutePPREnabled:!1,isOnDemandRevalidate:b,revalidateOnlyGenerated:P,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:o});if(!D)return null;if((null==c||null==(i=c.value)?void 0:i.kind)!==m.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",b?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),T&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,R.fromNodeOutgoingHttpHeaders)(c.value.headers);return o&&D||u.delete(f.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,E.getCacheControlHeader)(c.cacheControl)),await (0,h.sendResponse)(W,B,new Response(c.value.body,{headers:u,status:c.value.status||200})),null};j?await l(j):await L.withPropagatedContext(e.headers,()=>L.trace(u.BaseServerSpan.handleRequest,{spanName:`${U} ${v}`,kind:i.SpanKind.SERVER,attributes:{"http.method":U,"http.target":e.url}},l))}catch(t){if(t instanceof w.NoFallbackError||await x.onRequestError(e,t,{routerKind:"App Router",routePath:q,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:b})}),D)throw t;return await (0,h.sendResponse)(W,B,new Response(null,{status:500})),null}}e.s(["handler",()=>b,"patchFetch",()=>N,"routeModule",()=>x,"serverHooks",()=>O,"workAsyncStorage",()=>A,"workUnitAsyncStorage",()=>T],209462)},453753,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__86f7d54e._.js"].map(t=>e.l(t))).then(()=>t(736987)))},121985,e=>{e.v(t=>Promise.all(["server/chunks/src_models_index_ts_328304ec._.js"].map(t=>e.l(t))).then(()=>t(540590)))}];

//# sourceMappingURL=_8904fbb7._.js.map