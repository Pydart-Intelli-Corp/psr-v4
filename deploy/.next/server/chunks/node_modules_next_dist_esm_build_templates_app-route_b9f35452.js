module.exports=[770306,e=>{"use strict";var t=e.i(747909),a=e.i(174017),i=e.i(996250),r=e.i(759756),s=e.i(561916),n=e.i(114444),o=e.i(837092),c=e.i(869741),l=e.i(316795),d=e.i(487718),m=e.i(995169),E=e.i(47587),u=e.i(666012),y=e.i(570101),N=e.i(626937),f=e.i(10372),S=e.i(193695);e.i(52474);var C=e.i(600220),_=e.i(79832),O=e.i(84168),D=e.i(48798);async function T(t,{params:a}){try{let i,r=t.headers.get("authorization")?.replace("Bearer ","");if(!r)return(0,D.createErrorResponse)("Authentication required",401);let s=(0,_.verifyToken)(r);if(!s||"admin"!==s.role)return(0,D.createErrorResponse)("Admin access required",403);let{id:n}=await a;await (0,O.connectDB)();let{getModels:o}=await e.A(121985),{sequelize:c,User:l}=o(),d=await l.findByPk(s.id);if(!d||!d.dbKey)return(0,D.createErrorResponse)("Admin schema not found",404);let m=d.fullName.replace(/[^a-zA-Z0-9]/g,"").toLowerCase(),E=`${m}_${d.dbKey.toLowerCase()}`;console.log(`[Dairy Details API] Fetching dairy ${n} from schema: ${E}`);try{[i]=await c.query(`
        SELECT 
          id, 
          name, 
          dairy_id as dairyId, 
          location, 
          contact_person as contactPerson, 
          phone, 
          email,
          capacity,
          status,
          monthly_target as monthlyTarget,
          created_at as createdAt, 
          updated_at as updatedAt
        FROM \`${E}\`.\`dairy_farms\`
        WHERE id = ?
      `,{replacements:[n]})}catch(e){return console.error("[Dairy Details API] Error fetching dairy:",e),(0,D.createErrorResponse)("Failed to fetch dairy information. Table may not exist.",500)}if(!i||0===i.length)return console.log(`[Dairy Details API] Dairy ${n} not found in schema ${E}`),(0,D.createErrorResponse)("Dairy not found",404);let u=i[0];console.log(`[Dairy Details API] Found dairy: ${u.name}`);let y=[],N=[],f=[],S=[],C=[],T={totalBmcs:0,totalSocieties:0,totalFarmers:0,totalMachines:0,totalCollections:0,totalQuantity:0,totalRevenue:0,avgFat:0,avgSnf:0,avgRate:0},A=[],R=[],p=[],I=[];try{[y]=await c.query(`
        SELECT 
          b.id,
          b.bmc_id as bmcId,
          b.name,
          b.location,
          b.capacity,
          b.status,
          b.created_at as createdAt,
          COUNT(DISTINCT s.id) as societyCount,
          COUNT(DISTINCT f.id) as farmerCount,
          COALESCE(SUM(mc.quantity), 0) as totalCollections
        FROM \`${E}\`.\`bmcs\` b
        LEFT JOIN \`${E}\`.\`societies\` s ON s.bmc_id = b.id
        LEFT JOIN \`${E}\`.\`farmers\` f ON f.society_id = s.id
        LEFT JOIN \`${E}\`.\`milk_collections\` mc ON mc.bmc_id = b.id
          AND mc.collection_date >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)
        WHERE b.dairy_farm_id = ?
        GROUP BY b.id, b.bmc_id, b.name, b.location, b.capacity, b.status, b.created_at
        ORDER BY b.created_at DESC
      `,{replacements:[n]}),console.log(`[Dairy Details API] Found ${y.length} BMCs`)}catch(e){console.error("[Dairy Details API] Error fetching BMCs:",e)}try{[N]=await c.query(`
        SELECT 
          s.id,
          s.society_id as societyId,
          s.name,
          s.location,
          s.contact_person as contactPerson,
          s.phone,
          s.status,
          b.name as bmcName,
          b.bmc_id as bmcId,
          COUNT(DISTINCT f.id) as farmerCount,
          COALESCE(SUM(mc.quantity), 0) as totalCollections
        FROM \`${E}\`.\`societies\` s
        LEFT JOIN \`${E}\`.\`bmcs\` b ON s.bmc_id = b.id
        LEFT JOIN \`${E}\`.\`farmers\` f ON f.society_id = s.id
        LEFT JOIN \`${E}\`.\`milk_collections\` mc ON mc.society_id = s.id
          AND mc.collection_date >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)
        WHERE b.dairy_farm_id = ?
        GROUP BY s.id, s.society_id, s.name, s.location, s.contact_person, s.phone, s.status, b.name, b.bmc_id
        ORDER BY s.created_at DESC
      `,{replacements:[n]}),console.log(`[Dairy Details API] Found ${N.length} societies`)}catch(e){console.error("[Dairy Details API] Error fetching societies:",e)}try{[f]=await c.query(`
        SELECT 
          f.id,
          f.farmer_id as farmerId,
          f.rf_id as rfId,
          f.name,
          f.phone,
          f.status,
          s.name as societyName,
          s.society_id as societyId,
          b.name as bmcName,
          COUNT(DISTINCT mc.id) as totalCollections,
          COALESCE(SUM(mc.quantity), 0) as totalQuantity,
          COALESCE(
            CASE 
              WHEN SUM(mc.quantity) > 0 
              THEN ROUND(SUM(mc.fat_percentage * mc.quantity) / SUM(mc.quantity), 2)
              ELSE 0 
            END, 0
          ) as avgFat,
          COALESCE(
            CASE 
              WHEN SUM(mc.quantity) > 0 
              THEN ROUND(SUM(mc.snf_percentage * mc.quantity) / SUM(mc.quantity), 2)
              ELSE 0 
            END, 0
          ) as avgSnf
        FROM \`${E}\`.\`farmers\` f
        LEFT JOIN \`${E}\`.\`societies\` s ON f.society_id = s.id
        LEFT JOIN \`${E}\`.\`bmcs\` b ON s.bmc_id = b.id
        LEFT JOIN \`${E}\`.\`milk_collections\` mc ON mc.farmer_id = f.id
          AND mc.collection_date >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)
        WHERE b.dairy_farm_id = ?
        GROUP BY f.id, f.farmer_id, f.rf_id, f.name, f.phone, f.status, s.name, s.society_id, b.name
        ORDER BY totalQuantity DESC
        LIMIT 50
      `,{replacements:[n]}),console.log(`[Dairy Details API] Found ${f.length} farmers`)}catch(e){console.error("[Dairy Details API] Error fetching farmers:",e)}try{[S]=await c.query(`
        SELECT 
          m.id,
          m.machine_id as machineId,
          m.machine_type as machineType,
          m.status,
          m.is_master_machine as isMasterMachine,
          s.name as societyName,
          s.society_id as societyId,
          b.name as bmcName,
          COUNT(DISTINCT mc.id) as totalCollections,
          MAX(mc.collection_date) as lastCollection
        FROM \`${E}\`.\`machines\` m
        LEFT JOIN \`${E}\`.\`societies\` s ON m.society_id = s.id
        LEFT JOIN \`${E}\`.\`bmcs\` b ON s.bmc_id = b.id
        LEFT JOIN \`${E}\`.\`milk_collections\` mc ON mc.machine_id = m.id
          AND mc.collection_date >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)
        WHERE b.dairy_farm_id = ?
        GROUP BY m.id, m.machine_id, m.machine_type, m.status, m.is_master_machine, s.name, s.society_id, b.name
        ORDER BY m.created_at DESC
      `,{replacements:[n]}),console.log(`[Dairy Details API] Found ${S.length} machines`)}catch(e){console.error("[Dairy Details API] Error fetching machines:",e)}try{[C]=await c.query(`
        SELECT 
          mc.id,
          mc.collection_date as collectionDate,
          mc.shift,
          mc.quantity,
          mc.fat_percentage as fat,
          mc.snf_percentage as snf,
          mc.rate,
          mc.total_amount as totalAmount,
          f.name as farmerName,
          f.farmer_id as farmerId,
          s.name as societyName,
          s.society_id as societyId
        FROM \`${E}\`.\`milk_collections\` mc
        LEFT JOIN \`${E}\`.\`farmers\` f ON mc.farmer_id = f.id
        LEFT JOIN \`${E}\`.\`societies\` s ON mc.society_id = s.id
        LEFT JOIN \`${E}\`.\`bmcs\` b ON s.bmc_id = b.id
        WHERE b.dairy_farm_id = ?
          AND mc.collection_date >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)
        ORDER BY mc.collection_date DESC, mc.created_at DESC
        LIMIT 100
      `,{replacements:[n]}),console.log(`[Dairy Details API] Found ${C.length} collections`)}catch(e){console.error("[Dairy Details API] Error fetching collections:",e)}try{let[e]=await c.query(`
        SELECT 
          COUNT(DISTINCT b.id) as totalBmcs,
          COUNT(DISTINCT s.id) as totalSocieties,
          COALESCE(COUNT(DISTINCT mc.id), 0) as totalCollections,
          COALESCE(SUM(mc.quantity), 0) as totalQuantity,
          COALESCE(SUM(mc.total_amount), 0) as totalRevenue,
          COALESCE(
            CASE 
              WHEN SUM(mc.quantity) > 0 
              THEN ROUND(SUM(mc.fat_percentage * mc.quantity) / SUM(mc.quantity), 2)
              ELSE 0 
            END, 0
          ) as avgFat,
          COALESCE(
            CASE 
              WHEN SUM(mc.quantity) > 0 
              THEN ROUND(SUM(mc.snf_percentage * mc.quantity) / SUM(mc.quantity), 2)
              ELSE 0 
            END, 0
          ) as avgSnf,
          COALESCE(
            CASE 
              WHEN SUM(mc.quantity) > 0 
              THEN ROUND(SUM(mc.total_amount) / SUM(mc.quantity), 2)
              ELSE 0 
            END, 0
          ) as avgRate
        FROM \`${E}\`.\`dairy_farms\` d
        LEFT JOIN \`${E}\`.\`bmcs\` b ON b.dairy_farm_id = d.id
        LEFT JOIN \`${E}\`.\`societies\` s ON s.bmc_id = b.id
        LEFT JOIN \`${E}\`.\`milk_collections\` mc ON mc.society_id = s.id
          AND mc.collection_date >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)
        WHERE d.id = ?
      `,{replacements:[n]});console.log("[Dairy Details API] Raw analytics result:",JSON.stringify(e,null,2)),T=e[0];let[t]=await c.query(`
        SELECT COUNT(DISTINCT f.id) as totalFarmers
        FROM \`${E}\`.\`dairy_farms\` d
        LEFT JOIN \`${E}\`.\`bmcs\` b ON b.dairy_farm_id = d.id
        LEFT JOIN \`${E}\`.\`societies\` s ON s.bmc_id = b.id
        LEFT JOIN \`${E}\`.\`farmers\` f ON f.society_id = s.id
        WHERE d.id = ?
      `,{replacements:[n]}),[a]=await c.query(`
        SELECT COUNT(DISTINCT m.id) as totalMachines
        FROM \`${E}\`.\`dairy_farms\` d
        LEFT JOIN \`${E}\`.\`bmcs\` b ON b.dairy_farm_id = d.id
        LEFT JOIN \`${E}\`.\`societies\` s ON s.bmc_id = b.id
        LEFT JOIN \`${E}\`.\`machines\` m ON m.society_id = s.id
        WHERE d.id = ?
      `,{replacements:[n]});T.totalFarmers=t[0].totalFarmers||0,T.totalMachines=a[0].totalMachines||0,console.log("[Dairy Details API] Parsed analytics:",JSON.stringify(T,null,2)),console.log(`[Dairy Details API] Analytics: ${T.totalCollections} collections, ${T.totalQuantity} L`)}catch(e){console.error("[Dairy Details API] Error fetching analytics:",e)}try{[A]=await c.query(`
        SELECT 
          DATE(mc.collection_date) as date,
          COUNT(DISTINCT mc.id) as collections,
          COALESCE(SUM(mc.quantity), 0) as quantity,
          COALESCE(SUM(mc.total_amount), 0) as revenue,
          COALESCE(
            CASE 
              WHEN SUM(mc.quantity) > 0 
              THEN ROUND(SUM(mc.fat_percentage * mc.quantity) / SUM(mc.quantity), 2)
              ELSE 0 
            END, 0
          ) as avgFat,
          COALESCE(
            CASE 
              WHEN SUM(mc.quantity) > 0 
              THEN ROUND(SUM(mc.snf_percentage * mc.quantity) / SUM(mc.quantity), 2)
              ELSE 0 
            END, 0
          ) as avgSnf
        FROM \`${E}\`.\`milk_collections\` mc
        LEFT JOIN \`${E}\`.\`societies\` s ON mc.society_id = s.id
        LEFT JOIN \`${E}\`.\`bmcs\` b ON s.bmc_id = b.id
        WHERE b.dairy_farm_id = ?
          AND mc.collection_date >= DATE_SUB(CURDATE(), INTERVAL 7 DAY)
        GROUP BY DATE(mc.collection_date)
        ORDER BY date DESC
      `,{replacements:[n]}),console.log(`[Dairy Details API] Found ${A.length} daily trends`)}catch(e){console.error("[Dairy Details API] Error fetching daily trends:",e)}try{[R]=await c.query(`
        SELECT 
          mc.shift,
          COUNT(DISTINCT mc.id) as collections,
          COALESCE(SUM(mc.quantity), 0) as quantity,
          COALESCE(
            CASE 
              WHEN SUM(mc.quantity) > 0 
              THEN ROUND(SUM(mc.fat_percentage * mc.quantity) / SUM(mc.quantity), 2)
              ELSE 0 
            END, 0
          ) as avgFat,
          COALESCE(
            CASE 
              WHEN SUM(mc.quantity) > 0 
              THEN ROUND(SUM(mc.snf_percentage * mc.quantity) / SUM(mc.quantity), 2)
              ELSE 0 
            END, 0
          ) as avgSnf
        FROM \`${E}\`.\`milk_collections\` mc
        LEFT JOIN \`${E}\`.\`societies\` s ON mc.society_id = s.id
        LEFT JOIN \`${E}\`.\`bmcs\` b ON s.bmc_id = b.id
        WHERE b.dairy_farm_id = ?
          AND mc.collection_date >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)
        GROUP BY mc.shift
        ORDER BY mc.shift
      `,{replacements:[n]}),console.log(`[Dairy Details API] Found ${R.length} shift analysis records`)}catch(e){console.error("[Dairy Details API] Error fetching shift analysis:",e)}try{[p]=await c.query(`
        SELECT 
          f.farmer_id as farmerId,
          f.name,
          s.name as societyName,
          COUNT(DISTINCT mc.id) as collections,
          COALESCE(SUM(mc.quantity), 0) as totalQuantity,
          COALESCE(SUM(mc.total_amount), 0) as totalRevenue,
          COALESCE(
            CASE 
              WHEN SUM(mc.quantity) > 0 
              THEN ROUND(SUM(mc.fat_percentage * mc.quantity) / SUM(mc.quantity), 2)
              ELSE 0 
            END, 0
          ) as avgFat,
          COALESCE(
            CASE 
              WHEN SUM(mc.quantity) > 0 
              THEN ROUND(SUM(mc.snf_percentage * mc.quantity) / SUM(mc.quantity), 2)
              ELSE 0 
            END, 0
          ) as avgSnf
        FROM \`${E}\`.\`farmers\` f
        LEFT JOIN \`${E}\`.\`societies\` s ON f.society_id = s.id
        LEFT JOIN \`${E}\`.\`bmcs\` b ON s.bmc_id = b.id
        LEFT JOIN \`${E}\`.\`milk_collections\` mc ON mc.farmer_id = f.id
          AND mc.collection_date >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)
        WHERE b.dairy_farm_id = ?
        GROUP BY f.id, f.farmer_id, f.name, s.name
        HAVING totalQuantity > 0
        ORDER BY totalQuantity DESC
        LIMIT 10
      `,{replacements:[n]}),console.log(`[Dairy Details API] Found ${p.length} top farmers`)}catch(e){console.error("[Dairy Details API] Error fetching top farmers:",e)}try{[I]=await c.query(`
        SELECT 
          s.society_id as societyId,
          s.name,
          b.name as bmcName,
          COUNT(DISTINCT f.id) as farmerCount,
          COUNT(DISTINCT mc.id) as collections,
          COALESCE(SUM(mc.quantity), 0) as totalQuantity,
          COALESCE(SUM(mc.total_amount), 0) as totalRevenue,
          COALESCE(
            CASE 
              WHEN SUM(mc.quantity) > 0 
              THEN ROUND(SUM(mc.fat_percentage * mc.quantity) / SUM(mc.quantity), 2)
              ELSE 0 
            END, 0
          ) as avgFat,
          COALESCE(
            CASE 
              WHEN SUM(mc.quantity) > 0 
              THEN ROUND(SUM(mc.snf_percentage * mc.quantity) / SUM(mc.quantity), 2)
              ELSE 0 
            END, 0
          ) as avgSnf
        FROM \`${E}\`.\`societies\` s
        LEFT JOIN \`${E}\`.\`bmcs\` b ON s.bmc_id = b.id
        LEFT JOIN \`${E}\`.\`farmers\` f ON f.society_id = s.id
        LEFT JOIN \`${E}\`.\`milk_collections\` mc ON mc.society_id = s.id
          AND mc.collection_date >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)
        WHERE b.dairy_farm_id = ?
        GROUP BY s.id, s.society_id, s.name, b.name
        HAVING totalQuantity > 0
        ORDER BY totalQuantity DESC
        LIMIT 10
      `,{replacements:[n]}),console.log(`[Dairy Details API] Found ${I.length} top societies`)}catch(e){console.error("[Dairy Details API] Error fetching top societies:",e)}return(0,D.createSuccessResponse)("Dairy details retrieved successfully",{dairy:u,bmcs:y,societies:N,farmers:f,machines:S,collections:C,analytics:T,trends:{daily:A,byShift:R},topPerformers:{farmers:p,societies:I}})}catch(e){return console.error("Error retrieving dairy details:",e),(0,D.createErrorResponse)("Failed to retrieve dairy details",500)}}e.s(["GET",()=>T],221906);var A=e.i(221906);let R=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/user/dairy/[id]/route",pathname:"/api/user/dairy/[id]",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/user/dairy/[id]/route.ts",nextConfigOutput:"",userland:A}),{workAsyncStorage:p,workUnitAsyncStorage:I,serverHooks:h}=R;function b(){return(0,i.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:I})}async function U(e,t,i){R.isDev&&(0,r.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let _="/api/user/dairy/[id]/route";_=_.replace(/\/index$/,"")||"/";let O=await R.prepare(e,t,{srcPage:_,multiZoneDraftMode:!1});if(!O)return t.statusCode=400,t.end("Bad Request"),null==i.waitUntil||i.waitUntil.call(i,Promise.resolve()),null;let{buildId:D,params:T,nextConfig:A,parsedUrl:p,isDraftMode:I,prerenderManifest:h,routerServerContext:b,isOnDemandRevalidate:U,revalidateOnlyGenerated:g,resolvedPathname:L,clientReferenceManifest:M,serverActionsManifest:F}=O,q=(0,c.normalizeAppPath)(_),$=!!(h.dynamicRoutes[q]||h.routes[L]),v=async()=>((null==b?void 0:b.render404)?await b.render404(e,t,p,!1):t.end("This page could not be found"),null);if($&&!I){let e=!!h.routes[L],t=h.dynamicRoutes[q];if(t&&!1===t.fallback&&!e){if(A.experimental.adapterPath)return await v();throw new S.NoFallbackError}}let P=null;!$||R.isDev||I||(P="/index"===(P=L)?"/":P);let H=!0===R.isDev||!$,w=$&&!H;F&&M&&(0,n.setReferenceManifestsSingleton)({page:_,clientReferenceManifest:M,serverActionsManifest:F,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:F})});let B=e.method||"GET",J=(0,s.getTracer)(),x=J.getActiveScopeSpan(),W={params:T,prerenderManifest:h,renderOpts:{experimental:{authInterrupts:!!A.experimental.authInterrupts},cacheComponents:!!A.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,r.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:A.cacheLife,waitUntil:i.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,i)=>R.onRequestError(e,t,i,b)},sharedContext:{buildId:D}},Y=new l.NodeNextRequest(e),k=new l.NodeNextResponse(t),V=d.NextRequestAdapter.fromNodeNextRequest(Y,(0,d.signalFromNodeResponse)(t));try{let n=async e=>R.handle(V,W).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=J.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=a.get("next.route");if(i){let t=`${B} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${B} ${_}`)}),o=!!(0,r.getRequestMeta)(e,"minimalMode"),c=async r=>{var s,c;let l=async({previousCacheEntry:a})=>{try{if(!o&&U&&g&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await n(r);e.fetchMetrics=W.renderOpts.fetchMetrics;let c=W.renderOpts.pendingWaitUntil;c&&i.waitUntil&&(i.waitUntil(c),c=void 0);let l=W.renderOpts.collectedTags;if(!$)return await (0,u.sendResponse)(Y,k,s,W.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,y.toNodeOutgoingHttpHeaders)(s.headers);l&&(t[f.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==W.renderOpts.collectedRevalidate&&!(W.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&W.renderOpts.collectedRevalidate,i=void 0===W.renderOpts.collectedExpire||W.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:W.renderOpts.collectedExpire;return{value:{kind:C.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:i}}}}catch(t){throw(null==a?void 0:a.isStale)&&await R.onRequestError(e,t,{routerKind:"App Router",routePath:_,routeType:"route",revalidateReason:(0,E.getRevalidateReason)({isStaticGeneration:w,isOnDemandRevalidate:U})},b),t}},d=await R.handleResponse({req:e,nextConfig:A,cacheKey:P,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:h,isRoutePPREnabled:!1,isOnDemandRevalidate:U,revalidateOnlyGenerated:g,responseGenerator:l,waitUntil:i.waitUntil,isMinimalMode:o});if(!$)return null;if((null==d||null==(s=d.value)?void 0:s.kind)!==C.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(c=d.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",U?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),I&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,y.fromNodeOutgoingHttpHeaders)(d.value.headers);return o&&$||m.delete(f.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,N.getCacheControlHeader)(d.cacheControl)),await (0,u.sendResponse)(Y,k,new Response(d.value.body,{headers:m,status:d.value.status||200})),null};x?await c(x):await J.withPropagatedContext(e.headers,()=>J.trace(m.BaseServerSpan.handleRequest,{spanName:`${B} ${_}`,kind:s.SpanKind.SERVER,attributes:{"http.method":B,"http.target":e.url}},c))}catch(t){if(t instanceof S.NoFallbackError||await R.onRequestError(e,t,{routerKind:"App Router",routePath:q,routeType:"route",revalidateReason:(0,E.getRevalidateReason)({isStaticGeneration:w,isOnDemandRevalidate:U})}),$)throw t;return await (0,u.sendResponse)(Y,k,new Response(null,{status:500})),null}}e.s(["handler",()=>U,"patchFetch",()=>b,"routeModule",()=>R,"serverHooks",()=>h,"workAsyncStorage",()=>p,"workUnitAsyncStorage",()=>I],770306)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_b9f35452.js.map