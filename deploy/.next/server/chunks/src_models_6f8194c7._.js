module.exports=[213075,e=>{"use strict";var a,t,l=e.i(191273),s=e.i(449632),i=((a={}).SUPER_ADMIN="super_admin",a.ADMIN="admin",a.DAIRY="dairy",a.BMC="bmc",a.SOCIETY="society",a.FARMER="farmer",a),o=((t={}).PENDING="pending",t.PENDING_APPROVAL="pending_approval",t.ACTIVE="active",t.INACTIVE="inactive",t.SUSPENDED="suspended",t);class n extends l.Model{async comparePassword(e){return s.default.compare(e,this.password)}async incLoginAttempts(){if(this.lockUntil&&this.lockUntil<new Date)return void await this.update({loginAttempts:1,lockUntil:void 0});let e={loginAttempts:this.loginAttempts+1};this.loginAttempts+1>=5&&!this.isLocked&&(e.lockUntil=new Date(Date.now()+72e5)),await this.update(e)}async resetLoginAttempts(){await this.update({loginAttempts:0,lockUntil:void 0})}get isLocked(){return!!(this.lockUntil&&this.lockUntil>new Date)}canManageRole(e){let a=["super_admin","admin","dairy","bmc","society","farmer"];return a.indexOf(this.role)<a.indexOf(e)}}e.s(["UserRole",()=>i,"UserStatus",()=>o,"default",0,n,"initUserModel",0,e=>(n.init({id:{type:l.DataTypes.INTEGER,primaryKey:!0,autoIncrement:!0},uid:{type:l.DataTypes.STRING(50),allowNull:!1,unique:!0,validate:{notEmpty:!0,len:[3,50]}},email:{type:l.DataTypes.STRING(255),allowNull:!1,unique:!0,validate:{isEmail:!0,notEmpty:!0}},password:{type:l.DataTypes.STRING(255),allowNull:!1,validate:{notEmpty:!0,len:[6,255]}},fullName:{type:l.DataTypes.STRING(200),allowNull:!1,validate:{notEmpty:!0,len:[2,200]}},role:{type:l.DataTypes.ENUM(...Object.values(i)),allowNull:!1,defaultValue:"farmer"},status:{type:l.DataTypes.ENUM(...Object.values(o)),allowNull:!1,defaultValue:"pending"},dbKey:{type:l.DataTypes.STRING(50),allowNull:!0,unique:!0,comment:"Dedicated database schema key for admins"},companyName:{type:l.DataTypes.STRING(255),allowNull:!0},companyPincode:{type:l.DataTypes.STRING(10),allowNull:!0,validate:{len:[5,10]}},companyCity:{type:l.DataTypes.STRING(100),allowNull:!0,validate:{len:[2,100]}},companyState:{type:l.DataTypes.STRING(100),allowNull:!0,validate:{len:[2,100]}},parentId:{type:l.DataTypes.INTEGER,allowNull:!0,references:{model:"users",key:"id"}},isEmailVerified:{type:l.DataTypes.BOOLEAN,allowNull:!1,defaultValue:!1},emailVerificationToken:{type:l.DataTypes.STRING(255),allowNull:!0},emailVerificationExpires:{type:l.DataTypes.DATE,allowNull:!0},passwordResetToken:{type:l.DataTypes.STRING(255),allowNull:!0},passwordResetExpires:{type:l.DataTypes.DATE,allowNull:!0},otpCode:{type:l.DataTypes.STRING(10),allowNull:!0},otpExpires:{type:l.DataTypes.DATE,allowNull:!0},lastLogin:{type:l.DataTypes.DATE,allowNull:!0},loginAttempts:{type:l.DataTypes.INTEGER,allowNull:!1,defaultValue:0},lockUntil:{type:l.DataTypes.DATE,allowNull:!0}},{sequelize:e,modelName:"User",tableName:"users",timestamps:!0,hooks:{beforeSave:async e=>{if(e.changed("password")&&e.password){let a=await s.default.genSalt(12);e.password=await s.default.hash(e.password,a)}if(!e.uid&&e.email){let a=Date.now().toString().slice(-6),t=e.email.substring(0,3).toUpperCase();e.uid=`${t}${a}`}}}}),n.hasMany(n,{as:"Children",foreignKey:"parentId",onDelete:"SET NULL"}),n.belongsTo(n,{as:"Parent",foreignKey:"parentId",onDelete:"SET NULL"}),n)])},180725,553146,e=>{"use strict";var a=e.i(84168),t=e.i(213075),l=e.i(191273);class s extends l.Model{id;adminId;schemaKey;schemaName;status;configuration;createdAt;updatedAt;static associate(e){s.belongsTo(e.User,{foreignKey:"adminId",as:"admin"})}}var i=l;class o extends i.Model{id;userId;action;resource;resourceId;oldValues;newValues;ipAddress;userAgent;timestamp;static associate(e){o.belongsTo(e.User,{foreignKey:"userId",as:"user"})}}var n=l;class p extends n.Model{id;machineType;description;isActive}let d=e=>(p.init({id:{type:n.DataTypes.INTEGER,autoIncrement:!0,primaryKey:!0},machineType:{type:n.DataTypes.STRING(100),allowNull:!1,unique:!0,field:"machine_type",validate:{notEmpty:!0,len:[1,100]},comment:"Machine type/model identifier"},description:{type:n.DataTypes.TEXT,allowNull:!0,comment:"Optional description of the machine type"},isActive:{type:n.DataTypes.BOOLEAN,allowNull:!1,defaultValue:!0,field:"is_active",comment:"Whether this machine type is active"}},{sequelize:e,modelName:"Machine",tableName:"machinetype",timestamps:!1,indexes:[{unique:!0,fields:["machine_type"]},{fields:["is_active"]}]}),p);e.s(["Machine",()=>p,"default",0,p,"initMachineModel",0,d],553146),e.s(["getModels",0,()=>{let e=(0,a.default)();if(!e)throw Error("Database not initialized");let n=(0,t.initUserModel)(e),p=(s.init({id:{type:l.DataTypes.INTEGER,autoIncrement:!0,primaryKey:!0},adminId:{type:l.DataTypes.INTEGER,allowNull:!1,references:{model:"Users",key:"id"}},schemaKey:{type:l.DataTypes.STRING(50),allowNull:!1,unique:!0},schemaName:{type:l.DataTypes.STRING(255),allowNull:!1},status:{type:l.DataTypes.ENUM("active","inactive","suspended","maintenance"),allowNull:!1,defaultValue:"active"},configuration:{type:l.DataTypes.JSON,allowNull:!0}},{sequelize:e,modelName:"AdminSchema",tableName:"AdminSchemas",timestamps:!0,indexes:[{fields:["adminId"]},{fields:["schemaKey"]},{fields:["status"]}]}),s),y=(o.init({id:{type:i.DataTypes.INTEGER,autoIncrement:!0,primaryKey:!0},userId:{type:i.DataTypes.INTEGER,allowNull:!0,references:{model:"Users",key:"id"}},action:{type:i.DataTypes.STRING(100),allowNull:!1},resource:{type:i.DataTypes.STRING(100),allowNull:!1},resourceId:{type:i.DataTypes.STRING(50),allowNull:!0},oldValues:{type:i.DataTypes.JSON,allowNull:!0},newValues:{type:i.DataTypes.JSON,allowNull:!0},ipAddress:{type:i.DataTypes.STRING(45),allowNull:!0},userAgent:{type:i.DataTypes.TEXT,allowNull:!0},timestamp:{type:i.DataTypes.DATE,allowNull:!1,defaultValue:i.DataTypes.NOW}},{sequelize:e,modelName:"AuditLog",tableName:"AuditLogs",timestamps:!1,indexes:[{fields:["userId"]},{fields:["action"]},{fields:["resource"]},{fields:["resourceId"]},{fields:["timestamp"]},{fields:["ipAddress"]}]}),o),r=d(e),u={User:n,AdminSchema:p,AuditLog:y,Machine:r};return n.associate&&n.associate(u),p.associate&&p.associate(u),y.associate&&y.associate(u),{User:n,AdminSchema:p,AuditLog:y,Machine:r,sequelize:e}}],180725)},540590,e=>{"use strict";var a=e.i(180725),t=e.i(213075),l=e.i(553146);e.s(["Machine",()=>l.Machine,"UserRole",()=>t.UserRole,"UserStatus",()=>t.UserStatus,"getModels",()=>a.getModels,"initMachineModel",()=>l.initMachineModel,"initUserModel",()=>t.initUserModel])}];

//# sourceMappingURL=src_models_6f8194c7._.js.map