module.exports=[444406,e=>{"use strict";var t=e.i(747909),a=e.i(174017),r=e.i(996250),i=e.i(759756),s=e.i(561916),o=e.i(114444),n=e.i(837092),c=e.i(869741),l=e.i(316795),d=e.i(487718),E=e.i(995169),u=e.i(47587),m=e.i(666012),p=e.i(570101),R=e.i(626937),h=e.i(10372),N=e.i(193695);e.i(52474);var y=e.i(600220),C=e.i(79832),_=e.i(84168),T=e.i(48798);async function f(t){try{let a=t.headers.get("authorization")?.replace("Bearer ","");if(!a)return(0,T.createErrorResponse)("Authentication required",401);let r=(0,C.verifyToken)(a);if(!r||"admin"!==r.role)return(0,T.createErrorResponse)("Admin access required",403);let{name:i,password:s,bmcId:o,dairyFarmId:n,location:c,contactPerson:l,phone:d,email:E,capacity:u,status:m,monthlyTarget:p}=await t.json();if(!i||!s||!o)return(0,T.createErrorResponse)("Name, password, and BMC ID are required",400);await (0,_.connectDB)();let{getModels:R}=await e.A(121985),{sequelize:h,User:N}=R(),y=await N.findByPk(r.id);if(!y||!y.dbKey)return(0,T.createErrorResponse)("Admin schema not found",404);let f=y.fullName.replace(/[^a-zA-Z0-9]/g,"").toLowerCase(),A=`${f}_${y.dbKey.toLowerCase()}`,O=`
      INSERT INTO \`${A}\`.\`bmcs\` 
      (name, bmc_id, password, dairy_farm_id, location, contactPerson, phone, email, capacity, status, monthly_target) 
      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `;return await h.query(O,{replacements:[i,o,s,n||null,c||null,l||null,d||null,E||null,u||2e3,m||"active",p||2e3]}),console.log(`✅ BMC added successfully to schema: ${A}`),(0,T.createSuccessResponse)("BMC added successfully",{bmcId:o,name:i,dairyFarmId:n,location:c,contactPerson:l,capacity:u||2e3,status:m||"active",monthlyTarget:p||2e3})}catch(e){if(console.error("Error adding BMC:",e),e instanceof Error&&"SequelizeUniqueConstraintError"===e.name)return(0,T.createErrorResponse)("BMC ID already exists",409);return(0,T.createErrorResponse)("Failed to add BMC",500)}}async function A(t){try{let a=t.headers.get("authorization")?.replace("Bearer ","");if(!a)return(0,T.createErrorResponse)("Authentication required",401);let r=(0,C.verifyToken)(a);if(!r||"admin"!==r.role)return(0,T.createErrorResponse)("Admin access required",403);await (0,_.connectDB)();let{getModels:i}=await e.A(121985),{sequelize:s,User:o}=i(),n=await o.findByPk(r.id);if(!n||!n.dbKey)return(0,T.createErrorResponse)("Admin schema not found",404);let c=n.fullName.replace(/[^a-zA-Z0-9]/g,"").toLowerCase(),l=`${c}_${n.dbKey.toLowerCase()}`,[d]=await s.query(`
      SELECT 
        b.id, 
        b.name, 
        b.bmc_id as bmcId,
        b.dairy_farm_id as dairyFarmId,
        d.name as dairyFarmName,
        b.location, 
        b.contactPerson, 
        b.phone, 
        b.email,
        b.capacity,
        b.status,
        b.monthly_target as monthlyTarget,
        b.created_at as createdAt, 
        b.updated_at as updatedAt,
        
        -- Society count
        (SELECT COUNT(*) FROM \`${l}\`.\`societies\` WHERE bmc_id = b.id) as societyCount,
        
        -- Farmer count (across all societies in this BMC)
        (SELECT COUNT(*) FROM \`${l}\`.\`farmers\` f 
         INNER JOIN \`${l}\`.\`societies\` s ON f.society_id = s.id 
         WHERE s.bmc_id = b.id) as farmerCount,
        
        -- Total collections (30 days)
        (SELECT COUNT(*) FROM \`${l}\`.\`milk_collections\` mc
         INNER JOIN \`${l}\`.\`societies\` s ON mc.society_id = s.id
         WHERE s.bmc_id = b.id 
         AND mc.collection_date >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)) as totalCollections30d,
        
        -- Total quantity (30 days)
        (SELECT COALESCE(SUM(mc.quantity), 0) FROM \`${l}\`.\`milk_collections\` mc
         INNER JOIN \`${l}\`.\`societies\` s ON mc.society_id = s.id
         WHERE s.bmc_id = b.id 
         AND mc.collection_date >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)) as totalQuantity30d,
        
        -- Total amount/revenue (30 days)
        (SELECT COALESCE(SUM(mc.total_amount), 0) FROM \`${l}\`.\`milk_collections\` mc
         INNER JOIN \`${l}\`.\`societies\` s ON mc.society_id = s.id
         WHERE s.bmc_id = b.id 
         AND mc.collection_date >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)) as totalAmount30d,
        
        -- Weighted Fat (30 days)
        (SELECT COALESCE(
          CASE 
            WHEN SUM(mc.quantity) > 0 
            THEN ROUND(SUM(mc.fat_percentage * mc.quantity) / SUM(mc.quantity), 2)
            ELSE 0 
          END, 0)
         FROM \`${l}\`.\`milk_collections\` mc
         INNER JOIN \`${l}\`.\`societies\` s ON mc.society_id = s.id
         WHERE s.bmc_id = b.id 
         AND mc.collection_date >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)) as weightedFat30d,
        
        -- Weighted SNF (30 days)
        (SELECT COALESCE(
          CASE 
            WHEN SUM(mc.quantity) > 0 
            THEN ROUND(SUM(mc.snf_percentage * mc.quantity) / SUM(mc.quantity), 2)
            ELSE 0 
          END, 0)
         FROM \`${l}\`.\`milk_collections\` mc
         INNER JOIN \`${l}\`.\`societies\` s ON mc.society_id = s.id
         WHERE s.bmc_id = b.id 
         AND mc.collection_date >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)) as weightedSnf30d,
        
        -- Weighted CLR (30 days)
        (SELECT COALESCE(
          CASE 
            WHEN SUM(mc.quantity) > 0 
            THEN ROUND(SUM(mc.clr_value * mc.quantity) / SUM(mc.quantity), 2)
            ELSE 0 
          END, 0)
         FROM \`${l}\`.\`milk_collections\` mc
         INNER JOIN \`${l}\`.\`societies\` s ON mc.society_id = s.id
         WHERE s.bmc_id = b.id 
         AND mc.collection_date >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)) as weightedClr30d,
        
        -- Weighted Water (30 days)
        (SELECT COALESCE(
          CASE 
            WHEN SUM(CASE WHEN mc.water_percentage IS NOT NULL THEN mc.quantity ELSE 0 END) > 0 
            THEN ROUND(
              SUM(CASE WHEN mc.water_percentage IS NOT NULL THEN mc.water_percentage * mc.quantity ELSE 0 END) / 
              SUM(CASE WHEN mc.water_percentage IS NOT NULL THEN mc.quantity ELSE 0 END), 
              2
            )
            ELSE 0 
          END, 0)
         FROM \`${l}\`.\`milk_collections\` mc
         INNER JOIN \`${l}\`.\`societies\` s ON mc.society_id = s.id
         WHERE s.bmc_id = b.id 
         AND mc.collection_date >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)) as weightedWater30d,
        
        -- Dispatch metrics (30 days)
        (SELECT COUNT(*) FROM \`${l}\`.\`milk_dispatches\` md
         INNER JOIN \`${l}\`.\`societies\` s ON md.society_id = s.id
         WHERE s.bmc_id = b.id 
         AND md.dispatch_date >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)) as totalDispatches30d,
        
        (SELECT COALESCE(SUM(md.quantity), 0) FROM \`${l}\`.\`milk_dispatches\` md
         INNER JOIN \`${l}\`.\`societies\` s ON md.society_id = s.id
         WHERE s.bmc_id = b.id 
         AND md.dispatch_date >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)) as dispatchedQuantity30d,
        
        -- Sales metrics (30 days)
        (SELECT COUNT(*) FROM \`${l}\`.\`milk_sales\` ms
         INNER JOIN \`${l}\`.\`societies\` s ON ms.society_id = s.id
         WHERE s.bmc_id = b.id 
         AND ms.sales_date >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)) as totalSales30d,
        
        (SELECT COALESCE(SUM(ms.total_amount), 0) FROM \`${l}\`.\`milk_sales\` ms
         INNER JOIN \`${l}\`.\`societies\` s ON ms.society_id = s.id
         WHERE s.bmc_id = b.id 
         AND ms.sales_date >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)) as salesAmount30d
        
      FROM \`${l}\`.\`bmcs\` b
      LEFT JOIN \`${l}\`.\`dairy_farms\` d ON d.id = b.dairy_farm_id
      ORDER BY b.created_at DESC
    `);return(0,T.createSuccessResponse)("BMCs retrieved successfully",d)}catch(e){return console.error("Error retrieving BMCs:",e),(0,T.createErrorResponse)("Failed to retrieve BMCs",500)}}async function O(t){try{let a=t.headers.get("authorization")?.replace("Bearer ","");if(!a)return(0,T.createErrorResponse)("Authentication required",401);let r=(0,C.verifyToken)(a);if(!r||"admin"!==r.role)return(0,T.createErrorResponse)("Admin access required",403);let{id:i,newBmcId:s,deleteAll:o,otp:n}=await t.json();if(!i)return(0,T.createErrorResponse)("BMC ID is required",400);if(!n)return(0,T.createErrorResponse)("OTP verification required for BMC deletion",400,{requiresOTP:!0});await (0,_.connectDB)();let{getModels:c}=await e.A(121985),{sequelize:l,User:d}=c(),E=await d.findByPk(r.id);if(!E||!E.dbKey)return(0,T.createErrorResponse)("Admin schema not found",404);let u=E.fullName.replace(/[^a-zA-Z0-9]/g,"").toLowerCase(),m=`${u}_${E.dbKey.toLowerCase()}`,[p]=await l.query(`
      SELECT id, name FROM \`${m}\`.\`bmcs\` WHERE id = ?
    `,{replacements:[i]});if(!p||0===p.length)return(0,T.createErrorResponse)("BMC not found",404);let[R]=await l.query(`
      SELECT COUNT(*) as count FROM \`${m}\`.\`societies\` WHERE bmc_id = ?
    `,{replacements:[i]}),h=R[0]?.count||0;if(h>0&&!s&&!o)return(0,T.createErrorResponse)("Cannot delete BMC with active societies. Transfer societies or use delete all option.",400,{hasSocieties:!0,societyCount:h});if(o&&h>0){let{verifyDeleteOTP:t}=await e.A(396168);if(!t(r.id,i,n))return(0,T.createErrorResponse)("Invalid or expired OTP. Please request a new one.",400);console.log(`⚠️  OTP verified! Cascade deleting all data under BMC ${i}...`);let[a]=await l.query(`
        SELECT id FROM \`${m}\`.\`societies\` WHERE bmc_id = ?
      `,{replacements:[i]}),s=a.map(e=>e.id);if(s.length>0){await l.query(`
          DELETE FROM \`${m}\`.\`milk_collections\` 
          WHERE farmer_id IN (
            SELECT id FROM \`${m}\`.\`farmers\` WHERE society_id IN (?)
          )
        `,{replacements:[s]}),console.log(`✅ Deleted milk collections`),await l.query(`
          DELETE FROM \`${m}\`.\`milk_sales\` WHERE society_id IN (?)
        `,{replacements:[s]}),console.log(`✅ Deleted milk sales`),await l.query(`
          DELETE FROM \`${m}\`.\`milk_dispatches\` WHERE society_id IN (?)
        `,{replacements:[s]}),console.log(`✅ Deleted milk dispatches`),await l.query(`
          DELETE FROM \`${m}\`.\`section_pulse\` WHERE society_id IN (?)
        `,{replacements:[s]}),console.log(`✅ Deleted section pulse data`);let[e]=await l.query(`
          SELECT id FROM \`${m}\`.\`rate_charts\` WHERE society_id IN (?)
        `,{replacements:[s]}),t=e.map(e=>e.id);t.length>0&&(await l.query(`
            DELETE FROM \`${m}\`.\`rate_chart_download_history\` WHERE rate_chart_id IN (?)
          `,{replacements:[t]}),console.log(`✅ Deleted rate chart download history`),await l.query(`
            DELETE FROM \`${m}\`.\`rate_chart_data\` WHERE rate_chart_id IN (?)
          `,{replacements:[t]}),console.log(`✅ Deleted rate chart data`),await l.query(`
            DELETE FROM \`${m}\`.\`rate_charts\` WHERE id IN (?)
          `,{replacements:[t]}),console.log(`✅ Deleted rate charts`)),await l.query(`
          DELETE FROM \`${m}\`.\`machine_statistics\` WHERE society_id IN (?)
        `,{replacements:[s]}),console.log(`✅ Deleted machine statistics`),await l.query(`
          DELETE FROM \`${m}\`.\`machine_corrections\` WHERE society_id IN (?)
        `,{replacements:[s]}),console.log(`✅ Deleted machine corrections`),await l.query(`
          DELETE FROM \`${m}\`.\`machine_corrections_from_machine\` WHERE society_id IN (?)
        `,{replacements:[s]}),console.log(`✅ Deleted machine corrections from device`),await l.query(`
          DELETE FROM \`${m}\`.\`farmers\` WHERE society_id IN (?)
        `,{replacements:[s]}),console.log(`✅ Deleted farmers`),await l.query(`
          DELETE FROM \`${m}\`.\`machines\` WHERE society_id IN (?)
        `,{replacements:[s]}),console.log(`✅ Deleted machines`),await l.query(`
          DELETE FROM \`${m}\`.\`societies\` WHERE id IN (?)
        `,{replacements:[s]}),console.log(`✅ Deleted societies`),console.log(`✅ Cascade deleted all data: ${s.length} societies and all related data`)}}if(s&&h>0&&!o){let{verifyDeleteOTP:t}=await e.A(396168);if(!t(r.id,i,n))return(0,T.createErrorResponse)("Invalid or expired OTP. Please request a new one.",400);console.log(`✅ OTP verified for BMC ${i} transfer operation`);let[a]=await l.query(`
        SELECT id, name FROM \`${m}\`.\`bmcs\` WHERE id = ?
      `,{replacements:[s]});if(!a||0===a.length)return(0,T.createErrorResponse)("Target BMC not found",404);await l.query(`
        UPDATE \`${m}\`.\`societies\` SET bmc_id = ? WHERE bmc_id = ?
      `,{replacements:[s,i]}),console.log(`✅ Transferred ${h} societies from BMC ${i} to BMC ${s}`)}if(!o&&!s&&n){let{verifyDeleteOTP:t}=await e.A(396168);if(!t(r.id,i,n))return(0,T.createErrorResponse)("Invalid or expired OTP. Please request a new one.",400);console.log(`✅ OTP verified for BMC ${i} deletion`)}return await l.query(`
      DELETE FROM \`${m}\`.\`bmcs\` WHERE id = ?
    `,{replacements:[i]}),console.log(`✅ BMC deleted successfully from schema: ${m}`),(0,T.createSuccessResponse)("BMC deleted successfully",{transferredSocieties:o?0:h,deletedAll:o||!1})}catch(e){return console.error("Error deleting BMC:",e),(0,T.createErrorResponse)("Failed to delete BMC",500)}}async function S(t){try{let a=t.headers.get("authorization")?.replace("Bearer ","");if(!a)return(0,T.createErrorResponse)("Authentication required",401);let r=(0,C.verifyToken)(a);if(!r||"admin"!==r.role)return(0,T.createErrorResponse)("Admin access required",403);let{id:i,name:s,password:o,dairyFarmId:n,location:c,contactPerson:l,phone:d,email:E,capacity:u,status:m,monthlyTarget:p}=await t.json();if(!i)return(0,T.createErrorResponse)("BMC ID is required",400);await (0,_.connectDB)();let{getModels:R}=await e.A(121985),{sequelize:h,User:N}=R(),y=await N.findByPk(r.id);if(!y||!y.dbKey)return(0,T.createErrorResponse)("Admin schema not found",404);let f=y.fullName.replace(/[^a-zA-Z0-9]/g,"").toLowerCase(),A=`${f}_${y.dbKey.toLowerCase()}`,[O]=await h.query(`
      SELECT id FROM \`${A}\`.\`bmcs\` WHERE id = ?
    `,{replacements:[i]});if(!O||0===O.length)return(0,T.createErrorResponse)("BMC not found",404);let S=[],D=[];if(void 0!==s&&(S.push("name = ?"),D.push(s)),void 0!==n&&(S.push("dairy_farm_id = ?"),D.push(n||null)),void 0!==c&&(S.push("location = ?"),D.push(c||null)),void 0!==l&&(S.push("contactPerson = ?"),D.push(l||null)),void 0!==d&&(S.push("phone = ?"),D.push(d||null)),void 0!==E&&(S.push("email = ?"),D.push(E||null)),void 0!==u&&(S.push("capacity = ?"),D.push(u||null)),void 0!==m&&(S.push("status = ?"),D.push(m)),void 0!==p&&(S.push("monthly_target = ?"),D.push(p||null)),void 0!==o&&""!==o&&(S.push("password = ?"),D.push(o)),0===S.length)return(0,T.createErrorResponse)("No fields to update",400);return S.push("updated_at = NOW()"),D.push(i),await h.query(`
      UPDATE \`${A}\`.\`bmcs\`
      SET ${S.join(", ")}
      WHERE id = ?
    `,{replacements:D}),console.log(`✅ BMC updated successfully in schema: ${A}`),(0,T.createSuccessResponse)("BMC updated successfully")}catch(e){return console.error("Error updating BMC:",e),(0,T.createErrorResponse)("Failed to update BMC",500)}}e.s(["DELETE",()=>O,"GET",()=>A,"POST",()=>f,"PUT",()=>S],868105);var D=e.i(868105);let w=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/user/bmc/route",pathname:"/api/user/bmc",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/user/bmc/route.ts",nextConfigOutput:"",userland:D}),{workAsyncStorage:g,workUnitAsyncStorage:M,serverHooks:b}=w;function L(){return(0,r.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:M})}async function I(e,t,r){w.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let C="/api/user/bmc/route";C=C.replace(/\/index$/,"")||"/";let _=await w.prepare(e,t,{srcPage:C,multiZoneDraftMode:!1});if(!_)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:T,params:f,nextConfig:A,parsedUrl:O,isDraftMode:S,prerenderManifest:D,routerServerContext:g,isOnDemandRevalidate:M,revalidateOnlyGenerated:b,resolvedPathname:L,clientReferenceManifest:I,serverActionsManifest:$}=_,v=(0,c.normalizeAppPath)(C),U=!!(D.dynamicRoutes[v]||D.routes[L]),q=async()=>((null==g?void 0:g.render404)?await g.render404(e,t,O,!1):t.end("This page could not be found"),null);if(U&&!S){let e=!!D.routes[L],t=D.dynamicRoutes[v];if(t&&!1===t.fallback&&!e){if(A.experimental.adapterPath)return await q();throw new N.NoFallbackError}}let H=null;!U||w.isDev||S||(H="/index"===(H=L)?"/":H);let B=!0===w.isDev||!U,F=U&&!B;$&&I&&(0,o.setReferenceManifestsSingleton)({page:C,clientReferenceManifest:I,serverActionsManifest:$,serverModuleMap:(0,n.createServerModuleMap)({serverActionsManifest:$})});let W=e.method||"GET",P=(0,s.getTracer)(),k=P.getActiveScopeSpan(),x={params:f,prerenderManifest:D,renderOpts:{experimental:{authInterrupts:!!A.experimental.authInterrupts},cacheComponents:!!A.cacheComponents,supportsDynamicResponse:B,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:A.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r)=>w.onRequestError(e,t,r,g)},sharedContext:{buildId:T}},K=new l.NodeNextRequest(e),V=new l.NodeNextResponse(t),J=d.NextRequestAdapter.fromNodeNextRequest(K,(0,d.signalFromNodeResponse)(t));try{let o=async e=>w.handle(J,x).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=P.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==E.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${W} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${W} ${C}`)}),n=!!(0,i.getRequestMeta)(e,"minimalMode"),c=async i=>{var s,c;let l=async({previousCacheEntry:a})=>{try{if(!n&&M&&b&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await o(i);e.fetchMetrics=x.renderOpts.fetchMetrics;let c=x.renderOpts.pendingWaitUntil;c&&r.waitUntil&&(r.waitUntil(c),c=void 0);let l=x.renderOpts.collectedTags;if(!U)return await (0,m.sendResponse)(K,V,s,x.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,p.toNodeOutgoingHttpHeaders)(s.headers);l&&(t[h.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==x.renderOpts.collectedRevalidate&&!(x.renderOpts.collectedRevalidate>=h.INFINITE_CACHE)&&x.renderOpts.collectedRevalidate,r=void 0===x.renderOpts.collectedExpire||x.renderOpts.collectedExpire>=h.INFINITE_CACHE?void 0:x.renderOpts.collectedExpire;return{value:{kind:y.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await w.onRequestError(e,t,{routerKind:"App Router",routePath:C,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:M})},g),t}},d=await w.handleResponse({req:e,nextConfig:A,cacheKey:H,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:D,isRoutePPREnabled:!1,isOnDemandRevalidate:M,revalidateOnlyGenerated:b,responseGenerator:l,waitUntil:r.waitUntil,isMinimalMode:n});if(!U)return null;if((null==d||null==(s=d.value)?void 0:s.kind)!==y.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(c=d.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});n||t.setHeader("x-nextjs-cache",M?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),S&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let E=(0,p.fromNodeOutgoingHttpHeaders)(d.value.headers);return n&&U||E.delete(h.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||E.get("Cache-Control")||E.set("Cache-Control",(0,R.getCacheControlHeader)(d.cacheControl)),await (0,m.sendResponse)(K,V,new Response(d.value.body,{headers:E,status:d.value.status||200})),null};k?await c(k):await P.withPropagatedContext(e.headers,()=>P.trace(E.BaseServerSpan.handleRequest,{spanName:`${W} ${C}`,kind:s.SpanKind.SERVER,attributes:{"http.method":W,"http.target":e.url}},c))}catch(t){if(t instanceof N.NoFallbackError||await w.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:M})}),U)throw t;return await (0,m.sendResponse)(K,V,new Response(null,{status:500})),null}}e.s(["handler",()=>I,"patchFetch",()=>L,"routeModule",()=>w,"serverHooks",()=>b,"workAsyncStorage",()=>g,"workUnitAsyncStorage",()=>M],444406)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_e5e83b21.js.map