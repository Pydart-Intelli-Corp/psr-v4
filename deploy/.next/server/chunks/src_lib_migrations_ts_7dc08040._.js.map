{"version":3,"sources":["turbopack:///[project]/src/lib/migrations.ts"],"sourcesContent":["import { exec } from 'child_process';\r\nimport { promisify } from 'util';\r\n\r\nconst execAsync = promisify(exec);\r\n\r\nexport class MigrationRunner {\r\n  constructor() {}\r\n\r\n  /**\r\n   * Run all pending migrations\r\n   */\r\n  async up(): Promise<void> {\r\n    try {\r\n      console.log('üöÄ Running database migrations...');\r\n      const { stdout, stderr } = await execAsync('npx sequelize-cli db:migrate');\r\n      \r\n      if (stderr && !stderr.includes('WARNING')) {\r\n        throw new Error(stderr);\r\n      }\r\n      \r\n      console.log('‚úÖ Migrations completed successfully');\r\n      if (stdout) console.log(stdout);\r\n    } catch (error) {\r\n      console.error('‚ùå Migration failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Rollback last migration\r\n   */\r\n  async down(): Promise<void> {\r\n    try {\r\n      console.log('‚è™ Rolling back last migration...');\r\n      const { stdout, stderr } = await execAsync('npx sequelize-cli db:migrate:undo');\r\n      \r\n      if (stderr && !stderr.includes('WARNING')) {\r\n        throw new Error(stderr);\r\n      }\r\n      \r\n      console.log('‚úÖ Rollback completed successfully');\r\n      if (stdout) console.log(stdout);\r\n    } catch (error) {\r\n      console.error('‚ùå Rollback failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check migration status\r\n   */\r\n  async status(): Promise<void> {\r\n    try {\r\n      console.log('üìä Checking migration status...');\r\n      \r\n      // List executed migrations\r\n      console.log('\\n--- Executed Migrations ---');\r\n      const { stdout: executedStdout } = await execAsync('npx sequelize-cli db:migrate:status');\r\n      console.log(executedStdout || 'No migrations executed yet');\r\n      \r\n    } catch (error) {\r\n      console.error('‚ùå Status check failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get migration status (alias for status method)\r\n   */\r\n  async getMigrationStatus(): Promise<string> {\r\n    try {\r\n      console.log('üìä Getting migration status...');\r\n      const { stdout } = await execAsync('npx sequelize-cli db:migrate:status');\r\n      return stdout || 'No migrations executed yet';\r\n    } catch (error) {\r\n      console.error('‚ùå Get migration status failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Run migrations (alias for up method)\r\n   */\r\n  async runMigrations(): Promise<void> {\r\n    return this.up();\r\n  }\r\n\r\n  /**\r\n   * Undo last migration (alias for down method)  \r\n   */\r\n  async undoLastMigration(): Promise<void> {\r\n    return this.down();\r\n  }\r\n\r\n  /**\r\n   * Run seeders (alias for seed method)\r\n   */\r\n  async runSeeders(): Promise<void> {\r\n    return this.seed();\r\n  }\r\n\r\n  /**\r\n   * Undo all seeders\r\n   */\r\n  async undoSeeders(): Promise<void> {\r\n    try {\r\n      console.log('üîÑ Undoing all seeders...');\r\n      const { stdout, stderr } = await execAsync('npx sequelize-cli db:seed:undo:all');\r\n      \r\n      if (stderr && !stderr.includes('WARNING')) {\r\n        throw new Error(stderr);\r\n      }\r\n      \r\n      console.log('‚úÖ All seeders undone successfully');\r\n      if (stdout) console.log(stdout);\r\n    } catch (error) {\r\n      console.error('‚ùå Undo seeders failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize database (alias for init method)\r\n   */\r\n  async initializeDatabase(): Promise<void> {\r\n    return this.init();\r\n  }\r\n\r\n  /**\r\n   * Seed the database\r\n   */\r\n  async seed(): Promise<void> {\r\n    try {\r\n      console.log('üå± Seeding database...');\r\n      const { stdout, stderr } = await execAsync('npx sequelize-cli db:seed:all');\r\n      \r\n      if (stderr && !stderr.includes('WARNING')) {\r\n        throw new Error(stderr);\r\n      }\r\n      \r\n      console.log('‚úÖ Seeding completed successfully');\r\n      if (stdout) console.log(stdout);\r\n    } catch (error) {\r\n      console.error('‚ùå Seeding failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize database (create + migrate + seed)\r\n   */\r\n  async init(): Promise<void> {\r\n    try {\r\n      console.log('üèóÔ∏è  Initializing database...');\r\n      \r\n      // Create database\r\n      console.log('Creating database...');\r\n      try {\r\n        await execAsync('npx sequelize-cli db:create');\r\n      } catch (createError) {\r\n        // Database might already exist, which is fine\r\n        console.log('Database already exists or creation failed, continuing...');\r\n      }\r\n      \r\n      // Run migrations\r\n      await this.up();\r\n      \r\n      // Run seeds\r\n      await this.seed();\r\n      \r\n      console.log('‚úÖ Database initialization completed successfully');\r\n    } catch (error) {\r\n      console.error('‚ùå Database initialization failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Reset database (drop + create + migrate + seed)\r\n   */\r\n  async reset(): Promise<void> {\r\n    try {\r\n      console.log('üîÑ Resetting database...');\r\n      const { stdout, stderr } = await execAsync('npm run db:reset');\r\n      \r\n      if (stderr && !stderr.includes('WARNING')) {\r\n        throw new Error(stderr);\r\n      }\r\n      \r\n      console.log('‚úÖ Database reset completed successfully');\r\n      if (stdout) console.log(stdout);\r\n    } catch (error) {\r\n      console.error('‚ùå Database reset failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const migrationRunner = new MigrationRunner();"],"names":[],"mappings":"wCAAA,IAAA,EAAA,EAAA,CAAA,CAAA,QAGA,IAAM,EAAY,CAAA,EAFlB,AAEkB,EAFlB,CAAA,CAAA,QAEkB,SAAA,AAAS,EAAC,EAAA,IAAI,CAEzB,OAAM,EACX,aAAc,CAAC,CAKf,MAAM,IAAoB,CACxB,GAAI,CACF,QAAQ,GAAG,CAAC,qCACZ,GAAM,CAAE,QAAM,CAAE,QAAM,CAAE,CAAG,MAAM,EAAU,gCAE3C,GAAI,GAAU,CAAC,EAAO,QAAQ,CAAC,WAC7B,CADyC,KACnC,AAAI,MAAM,GAGlB,QAAQ,GAAG,CAAC,uCACR,GAAQ,QAAQ,GAAG,CAAC,EAC1B,CAAE,MAAO,EAAO,CAEd,MADA,QAAQ,KAAK,CAAC,sBAAuB,GAC/B,CACR,CACF,CAKA,MAAM,MAAsB,CAC1B,GAAI,CACF,QAAQ,GAAG,CAAC,oCACZ,GAAM,CAAE,QAAM,CAAE,QAAM,CAAE,CAAG,MAAM,EAAU,qCAE3C,GAAI,GAAU,CAAC,EAAO,QAAQ,CAAC,WAC7B,CADyC,KACnC,AAAI,MAAM,GAGlB,QAAQ,GAAG,CAAC,qCACR,GAAQ,QAAQ,GAAG,CAAC,EAC1B,CAAE,MAAO,EAAO,CAEd,MADA,QAAQ,KAAK,CAAC,qBAAsB,GAC9B,CACR,CACF,CAKA,MAAM,QAAwB,CAC5B,GAAI,CACF,QAAQ,GAAG,CAAC,mCAGZ,QAAQ,GAAG,CAAC,iCACZ,GAAM,CAAE,OAAQ,CAAc,CAAE,CAAG,MAAM,EAAU,uCACnD,QAAQ,GAAG,CAAC,GAAkB,6BAEhC,CAAE,MAAO,EAAO,CAEd,MADA,QAAQ,KAAK,CAAC,yBAA0B,GAClC,CACR,CACF,CAKA,MAAM,oBAAsC,CAC1C,GAAI,CACF,QAAQ,GAAG,CAAC,kCACZ,GAAM,QAAE,CAAM,CAAE,CAAG,MAAM,EAAU,uCACnC,OAAO,GAAU,4BACnB,CAAE,MAAO,EAAO,CAEd,MADA,QAAQ,KAAK,CAAC,iCAAkC,GAC1C,CACR,CACF,CAKA,MAAM,eAA+B,CACnC,OAAO,IAAI,CAAC,EAAE,EAChB,CAKA,MAAM,mBAAmC,CACvC,OAAO,IAAI,CAAC,IAAI,EAClB,CAKA,MAAM,YAA4B,CAChC,OAAO,IAAI,CAAC,IAAI,EAClB,CAKA,MAAM,aAA6B,CACjC,GAAI,CACF,QAAQ,GAAG,CAAC,6BACZ,GAAM,QAAE,CAAM,QAAE,CAAM,CAAE,CAAG,MAAM,EAAU,sCAE3C,GAAI,GAAU,CAAC,EAAO,QAAQ,CAAC,WAC7B,CADyC,KACnC,AAAI,MAAM,GAGlB,QAAQ,GAAG,CAAC,qCACR,GAAQ,QAAQ,GAAG,CAAC,EAC1B,CAAE,MAAO,EAAO,CAEd,MADA,QAAQ,KAAK,CAAC,yBAA0B,GAClC,CACR,CACF,CAKA,MAAM,oBAAoC,CACxC,OAAO,IAAI,CAAC,IAAI,EAClB,CAKA,MAAM,MAAsB,CAC1B,GAAI,CACF,QAAQ,GAAG,CAAC,0BACZ,GAAM,QAAE,CAAM,QAAE,CAAM,CAAE,CAAG,MAAM,EAAU,iCAE3C,GAAI,GAAU,CAAC,EAAO,QAAQ,CAAC,WAC7B,CADyC,KACnC,AAAI,MAAM,GAGlB,QAAQ,GAAG,CAAC,oCACR,GAAQ,QAAQ,GAAG,CAAC,EAC1B,CAAE,MAAO,EAAO,CAEd,MADA,QAAQ,KAAK,CAAC,oBAAqB,GAC7B,CACR,CACF,CAKA,MAAM,MAAsB,CAC1B,GAAI,CACF,QAAQ,GAAG,CAAC,iCAGZ,QAAQ,GAAG,CAAC,wBACZ,GAAI,CACF,MAAM,EAAU,8BAClB,CAAE,MAAO,EAAa,CAEpB,QAAQ,GAAG,CAAC,4DACd,CAGA,MAAM,IAAI,CAAC,EAAE,GAGb,MAAM,IAAI,CAAC,IAAI,GAEf,QAAQ,GAAG,CAAC,mDACd,CAAE,MAAO,EAAO,CAEd,MADA,QAAQ,KAAK,CAAC,oCAAqC,GAC7C,CACR,CACF,CAKA,MAAM,OAAuB,CAC3B,GAAI,CACF,QAAQ,GAAG,CAAC,4BACZ,GAAM,QAAE,CAAM,QAAE,CAAM,CAAE,CAAG,MAAM,EAAU,oBAE3C,GAAI,GAAU,CAAC,EAAO,QAAQ,CAAC,WAC7B,CADyC,KACnC,AAAI,MAAM,GAGlB,QAAQ,GAAG,CAAC,2CACR,GAAQ,QAAQ,GAAG,CAAC,EAC1B,CAAE,MAAO,EAAO,CAEd,MADA,QAAQ,KAAK,CAAC,2BAA4B,GACpC,CACR,CACF,CACF,CAGO,IAAM,EAAkB,IAAI"}