module.exports=[136543,e=>{"use strict";var t=e.i(89171);e.i(79832),e.i(213075),e.s(["createErrorResponse",0,(e,r=400)=>t.NextResponse.json({success:!1,error:{message:e,code:r.toString()},timestamp:new Date().toISOString()},{status:r}),"createSuccessResponse",0,(e,r="Success",i=200)=>t.NextResponse.json({success:!0,message:r,data:e,timestamp:new Date().toISOString()},{status:i}),"validateRequiredFields",0,(e,t)=>{let r=t.filter(t=>!e[t]||"string"==typeof e[t]&&""===e[t].trim());return r.length>0?{success:!1,missing:r}:{success:!0}}])},233405,(e,t,r)=>{t.exports=e.x("child_process",()=>require("child_process"))},152562,e=>{"use strict";var t=e.i(79832),r=e.i(136543),i=e.i(84168),n=e.i(686599),o=e.i(129508);let s=new Map;async function a(o){try{let a=o.headers.get("authorization")?.replace("Bearer ","");if(!a)return(0,r.createErrorResponse)("Authentication required",401);let d=(0,t.verifyToken)(a);if(!d||"admin"!==d.role)return(0,r.createErrorResponse)("Admin access required",403);let{bmcId:c,bmcName:p}=await o.json();if(!c)return(0,r.createErrorResponse)("BMC ID is required",400);await (0,i.connectDB)();let{getModels:u}=await e.A(121985),{User:h}=u(),m=await h.findByPk(d.id);if(!m)return(0,r.createErrorResponse)("Admin not found",404);let g=(0,n.generateOTP)(),f=new Date(Date.now()+6e5),v=`${m.id}_${c}`;for(let[e,t]of(s.set(v,{otp:g,expires:f,bmcId:c}),s.entries()))t.expires<new Date&&s.delete(e);try{await l(m.email,g,m.fullName,p),console.log(`✅ Delete confirmation OTP sent to ${m.email} for BMC ${p}`)}catch(e){return console.error("Failed to send OTP email:",e),(0,r.createErrorResponse)("Failed to send OTP email",500)}return(0,r.createSuccessResponse)({expiresIn:600},"OTP sent to your email. Please check and verify.")}catch(e){return console.error("Error sending delete OTP:",e),(0,r.createErrorResponse)("Failed to send OTP",500)}}async function l(e,t,r,i){let n={host:process.env.SMTP_HOST||process.env.EMAIL_HOST||"smtp.gmail.com",port:parseInt(process.env.SMTP_PORT||process.env.EMAIL_PORT||"587"),secure:"true"===(process.env.SMTP_SECURE||process.env.EMAIL_SECURE),auth:{user:process.env.SMTP_USERNAME||process.env.EMAIL_USER,pass:process.env.SMTP_PASSWORD||process.env.EMAIL_PASSWORD}},s=o.default.createTransport(n),a={from:`"Poornasree Equipments Cloud" <${process.env.SMTP_USERNAME||process.env.EMAIL_USER}>`,to:e,subject:"⚠️ CRITICAL: BMC Deletion Confirmation Required",html:`
      <div style="max-width: 600px; margin: 0 auto; padding: 20px; font-family: Arial, sans-serif;">
        <div style="background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); padding: 30px; border-radius: 10px; color: white; text-align: center; margin-bottom: 20px;">
          <h1 style="margin: 0; font-size: 28px;">⚠️ Critical Action Required</h1>
          <p style="margin: 10px 0 0 0; opacity: 0.9;">BMC Deletion Confirmation</p>
        </div>
        
        <div style="padding: 20px; background: #fef2f2; border: 2px solid #dc2626; border-radius: 10px;">
          <h2 style="color: #dc2626; margin-top: 0;">Hello ${r}!</h2>
          <p style="color: #666; line-height: 1.6;">
            You have requested to <strong style="color: #dc2626;">permanently delete</strong> the following BMC and all its associated data:
          </p>
          
          <div style="background: white; padding: 15px; border-left: 4px solid #dc2626; margin: 20px 0;">
            <h3 style="margin: 0; color: #dc2626;">${i}</h3>
            <p style="margin: 10px 0 0 0; color: #666; font-size: 14px;">
              This action will delete:
            </p>
            <ul style="color: #666; font-size: 14px; margin: 10px 0;">
              <li>All societies under this BMC</li>
              <li>All farmers</li>
              <li>All machines</li>
              <li>All machine statistics</li>
              <li>All machine corrections (admin & device saved)</li>
              <li>All rate charts and rate chart data</li>
              <li>All milk collections</li>
              <li>All sales records</li>
              <li>All dispatch records</li>
              <li>All section pulse tracking data</li>
            </ul>
            <p style="margin: 10px 0 0 0; color: #dc2626; font-weight: bold; font-size: 14px;">
              ⚠️ THIS ACTION CANNOT BE UNDONE!
            </p>
          </div>
          
          <p style="color: #666; line-height: 1.6;">
            To confirm this deletion, please enter the following OTP:
          </p>
          
          <div style="text-align: center; margin: 30px 0;">
            <div style="display: inline-block; padding: 15px 30px; background: #dc2626; color: white; font-size: 32px; font-weight: bold; letter-spacing: 5px; border-radius: 8px; box-shadow: 0 4px 6px rgba(220, 38, 38, 0.3);">
              ${t}
            </div>
          </div>
          
          <p style="color: #666; line-height: 1.6; font-size: 14px;">
            This OTP is valid for <strong>10 minutes</strong>. If you didn't request this deletion, please ignore this email and contact support immediately.
          </p>
          
          <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #fca5a5; color: #888; font-size: 14px;">
            <p>Best regards,<br>Poornasree Equipments Cloud Team</p>
          </div>
        </div>
      </div>
    `};await s.sendMail(a)}function d(e,t,r){let i=`${e}_${t}`,n=s.get(i);return n?n.expires<new Date?(s.delete(i),console.log("❌ OTP expired"),!1):n.otp!==r?(console.log("❌ Invalid OTP"),!1):(s.delete(i),console.log("✅ OTP verified successfully"),!0):(console.log("❌ No OTP found for this deletion request"),!1)}e.s(["POST",()=>a,"verifyDeleteOTP",()=>d])},741230,e=>{"use strict";var t=e.i(747909),r=e.i(174017),i=e.i(996250),n=e.i(759756),o=e.i(561916),s=e.i(114444),a=e.i(837092),l=e.i(869741),d=e.i(316795),c=e.i(487718),p=e.i(995169),u=e.i(47587),h=e.i(666012),m=e.i(570101),g=e.i(626937),f=e.i(10372),v=e.i(193695);e.i(52474);var R=e.i(600220),x=e.i(152562);let E=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/user/bmc/send-delete-otp/route",pathname:"/api/user/bmc/send-delete-otp",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/user/bmc/send-delete-otp/route.ts",nextConfigOutput:"",userland:x}),{workAsyncStorage:y,workUnitAsyncStorage:w,serverHooks:T}=E;function A(){return(0,i.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:w})}async function P(e,t,i){E.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let x="/api/user/bmc/send-delete-otp/route";x=x.replace(/\/index$/,"")||"/";let y=await E.prepare(e,t,{srcPage:x,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==i.waitUntil||i.waitUntil.call(i,Promise.resolve()),null;let{buildId:w,params:T,nextConfig:A,parsedUrl:P,isDraftMode:C,prerenderManifest:S,routerServerContext:O,isOnDemandRevalidate:b,revalidateOnlyGenerated:_,resolvedPathname:M,clientReferenceManifest:N,serverActionsManifest:I}=y,D=(0,l.normalizeAppPath)(x),q=!!(S.dynamicRoutes[D]||S.routes[M]),k=async()=>((null==O?void 0:O.render404)?await O.render404(e,t,P,!1):t.end("This page could not be found"),null);if(q&&!C){let e=!!S.routes[M],t=S.dynamicRoutes[D];if(t&&!1===t.fallback&&!e){if(A.experimental.adapterPath)return await k();throw new v.NoFallbackError}}let U=null;!q||E.isDev||C||(U="/index"===(U=M)?"/":U);let H=!0===E.isDev||!q,$=q&&!H;I&&N&&(0,s.setReferenceManifestsSingleton)({page:x,clientReferenceManifest:N,serverActionsManifest:I,serverModuleMap:(0,a.createServerModuleMap)({serverActionsManifest:I})});let B=e.method||"GET",j=(0,o.getTracer)(),F=j.getActiveScopeSpan(),L={params:T,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!A.experimental.authInterrupts},cacheComponents:!!A.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:A.cacheLife,waitUntil:i.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,i)=>E.onRequestError(e,t,i,O)},sharedContext:{buildId:w}},z=new d.NodeNextRequest(e),K=new d.NodeNextResponse(t),W=c.NextRequestAdapter.fromNodeNextRequest(z,(0,c.signalFromNodeResponse)(t));try{let s=async e=>E.handle(W,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=j.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=r.get("next.route");if(i){let t=`${B} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${B} ${x}`)}),a=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var o,l;let d=async({previousCacheEntry:r})=>{try{if(!a&&b&&_&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await s(n);e.fetchMetrics=L.renderOpts.fetchMetrics;let l=L.renderOpts.pendingWaitUntil;l&&i.waitUntil&&(i.waitUntil(l),l=void 0);let d=L.renderOpts.collectedTags;if(!q)return await (0,h.sendResponse)(z,K,o,L.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(o.headers);d&&(t[f.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,i=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:i}}}}catch(t){throw(null==r?void 0:r.isStale)&&await E.onRequestError(e,t,{routerKind:"App Router",routePath:x,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:$,isOnDemandRevalidate:b})},O),t}},c=await E.handleResponse({req:e,nextConfig:A,cacheKey:U,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:b,revalidateOnlyGenerated:_,responseGenerator:d,waitUntil:i.waitUntil,isMinimalMode:a});if(!q)return null;if((null==c||null==(o=c.value)?void 0:o.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});a||t.setHeader("x-nextjs-cache",b?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,m.fromNodeOutgoingHttpHeaders)(c.value.headers);return a&&q||p.delete(f.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,g.getCacheControlHeader)(c.cacheControl)),await (0,h.sendResponse)(z,K,new Response(c.value.body,{headers:p,status:c.value.status||200})),null};F?await l(F):await j.withPropagatedContext(e.headers,()=>j.trace(p.BaseServerSpan.handleRequest,{spanName:`${B} ${x}`,kind:o.SpanKind.SERVER,attributes:{"http.method":B,"http.target":e.url}},l))}catch(t){if(t instanceof v.NoFallbackError||await E.onRequestError(e,t,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:$,isOnDemandRevalidate:b})}),q)throw t;return await (0,h.sendResponse)(z,K,new Response(null,{status:500})),null}}e.s(["handler",()=>P,"patchFetch",()=>A,"routeModule",()=>E,"serverHooks",()=>T,"workAsyncStorage",()=>y,"workUnitAsyncStorage",()=>w])},453753,e=>{e.v(t=>Promise.all(["server/chunks/src_lib_migrations_ts_7dc08040._.js"].map(t=>e.l(t))).then(()=>t(736987)))},121985,e=>{e.v(t=>Promise.all(["server/chunks/src_models_index_ts_328304ec._.js"].map(t=>e.l(t))).then(()=>t(540590)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__73d32201._.js.map