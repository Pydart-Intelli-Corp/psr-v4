module.exports=[48798,e=>{"use strict";var t=e.i(89171);function r(e,a,n=200){return t.NextResponse.json({success:!0,message:e,data:a},{status:n})}function a(e,r=400,n){return t.NextResponse.json({success:!1,message:"Error occurred",error:e,data:n},{status:r})}e.s(["createErrorResponse",()=>a,"createSuccessResponse",()=>r])},373628,e=>{"use strict";var t=e.i(747909),r=e.i(174017),a=e.i(996250),n=e.i(759756),s=e.i(561916),o=e.i(114444),i=e.i(837092),l=e.i(869741),c=e.i(316795),d=e.i(487718),u=e.i(995169),p=e.i(47587),h=e.i(666012),E=e.i(570101),R=e.i(626937),m=e.i(10372),f=e.i(193695);e.i(52474);var _=e.i(600220),v=e.i(79832),y=e.i(84168),w=e.i(48798);async function g(t){try{await (0,y.connectDB)();let{getModels:r}=await e.A(121985),{sequelize:a,User:n}=r(),s=t.headers.get("authorization");if(!s?.startsWith("Bearer "))return(0,w.createErrorResponse)("Unauthorized",401);let o=s.substring(7),i=await (0,v.verifyToken)(o);if(!i)return(0,w.createErrorResponse)("Invalid token",401);if("admin"!==i.role)return(0,w.createErrorResponse)("Unauthorized - Admin access required",403);let{chartId:l,societyId:c}=await t.json();if(!l||!c)return(0,w.createErrorResponse)("Chart ID and Society ID are required",400);let d=await n.findByPk(i.id);if(!d||!d.dbKey)return(0,w.createErrorResponse)("Admin schema not found",404);let u=d.fullName.replace(/[^a-zA-Z0-9]/g,"").toLowerCase(),p=`${u}_${d.dbKey.toLowerCase()}`,[h]=await a.query(`
      SELECT file_name, channel, shared_chart_id
      FROM \`${p}\`.rate_charts
      WHERE id = ?
      LIMIT 1
    `,{replacements:[l]});if(!Array.isArray(h)||0===h.length)return(0,w.createErrorResponse)("Rate chart not found",404);let E=h[0],[R]=await a.query(`
      SELECT COUNT(*) as count
      FROM \`${p}\`.rate_charts
      WHERE file_name = ? AND channel = ?
    `,{replacements:[E.file_name,E.channel]});if(R[0].count<=1)return(0,w.createErrorResponse)("Cannot remove the last society. At least one society must be assigned to the chart.",400);if(null===E.shared_chart_id){let[e]=await a.query(`
        SELECT id, society_id FROM \`${p}\`.rate_charts
        WHERE shared_chart_id = ? 
        ORDER BY id ASC
        LIMIT 1
      `,{replacements:[l]});if(Array.isArray(e)&&e.length>0){let t=e[0];return await a.query(`
          UPDATE \`${p}\`.rate_chart_data
          SET rate_chart_id = ?
          WHERE rate_chart_id = ?
        `,{replacements:[t.id,l]}),await a.query(`
          UPDATE \`${p}\`.rate_charts
          SET shared_chart_id = NULL
          WHERE id = ?
        `,{replacements:[t.id]}),await a.query(`
          UPDATE \`${p}\`.rate_charts
          SET shared_chart_id = ?
          WHERE shared_chart_id = ? AND id != ?
        `,{replacements:[t.id,l,t.id]}),await a.query(`
          DELETE FROM \`${p}\`.rate_chart_download_history
          WHERE rate_chart_id = ?
        `,{replacements:[l]}),await a.query(`
          DELETE FROM \`${p}\`.rate_charts
          WHERE id = ?
        `,{replacements:[l]}),console.log(`✅ Removed master chart ${l}, promoted ${t.id} to master in schema: ${p}`),(0,w.createSuccessResponse)("Society removed from rate chart successfully",null)}}return await a.query(`
      DELETE FROM \`${p}\`.rate_charts
      WHERE id = ? AND society_id = ?
    `,{replacements:[l,c]}),await a.query(`
      DELETE FROM \`${p}\`.rate_chart_download_history
      WHERE rate_chart_id = ?
    `,{replacements:[l]}),console.log(`✅ Removed shared chart ${l} for society ${c} in schema: ${p}`),(0,w.createSuccessResponse)("Society removed from rate chart successfully",null)}catch(e){return console.error("Error removing society from rate chart:",e),(0,w.createErrorResponse)("Failed to remove society from rate chart",500)}}e.s(["POST",()=>g],681708);var A=e.i(681708);let C=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/user/ratechart/remove-society/route",pathname:"/api/user/ratechart/remove-society",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/user/ratechart/remove-society/route.ts",nextConfigOutput:"",userland:A}),{workAsyncStorage:T,workUnitAsyncStorage:x,serverHooks:S}=C;function N(){return(0,a.patchFetch)({workAsyncStorage:T,workUnitAsyncStorage:x})}async function O(e,t,a){C.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/user/ratechart/remove-society/route";v=v.replace(/\/index$/,"")||"/";let y=await C.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:w,params:g,nextConfig:A,parsedUrl:T,isDraftMode:x,prerenderManifest:S,routerServerContext:N,isOnDemandRevalidate:O,revalidateOnlyGenerated:P,resolvedPathname:D,clientReferenceManifest:H,serverActionsManifest:$}=y,q=(0,l.normalizeAppPath)(v),b=!!(S.dynamicRoutes[q]||S.routes[D]),M=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,T,!1):t.end("This page could not be found"),null);if(b&&!x){let e=!!S.routes[D],t=S.dynamicRoutes[q];if(t&&!1===t.fallback&&!e){if(A.experimental.adapterPath)return await M();throw new f.NoFallbackError}}let U=null;!b||C.isDev||x||(U="/index"===(U=D)?"/":U);let I=!0===C.isDev||!b,k=b&&!I;$&&H&&(0,o.setReferenceManifestsSingleton)({page:v,clientReferenceManifest:H,serverActionsManifest:$,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:$})});let L=e.method||"GET",F=(0,s.getTracer)(),W=F.getActiveScopeSpan(),j={params:g,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!A.experimental.authInterrupts},cacheComponents:!!A.cacheComponents,supportsDynamicResponse:I,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:A.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>C.onRequestError(e,t,a,N)},sharedContext:{buildId:w}},K=new c.NodeNextRequest(e),B=new c.NodeNextResponse(t),z=d.NextRequestAdapter.fromNodeNextRequest(K,(0,d.signalFromNodeResponse)(t));try{let o=async e=>C.handle(z,j).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=F.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${L} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${L} ${v}`)}),i=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var s,l;let c=async({previousCacheEntry:r})=>{try{if(!i&&O&&P&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await o(n);e.fetchMetrics=j.renderOpts.fetchMetrics;let l=j.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let c=j.renderOpts.collectedTags;if(!b)return await (0,h.sendResponse)(K,B,s,j.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,E.toNodeOutgoingHttpHeaders)(s.headers);c&&(t[m.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==j.renderOpts.collectedRevalidate&&!(j.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&j.renderOpts.collectedRevalidate,a=void 0===j.renderOpts.collectedExpire||j.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:j.renderOpts.collectedExpire;return{value:{kind:_.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await C.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:O})},N),t}},d=await C.handleResponse({req:e,nextConfig:A,cacheKey:U,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:O,revalidateOnlyGenerated:P,responseGenerator:c,waitUntil:a.waitUntil,isMinimalMode:i});if(!b)return null;if((null==d||null==(s=d.value)?void 0:s.kind)!==_.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",O?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),x&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,E.fromNodeOutgoingHttpHeaders)(d.value.headers);return i&&b||u.delete(m.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,R.getCacheControlHeader)(d.cacheControl)),await (0,h.sendResponse)(K,B,new Response(d.value.body,{headers:u,status:d.value.status||200})),null};W?await l(W):await F.withPropagatedContext(e.headers,()=>F.trace(u.BaseServerSpan.handleRequest,{spanName:`${L} ${v}`,kind:s.SpanKind.SERVER,attributes:{"http.method":L,"http.target":e.url}},l))}catch(t){if(t instanceof f.NoFallbackError||await C.onRequestError(e,t,{routerKind:"App Router",routePath:q,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:O})}),b)throw t;return await (0,h.sendResponse)(K,B,new Response(null,{status:500})),null}}e.s(["handler",()=>O,"patchFetch",()=>N,"routeModule",()=>C,"serverHooks",()=>S,"workAsyncStorage",()=>T,"workUnitAsyncStorage",()=>x],373628)},453753,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__86f7d54e._.js"].map(t=>e.l(t))).then(()=>t(736987)))},121985,e=>{e.v(t=>Promise.all(["server/chunks/src_models_index_ts_328304ec._.js"].map(t=>e.l(t))).then(()=>t(540590)))}];

//# sourceMappingURL=_05e5cf55._.js.map