{"version":3,"sources":["turbopack:///[project]/src/lib/emailService.ts"],"sourcesContent":["import nodemailer from 'nodemailer';\r\n\r\n// Email configuration\r\n// Support both SMTP_* (local) and EMAIL_* (production) environment variables\r\nconst emailConfig = {\r\n  host: process.env.SMTP_HOST || process.env.EMAIL_HOST || 'smtp.gmail.com',\r\n  port: parseInt(process.env.SMTP_PORT || process.env.EMAIL_PORT || '587'),\r\n  secure: (process.env.SMTP_SECURE || process.env.EMAIL_SECURE) === 'true', // true for 465, false for other ports\r\n  auth: {\r\n    user: process.env.SMTP_USERNAME || process.env.EMAIL_USER,\r\n    pass: process.env.SMTP_PASSWORD || process.env.EMAIL_PASSWORD,\r\n  },\r\n};\r\n\r\n// Create transporter\r\nconst transporter = nodemailer.createTransport(emailConfig);\r\n\r\n// Generate OTP\r\nexport const generateOTP = (): string => {\r\n  return Math.floor(100000 + Math.random() * 900000).toString();\r\n};\r\n\r\n// Send OTP email\r\nexport const sendOTPEmail = async (\r\n  email: string, \r\n  otp: string, \r\n  name: string\r\n): Promise<void> => {\r\n  // Debug logging\r\n  console.log('Email config debug:', {\r\n    to: email,\r\n    from: process.env.SMTP_USERNAME || process.env.EMAIL_USER,\r\n    host: process.env.SMTP_HOST || process.env.EMAIL_HOST,\r\n    port: process.env.SMTP_PORT || process.env.EMAIL_PORT,\r\n    hasPassword: !!(process.env.SMTP_PASSWORD || process.env.EMAIL_PASSWORD),\r\n    secure: (process.env.SMTP_SECURE || process.env.EMAIL_SECURE) === 'true'\r\n  });\r\n\r\n  const mailOptions = {\r\n    from: `\"Poornasree Equipments Cloud\" <${process.env.SMTP_USERNAME || process.env.EMAIL_USER}>`,\r\n    to: email,\r\n    subject: 'Email Verification - Poornasree Equipments Cloud',\r\n    html: `\r\n      <div style=\"max-width: 600px; margin: 0 auto; padding: 20px; font-family: Arial, sans-serif;\">\r\n        <div style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 10px; color: white; text-align: center; margin-bottom: 20px;\">\r\n          <h1 style=\"margin: 0; font-size: 28px;\">Poornasree Equipments Cloud</h1>\r\n          <p style=\"margin: 10px 0 0 0; opacity: 0.9;\">Email Verification</p>\r\n        </div>\r\n        \r\n        <div style=\"padding: 20px; background: #f8f9fa; border-radius: 10px;\">\r\n          <h2 style=\"color: #333; margin-top: 0;\">Hello ${name}!</h2>\r\n          <p style=\"color: #666; line-height: 1.6;\">\r\n            Thank you for registering with Poornasree Equipments Cloud. Please verify your email address using the OTP below:\r\n          </p>\r\n          \r\n          <div style=\"text-align: center; margin: 30px 0;\">\r\n            <div style=\"display: inline-block; padding: 15px 30px; background: #667eea; color: white; font-size: 24px; font-weight: bold; letter-spacing: 3px; border-radius: 8px;\">\r\n              ${otp}\r\n            </div>\r\n          </div>\r\n          \r\n          <p style=\"color: #666; line-height: 1.6;\">\r\n            This OTP is valid for 10 minutes. If you didn't create an account, please ignore this email.\r\n          </p>\r\n          \r\n          <div style=\"margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd; color: #888; font-size: 14px;\">\r\n            <p>Best regards,<br>Poornasree Equipments Cloud Team</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `,\r\n  };\r\n\r\n  await transporter.sendMail(mailOptions);\r\n};\r\n\r\n// Send welcome email\r\nexport const sendWelcomeEmail = async (\r\n  email: string, \r\n  name: string, \r\n  role: string\r\n): Promise<void> => {\r\n  const mailOptions = {\r\n    from: `\"Poornasree Equipments Cloud\" <${process.env.SMTP_USERNAME || process.env.EMAIL_USER}>`,\r\n    to: email,\r\n    subject: 'Welcome to Poornasree Equipments Cloud',\r\n    html: `\r\n      <div style=\"max-width: 600px; margin: 0 auto; padding: 20px; font-family: Arial, sans-serif;\">\r\n        <div style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 10px; color: white; text-align: center; margin-bottom: 20px;\">\r\n          <h1 style=\"margin: 0; font-size: 28px;\">Poornasree Equipments Cloud</h1>\r\n          <p style=\"margin: 10px 0 0 0; opacity: 0.9;\">Welcome!</p>\r\n        </div>\r\n        \r\n        <div style=\"padding: 20px; background: #f8f9fa; border-radius: 10px;\">\r\n          <h2 style=\"color: #333; margin-top: 0;\">Welcome ${name}!</h2>\r\n          <p style=\"color: #666; line-height: 1.6;\">\r\n            Your account has been successfully verified and activated. You can now access the Poornasree Equipments Cloud platform with your ${role} account.\r\n          </p>\r\n          \r\n          <div style=\"text-align: center; margin: 30px 0;\">\r\n            <a href=\"${process.env.FRONTEND_URL}/login\" style=\"display: inline-block; padding: 12px 30px; background: #667eea; color: white; text-decoration: none; border-radius: 6px; font-weight: bold;\">\r\n              Login to Dashboard\r\n            </a>\r\n          </div>\r\n          \r\n          <div style=\"margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd; color: #888; font-size: 14px;\">\r\n            <p>Best regards,<br>Poornasree Equipments Cloud Team</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `,\r\n  };\r\n\r\n  await transporter.sendMail(mailOptions);\r\n};\r\n\r\n// Send admin welcome email with dbKey\r\nexport const sendAdminWelcomeEmail = async (\r\n  email: string, \r\n  name: string, \r\n  dbKey: string\r\n): Promise<void> => {\r\n  const apiUrl = `http://lactosure.azurewebsites.net/api/${dbKey}`;\r\n  \r\n  const mailOptions = {\r\n    from: `\"Poornasree Equipments Cloud\" <${process.env.SMTP_USERNAME || process.env.EMAIL_USER}>`,\r\n    to: email,\r\n    subject: 'üéâ Admin Account Approved - Your Personal Database Access',\r\n    html: `\r\n      <div style=\"max-width: 600px; margin: 0 auto; padding: 20px; font-family: Arial, sans-serif;\">\r\n        <div style=\"background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 30px; border-radius: 10px; color: white; text-align: center; margin-bottom: 20px;\">\r\n          <h1 style=\"margin: 0; font-size: 28px;\">üéâ Congratulations!</h1>\r\n          <p style=\"margin: 10px 0 0 0; opacity: 0.9;\">Your Admin Account is Approved</p>\r\n        </div>\r\n        \r\n        <div style=\"padding: 20px; background: #f8f9fa; border-radius: 10px;\">\r\n          <h2 style=\"color: #333; margin-top: 0;\">Welcome ${name}!</h2>\r\n          <p style=\"color: #666; line-height: 1.6;\">\r\n            Congratulations! Your admin account has been approved by the Super Admin. Your personal database schema has been created and is ready for use.\r\n          </p>\r\n          \r\n          <div style=\"background: #fff; border: 2px solid #ef4444; border-radius: 8px; padding: 20px; margin: 20px 0;\">\r\n            <h3 style=\"color: #ef4444; margin-top: 0; font-size: 18px;\">üîí CONFIDENTIAL - Database Access Key</h3>\r\n            <p style=\"color: #666; margin-bottom: 15px;\">Your unique database access key:</p>\r\n            <div style=\"background: #f3f4f6; border: 1px solid #d1d5db; border-radius: 6px; padding: 15px; text-align: center; font-family: 'Courier New', monospace; font-size: 24px; font-weight: bold; color: #1f2937; letter-spacing: 3px;\">\r\n              ${dbKey}\r\n            </div>\r\n            <p style=\"color: #ef4444; font-weight: bold; margin-top: 15px; margin-bottom: 0;\">\r\n              ‚ö†Ô∏è KEEP THIS KEY STRICTLY CONFIDENTIAL AND SECURE\r\n            </p>\r\n          </div>\r\n          \r\n          <div style=\"background: #fff; border: 1px solid #d1d5db; border-radius: 8px; padding: 20px; margin: 20px 0;\">\r\n            <h3 style=\"color: #333; margin-top: 0;\">üåê Your Personal API Endpoint</h3>\r\n            <p style=\"color: #666; margin-bottom: 10px;\">Use this URL on your machine to access your database:</p>\r\n            <div style=\"background: #f8f9fa; border: 1px solid #e5e7eb; border-radius: 4px; padding: 12px; font-family: 'Courier New', monospace; word-break: break-all; color: #1f2937;\">\r\n              ${apiUrl}\r\n            </div>\r\n            <p style=\"color: #ef4444; font-size: 14px; margin-top: 10px; margin-bottom: 0;\">\r\n              <strong>Important:</strong> Only enter this URL on your designated work machine. Do not share this URL with anyone.\r\n            </p>\r\n          </div>\r\n          \r\n          <div style=\"background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; padding: 15px; margin: 20px 0;\">\r\n            <h4 style=\"color: #92400e; margin-top: 0; margin-bottom: 10px;\">üõ°Ô∏è Security Guidelines:</h4>\r\n            <ul style=\"color: #92400e; margin: 0; padding-left: 20px; line-height: 1.6;\">\r\n              <li>Never share your dbKey with anyone</li>\r\n              <li>Only access the API from secure, trusted machines</li>\r\n              <li>Log out completely when finished working</li>\r\n              <li>Report any suspicious activity immediately</li>\r\n              <li>Change your password regularly</li>\r\n            </ul>\r\n          </div>\r\n          \r\n          <div style=\"text-align: center; margin: 30px 0;\">\r\n            <a href=\"${process.env.FRONTEND_URL}/adminpanel\" style=\"display: inline-block; padding: 15px 30px; background: #10b981; color: white; text-decoration: none; border-radius: 8px; font-weight: bold; font-size: 16px;\">\r\n              üöÄ Access Admin Dashboard\r\n            </a>\r\n          </div>\r\n          \r\n          <div style=\"margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd; color: #888; font-size: 14px;\">\r\n            <p><strong>Support:</strong> If you have any questions or issues, please contact our support team.</p>\r\n            <p>Best regards,<br>Poornasree Equipments Cloud Team</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `,\r\n  };\r\n\r\n  await transporter.sendMail(mailOptions);\r\n};\r\n\r\n// Send password reset email\r\nexport const sendPasswordResetEmail = async (\r\n  email: string, \r\n  name: string, \r\n  resetToken: string\r\n): Promise<void> => {\r\n  const resetUrl = `${process.env.FRONTEND_URL}/reset-password?token=${resetToken}`;\r\n  \r\n  const mailOptions = {\r\n    from: `\"Poornasree Equipments Cloud\" <${process.env.SMTP_USERNAME || process.env.EMAIL_USER}>`,\r\n    to: email,\r\n    subject: 'Password Reset - Poornasree Equipments Cloud',\r\n    html: `\r\n      <div style=\"max-width: 600px; margin: 0 auto; padding: 20px; font-family: Arial, sans-serif;\">\r\n        <div style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 10px; color: white; text-align: center; margin-bottom: 20px;\">\r\n          <h1 style=\"margin: 0; font-size: 28px;\">Poornasree Equipments Cloud</h1>\r\n          <p style=\"margin: 10px 0 0 0; opacity: 0.9;\">Password Reset</p>\r\n        </div>\r\n        \r\n        <div style=\"padding: 20px; background: #f8f9fa; border-radius: 10px;\">\r\n          <h2 style=\"color: #333; margin-top: 0;\">Hello ${name}!</h2>\r\n          <p style=\"color: #666; line-height: 1.6;\">\r\n            You have requested to reset your password. Click the button below to set a new password:\r\n          </p>\r\n          \r\n          <div style=\"text-align: center; margin: 30px 0;\">\r\n            <a href=\"${resetUrl}\" style=\"display: inline-block; padding: 12px 30px; background: #dc3545; color: white; text-decoration: none; border-radius: 6px; font-weight: bold;\">\r\n              Reset Password\r\n            </a>\r\n          </div>\r\n          \r\n          <p style=\"color: #666; line-height: 1.6; font-size: 14px;\">\r\n            This link is valid for 1 hour. If you didn't request a password reset, please ignore this email.\r\n          </p>\r\n          \r\n          <div style=\"margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd; color: #888; font-size: 14px;\">\r\n            <p>Best regards,<br>Poornasree Equipments Cloud Team</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `,\r\n  };\r\n\r\n  await transporter.sendMail(mailOptions);\r\n};\r\n\r\n// Send admin approval request to super admin\r\nexport const sendAdminApprovalRequest = async (\r\n  adminEmail: string,\r\n  adminName: string,\r\n  companyName: string\r\n): Promise<void> => {\r\n  const approvalUrl = `${process.env.CLIENT_URL}/adminpanel/dashboard#pending-approvals`;\r\n  \r\n  const mailOptions = {\r\n    from: `\"Poornasree Equipments Cloud\" <${process.env.SMTP_USERNAME || process.env.EMAIL_USER}>`,\r\n    to: process.env.SUPER_ADMIN_EMAIL || 'admin@poornasreeequipments.com',\r\n    subject: 'New Admin Registration - Approval Required',\r\n    html: `\r\n      <div style=\"max-width: 600px; margin: 0 auto; padding: 20px; font-family: Arial, sans-serif;\">\r\n        <div style=\"background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%); padding: 30px; border-radius: 10px; color: white; text-align: center; margin-bottom: 20px;\">\r\n          <h1 style=\"margin: 0; font-size: 28px;\">Poornasree Equipments Cloud</h1>\r\n          <p style=\"margin: 10px 0 0 0; opacity: 0.9;\">Admin Approval Required</p>\r\n        </div>\r\n        \r\n        <div style=\"padding: 20px; background: #f8f9fa; border-radius: 10px;\">\r\n          <h2 style=\"color: #333; margin-top: 0;\">New Admin Registration</h2>\r\n          <p style=\"color: #666; line-height: 1.6;\">\r\n            A new admin has completed email verification and is requesting account activation:\r\n          </p>\r\n          \r\n          <div style=\"background: white; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #dc3545;\">\r\n            <h3 style=\"color: #dc3545; margin-top: 0;\">Admin Details:</h3>\r\n            <p style=\"margin: 5px 0;\"><strong>Name:</strong> ${adminName}</p>\r\n            <p style=\"margin: 5px 0;\"><strong>Email:</strong> ${adminEmail}</p>\r\n            <p style=\"margin: 5px 0;\"><strong>Company:</strong> ${companyName}</p>\r\n            <p style=\"margin: 5px 0;\"><strong>Role:</strong> Admin</p>\r\n            <p style=\"margin: 5px 0;\"><strong>Status:</strong> <span style=\"color: #fd7e14;\">Pending Approval</span></p>\r\n          </div>\r\n          \r\n          <div style=\"text-align: center; margin: 30px 0;\">\r\n            <a href=\"${approvalUrl}\" style=\"display: inline-block; padding: 15px 30px; background: #dc3545; color: white; text-decoration: none; border-radius: 6px; font-weight: bold; margin-right: 10px;\">\r\n              Review & Approve\r\n            </a>\r\n          </div>\r\n          \r\n          <p style=\"color: #666; line-height: 1.6; font-size: 14px; border-top: 1px solid #ddd; padding-top: 15px; margin-top: 25px;\">\r\n            <strong>Action Required:</strong> Please log in to the admin panel to review and approve/reject this admin registration request.\r\n          </p>\r\n          \r\n          <div style=\"margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd; color: #888; font-size: 14px;\">\r\n            <p>Best regards,<br>Poornasree Equipments Cloud System</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `,\r\n  };\r\n\r\n  await transporter.sendMail(mailOptions);\r\n};\r\n\r\n// Send admin rejection email\r\nexport const sendAdminRejectionEmail = async (\r\n  adminEmail: string,\r\n  adminName: string,\r\n  reason?: string\r\n): Promise<void> => {\r\n  const supportEmail = 'support@poornasreeequipments.com';\r\n  \r\n  const mailOptions = {\r\n    from: `\"Poornasree Equipments Cloud\" <${process.env.SMTP_USERNAME || process.env.EMAIL_USER}>`,\r\n    to: adminEmail,\r\n    subject: 'Admin Application Status - Poornasree Equipments Cloud',\r\n    html: `\r\n      <div style=\"max-width: 600px; margin: 0 auto; padding: 20px; font-family: Arial, sans-serif;\">\r\n        <div style=\"background: linear-gradient(135deg, #6c757d 0%, #495057 100%); padding: 30px; border-radius: 10px; color: white; text-align: center; margin-bottom: 20px;\">\r\n          <h1 style=\"margin: 0; font-size: 28px;\">Poornasree Equipments Cloud</h1>\r\n          <p style=\"margin: 10px 0 0 0; opacity: 0.9;\">Application Status Update</p>\r\n        </div>\r\n        \r\n        <div style=\"padding: 20px; background: #f8f9fa; border-radius: 10px;\">\r\n          <h2 style=\"color: #333; margin-top: 0;\">Hello ${adminName},</h2>\r\n          <p style=\"color: #666; line-height: 1.6;\">\r\n            Thank you for your interest in joining Poornasree Equipments Cloud as an administrator.\r\n          </p>\r\n          \r\n          <div style=\"background: #fff3cd; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #ffc107;\">\r\n            <h3 style=\"color: #856404; margin-top: 0;\">Application Status: Not Approved</h3>\r\n            <p style=\"color: #856404; margin-bottom: 0;\">\r\n              After careful review, we are unable to approve your admin application at this time.\r\n            </p>\r\n          </div>\r\n          \r\n          ${reason ? `\r\n          <div style=\"background: white; padding: 20px; border-radius: 8px; margin: 20px 0; border: 1px solid #dee2e6;\">\r\n            <h4 style=\"color: #495057; margin-top: 0;\">Reason:</h4>\r\n            <p style=\"color: #666; margin-bottom: 0;\">${reason}</p>\r\n          </div>\r\n          ` : ''}\r\n          \r\n          <div style=\"background: #d1ecf1; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #0dcaf0;\">\r\n            <h4 style=\"color: #055160; margin-top: 0;\">What's Next?</h4>\r\n            <p style=\"color: #055160; margin-bottom: 10px;\">\r\n              If you believe this decision was made in error or if you have additional information to provide, \r\n              please don't hesitate to contact our support team.\r\n            </p>\r\n            <div style=\"text-align: center; margin-top: 20px;\">\r\n              <a href=\"mailto:${supportEmail}\" style=\"display: inline-block; padding: 12px 24px; background: #0dcaf0; color: white; text-decoration: none; border-radius: 6px; font-weight: bold;\">\r\n                Contact Support\r\n              </a>\r\n            </div>\r\n          </div>\r\n          \r\n          <p style=\"color: #666; line-height: 1.6;\">\r\n            We appreciate your understanding and thank you for your interest in our platform.\r\n          </p>\r\n          \r\n          <div style=\"margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd; color: #888; font-size: 14px;\">\r\n            <p>Best regards,<br>Poornasree Equipments Cloud Team</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `,\r\n  };\r\n\r\n  await transporter.sendMail(mailOptions);\r\n};\r\n\r\n// Send milk collection notification email\r\nexport const sendMilkCollectionEmail = async (\r\n  email: string,\r\n  farmerName: string,\r\n  collectionDetails: {\r\n    farmerId: string;\r\n    societyName?: string;\r\n    collectionDate: string;\r\n    collectionTime: string;\r\n    shiftType: string;\r\n    channel: string;\r\n    quantity: number;\r\n    fatPercentage: number;\r\n    snfPercentage: number;\r\n    clrValue: number;\r\n    proteinPercentage: number;\r\n    lactosePercentage: number;\r\n    waterPercentage: number;\r\n    temperature: number;\r\n    ratePerLiter: number;\r\n    totalAmount: number;\r\n    bonus: number;\r\n  }\r\n): Promise<void> => {\r\n  const formattedDate = new Date(collectionDetails.collectionDate).toLocaleDateString('en-IN', {\r\n    weekday: 'long',\r\n    year: 'numeric',\r\n    month: 'long',\r\n    day: 'numeric'\r\n  });\r\n\r\n  const mailOptions = {\r\n    from: `\"Poornasree Equipments Cloud\" <${process.env.SMTP_USERNAME || process.env.EMAIL_USER}>`,\r\n    to: email,\r\n    subject: `Milk Collection Receipt - ${collectionDetails.farmerId} - ${formattedDate}`,\r\n    html: `\r\n      <div style=\"max-width: 650px; margin: 0 auto; padding: 20px; font-family: 'Segoe UI', Arial, sans-serif; background-color: #f5f5f5;\">\r\n        <!-- Header -->\r\n        <div style=\"background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 30px; border-radius: 12px 12px 0 0; color: white; text-align: center;\">\r\n          <h1 style=\"margin: 0; font-size: 28px; font-weight: 600;\">ü•õ Milk Collection Receipt</h1>\r\n          <p style=\"margin: 10px 0 0 0; opacity: 0.95; font-size: 16px;\">Poornasree Equipments Cloud</p>\r\n        </div>\r\n        \r\n        <!-- Body -->\r\n        <div style=\"background: white; padding: 30px; border-radius: 0 0 12px 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);\">\r\n          <!-- Greeting -->\r\n          <div style=\"margin-bottom: 25px;\">\r\n            <h2 style=\"color: #1f2937; margin: 0 0 10px 0; font-size: 22px;\">Hello ${farmerName},</h2>\r\n            <p style=\"color: #6b7280; margin: 0; line-height: 1.6;\">\r\n              Your milk collection has been successfully recorded. Here are the details:\r\n            </p>\r\n          </div>\r\n\r\n          <!-- Collection Details Card -->\r\n          <div style=\"background: #f9fafb; border-left: 4px solid #10b981; padding: 20px; border-radius: 8px; margin-bottom: 20px;\">\r\n            <h3 style=\"color: #059669; margin: 0 0 15px 0; font-size: 18px; font-weight: 600;\">üìã Collection Information</h3>\r\n            \r\n            <table style=\"width: 100%; border-collapse: collapse;\">\r\n              <tr>\r\n                <td style=\"padding: 8px 0; color: #6b7280; width: 45%;\">Farmer ID:</td>\r\n                <td style=\"padding: 8px 0; color: #1f2937; font-weight: 600;\">${collectionDetails.farmerId}</td>\r\n              </tr>\r\n              ${collectionDetails.societyName ? `\r\n              <tr>\r\n                <td style=\"padding: 8px 0; color: #6b7280;\">Society:</td>\r\n                <td style=\"padding: 8px 0; color: #1f2937; font-weight: 600;\">${collectionDetails.societyName}</td>\r\n              </tr>\r\n              ` : ''}\r\n              <tr>\r\n                <td style=\"padding: 8px 0; color: #6b7280;\">Date:</td>\r\n                <td style=\"padding: 8px 0; color: #1f2937; font-weight: 600;\">${formattedDate}</td>\r\n              </tr>\r\n              <tr>\r\n                <td style=\"padding: 8px 0; color: #6b7280;\">Time:</td>\r\n                <td style=\"padding: 8px 0; color: #1f2937; font-weight: 600;\">${collectionDetails.collectionTime}</td>\r\n              </tr>\r\n              <tr>\r\n                <td style=\"padding: 8px 0; color: #6b7280;\">Shift:</td>\r\n                <td style=\"padding: 8px 0; color: #1f2937; font-weight: 600;\">\r\n                  <span style=\"background: ${collectionDetails.shiftType === 'morning' ? '#fef3c7' : '#dbeafe'}; color: ${collectionDetails.shiftType === 'morning' ? '#92400e' : '#1e40af'}; padding: 4px 12px; border-radius: 12px; font-size: 14px;\">\r\n                    ${collectionDetails.shiftType === 'morning' ? 'üåÖ Morning' : 'üåÜ Evening'}\r\n                  </span>\r\n                </td>\r\n              </tr>\r\n              <tr>\r\n                <td style=\"padding: 8px 0; color: #6b7280;\">Milk Type:</td>\r\n                <td style=\"padding: 8px 0; color: #1f2937; font-weight: 600;\">${collectionDetails.channel}</td>\r\n              </tr>\r\n            </table>\r\n          </div>\r\n\r\n          <!-- Quality Parameters Card -->\r\n          <div style=\"background: #eff6ff; border-left: 4px solid #3b82f6; padding: 20px; border-radius: 8px; margin-bottom: 20px;\">\r\n            <h3 style=\"color: #1e40af; margin: 0 0 15px 0; font-size: 18px; font-weight: 600;\">üî¨ Quality Parameters</h3>\r\n            \r\n            <table style=\"width: 100%; border-collapse: collapse;\">\r\n              <tr>\r\n                <td style=\"padding: 8px 0; color: #6b7280; width: 45%;\">Fat:</td>\r\n                <td style=\"padding: 8px 0; color: #1f2937; font-weight: 600;\">${collectionDetails.fatPercentage.toFixed(2)}%</td>\r\n              </tr>\r\n              <tr>\r\n                <td style=\"padding: 8px 0; color: #6b7280;\">SNF:</td>\r\n                <td style=\"padding: 8px 0; color: #1f2937; font-weight: 600;\">${collectionDetails.snfPercentage.toFixed(2)}%</td>\r\n              </tr>\r\n              <tr>\r\n                <td style=\"padding: 8px 0; color: #6b7280;\">CLR:</td>\r\n                <td style=\"padding: 8px 0; color: #1f2937; font-weight: 600;\">${collectionDetails.clrValue.toFixed(2)}</td>\r\n              </tr>\r\n              <tr>\r\n                <td style=\"padding: 8px 0; color: #6b7280;\">Protein:</td>\r\n                <td style=\"padding: 8px 0; color: #1f2937; font-weight: 600;\">${collectionDetails.proteinPercentage.toFixed(2)}%</td>\r\n              </tr>\r\n              <tr>\r\n                <td style=\"padding: 8px 0; color: #6b7280;\">Lactose:</td>\r\n                <td style=\"padding: 8px 0; color: #1f2937; font-weight: 600;\">${collectionDetails.lactosePercentage.toFixed(2)}%</td>\r\n              </tr>\r\n              <tr>\r\n                <td style=\"padding: 8px 0; color: #6b7280;\">Water:</td>\r\n                <td style=\"padding: 8px 0; color: #1f2937; font-weight: 600;\">${collectionDetails.waterPercentage.toFixed(2)}%</td>\r\n              </tr>\r\n              <tr>\r\n                <td style=\"padding: 8px 0; color: #6b7280;\">Temperature:</td>\r\n                <td style=\"padding: 8px 0; color: #1f2937; font-weight: 600;\">${collectionDetails.temperature.toFixed(2)}¬∞C</td>\r\n              </tr>\r\n            </table>\r\n          </div>\r\n\r\n          <!-- Payment Details Card -->\r\n          <div style=\"background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 20px; border-radius: 8px; margin-bottom: 20px; color: white;\">\r\n            <h3 style=\"margin: 0 0 15px 0; font-size: 18px; font-weight: 600;\">üí∞ Payment Details</h3>\r\n            \r\n            <table style=\"width: 100%; border-collapse: collapse;\">\r\n              <tr>\r\n                <td style=\"padding: 8px 0; opacity: 0.9; width: 45%;\">Quantity:</td>\r\n                <td style=\"padding: 8px 0; font-weight: 600; font-size: 16px;\">${collectionDetails.quantity.toFixed(2)} Liters</td>\r\n              </tr>\r\n              <tr>\r\n                <td style=\"padding: 8px 0; opacity: 0.9;\">Rate per Liter:</td>\r\n                <td style=\"padding: 8px 0; font-weight: 600; font-size: 16px;\">‚Çπ${collectionDetails.ratePerLiter.toFixed(2)}</td>\r\n              </tr>\r\n              ${collectionDetails.bonus > 0 ? `\r\n              <tr>\r\n                <td style=\"padding: 8px 0; opacity: 0.9;\">Bonus:</td>\r\n                <td style=\"padding: 8px 0; font-weight: 600; font-size: 16px;\">‚Çπ${collectionDetails.bonus.toFixed(2)}</td>\r\n              </tr>\r\n              ` : ''}\r\n              <tr style=\"border-top: 1px solid rgba(255,255,255,0.3);\">\r\n                <td style=\"padding: 12px 0; font-size: 18px; font-weight: 600;\">Total Amount:</td>\r\n                <td style=\"padding: 12px 0; font-size: 24px; font-weight: 700;\">‚Çπ${collectionDetails.totalAmount.toFixed(2)}</td>\r\n              </tr>\r\n            </table>\r\n          </div>\r\n\r\n          <!-- Footer Note -->\r\n          <div style=\"background: #fef3c7; border-left: 4px solid #f59e0b; padding: 15px; border-radius: 8px; margin-bottom: 20px;\">\r\n            <p style=\"margin: 0; color: #92400e; line-height: 1.6; font-size: 14px;\">\r\n              <strong>üìù Note:</strong> This is an automated notification for your milk collection. Please keep this email for your records. For any discrepancies, contact your society office within 24 hours.\r\n            </p>\r\n          </div>\r\n\r\n          <!-- Footer -->\r\n          <div style=\"margin-top: 30px; padding-top: 20px; border-top: 2px solid #e5e7eb; text-align: center;\">\r\n            <p style=\"color: #6b7280; margin: 0 0 10px 0; font-size: 14px;\">\r\n              Thank you for your continued support!\r\n            </p>\r\n            <p style=\"color: #9ca3af; margin: 0; font-size: 12px;\">\r\n              Best regards,<br>\r\n              <strong>Poornasree Equipments Cloud Team</strong>\r\n            </p>\r\n          </div>\r\n        </div>\r\n        \r\n        <!-- Disclaimer -->\r\n        <div style=\"margin-top: 20px; text-align: center;\">\r\n          <p style=\"color: #9ca3af; font-size: 11px; line-height: 1.4; margin: 0;\">\r\n            This is an automated email. Please do not reply to this email.<br>\r\n            ¬© ${new Date().getFullYear()} Poornasree Equipments Cloud. All rights reserved.\r\n          </p>\r\n        </div>\r\n      </div>\r\n    `,\r\n  };\r\n\r\n  try {\r\n    await transporter.sendMail(mailOptions);\r\n    console.log(`‚úÖ Collection email sent to ${email}`);\r\n  } catch (error) {\r\n    console.error(`‚ùå Failed to send collection email to ${email}:`, error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport default transporter;"],"names":[],"mappings":"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"}