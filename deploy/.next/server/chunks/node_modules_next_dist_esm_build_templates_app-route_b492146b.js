module.exports=[409361,t=>{"use strict";var e=t.i(747909),a=t.i(174017),i=t.i(996250),s=t.i(759756),n=t.i(561916),d=t.i(114444),c=t.i(837092),m=t.i(869741),o=t.i(316795),r=t.i(487718),l=t.i(995169),_=t.i(47587),u=t.i(666012),E=t.i(570101),N=t.i(626937),O=t.i(10372),y=t.i(193695);t.i(52474);var h=t.i(600220),U=t.i(89171),T=t.i(84168),p=t.i(724652);let f=process.env.JWT_SECRET||"your-secret-key";async function L(e){try{let a=e.headers.get("authorization");if(!a?.startsWith("Bearer "))return U.NextResponse.json({error:"Unauthorized"},{status:401});let i=a.substring(7),s=p.default.verify(i,f);await (0,T.connectDB)();let{getModels:n}=await t.A(121985),{sequelize:d,User:c}=n(),m=await c.findByPk(s.id);if(!m||!m.dbKey)return console.error("Admin not found or missing dbKey:",s.id),U.NextResponse.json({error:"Admin schema not found"},{status:404});let o=m.fullName.replace(/[^a-zA-Z0-9]/g,"").toLowerCase(),r=`${o}_${m.dbKey.toLowerCase()}`;console.log("Fetching analytics for schema:",r);let l=e.nextUrl.searchParams,_=l.get("from"),u=l.get("to"),E=parseInt(l.get("days")||"30"),N=l.get("dairy")?.split(",").filter(Boolean)||[],O=l.get("bmc")?.split(",").filter(Boolean)||[],y=l.get("society")?.split(",").filter(Boolean)||[],h=l.get("machine")?.split(",").filter(Boolean)||[],L=l.get("channel"),I=l.get("shift");console.log("ðŸ” Filters:",{dairyFilter:N,bmcFilter:O,societyFilter:y,machineFilter:h,channelFilter:L,shiftFilter:I});let S="";if(_&&u)S=`WHERE mc.collection_date >= '${_}' AND mc.collection_date <= '${u}'`,console.log(`ðŸ“… Using custom date range: ${_} to ${u}`);else if(E>0){let t=new Date;t.setDate(t.getDate()-E);let e=t.toISOString().split("T")[0];S=`WHERE mc.collection_date >= '${e}'`,console.log(`ðŸ“… Using preset range: Last ${E} days (from ${e})`)}else S="",console.log(`ðŸ“… Fetching ALL data (no date filter)`);let g=[];if(N.length>0&&g.push(`df.id IN (${N.join(",")})`),O.length>0&&g.push(`b.id IN (${O.join(",")})`),y.length>0&&g.push(`s.id IN (${y.join(",")})`),h.length>0){let t=h.map(t=>`'${t}'`).join(",");g.push(`m.machine_id IN (${t})`)}if(L&&"all"!==L){let t=(({COW:["COW","cow","ch1","CH1"],BUFFALO:["BUFFALO","buffalo","BUF","ch2","CH2"],MIXED:["MIXED","mixed","MIX","ch3","CH3"]})[L]||[L]).map(t=>`'${t}'`).join(",");g.push(`mc.channel IN (${t})`)}I&&"all"!==I&&g.push(`mc.shift_type = '${I}'`);let F=S?g.length>0?`${S} AND ${g.join(" AND ")}`:S:g.length>0?`WHERE ${g.join(" AND ")}`:"";console.log("ðŸ“‹ WHERE clause:",F);let M=`
      SELECT 
        DATE(mc.collection_date) as date,
        COUNT(*) as total_collections,
        SUM(mc.quantity) as total_quantity,
        SUM(mc.total_amount) as total_amount,
        AVG(mc.rate_per_liter) as avg_rate,
        SUM(mc.quantity * mc.fat_percentage) / NULLIF(SUM(mc.quantity), 0) as weighted_fat,
        SUM(mc.quantity * mc.snf_percentage) / NULLIF(SUM(mc.quantity), 0) as weighted_snf,
        SUM(mc.quantity * mc.clr_value) / NULLIF(SUM(mc.quantity), 0) as weighted_clr,
        SUM(mc.quantity * mc.protein_percentage) / NULLIF(SUM(mc.quantity), 0) as weighted_protein,
        SUM(mc.quantity * mc.lactose_percentage) / NULLIF(SUM(mc.quantity), 0) as weighted_lactose
      FROM \`${r}\`.milk_collections mc
      LEFT JOIN \`${r}\`.machines m ON mc.machine_id = m.id
      LEFT JOIN \`${r}\`.societies s ON mc.society_id = s.id
      LEFT JOIN \`${r}\`.bmcs b ON s.bmc_id = b.id
      LEFT JOIN \`${r}\`.dairy_farms df ON b.dairy_farm_id = df.id
      ${F}
      GROUP BY DATE(mc.collection_date)
      ORDER BY DATE(mc.collection_date) ASC
    `,R=F.replace(/mc\./g,"md.").replace(/m\.machine_id/g,"dm.machine_id").replace(/collection_date/g,"dispatch_date"),$=`
      SELECT 
        DATE(md.dispatch_date) as date,
        COUNT(*) as total_dispatches,
        SUM(md.quantity) as total_quantity,
        SUM(md.total_amount) as total_amount,
        AVG(md.rate_per_liter) as avg_rate,
        SUM(md.quantity * md.fat_percentage) / NULLIF(SUM(md.quantity), 0) as weighted_fat,
        SUM(md.quantity * md.snf_percentage) / NULLIF(SUM(md.quantity), 0) as weighted_snf,
        SUM(md.quantity * md.clr_value) / NULLIF(SUM(md.quantity), 0) as weighted_clr
      FROM \`${r}\`.milk_dispatches md
      LEFT JOIN \`${r}\`.machines dm ON md.machine_id = dm.id
      LEFT JOIN \`${r}\`.societies s ON md.society_id = s.id
      LEFT JOIN \`${r}\`.bmcs b ON s.bmc_id = b.id
      LEFT JOIN \`${r}\`.dairy_farms df ON b.dairy_farm_id = df.id
      ${R}
      GROUP BY DATE(md.dispatch_date)
      ORDER BY DATE(md.dispatch_date) ASC
    `,C=F.replace(/mc\./g,"ms.").replace(/m\.machine_id/g,"sm.machine_id").replace(/collection_date/g,"sales_date"),b=`
      SELECT 
        DATE(ms.sales_date) as date,
        COUNT(*) as total_sales,
        SUM(ms.quantity) as total_quantity,
        SUM(ms.total_amount) as total_amount,
        AVG(ms.rate_per_liter) as avg_rate
      FROM \`${r}\`.milk_sales ms
      LEFT JOIN \`${r}\`.machines sm ON ms.machine_id = sm.id
      LEFT JOIN \`${r}\`.societies s ON ms.society_id = s.id
      LEFT JOIN \`${r}\`.bmcs b ON s.bmc_id = b.id
      LEFT JOIN \`${r}\`.dairy_farms df ON b.dairy_farm_id = df.id
      ${C}
      GROUP BY DATE(ms.sales_date)
      ORDER BY DATE(ms.sales_date) ASC
    `,q=`
      SELECT 
        COALESCE(df.name, 'Unknown') as dairy_name,
        COUNT(DISTINCT mc.id) as total_collections,
        SUM(mc.quantity) as total_quantity,
        SUM(mc.total_amount) as total_amount,
        AVG(mc.rate_per_liter) as avg_rate,
        SUM(mc.quantity * mc.fat_percentage) / NULLIF(SUM(mc.quantity), 0) as weighted_fat,
        SUM(mc.quantity * mc.snf_percentage) / NULLIF(SUM(mc.quantity), 0) as weighted_snf,
        SUM(mc.quantity * mc.clr_value) / NULLIF(SUM(mc.quantity), 0) as weighted_clr
      FROM \`${r}\`.milk_collections mc
      LEFT JOIN \`${r}\`.machines m ON mc.machine_id = m.id
      LEFT JOIN \`${r}\`.societies s ON mc.society_id = s.id
      LEFT JOIN \`${r}\`.bmcs b ON s.bmc_id = b.id
      LEFT JOIN \`${r}\`.dairy_farms df ON b.dairy_farm_id = df.id
      ${F}
      GROUP BY df.name
      ORDER BY total_quantity DESC
    `,w=`
      SELECT 
        COALESCE(b.name, 'Unknown') as bmc_name,
        COUNT(DISTINCT mc.id) as total_collections,
        SUM(mc.quantity) as total_quantity,
        SUM(mc.total_amount) as total_amount,
        AVG(mc.rate_per_liter) as avg_rate,
        SUM(mc.quantity * mc.fat_percentage) / NULLIF(SUM(mc.quantity), 0) as weighted_fat,
        SUM(mc.quantity * mc.snf_percentage) / NULLIF(SUM(mc.quantity), 0) as weighted_snf,
        SUM(mc.quantity * mc.clr_value) / NULLIF(SUM(mc.quantity), 0) as weighted_clr
      FROM \`${r}\`.milk_collections mc
      LEFT JOIN \`${r}\`.machines m ON mc.machine_id = m.id
      LEFT JOIN \`${r}\`.societies s ON mc.society_id = s.id
      LEFT JOIN \`${r}\`.bmcs b ON s.bmc_id = b.id
      LEFT JOIN \`${r}\`.dairy_farms df ON b.dairy_farm_id = df.id
      ${F}
      GROUP BY b.name
      ORDER BY total_quantity DESC
      LIMIT 20
    `,D=`
      SELECT 
        COALESCE(s.name, 'Unknown') as society_name,
        COUNT(DISTINCT mc.id) as total_collections,
        SUM(mc.quantity) as total_quantity,
        SUM(mc.total_amount) as total_amount,
        AVG(mc.rate_per_liter) as avg_rate,
        SUM(mc.quantity * mc.fat_percentage) / NULLIF(SUM(mc.quantity), 0) as weighted_fat,
        SUM(mc.quantity * mc.snf_percentage) / NULLIF(SUM(mc.quantity), 0) as weighted_snf,
        SUM(mc.quantity * mc.clr_value) / NULLIF(SUM(mc.quantity), 0) as weighted_clr
      FROM \`${r}\`.milk_collections mc
      LEFT JOIN \`${r}\`.machines m ON mc.machine_id = m.id
      LEFT JOIN \`${r}\`.societies s ON mc.society_id = s.id
      LEFT JOIN \`${r}\`.bmcs b ON s.bmc_id = b.id
      LEFT JOIN \`${r}\`.dairy_farms df ON b.dairy_farm_id = df.id
      ${F}
      GROUP BY s.name
      ORDER BY total_quantity DESC
      LIMIT 20
    `,A=`
      SELECT 
        m.machine_id as machine_id,
        mc.machine_type,
        COUNT(DISTINCT mc.id) as total_collections,
        SUM(mc.quantity) as total_quantity,
        SUM(mc.total_amount) as total_amount,
        AVG(mc.rate_per_liter) as avg_rate,
        SUM(mc.quantity * mc.fat_percentage) / NULLIF(SUM(mc.quantity), 0) as weighted_fat,
        SUM(mc.quantity * mc.snf_percentage) / NULLIF(SUM(mc.quantity), 0) as weighted_snf,
        SUM(mc.quantity * mc.clr_value) / NULLIF(SUM(mc.quantity), 0) as weighted_clr
      FROM \`${r}\`.milk_collections mc
      LEFT JOIN \`${r}\`.machines m ON mc.machine_id = m.id
      LEFT JOIN \`${r}\`.societies s ON mc.society_id = s.id
      LEFT JOIN \`${r}\`.bmcs b ON s.bmc_id = b.id
      LEFT JOIN \`${r}\`.dairy_farms df ON b.dairy_farm_id = df.id
      ${F}
      GROUP BY m.machine_id, mc.machine_type
      ORDER BY total_quantity DESC
      LIMIT 20
    `,J=`
      SELECT 
        CASE 
          WHEN mc.shift_type IN ('MR', 'MX', 'morning') THEN 'Morning'
          WHEN mc.shift_type IN ('EV', 'EX', 'evening') THEN 'Evening'
          ELSE mc.shift_type
        END as shift,
        COUNT(*) as total_collections,
        SUM(mc.quantity) as total_quantity,
        SUM(mc.total_amount) as total_amount,
        SUM(mc.quantity * mc.fat_percentage) / NULLIF(SUM(mc.quantity), 0) as weighted_fat,
        SUM(mc.quantity * mc.snf_percentage) / NULLIF(SUM(mc.quantity), 0) as weighted_snf,
        SUM(mc.quantity * mc.clr_value) / NULLIF(SUM(mc.quantity), 0) as weighted_clr
      FROM \`${r}\`.milk_collections mc
      LEFT JOIN \`${r}\`.societies s ON mc.society_id = s.id
      LEFT JOIN \`${r}\`.bmcs b ON s.bmc_id = b.id
      LEFT JOIN \`${r}\`.dairy_farms df ON b.dairy_farm_id = df.id
      ${F}
      GROUP BY shift
    `,v=`
      SELECT 
        CASE 
          WHEN UPPER(mc.channel) IN ('CH1', 'COW') THEN 'COW'
          WHEN UPPER(mc.channel) IN ('CH2', 'BUFFALO') THEN 'BUFFALO'
          WHEN UPPER(mc.channel) IN ('CH3', 'MIXED') THEN 'MIXED'
          ELSE UPPER(mc.channel)
        END as channel,
        COUNT(*) as total_collections,
        SUM(mc.quantity) as total_quantity,
        SUM(mc.total_amount) as total_amount,
        SUM(mc.quantity * mc.fat_percentage) / NULLIF(SUM(mc.quantity), 0) as weighted_fat,
        SUM(mc.quantity * mc.snf_percentage) / NULLIF(SUM(mc.quantity), 0) as weighted_snf,
        SUM(mc.quantity * mc.clr_value) / NULLIF(SUM(mc.quantity), 0) as weighted_clr
      FROM \`${r}\`.milk_collections mc
      LEFT JOIN \`${r}\`.machines m ON mc.machine_id = m.id
      LEFT JOIN \`${r}\`.societies s ON mc.society_id = s.id
      LEFT JOIN \`${r}\`.bmcs b ON s.bmc_id = b.id
      LEFT JOIN \`${r}\`.dairy_farms df ON b.dairy_farm_id = df.id
      ${F}
      GROUP BY channel
    `,B=`
      SELECT 
        COALESCE(df.name, 'Unknown') as dairy_name,
        COUNT(DISTINCT md.id) as total_dispatches,
        SUM(md.quantity) as total_quantity,
        SUM(md.total_amount) as total_amount,
        AVG(md.rate_per_liter) as avg_rate
      FROM \`${r}\`.milk_dispatches md
      LEFT JOIN \`${r}\`.machines dm ON md.machine_id = dm.id
      LEFT JOIN \`${r}\`.societies s ON md.society_id = s.id
      LEFT JOIN \`${r}\`.bmcs b ON s.bmc_id = b.id
      LEFT JOIN \`${r}\`.dairy_farms df ON b.dairy_farm_id = df.id
      ${R}
      GROUP BY df.name
      ORDER BY total_quantity DESC
    `,P=`
      SELECT 
        COALESCE(b.name, 'Unknown') as bmc_name,
        COUNT(DISTINCT md.id) as total_dispatches,
        SUM(md.quantity) as total_quantity,
        SUM(md.total_amount) as total_amount,
        AVG(md.rate_per_liter) as avg_rate
      FROM \`${r}\`.milk_dispatches md
      LEFT JOIN \`${r}\`.machines dm ON md.machine_id = dm.id
      LEFT JOIN \`${r}\`.societies s ON md.society_id = s.id
      LEFT JOIN \`${r}\`.bmcs b ON s.bmc_id = b.id
      LEFT JOIN \`${r}\`.dairy_farms df ON b.dairy_farm_id = df.id
      ${R}
      GROUP BY b.name
      ORDER BY total_quantity DESC
      LIMIT 20
    `,k=`
      SELECT 
        COALESCE(s.name, 'Unknown') as society_name,
        COUNT(DISTINCT md.id) as total_dispatches,
        SUM(md.quantity) as total_quantity,
        SUM(md.total_amount) as total_amount,
        AVG(md.rate_per_liter) as avg_rate
      FROM \`${r}\`.milk_dispatches md
      LEFT JOIN \`${r}\`.machines dm ON md.machine_id = dm.id
      LEFT JOIN \`${r}\`.societies s ON md.society_id = s.id
      LEFT JOIN \`${r}\`.bmcs b ON s.bmc_id = b.id
      LEFT JOIN \`${r}\`.dairy_farms df ON b.dairy_farm_id = df.id
      ${R}
      GROUP BY s.name
      ORDER BY total_quantity DESC
      LIMIT 20
    `,H=`
      SELECT 
        dm.machine_id as machine_id,
        md.machine_type,
        COUNT(DISTINCT md.id) as total_dispatches,
        SUM(md.quantity) as total_quantity,
        SUM(md.total_amount) as total_amount,
        AVG(md.rate_per_liter) as avg_rate
      FROM \`${r}\`.milk_dispatches md
      LEFT JOIN \`${r}\`.machines dm ON md.machine_id = dm.id
      LEFT JOIN \`${r}\`.societies s ON md.society_id = s.id
      LEFT JOIN \`${r}\`.bmcs b ON s.bmc_id = b.id
      LEFT JOIN \`${r}\`.dairy_farms df ON b.dairy_farm_id = df.id
      ${R}
      GROUP BY dm.machine_id, md.machine_type
      ORDER BY total_quantity DESC
      LIMIT 20
    `,x=`
      SELECT 
        CASE 
          WHEN UPPER(md.channel) IN ('CH1', 'COW') THEN 'COW'
          WHEN UPPER(md.channel) IN ('CH2', 'BUFFALO') THEN 'BUFFALO'
          WHEN UPPER(md.channel) IN ('CH3', 'MIXED') THEN 'MIXED'
          ELSE UPPER(md.channel)
        END as channel,
        COUNT(*) as total_dispatches,
        SUM(md.quantity) as total_quantity,
        SUM(md.total_amount) as total_amount
      FROM \`${r}\`.milk_dispatches md
      LEFT JOIN \`${r}\`.machines dm ON md.machine_id = dm.id
      LEFT JOIN \`${r}\`.societies s ON md.society_id = s.id
      LEFT JOIN \`${r}\`.bmcs b ON s.bmc_id = b.id
      LEFT JOIN \`${r}\`.dairy_farms df ON b.dairy_farm_id = df.id
      ${R}
      GROUP BY channel
    `,G=`
      SELECT 
        COALESCE(df.name, 'Unknown') as dairy_name,
        COUNT(DISTINCT ms.id) as total_sales,
        SUM(ms.quantity) as total_quantity,
        SUM(ms.total_amount) as total_amount,
        AVG(ms.rate_per_liter) as avg_rate
      FROM \`${r}\`.milk_sales ms
      LEFT JOIN \`${r}\`.machines sm ON ms.machine_id = sm.id
      LEFT JOIN \`${r}\`.societies s ON ms.society_id = s.id
      LEFT JOIN \`${r}\`.bmcs b ON s.bmc_id = b.id
      LEFT JOIN \`${r}\`.dairy_farms df ON b.dairy_farm_id = df.id
      ${C}
      GROUP BY df.name
      ORDER BY total_quantity DESC
    `,Y=`
      SELECT 
        COALESCE(b.name, 'Unknown') as bmc_name,
        COUNT(DISTINCT ms.id) as total_sales,
        SUM(ms.quantity) as total_quantity,
        SUM(ms.total_amount) as total_amount,
        AVG(ms.rate_per_liter) as avg_rate
      FROM \`${r}\`.milk_sales ms
      LEFT JOIN \`${r}\`.machines sm ON ms.machine_id = sm.id
      LEFT JOIN \`${r}\`.societies s ON ms.society_id = s.id
      LEFT JOIN \`${r}\`.bmcs b ON s.bmc_id = b.id
      LEFT JOIN \`${r}\`.dairy_farms df ON b.dairy_farm_id = df.id
      ${C}
      GROUP BY b.name
      ORDER BY total_quantity DESC
      LIMIT 20
    `,W=`
      SELECT 
        COALESCE(s.name, 'Unknown') as society_name,
        COUNT(DISTINCT ms.id) as total_sales,
        SUM(ms.quantity) as total_quantity,
        SUM(ms.total_amount) as total_amount,
        AVG(ms.rate_per_liter) as avg_rate
      FROM \`${r}\`.milk_sales ms
      LEFT JOIN \`${r}\`.machines sm ON ms.machine_id = sm.id
      LEFT JOIN \`${r}\`.societies s ON ms.society_id = s.id
      LEFT JOIN \`${r}\`.bmcs b ON s.bmc_id = b.id
      LEFT JOIN \`${r}\`.dairy_farms df ON b.dairy_farm_id = df.id
      ${C}
      GROUP BY s.name
      ORDER BY total_quantity DESC
      LIMIT 20
    `,V=`
      SELECT 
        sm.machine_id as machine_id,
        ms.machine_type,
        COUNT(DISTINCT ms.id) as total_sales,
        SUM(ms.quantity) as total_quantity,
        SUM(ms.total_amount) as total_amount,
        AVG(ms.rate_per_liter) as avg_rate
      FROM \`${r}\`.milk_sales ms
      LEFT JOIN \`${r}\`.machines sm ON ms.machine_id = sm.id
      LEFT JOIN \`${r}\`.societies s ON ms.society_id = s.id
      LEFT JOIN \`${r}\`.bmcs b ON s.bmc_id = b.id
      LEFT JOIN \`${r}\`.dairy_farms df ON b.dairy_farm_id = df.id
      ${C}
      GROUP BY sm.machine_id, ms.machine_type
      ORDER BY total_quantity DESC
      LIMIT 20
    `,j=`
      SELECT 
        CASE 
          WHEN UPPER(ms.channel) IN ('CH1', 'COW') THEN 'COW'
          WHEN UPPER(ms.channel) IN ('CH2', 'BUFFALO') THEN 'BUFFALO'
          WHEN UPPER(ms.channel) IN ('CH3', 'MIXED') THEN 'MIXED'
          ELSE UPPER(ms.channel)
        END as channel,
        COUNT(*) as total_sales,
        SUM(ms.quantity) as total_quantity,
        SUM(ms.total_amount) as total_amount
      FROM \`${r}\`.milk_sales ms
      LEFT JOIN \`${r}\`.machines sm ON ms.machine_id = sm.id
      LEFT JOIN \`${r}\`.societies s ON ms.society_id = s.id
      LEFT JOIN \`${r}\`.bmcs b ON s.bmc_id = b.id
      LEFT JOIN \`${r}\`.dairy_farms df ON b.dairy_farm_id = df.id
      ${C}
      GROUP BY channel
    `,X=`
      SELECT 
        MIN(DATE(collection_date)) as earliest_date,
        MAX(DATE(collection_date)) as latest_date,
        COUNT(*) as total_records
      FROM \`${r}\`.milk_collections
    `,[K]=await d.query(X);console.log(`ðŸ—„ï¸  Database contains ${K[0]?.total_records||0} collection records`),console.log(`ðŸ“† Date range in DB: ${K[0]?.earliest_date||"N/A"} to ${K[0]?.latest_date||"N/A"}`);let z=async(t,e)=>{try{let[a]=await d.query(t);return console.log(`âœ… ${e}: ${a.length} records`),a}catch(t){return console.error(`âŒ Error executing ${e} query:`,t),[]}},[Z,Q,tt,te,ta,ti,ts,tn,td,tc,tm,to,tr,tl,t_,tu,tE,tN,tO]=await Promise.all([z(M,"dailyCollection"),z($,"dailyDispatch"),z(b,"dailySales"),z(q,"dairyBreakdown"),z(w,"bmcBreakdown"),z(D,"societyBreakdown"),z(A,"machineBreakdown"),z(J,"shiftBreakdown"),z(v,"channelBreakdown"),z(B,"dairyDispatchBreakdown"),z(P,"bmcDispatchBreakdown"),z(k,"societyDispatchBreakdown"),z(H,"machineDispatchBreakdown"),z(x,"channelDispatchBreakdown"),z(G,"dairySalesBreakdown"),z(Y,"bmcSalesBreakdown"),z(W,"societySalesBreakdown"),z(V,"machineSalesBreakdown"),z(j,"channelSalesBreakdown")]);return U.NextResponse.json({dailyCollections:Z,dailyDispatches:Q,dailySales:tt,dairyBreakdown:te,bmcBreakdown:ta,societyBreakdown:ti,machineBreakdown:ts,shiftBreakdown:tn,channelBreakdown:td,dairyDispatchBreakdown:tc,bmcDispatchBreakdown:tm,societyDispatchBreakdown:to,machineDispatchBreakdown:tr,channelDispatchBreakdown:tl,dairySalesBreakdown:t_,bmcSalesBreakdown:tu,societySalesBreakdown:tE,machineSalesBreakdown:tN,channelSalesBreakdown:tO})}catch(t){return console.error("Error fetching analytics data:",t),t instanceof Error&&(console.error("Error message:",t.message),console.error("Error stack:",t.stack)),U.NextResponse.json({error:"Failed to fetch analytics data",message:t instanceof Error?t.message:"Unknown error"},{status:500})}}t.s(["GET",()=>L],15901);var I=t.i(15901);let S=new e.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/user/analytics/route",pathname:"/api/user/analytics",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/user/analytics/route.ts",nextConfigOutput:"",userland:I}),{workAsyncStorage:g,workUnitAsyncStorage:F,serverHooks:M}=S;function R(){return(0,i.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:F})}async function $(t,e,i){S.isDev&&(0,s.addRequestMeta)(t,"devRequestTimingInternalsEnd",process.hrtime.bigint());let U="/api/user/analytics/route";U=U.replace(/\/index$/,"")||"/";let T=await S.prepare(t,e,{srcPage:U,multiZoneDraftMode:!1});if(!T)return e.statusCode=400,e.end("Bad Request"),null==i.waitUntil||i.waitUntil.call(i,Promise.resolve()),null;let{buildId:p,params:f,nextConfig:L,parsedUrl:I,isDraftMode:g,prerenderManifest:F,routerServerContext:M,isOnDemandRevalidate:R,revalidateOnlyGenerated:$,resolvedPathname:C,clientReferenceManifest:b,serverActionsManifest:q}=T,w=(0,m.normalizeAppPath)(U),D=!!(F.dynamicRoutes[w]||F.routes[C]),A=async()=>((null==M?void 0:M.render404)?await M.render404(t,e,I,!1):e.end("This page could not be found"),null);if(D&&!g){let t=!!F.routes[C],e=F.dynamicRoutes[w];if(e&&!1===e.fallback&&!t){if(L.experimental.adapterPath)return await A();throw new y.NoFallbackError}}let J=null;!D||S.isDev||g||(J="/index"===(J=C)?"/":J);let v=!0===S.isDev||!D,B=D&&!v;q&&b&&(0,d.setReferenceManifestsSingleton)({page:U,clientReferenceManifest:b,serverActionsManifest:q,serverModuleMap:(0,c.createServerModuleMap)({serverActionsManifest:q})});let P=t.method||"GET",k=(0,n.getTracer)(),H=k.getActiveScopeSpan(),x={params:f,prerenderManifest:F,renderOpts:{experimental:{authInterrupts:!!L.experimental.authInterrupts},cacheComponents:!!L.cacheComponents,supportsDynamicResponse:v,incrementalCache:(0,s.getRequestMeta)(t,"incrementalCache"),cacheLifeProfiles:L.cacheLife,waitUntil:i.waitUntil,onClose:t=>{e.on("close",t)},onAfterTaskError:void 0,onInstrumentationRequestError:(e,a,i)=>S.onRequestError(t,e,i,M)},sharedContext:{buildId:p}},G=new o.NodeNextRequest(t),Y=new o.NodeNextResponse(e),W=r.NextRequestAdapter.fromNodeNextRequest(G,(0,r.signalFromNodeResponse)(e));try{let d=async t=>S.handle(W,x).finally(()=>{if(!t)return;t.setAttributes({"http.status_code":e.statusCode,"next.rsc":!1});let a=k.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=a.get("next.route");if(i){let e=`${P} ${i}`;t.setAttributes({"next.route":i,"http.route":i,"next.span_name":e}),t.updateName(e)}else t.updateName(`${P} ${U}`)}),c=!!(0,s.getRequestMeta)(t,"minimalMode"),m=async s=>{var n,m;let o=async({previousCacheEntry:a})=>{try{if(!c&&R&&$&&!a)return e.statusCode=404,e.setHeader("x-nextjs-cache","REVALIDATED"),e.end("This page could not be found"),null;let n=await d(s);t.fetchMetrics=x.renderOpts.fetchMetrics;let m=x.renderOpts.pendingWaitUntil;m&&i.waitUntil&&(i.waitUntil(m),m=void 0);let o=x.renderOpts.collectedTags;if(!D)return await (0,u.sendResponse)(G,Y,n,x.renderOpts.pendingWaitUntil),null;{let t=await n.blob(),e=(0,E.toNodeOutgoingHttpHeaders)(n.headers);o&&(e[O.NEXT_CACHE_TAGS_HEADER]=o),!e["content-type"]&&t.type&&(e["content-type"]=t.type);let a=void 0!==x.renderOpts.collectedRevalidate&&!(x.renderOpts.collectedRevalidate>=O.INFINITE_CACHE)&&x.renderOpts.collectedRevalidate,i=void 0===x.renderOpts.collectedExpire||x.renderOpts.collectedExpire>=O.INFINITE_CACHE?void 0:x.renderOpts.collectedExpire;return{value:{kind:h.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await t.arrayBuffer()),headers:e},cacheControl:{revalidate:a,expire:i}}}}catch(e){throw(null==a?void 0:a.isStale)&&await S.onRequestError(t,e,{routerKind:"App Router",routePath:U,routeType:"route",revalidateReason:(0,_.getRevalidateReason)({isStaticGeneration:B,isOnDemandRevalidate:R})},M),e}},r=await S.handleResponse({req:t,nextConfig:L,cacheKey:J,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:F,isRoutePPREnabled:!1,isOnDemandRevalidate:R,revalidateOnlyGenerated:$,responseGenerator:o,waitUntil:i.waitUntil,isMinimalMode:c});if(!D)return null;if((null==r||null==(n=r.value)?void 0:n.kind)!==h.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==r||null==(m=r.value)?void 0:m.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});c||e.setHeader("x-nextjs-cache",R?"REVALIDATED":r.isMiss?"MISS":r.isStale?"STALE":"HIT"),g&&e.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let l=(0,E.fromNodeOutgoingHttpHeaders)(r.value.headers);return c&&D||l.delete(O.NEXT_CACHE_TAGS_HEADER),!r.cacheControl||e.getHeader("Cache-Control")||l.get("Cache-Control")||l.set("Cache-Control",(0,N.getCacheControlHeader)(r.cacheControl)),await (0,u.sendResponse)(G,Y,new Response(r.value.body,{headers:l,status:r.value.status||200})),null};H?await m(H):await k.withPropagatedContext(t.headers,()=>k.trace(l.BaseServerSpan.handleRequest,{spanName:`${P} ${U}`,kind:n.SpanKind.SERVER,attributes:{"http.method":P,"http.target":t.url}},m))}catch(e){if(e instanceof y.NoFallbackError||await S.onRequestError(t,e,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,_.getRevalidateReason)({isStaticGeneration:B,isOnDemandRevalidate:R})}),D)throw e;return await (0,u.sendResponse)(G,Y,new Response(null,{status:500})),null}}t.s(["handler",()=>$,"patchFetch",()=>R,"routeModule",()=>S,"serverHooks",()=>M,"workAsyncStorage",()=>g,"workUnitAsyncStorage",()=>F],409361)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_b492146b.js.map