module.exports=[136543,e=>{"use strict";var t=e.i(89171);e.i(79832),e.i(213075),e.s(["createErrorResponse",0,(e,r=400)=>t.NextResponse.json({success:!1,error:{message:e,code:r.toString()},timestamp:new Date().toISOString()},{status:r}),"createSuccessResponse",0,(e,r="Success",a=200)=>t.NextResponse.json({success:!0,message:r,data:e,timestamp:new Date().toISOString()},{status:a}),"validateRequiredFields",0,(e,t)=>{let r=t.filter(t=>!e[t]||"string"==typeof e[t]&&""===e[t].trim());return r.length>0?{success:!1,missing:r}:{success:!0}}])},912785,e=>{"use strict";var t=e.i(747909),r=e.i(174017),a=e.i(996250),n=e.i(759756),o=e.i(561916),s=e.i(114444),i=e.i(837092),l=e.i(869741),d=e.i(316795),u=e.i(487718),c=e.i(995169),p=e.i(47587),h=e.i(666012),R=e.i(570101),f=e.i(626937),w=e.i(10372),v=e.i(193695);e.i(52474);var m=e.i(600220),E=e.i(84168),g=e.i(79832),y=e.i(136543);async function C(t){try{await (0,E.connectDB)();let{getModels:r}=await e.A(121985),{sequelize:a,User:n}=r(),o=t.headers.get("authorization");if(!o?.startsWith("Bearer "))return(0,y.createErrorResponse)("Unauthorized",401);let s=o.substring(7),i=await (0,g.verifyToken)(s);if(!i)return(0,y.createErrorResponse)("Invalid token",401);if("admin"!==i.role)return(0,y.createErrorResponse)("Unauthorized - Admin access required",403);let{chartIds:l,machineIds:d,channel:u}=await t.json();if(!l||!Array.isArray(l)||0===l.length||!d||!Array.isArray(d)||0===d.length)return(0,y.createErrorResponse)("Chart IDs and machine IDs are required",400);if(!u||!["COW","BUF","MIX"].includes(u))return(0,y.createErrorResponse)("Valid channel (COW, BUF, or MIX) is required",400);let c=await n.findByPk(i.id);if(!c||!c.dbKey)return(0,y.createErrorResponse)("Admin schema not found",404);let p=c.fullName.replace(/[^a-zA-Z0-9]/g,"").toLowerCase(),h=`${p}_${c.dbKey.toLowerCase()}`,R=l.map(()=>"?").join(", "),f=d.map(()=>"?").join(", "),w=`
      DELETE FROM \`${h}\`.rate_chart_download_history
      WHERE rate_chart_id IN (${R}) AND machine_id IN (${f}) AND channel = ?
    `,[v]=await a.query(w,{replacements:[...l,...d,u]}),m=v.affectedRows||0;return(0,y.createSuccessResponse)(`Reset ${u} channel download history for ${m} machine(s). They can now re-download the ${u} chart.`,JSON.stringify({deletedCount:m,chartIds:l,machineIds:d,channel:u}))}catch(e){return console.error("Error resetting download history:",e),(0,y.createErrorResponse)("Failed to reset download history",500)}}e.s(["POST",()=>C],4338);var A=e.i(4338);let _=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/user/ratechart/reset-download/route",pathname:"/api/user/ratechart/reset-download",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/user/ratechart/reset-download/route.ts",nextConfigOutput:"",userland:A}),{workAsyncStorage:x,workUnitAsyncStorage:N,serverHooks:S}=_;function O(){return(0,a.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:N})}async function T(e,t,a){_.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let E="/api/user/ratechart/reset-download/route";E=E.replace(/\/index$/,"")||"/";let g=await _.prepare(e,t,{srcPage:E,multiZoneDraftMode:!1});if(!g)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:y,params:C,nextConfig:A,parsedUrl:x,isDraftMode:N,prerenderManifest:S,routerServerContext:O,isOnDemandRevalidate:T,revalidateOnlyGenerated:P,resolvedPathname:b,clientReferenceManifest:I,serverActionsManifest:D}=g,U=(0,l.normalizeAppPath)(E),q=!!(S.dynamicRoutes[U]||S.routes[b]),M=async()=>((null==O?void 0:O.render404)?await O.render404(e,t,x,!1):t.end("This page could not be found"),null);if(q&&!N){let e=!!S.routes[b],t=S.dynamicRoutes[U];if(t&&!1===t.fallback&&!e){if(A.experimental.adapterPath)return await M();throw new v.NoFallbackError}}let k=null;!q||_.isDev||N||(k="/index"===(k=b)?"/":k);let H=!0===_.isDev||!q,$=q&&!H;D&&I&&(0,s.setReferenceManifestsSingleton)({page:E,clientReferenceManifest:I,serverActionsManifest:D,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:D})});let j=e.method||"GET",F=(0,o.getTracer)(),B=F.getActiveScopeSpan(),K={params:C,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!A.experimental.authInterrupts},cacheComponents:!!A.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:A.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>_.onRequestError(e,t,a,O)},sharedContext:{buildId:y}},L=new d.NodeNextRequest(e),W=new d.NodeNextResponse(t),z=u.NextRequestAdapter.fromNodeNextRequest(L,(0,u.signalFromNodeResponse)(t));try{let s=async e=>_.handle(z,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=F.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${j} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${j} ${E}`)}),i=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var o,l;let d=async({previousCacheEntry:r})=>{try{if(!i&&T&&P&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await s(n);e.fetchMetrics=K.renderOpts.fetchMetrics;let l=K.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let d=K.renderOpts.collectedTags;if(!q)return await (0,h.sendResponse)(L,W,o,K.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,R.toNodeOutgoingHttpHeaders)(o.headers);d&&(t[w.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=w.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,a=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=w.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:m.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await _.onRequestError(e,t,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:$,isOnDemandRevalidate:T})},O),t}},u=await _.handleResponse({req:e,nextConfig:A,cacheKey:k,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:P,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:i});if(!q)return null;if((null==u||null==(o=u.value)?void 0:o.kind)!==m.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",T?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),N&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,R.fromNodeOutgoingHttpHeaders)(u.value.headers);return i&&q||c.delete(w.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,f.getCacheControlHeader)(u.cacheControl)),await (0,h.sendResponse)(L,W,new Response(u.value.body,{headers:c,status:u.value.status||200})),null};B?await l(B):await F.withPropagatedContext(e.headers,()=>F.trace(c.BaseServerSpan.handleRequest,{spanName:`${j} ${E}`,kind:o.SpanKind.SERVER,attributes:{"http.method":j,"http.target":e.url}},l))}catch(t){if(t instanceof v.NoFallbackError||await _.onRequestError(e,t,{routerKind:"App Router",routePath:U,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:$,isOnDemandRevalidate:T})}),q)throw t;return await (0,h.sendResponse)(L,W,new Response(null,{status:500})),null}}e.s(["handler",()=>T,"patchFetch",()=>O,"routeModule",()=>_,"serverHooks",()=>S,"workAsyncStorage",()=>x,"workUnitAsyncStorage",()=>N],912785)},453753,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__86f7d54e._.js"].map(t=>e.l(t))).then(()=>t(736987)))},121985,e=>{e.v(t=>Promise.all(["server/chunks/src_models_index_ts_328304ec._.js"].map(t=>e.l(t))).then(()=>t(540590)))}];

//# sourceMappingURL=_182816fd._.js.map