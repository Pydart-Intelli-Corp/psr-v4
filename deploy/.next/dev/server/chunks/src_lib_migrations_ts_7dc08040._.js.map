{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///P:/psr-cloud-v2/src/lib/migrations.ts"],"sourcesContent":["import { exec } from 'child_process';\r\nimport { promisify } from 'util';\r\n\r\nconst execAsync = promisify(exec);\r\n\r\nexport class MigrationRunner {\r\n  constructor() {}\r\n\r\n  /**\r\n   * Run all pending migrations\r\n   */\r\n  async up(): Promise<void> {\r\n    try {\r\n      console.log('üöÄ Running database migrations...');\r\n      const { stdout, stderr } = await execAsync('npx sequelize-cli db:migrate');\r\n      \r\n      if (stderr && !stderr.includes('WARNING')) {\r\n        throw new Error(stderr);\r\n      }\r\n      \r\n      console.log('‚úÖ Migrations completed successfully');\r\n      if (stdout) console.log(stdout);\r\n    } catch (error) {\r\n      console.error('‚ùå Migration failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Rollback last migration\r\n   */\r\n  async down(): Promise<void> {\r\n    try {\r\n      console.log('‚è™ Rolling back last migration...');\r\n      const { stdout, stderr } = await execAsync('npx sequelize-cli db:migrate:undo');\r\n      \r\n      if (stderr && !stderr.includes('WARNING')) {\r\n        throw new Error(stderr);\r\n      }\r\n      \r\n      console.log('‚úÖ Rollback completed successfully');\r\n      if (stdout) console.log(stdout);\r\n    } catch (error) {\r\n      console.error('‚ùå Rollback failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check migration status\r\n   */\r\n  async status(): Promise<void> {\r\n    try {\r\n      console.log('üìä Checking migration status...');\r\n      \r\n      // List executed migrations\r\n      console.log('\\n--- Executed Migrations ---');\r\n      const { stdout: executedStdout } = await execAsync('npx sequelize-cli db:migrate:status');\r\n      console.log(executedStdout || 'No migrations executed yet');\r\n      \r\n    } catch (error) {\r\n      console.error('‚ùå Status check failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get migration status (alias for status method)\r\n   */\r\n  async getMigrationStatus(): Promise<string> {\r\n    try {\r\n      console.log('üìä Getting migration status...');\r\n      const { stdout } = await execAsync('npx sequelize-cli db:migrate:status');\r\n      return stdout || 'No migrations executed yet';\r\n    } catch (error) {\r\n      console.error('‚ùå Get migration status failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Run migrations (alias for up method)\r\n   */\r\n  async runMigrations(): Promise<void> {\r\n    return this.up();\r\n  }\r\n\r\n  /**\r\n   * Undo last migration (alias for down method)  \r\n   */\r\n  async undoLastMigration(): Promise<void> {\r\n    return this.down();\r\n  }\r\n\r\n  /**\r\n   * Run seeders (alias for seed method)\r\n   */\r\n  async runSeeders(): Promise<void> {\r\n    return this.seed();\r\n  }\r\n\r\n  /**\r\n   * Undo all seeders\r\n   */\r\n  async undoSeeders(): Promise<void> {\r\n    try {\r\n      console.log('üîÑ Undoing all seeders...');\r\n      const { stdout, stderr } = await execAsync('npx sequelize-cli db:seed:undo:all');\r\n      \r\n      if (stderr && !stderr.includes('WARNING')) {\r\n        throw new Error(stderr);\r\n      }\r\n      \r\n      console.log('‚úÖ All seeders undone successfully');\r\n      if (stdout) console.log(stdout);\r\n    } catch (error) {\r\n      console.error('‚ùå Undo seeders failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize database (alias for init method)\r\n   */\r\n  async initializeDatabase(): Promise<void> {\r\n    return this.init();\r\n  }\r\n\r\n  /**\r\n   * Seed the database\r\n   */\r\n  async seed(): Promise<void> {\r\n    try {\r\n      console.log('üå± Seeding database...');\r\n      const { stdout, stderr } = await execAsync('npx sequelize-cli db:seed:all');\r\n      \r\n      if (stderr && !stderr.includes('WARNING')) {\r\n        throw new Error(stderr);\r\n      }\r\n      \r\n      console.log('‚úÖ Seeding completed successfully');\r\n      if (stdout) console.log(stdout);\r\n    } catch (error) {\r\n      console.error('‚ùå Seeding failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize database (create + migrate + seed)\r\n   */\r\n  async init(): Promise<void> {\r\n    try {\r\n      console.log('üèóÔ∏è  Initializing database...');\r\n      \r\n      // Create database\r\n      console.log('Creating database...');\r\n      try {\r\n        await execAsync('npx sequelize-cli db:create');\r\n      } catch (createError) {\r\n        // Database might already exist, which is fine\r\n        console.log('Database already exists or creation failed, continuing...');\r\n      }\r\n      \r\n      // Run migrations\r\n      await this.up();\r\n      \r\n      // Run seeds\r\n      await this.seed();\r\n      \r\n      console.log('‚úÖ Database initialization completed successfully');\r\n    } catch (error) {\r\n      console.error('‚ùå Database initialization failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Reset database (drop + create + migrate + seed)\r\n   */\r\n  async reset(): Promise<void> {\r\n    try {\r\n      console.log('üîÑ Resetting database...');\r\n      const { stdout, stderr } = await execAsync('npm run db:reset');\r\n      \r\n      if (stderr && !stderr.includes('WARNING')) {\r\n        throw new Error(stderr);\r\n      }\r\n      \r\n      console.log('‚úÖ Database reset completed successfully');\r\n      if (stdout) console.log(stdout);\r\n    } catch (error) {\r\n      console.error('‚ùå Database reset failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const migrationRunner = new MigrationRunner();"],"names":[],"mappings":"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","debugId":null}}]
}