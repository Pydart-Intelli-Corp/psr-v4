{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///P:/psr-cloud-v2/src/contexts/UserContext.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { createContext, useContext, useState, useEffect, useCallback } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { UserRole } from '@/types/user';\r\n\r\ninterface User {\r\n  id: number;\r\n  uid: string;\r\n  fullName: string;\r\n  email: string;\r\n  role: UserRole;\r\n  dbKey?: string;\r\n  companyName?: string;\r\n  companyPincode?: string;\r\n  companyCity?: string;\r\n  companyState?: string;\r\n}\r\n\r\ninterface UserContextType {\r\n  user: User | null;\r\n  loading: boolean;\r\n  error: string | null;\r\n  fetchUser: () => Promise<void>;\r\n  logout: () => Promise<void>;\r\n  updateUser: (userData: Partial<User>) => void;\r\n}\r\n\r\nconst UserContext = createContext<UserContextType | undefined>(undefined);\r\n\r\nexport function UserProvider({ children }: { children: React.ReactNode }) {\r\n  const [user, setUser] = useState<User | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const router = useRouter();\r\n\r\n  const fetchUser = useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      \r\n      const token = localStorage.getItem('authToken');\r\n      if (!token) {\r\n        setUser(null);\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      const response = await fetch('/api/user/profile', {\r\n        headers: {\r\n          'Authorization': `Bearer ${token}`,\r\n          'Content-Type': 'application/json'\r\n        },\r\n        cache: 'no-store'\r\n      });\r\n\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setUser(data.data);\r\n      } else if (response.status === 401 || response.status === 403) {\r\n        localStorage.removeItem('authToken');\r\n        setUser(null);\r\n        router.push('/login');\r\n      } else {\r\n        setError('Failed to fetch user data');\r\n      }\r\n    } catch (err) {\r\n      console.error('Error fetching user:', err);\r\n      setError('Network error');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [router]);\r\n\r\n  const logout = useCallback(async () => {\r\n    try {\r\n      await fetch('/api/auth/logout', {\r\n        method: 'POST',\r\n        credentials: 'include'\r\n      });\r\n    } catch (error) {\r\n      console.error('Logout error:', error);\r\n    } finally {\r\n      localStorage.removeItem('authToken');\r\n      setUser(null);\r\n      router.push('/login');\r\n    }\r\n  }, [router]);\r\n\r\n  const updateUser = useCallback((userData: Partial<User>) => {\r\n    setUser(prev => prev ? { ...prev, ...userData } : null);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    fetchUser();\r\n  }, [fetchUser]);\r\n\r\n  return (\r\n    <UserContext.Provider value={{ user, loading, error, fetchUser, logout, updateUser }}>\r\n      {children}\r\n    </UserContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useUser() {\r\n  const context = useContext(UserContext);\r\n  if (context === undefined) {\r\n    throw new Error('useUser must be used within a UserProvider');\r\n  }\r\n  return context;\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AAHA;;;;AA4BA,MAAM,4BAAc,IAAA,sNAAa,EAA8B;AAExD,SAAS,aAAa,EAAE,QAAQ,EAAiC;IACtE,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAc;IAC9C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAgB;IAClD,MAAM,SAAS,IAAA,+IAAS;IAExB,MAAM,YAAY,IAAA,oNAAW,EAAC;QAC5B,IAAI;YACF,WAAW;YACX,SAAS;YAET,MAAM,QAAQ,aAAa,OAAO,CAAC;YACnC,IAAI,CAAC,OAAO;gBACV,QAAQ;gBACR,WAAW;gBACX;YACF;YAEA,MAAM,WAAW,MAAM,MAAM,qBAAqB;gBAChD,SAAS;oBACP,iBAAiB,CAAC,OAAO,EAAE,OAAO;oBAClC,gBAAgB;gBAClB;gBACA,OAAO;YACT;YAEA,IAAI,SAAS,EAAE,EAAE;gBACf,MAAM,OAAO,MAAM,SAAS,IAAI;gBAChC,QAAQ,KAAK,IAAI;YACnB,OAAO,IAAI,SAAS,MAAM,KAAK,OAAO,SAAS,MAAM,KAAK,KAAK;gBAC7D,aAAa,UAAU,CAAC;gBACxB,QAAQ;gBACR,OAAO,IAAI,CAAC;YACd,OAAO;gBACL,SAAS;YACX;QACF,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,wBAAwB;YACtC,SAAS;QACX,SAAU;YACR,WAAW;QACb;IACF,GAAG;QAAC;KAAO;IAEX,MAAM,SAAS,IAAA,oNAAW,EAAC;QACzB,IAAI;YACF,MAAM,MAAM,oBAAoB;gBAC9B,QAAQ;gBACR,aAAa;YACf;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,iBAAiB;QACjC,SAAU;YACR,aAAa,UAAU,CAAC;YACxB,QAAQ;YACR,OAAO,IAAI,CAAC;QACd;IACF,GAAG;QAAC;KAAO;IAEX,MAAM,aAAa,IAAA,oNAAW,EAAC,CAAC;QAC9B,QAAQ,CAAA,OAAQ,OAAO;gBAAE,GAAG,IAAI;gBAAE,GAAG,QAAQ;YAAC,IAAI;IACpD,GAAG,EAAE;IAEL,IAAA,kNAAS,EAAC;QACR;IACF,GAAG;QAAC;KAAU;IAEd,qBACE,8OAAC,YAAY,QAAQ;QAAC,OAAO;YAAE;YAAM;YAAS;YAAO;YAAW;YAAQ;QAAW;kBAChF;;;;;;AAGP;AAEO,SAAS;IACd,MAAM,UAAU,IAAA,mNAAU,EAAC;IAC3B,IAAI,YAAY,WAAW;QACzB,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 113, "column": 0}, "map": {"version":3,"sources":["file:///P:/psr-cloud-v2/src/types/user.ts"],"sourcesContent":["// User role types for client-side components\r\nexport enum UserRole {\r\n  SUPER_ADMIN = 'super_admin',\r\n  ADMIN = 'admin', \r\n  DAIRY = 'dairy',\r\n  BMC = 'bmc',\r\n  SOCIETY = 'society',\r\n  FARMER = 'farmer'\r\n}"],"names":[],"mappings":"AAAA,6CAA6C;;;;;AACtC,IAAA,AAAK,kCAAA;;;;;;;WAAA","debugId":null}},
    {"offset": {"line": 131, "column": 0}, "map": {"version":3,"sources":["file:///P:/psr-cloud-v2/src/lib/clientAuth.ts"],"sourcesContent":["'use client';\r\n\r\nimport type { AppRouterInstance } from 'next/dist/shared/lib/app-router-context.shared-runtime';\r\n\r\ninterface UserData {\r\n  id: number;\r\n  uid: string;\r\n  email: string;\r\n  role: string;\r\n  fullName: string;\r\n}\r\n\r\n/**\r\n * Verify if the current user session is valid by checking with the server\r\n */\r\nexport async function verifyUserSession(): Promise<{ isValid: boolean; user?: UserData }> {\r\n  try {\r\n    const token = localStorage.getItem('authToken');\r\n    \r\n    if (!token) {\r\n      console.log('üîç verifyUserSession: No token found');\r\n      return { isValid: false };\r\n    }\r\n\r\n    console.log('üîç verifyUserSession: Token found, making API call');\r\n    const response = await fetch('/api/auth/verify-session', {\r\n      method: 'GET',\r\n      headers: {\r\n        'Authorization': `Bearer ${token}`,\r\n        'Content-Type': 'application/json',\r\n      },\r\n    });\r\n\r\n    console.log('üîç verifyUserSession: API response status:', response.status);\r\n    \r\n    if (response.ok) {\r\n      const data = await response.json();\r\n      console.log('üîç verifyUserSession: API response data:', data);\r\n      \r\n      if (data.success && data.data && data.data.user) {\r\n        // Update localStorage with fresh user data\r\n        localStorage.setItem('userData', JSON.stringify(data.data.user));\r\n        console.log('‚úÖ verifyUserSession: Session valid, user:', data.data.user);\r\n        return { isValid: true, user: data.data.user };\r\n      }\r\n    }\r\n\r\n    // If verification fails, clear stored data\r\n    console.log('‚ùå verifyUserSession: Session invalid, clearing storage');\r\n    localStorage.removeItem('authToken');\r\n    localStorage.removeItem('userData');\r\n    return { isValid: false };\r\n  } catch (error) {\r\n    console.error('‚ùå verifyUserSession: Session verification failed:', error);\r\n    localStorage.removeItem('authToken');\r\n    localStorage.removeItem('userData');\r\n    return { isValid: false };\r\n  }\r\n}\r\n\r\n/**\r\n * Get the appropriate dashboard route for a user role\r\n */\r\nexport function getDashboardRoute(role: string): string {\r\n  switch (role) {\r\n    case 'super_admin':\r\n      return '/superadmin/dashboard';\r\n    case 'admin':\r\n      return '/admin/dashboard';\r\n    case 'dairy':\r\n      return '/dairy/dashboard';\r\n    case 'bmc':\r\n      return '/bmc/dashboard';\r\n    case 'society':\r\n      return '/society/dashboard';\r\n    case 'farmer':\r\n      return '/farmer/dashboard';\r\n    default:\r\n      console.warn(`Unknown role: ${role}, redirecting to login`);\r\n      return '/login';\r\n  }\r\n}\r\n\r\n/**\r\n * Check if user has valid session and redirect appropriately\r\n */\r\nexport async function checkAuthAndRedirect(router: AppRouterInstance): Promise<boolean> {\r\n  console.log('üîç checkAuthAndRedirect: Starting authentication check');\r\n  const { isValid, user } = await verifyUserSession();\r\n  \r\n  console.log('üîç checkAuthAndRedirect: Session check result:', { isValid, user });\r\n  \r\n  if (isValid && user) {\r\n    const dashboardRoute = getDashboardRoute(user.role);\r\n    console.log('‚úÖ checkAuthAndRedirect: Redirecting to:', dashboardRoute);\r\n    router.push(dashboardRoute);\r\n    return true;\r\n  }\r\n  \r\n  console.log('‚ÑπÔ∏è checkAuthAndRedirect: No valid session, staying on current page');\r\n  return false;\r\n}"],"names":[],"mappings":";;;;;;;;AAAA;AAeO,eAAe;IACpB,IAAI;QACF,MAAM,QAAQ,aAAa,OAAO,CAAC;QAEnC,IAAI,CAAC,OAAO;YACV,QAAQ,GAAG,CAAC;YACZ,OAAO;gBAAE,SAAS;YAAM;QAC1B;QAEA,QAAQ,GAAG,CAAC;QACZ,MAAM,WAAW,MAAM,MAAM,4BAA4B;YACvD,QAAQ;YACR,SAAS;gBACP,iBAAiB,CAAC,OAAO,EAAE,OAAO;gBAClC,gBAAgB;YAClB;QACF;QAEA,QAAQ,GAAG,CAAC,8CAA8C,SAAS,MAAM;QAEzE,IAAI,SAAS,EAAE,EAAE;YACf,MAAM,OAAO,MAAM,SAAS,IAAI;YAChC,QAAQ,GAAG,CAAC,4CAA4C;YAExD,IAAI,KAAK,OAAO,IAAI,KAAK,IAAI,IAAI,KAAK,IAAI,CAAC,IAAI,EAAE;gBAC/C,2CAA2C;gBAC3C,aAAa,OAAO,CAAC,YAAY,KAAK,SAAS,CAAC,KAAK,IAAI,CAAC,IAAI;gBAC9D,QAAQ,GAAG,CAAC,6CAA6C,KAAK,IAAI,CAAC,IAAI;gBACvE,OAAO;oBAAE,SAAS;oBAAM,MAAM,KAAK,IAAI,CAAC,IAAI;gBAAC;YAC/C;QACF;QAEA,2CAA2C;QAC3C,QAAQ,GAAG,CAAC;QACZ,aAAa,UAAU,CAAC;QACxB,aAAa,UAAU,CAAC;QACxB,OAAO;YAAE,SAAS;QAAM;IAC1B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qDAAqD;QACnE,aAAa,UAAU,CAAC;QACxB,aAAa,UAAU,CAAC;QACxB,OAAO;YAAE,SAAS;QAAM;IAC1B;AACF;AAKO,SAAS,kBAAkB,IAAY;IAC5C,OAAQ;QACN,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT;YACE,QAAQ,IAAI,CAAC,CAAC,cAAc,EAAE,KAAK,sBAAsB,CAAC;YAC1D,OAAO;IACX;AACF;AAKO,eAAe,qBAAqB,MAAyB;IAClE,QAAQ,GAAG,CAAC;IACZ,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,MAAM;IAEhC,QAAQ,GAAG,CAAC,kDAAkD;QAAE;QAAS;IAAK;IAE9E,IAAI,WAAW,MAAM;QACnB,MAAM,iBAAiB,kBAAkB,KAAK,IAAI;QAClD,QAAQ,GAAG,CAAC,2CAA2C;QACvD,OAAO,IAAI,CAAC;QACZ,OAAO;IACT;IAEA,QAAQ,GAAG,CAAC;IACZ,OAAO;AACT","debugId":null}},
    {"offset": {"line": 226, "column": 0}, "map": {"version":3,"sources":["file:///P:/psr-cloud-v2/src/app/admin/layout.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { UserProvider, useUser } from '@/contexts/UserContext';\r\nimport DashboardLayout from '@/components/layout/DashboardLayout';\r\nimport { FlowerSpinner } from '@/components';\r\nimport { UserRole } from '@/types/user';\r\n\r\nfunction AdminLayoutContent({ children }: { children: React.ReactNode }) {\r\n  const { user, loading } = useUser();\r\n  const router = useRouter();\r\n\r\n  useEffect(() => {\r\n    if (!loading && !user) {\r\n      router.push('/login');\r\n    } else if (!loading && user && user.role !== UserRole.ADMIN && user.role !== UserRole.SUPER_ADMIN) {\r\n      // Redirect non-admin users\r\n      router.push('/login');\r\n    }\r\n  }, [user, loading, router]);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"h-screen w-full flex items-center justify-center bg-gradient-to-br from-green-50 to-emerald-50\">\r\n        <div className=\"text-center\">\r\n          <FlowerSpinner size={64} />\r\n          <p className=\"mt-4 text-gray-600\">Loading your workspace...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!user) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <DashboardLayout \r\n      user={{\r\n        id: user.id,\r\n        uid: user.uid,\r\n        firstName: user.fullName.split(' ')[0] || user.fullName,\r\n        lastName: user.fullName.split(' ').slice(1).join(' ') || '',\r\n        email: user.email,\r\n        role: user.role\r\n      }}\r\n    >\r\n      {children}\r\n    </DashboardLayout>\r\n  );\r\n}\r\n\r\nexport default function AdminLayout({ children }: { children: React.ReactNode }) {\r\n  return (\r\n    <UserProvider>\r\n      <AdminLayoutContent>{children}</AdminLayoutContent>\r\n    </UserProvider>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AAPA;;;;;;;;AASA,SAAS,mBAAmB,EAAE,QAAQ,EAAiC;IACrE,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,GAAG,IAAA,0IAAO;IACjC,MAAM,SAAS,IAAA,+IAAS;IAExB,IAAA,kNAAS,EAAC;QACR,IAAI,CAAC,WAAW,CAAC,MAAM;YACrB,OAAO,IAAI,CAAC;QACd,OAAO,IAAI,CAAC,WAAW,QAAQ,KAAK,IAAI,KAAK,gIAAQ,CAAC,KAAK,IAAI,KAAK,IAAI,KAAK,gIAAQ,CAAC,WAAW,EAAE;YACjG,2BAA2B;YAC3B,OAAO,IAAI,CAAC;QACd;IACF,GAAG;QAAC;QAAM;QAAS;KAAO;IAE1B,IAAI,SAAS;QACX,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;;kCACb,8OAAC,2MAAa;wBAAC,MAAM;;;;;;kCACrB,8OAAC;wBAAE,WAAU;kCAAqB;;;;;;;;;;;;;;;;;IAI1C;IAEA,IAAI,CAAC,MAAM;QACT,OAAO;IACT;IAEA,qBACE,8OAAC,0JAAe;QACd,MAAM;YACJ,IAAI,KAAK,EAAE;YACX,KAAK,KAAK,GAAG;YACb,WAAW,KAAK,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,IAAI,KAAK,QAAQ;YACvD,UAAU,KAAK,QAAQ,CAAC,KAAK,CAAC,KAAK,KAAK,CAAC,GAAG,IAAI,CAAC,QAAQ;YACzD,OAAO,KAAK,KAAK;YACjB,MAAM,KAAK,IAAI;QACjB;kBAEC;;;;;;AAGP;AAEe,SAAS,YAAY,EAAE,QAAQ,EAAiC;IAC7E,qBACE,8OAAC,+IAAY;kBACX,cAAA,8OAAC;sBAAoB;;;;;;;;;;;AAG3B","debugId":null}}]
}