{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///P:/psr-cloud-v2/src/lib/pincodeService.ts"],"sourcesContent":["// Indian Pincode Lookup Service\r\n// This uses a free API service to lookup city and state by pincode\r\n\r\nexport interface PincodeInfo {\r\n  pincode: string;\r\n  city: string;\r\n  state: string;\r\n  district?: string;\r\n  country: string;\r\n}\r\n\r\nexport interface PincodeResponse {\r\n  success: boolean;\r\n  data?: PincodeInfo;\r\n  error?: string;\r\n}\r\n\r\n// Cache for storing pincode lookups to reduce API calls\r\nconst pincodeCache = new Map<string, PincodeInfo>();\r\n\r\n/**\r\n * Lookup city and state information for an Indian pincode\r\n * @param pincode - 6-digit Indian pincode\r\n * @returns Promise with pincode information\r\n */\r\nexport async function lookupPincode(pincode: string): Promise<PincodeResponse> {\r\n  // Validate pincode format (6 digits)\r\n  const pincodeRegex = /^\\d{6}$/;\r\n  if (!pincodeRegex.test(pincode)) {\r\n    return {\r\n      success: false,\r\n      error: 'Invalid pincode format. Please enter a 6-digit pincode.'\r\n    };\r\n  }\r\n\r\n  // Check cache first\r\n  if (pincodeCache.has(pincode)) {\r\n    return {\r\n      success: true,\r\n      data: pincodeCache.get(pincode)!\r\n    };\r\n  }\r\n\r\n  try {\r\n    // Using India Post API (free and reliable)\r\n    const response = await fetch(`https://api.postalpincode.in/pincode/${pincode}`);\r\n    \r\n    if (!response.ok) {\r\n      throw new Error('Failed to fetch pincode data');\r\n    }\r\n\r\n    const data = await response.json();\r\n    \r\n    // API returns an array, check if data exists and is valid\r\n    if (!data || !Array.isArray(data) || data.length === 0) {\r\n      return {\r\n        success: false,\r\n        error: 'Pincode not found'\r\n      };\r\n    }\r\n\r\n    const result = data[0];\r\n    \r\n    if (result.Status !== 'Success' || !result.PostOffice || result.PostOffice.length === 0) {\r\n      return {\r\n        success: false,\r\n        error: 'Invalid pincode or no data available'\r\n      };\r\n    }\r\n\r\n    // Get the first post office data (usually the main one)\r\n    const postOffice = result.PostOffice[0];\r\n    \r\n    const pincodeInfo: PincodeInfo = {\r\n      pincode: pincode,\r\n      city: postOffice.Name || postOffice.Block || postOffice.Division || '',\r\n      state: postOffice.State || '',\r\n      district: postOffice.District || '',\r\n      country: postOffice.Country || 'India'\r\n    };\r\n\r\n    // Cache the result for future use\r\n    pincodeCache.set(pincode, pincodeInfo);\r\n\r\n    return {\r\n      success: true,\r\n      data: pincodeInfo\r\n    };\r\n\r\n  } catch (error) {\r\n    console.error('Pincode lookup error:', error);\r\n    return {\r\n      success: false,\r\n      error: 'Unable to fetch pincode information. Please enter manually.'\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Alternative lookup using a different API as fallback\r\n */\r\nasync function lookupPincodeAlternative(pincode: string): Promise<PincodeResponse> {\r\n  try {\r\n    // Using Zippopotam API as backup\r\n    const response = await fetch(`https://api.zippopotam.us/IN/${pincode}`);\r\n    \r\n    if (!response.ok) {\r\n      throw new Error('Pincode not found');\r\n    }\r\n\r\n    const data = await response.json();\r\n    \r\n    if (!data.places || data.places.length === 0) {\r\n      return {\r\n        success: false,\r\n        error: 'Pincode not found'\r\n      };\r\n    }\r\n\r\n    const place = data.places[0];\r\n    \r\n    const pincodeInfo: PincodeInfo = {\r\n      pincode: pincode,\r\n      city: place['place name'] || '',\r\n      state: place['state'] || '',\r\n      district: place['state abbreviation'] || place['state'] || '',\r\n      country: data.country || 'India'\r\n    };\r\n\r\n    // Cache the result\r\n    pincodeCache.set(pincode, pincodeInfo);\r\n\r\n    return {\r\n      success: true,\r\n      data: pincodeInfo\r\n    };\r\n\r\n  } catch {\r\n    return {\r\n      success: false,\r\n      error: 'Unable to fetch pincode information'\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Enhanced pincode lookup with fallback\r\n */\r\nexport async function lookupPincodeWithFallback(pincode: string): Promise<PincodeResponse> {\r\n  // Try primary API first\r\n  const primaryResult = await lookupPincode(pincode);\r\n  \r\n  if (primaryResult.success) {\r\n    return primaryResult;\r\n  }\r\n\r\n  // If primary fails, try alternative\r\n  console.log('Primary pincode API failed, trying alternative...');\r\n  return await lookupPincodeAlternative(pincode);\r\n}\r\n\r\n/**\r\n * Validate Indian pincode format\r\n */\r\nexport function isValidIndianPincode(pincode: string): boolean {\r\n  const pincodeRegex = /^\\d{6}$/;\r\n  return pincodeRegex.test(pincode);\r\n}\r\n\r\n/**\r\n * Format pincode with proper spacing (optional, for display purposes)\r\n */\r\nexport function formatPincode(pincode: string): string {\r\n  if (isValidIndianPincode(pincode)) {\r\n    return `${pincode.slice(0, 3)} ${pincode.slice(3)}`;\r\n  }\r\n  return pincode;\r\n}\r\n\r\n/**\r\n * Get common Indian states for fallback dropdown\r\n */\r\nexport const INDIAN_STATES = [\r\n  'Andhra Pradesh',\r\n  'Arunachal Pradesh', \r\n  'Assam',\r\n  'Bihar',\r\n  'Chhattisgarh',\r\n  'Goa',\r\n  'Gujarat',\r\n  'Haryana',\r\n  'Himachal Pradesh',\r\n  'Jharkhand',\r\n  'Karnataka',\r\n  'Kerala',\r\n  'Madhya Pradesh',\r\n  'Maharashtra',\r\n  'Manipur',\r\n  'Meghalaya',\r\n  'Mizoram',\r\n  'Nagaland',\r\n  'Odisha',\r\n  'Punjab',\r\n  'Rajasthan',\r\n  'Sikkim',\r\n  'Tamil Nadu',\r\n  'Telangana',\r\n  'Tripura',\r\n  'Uttar Pradesh',\r\n  'Uttarakhand',\r\n  'West Bengal',\r\n  'Andaman and Nicobar Islands',\r\n  'Chandigarh',\r\n  'Dadra and Nagar Haveli and Daman and Diu',\r\n  'Delhi',\r\n  'Jammu and Kashmir',\r\n  'Ladakh',\r\n  'Lakshadweep',\r\n  'Puducherry'\r\n];"],"names":[],"mappings":"AAAA,gCAAgC;AAChC,mEAAmE;;;;;;;;;;;;;AAgBnE,wDAAwD;AACxD,MAAM,eAAe,IAAI;AAOlB,eAAe,cAAc,OAAe;IACjD,qCAAqC;IACrC,MAAM,eAAe;IACrB,IAAI,CAAC,aAAa,IAAI,CAAC,UAAU;QAC/B,OAAO;YACL,SAAS;YACT,OAAO;QACT;IACF;IAEA,oBAAoB;IACpB,IAAI,aAAa,GAAG,CAAC,UAAU;QAC7B,OAAO;YACL,SAAS;YACT,MAAM,aAAa,GAAG,CAAC;QACzB;IACF;IAEA,IAAI;QACF,2CAA2C;QAC3C,MAAM,WAAW,MAAM,MAAM,CAAC,qCAAqC,EAAE,SAAS;QAE9E,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,IAAI,MAAM;QAClB;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAEhC,0DAA0D;QAC1D,IAAI,CAAC,QAAQ,CAAC,MAAM,OAAO,CAAC,SAAS,KAAK,MAAM,KAAK,GAAG;YACtD,OAAO;gBACL,SAAS;gBACT,OAAO;YACT;QACF;QAEA,MAAM,SAAS,IAAI,CAAC,EAAE;QAEtB,IAAI,OAAO,MAAM,KAAK,aAAa,CAAC,OAAO,UAAU,IAAI,OAAO,UAAU,CAAC,MAAM,KAAK,GAAG;YACvF,OAAO;gBACL,SAAS;gBACT,OAAO;YACT;QACF;QAEA,wDAAwD;QACxD,MAAM,aAAa,OAAO,UAAU,CAAC,EAAE;QAEvC,MAAM,cAA2B;YAC/B,SAAS;YACT,MAAM,WAAW,IAAI,IAAI,WAAW,KAAK,IAAI,WAAW,QAAQ,IAAI;YACpE,OAAO,WAAW,KAAK,IAAI;YAC3B,UAAU,WAAW,QAAQ,IAAI;YACjC,SAAS,WAAW,OAAO,IAAI;QACjC;QAEA,kCAAkC;QAClC,aAAa,GAAG,CAAC,SAAS;QAE1B,OAAO;YACL,SAAS;YACT,MAAM;QACR;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO;YACL,SAAS;YACT,OAAO;QACT;IACF;AACF;AAEA;;CAEC,GACD,eAAe,yBAAyB,OAAe;IACrD,IAAI;QACF,iCAAiC;QACjC,MAAM,WAAW,MAAM,MAAM,CAAC,6BAA6B,EAAE,SAAS;QAEtE,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,IAAI,MAAM;QAClB;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAEhC,IAAI,CAAC,KAAK,MAAM,IAAI,KAAK,MAAM,CAAC,MAAM,KAAK,GAAG;YAC5C,OAAO;gBACL,SAAS;gBACT,OAAO;YACT;QACF;QAEA,MAAM,QAAQ,KAAK,MAAM,CAAC,EAAE;QAE5B,MAAM,cAA2B;YAC/B,SAAS;YACT,MAAM,KAAK,CAAC,aAAa,IAAI;YAC7B,OAAO,KAAK,CAAC,QAAQ,IAAI;YACzB,UAAU,KAAK,CAAC,qBAAqB,IAAI,KAAK,CAAC,QAAQ,IAAI;YAC3D,SAAS,KAAK,OAAO,IAAI;QAC3B;QAEA,mBAAmB;QACnB,aAAa,GAAG,CAAC,SAAS;QAE1B,OAAO;YACL,SAAS;YACT,MAAM;QACR;IAEF,EAAE,OAAM;QACN,OAAO;YACL,SAAS;YACT,OAAO;QACT;IACF;AACF;AAKO,eAAe,0BAA0B,OAAe;IAC7D,wBAAwB;IACxB,MAAM,gBAAgB,MAAM,cAAc;IAE1C,IAAI,cAAc,OAAO,EAAE;QACzB,OAAO;IACT;IAEA,oCAAoC;IACpC,QAAQ,GAAG,CAAC;IACZ,OAAO,MAAM,yBAAyB;AACxC;AAKO,SAAS,qBAAqB,OAAe;IAClD,MAAM,eAAe;IACrB,OAAO,aAAa,IAAI,CAAC;AAC3B;AAKO,SAAS,cAAc,OAAe;IAC3C,IAAI,qBAAqB,UAAU;QACjC,OAAO,GAAG,QAAQ,KAAK,CAAC,GAAG,GAAG,CAAC,EAAE,QAAQ,KAAK,CAAC,IAAI;IACrD;IACA,OAAO;AACT;AAKO,MAAM,gBAAgB;IAC3B;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD","debugId":null}},
    {"offset": {"line": 179, "column": 0}, "map": {"version":3,"sources":["file:///P:/psr-cloud-v2/src/lib/clientAuth.ts"],"sourcesContent":["'use client';\r\n\r\nimport type { AppRouterInstance } from 'next/dist/shared/lib/app-router-context.shared-runtime';\r\n\r\ninterface UserData {\r\n  id: number;\r\n  uid: string;\r\n  email: string;\r\n  role: string;\r\n  fullName: string;\r\n}\r\n\r\n/**\r\n * Verify if the current user session is valid by checking with the server\r\n */\r\nexport async function verifyUserSession(): Promise<{ isValid: boolean; user?: UserData }> {\r\n  try {\r\n    const token = localStorage.getItem('authToken');\r\n    \r\n    if (!token) {\r\n      console.log('üîç verifyUserSession: No token found');\r\n      return { isValid: false };\r\n    }\r\n\r\n    console.log('üîç verifyUserSession: Token found, making API call');\r\n    const response = await fetch('/api/auth/verify-session', {\r\n      method: 'GET',\r\n      headers: {\r\n        'Authorization': `Bearer ${token}`,\r\n        'Content-Type': 'application/json',\r\n      },\r\n    });\r\n\r\n    console.log('üîç verifyUserSession: API response status:', response.status);\r\n    \r\n    if (response.ok) {\r\n      const data = await response.json();\r\n      console.log('üîç verifyUserSession: API response data:', data);\r\n      \r\n      if (data.success && data.data && data.data.user) {\r\n        // Update localStorage with fresh user data\r\n        localStorage.setItem('userData', JSON.stringify(data.data.user));\r\n        console.log('‚úÖ verifyUserSession: Session valid, user:', data.data.user);\r\n        return { isValid: true, user: data.data.user };\r\n      }\r\n    }\r\n\r\n    // If verification fails, clear stored data\r\n    console.log('‚ùå verifyUserSession: Session invalid, clearing storage');\r\n    localStorage.removeItem('authToken');\r\n    localStorage.removeItem('userData');\r\n    return { isValid: false };\r\n  } catch (error) {\r\n    console.error('‚ùå verifyUserSession: Session verification failed:', error);\r\n    localStorage.removeItem('authToken');\r\n    localStorage.removeItem('userData');\r\n    return { isValid: false };\r\n  }\r\n}\r\n\r\n/**\r\n * Get the appropriate dashboard route for a user role\r\n */\r\nexport function getDashboardRoute(role: string): string {\r\n  switch (role) {\r\n    case 'super_admin':\r\n      return '/superadmin/dashboard';\r\n    case 'admin':\r\n      return '/admin/dashboard';\r\n    case 'dairy':\r\n      return '/dairy/dashboard';\r\n    case 'bmc':\r\n      return '/bmc/dashboard';\r\n    case 'society':\r\n      return '/society/dashboard';\r\n    case 'farmer':\r\n      return '/farmer/dashboard';\r\n    default:\r\n      console.warn(`Unknown role: ${role}, redirecting to login`);\r\n      return '/login';\r\n  }\r\n}\r\n\r\n/**\r\n * Check if user has valid session and redirect appropriately\r\n */\r\nexport async function checkAuthAndRedirect(router: AppRouterInstance): Promise<boolean> {\r\n  console.log('üîç checkAuthAndRedirect: Starting authentication check');\r\n  const { isValid, user } = await verifyUserSession();\r\n  \r\n  console.log('üîç checkAuthAndRedirect: Session check result:', { isValid, user });\r\n  \r\n  if (isValid && user) {\r\n    const dashboardRoute = getDashboardRoute(user.role);\r\n    console.log('‚úÖ checkAuthAndRedirect: Redirecting to:', dashboardRoute);\r\n    router.push(dashboardRoute);\r\n    return true;\r\n  }\r\n  \r\n  console.log('‚ÑπÔ∏è checkAuthAndRedirect: No valid session, staying on current page');\r\n  return false;\r\n}"],"names":[],"mappings":";;;;;;;;AAAA;AAeO,eAAe;IACpB,IAAI;QACF,MAAM,QAAQ,aAAa,OAAO,CAAC;QAEnC,IAAI,CAAC,OAAO;YACV,QAAQ,GAAG,CAAC;YACZ,OAAO;gBAAE,SAAS;YAAM;QAC1B;QAEA,QAAQ,GAAG,CAAC;QACZ,MAAM,WAAW,MAAM,MAAM,4BAA4B;YACvD,QAAQ;YACR,SAAS;gBACP,iBAAiB,CAAC,OAAO,EAAE,OAAO;gBAClC,gBAAgB;YAClB;QACF;QAEA,QAAQ,GAAG,CAAC,8CAA8C,SAAS,MAAM;QAEzE,IAAI,SAAS,EAAE,EAAE;YACf,MAAM,OAAO,MAAM,SAAS,IAAI;YAChC,QAAQ,GAAG,CAAC,4CAA4C;YAExD,IAAI,KAAK,OAAO,IAAI,KAAK,IAAI,IAAI,KAAK,IAAI,CAAC,IAAI,EAAE;gBAC/C,2CAA2C;gBAC3C,aAAa,OAAO,CAAC,YAAY,KAAK,SAAS,CAAC,KAAK,IAAI,CAAC,IAAI;gBAC9D,QAAQ,GAAG,CAAC,6CAA6C,KAAK,IAAI,CAAC,IAAI;gBACvE,OAAO;oBAAE,SAAS;oBAAM,MAAM,KAAK,IAAI,CAAC,IAAI;gBAAC;YAC/C;QACF;QAEA,2CAA2C;QAC3C,QAAQ,GAAG,CAAC;QACZ,aAAa,UAAU,CAAC;QACxB,aAAa,UAAU,CAAC;QACxB,OAAO;YAAE,SAAS;QAAM;IAC1B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qDAAqD;QACnE,aAAa,UAAU,CAAC;QACxB,aAAa,UAAU,CAAC;QACxB,OAAO;YAAE,SAAS;QAAM;IAC1B;AACF;AAKO,SAAS,kBAAkB,IAAY;IAC5C,OAAQ;QACN,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT;YACE,QAAQ,IAAI,CAAC,CAAC,cAAc,EAAE,KAAK,sBAAsB,CAAC;YAC1D,OAAO;IACX;AACF;AAKO,eAAe,qBAAqB,MAAyB;IAClE,QAAQ,GAAG,CAAC;IACZ,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,MAAM;IAEhC,QAAQ,GAAG,CAAC,kDAAkD;QAAE;QAAS;IAAK;IAE9E,IAAI,WAAW,MAAM;QACnB,MAAM,iBAAiB,kBAAkB,KAAK,IAAI;QAClD,QAAQ,GAAG,CAAC,2CAA2C;QACvD,OAAO,IAAI,CAAC;QACZ,OAAO;IACT;IAEA,QAAQ,GAAG,CAAC;IACZ,OAAO;AACT","debugId":null}},
    {"offset": {"line": 274, "column": 0}, "map": {"version":3,"sources":["file:///P:/psr-cloud-v2/src/types/user.ts"],"sourcesContent":["// User role types for client-side components\r\nexport enum UserRole {\r\n  SUPER_ADMIN = 'super_admin',\r\n  ADMIN = 'admin', \r\n  DAIRY = 'dairy',\r\n  BMC = 'bmc',\r\n  SOCIETY = 'society',\r\n  FARMER = 'farmer'\r\n}"],"names":[],"mappings":"AAAA,6CAA6C;;;;;AACtC,IAAA,AAAK,kCAAA;;;;;;;WAAA","debugId":null}}]
}