{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///P:/psr-cloud-v2/src/app/api/superadmin/auth/login/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport jwt from 'jsonwebtoken';\r\n\r\ninterface LoginRequest {\r\n  username: string;\r\n  password: string;\r\n}\r\n\r\ninterface AdminUser {\r\n  id: number;\r\n  username: string;\r\n  email: string;\r\n  role: string;\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const { username, password }: LoginRequest = await request.json();\r\n\r\n    // Validate input\r\n    if (!username || !password) {\r\n      return NextResponse.json(\r\n        {\r\n          success: false,\r\n          error: {\r\n            message: 'Username and password are required',\r\n            code: 'MISSING_CREDENTIALS'\r\n          }\r\n        },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Get super admin credentials from environment\r\n    const superAdminUsername = process.env.SUPER_ADMIN_USERNAME;\r\n    const superAdminPassword = process.env.SUPER_ADMIN_PASSWORD;\r\n\r\n    if (!superAdminUsername || !superAdminPassword) {\r\n      console.error('Super admin credentials not configured in environment');\r\n      return NextResponse.json(\r\n        {\r\n          success: false,\r\n          error: {\r\n            message: 'Server configuration error',\r\n            code: 'CONFIG_ERROR'\r\n          }\r\n        },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    // Check credentials\r\n    if (username !== superAdminUsername || password !== superAdminPassword) {\r\n      return NextResponse.json(\r\n        {\r\n          success: false,\r\n          error: {\r\n            message: 'Invalid credentials',\r\n            code: 'INVALID_CREDENTIALS'\r\n          }\r\n        },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    // Create admin user object\r\n    const adminUser: AdminUser = {\r\n      id: 1,\r\n      username: superAdminUsername,\r\n      email: 'admin@poornasree.com',\r\n      role: 'super_admin'\r\n    };\r\n\r\n    // Generate JWT tokens\r\n    const jwtSecret = process.env.JWT_SECRET;\r\n    const jwtRefreshSecret = process.env.JWT_REFRESH_SECRET;\r\n\r\n    if (!jwtSecret || !jwtRefreshSecret) {\r\n      console.error('JWT secrets not configured');\r\n      return NextResponse.json(\r\n        {\r\n          success: false,\r\n          error: {\r\n            message: 'Server configuration error',\r\n            code: 'JWT_CONFIG_ERROR'\r\n          }\r\n        },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    // Generate tokens\r\n    const tokenPayload = { \r\n      userId: adminUser.id,\r\n      username: adminUser.username,\r\n      role: adminUser.role,\r\n      type: 'admin'\r\n    };\r\n\r\n    const refreshTokenPayload = { \r\n      userId: adminUser.id,\r\n      username: adminUser.username,\r\n      type: 'admin_refresh'\r\n    };\r\n\r\n    // Generate JWT tokens (simplified for now to avoid TypeScript issues)\r\n    const token = jwt.sign(tokenPayload, jwtSecret as string, { expiresIn: '7d' });\r\n    const refreshToken = jwt.sign(refreshTokenPayload, jwtRefreshSecret as string, { expiresIn: '30d' });\r\n\r\n    // Log successful login\r\n    console.log(`Super admin login successful: ${username} at ${new Date().toISOString()}`);\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: 'Login successful',\r\n      data: {\r\n        user: adminUser,\r\n        token,\r\n        refreshToken\r\n      }\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Admin login error:', error);\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        error: {\r\n          message: 'Internal server error',\r\n          code: 'SERVER_ERROR'\r\n        }\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function GET() {\r\n  return NextResponse.json(\r\n    {\r\n      success: false,\r\n      error: {\r\n        message: 'Method not allowed',\r\n        code: 'METHOD_NOT_ALLOWED'\r\n      }\r\n    },\r\n    { status: 405 }\r\n  );\r\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAcO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAiB,MAAM,QAAQ,IAAI;QAE/D,iBAAiB;QACjB,IAAI,CAAC,YAAY,CAAC,UAAU;YAC1B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,SAAS;gBACT,OAAO;oBACL,SAAS;oBACT,MAAM;gBACR;YACF,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,+CAA+C;QAC/C,MAAM,qBAAqB,QAAQ,GAAG,CAAC,oBAAoB;QAC3D,MAAM,qBAAqB,QAAQ,GAAG,CAAC,oBAAoB;QAE3D,IAAI,CAAC,sBAAsB,CAAC,oBAAoB;YAC9C,QAAQ,KAAK,CAAC;YACd,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,SAAS;gBACT,OAAO;oBACL,SAAS;oBACT,MAAM;gBACR;YACF,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,oBAAoB;QACpB,IAAI,aAAa,sBAAsB,aAAa,oBAAoB;YACtE,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,SAAS;gBACT,OAAO;oBACL,SAAS;oBACT,MAAM;gBACR;YACF,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,2BAA2B;QAC3B,MAAM,YAAuB;YAC3B,IAAI;YACJ,UAAU;YACV,OAAO;YACP,MAAM;QACR;QAEA,sBAAsB;QACtB,MAAM,YAAY,QAAQ,GAAG,CAAC,UAAU;QACxC,MAAM,mBAAmB,QAAQ,GAAG,CAAC,kBAAkB;QAEvD,IAAI,CAAC,aAAa,CAAC,kBAAkB;YACnC,QAAQ,KAAK,CAAC;YACd,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,SAAS;gBACT,OAAO;oBACL,SAAS;oBACT,MAAM;gBACR;YACF,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,kBAAkB;QAClB,MAAM,eAAe;YACnB,QAAQ,UAAU,EAAE;YACpB,UAAU,UAAU,QAAQ;YAC5B,MAAM,UAAU,IAAI;YACpB,MAAM;QACR;QAEA,MAAM,sBAAsB;YAC1B,QAAQ,UAAU,EAAE;YACpB,UAAU,UAAU,QAAQ;YAC5B,MAAM;QACR;QAEA,sEAAsE;QACtE,MAAM,QAAQ,kJAAG,CAAC,IAAI,CAAC,cAAc,WAAqB;YAAE,WAAW;QAAK;QAC5E,MAAM,eAAe,kJAAG,CAAC,IAAI,CAAC,qBAAqB,kBAA4B;YAAE,WAAW;QAAM;QAElG,uBAAuB;QACvB,QAAQ,GAAG,CAAC,CAAC,8BAA8B,EAAE,SAAS,IAAI,EAAE,IAAI,OAAO,WAAW,IAAI;QAEtF,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS;YACT,MAAM;gBACJ,MAAM;gBACN;gBACA;YACF;QACF;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,OAAO;gBACL,SAAS;gBACT,MAAM;YACR;QACF,GACA;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe;IACpB,OAAO,gJAAY,CAAC,IAAI,CACtB;QACE,SAAS;QACT,OAAO;YACL,SAAS;YACT,MAAM;QACR;IACF,GACA;QAAE,QAAQ;IAAI;AAElB","debugId":null}}]
}