{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///P:/psr-cloud-v2/src/lib/clientAuth.ts"],"sourcesContent":["'use client';\r\n\r\nimport type { AppRouterInstance } from 'next/dist/shared/lib/app-router-context.shared-runtime';\r\n\r\ninterface UserData {\r\n  id: number;\r\n  uid: string;\r\n  email: string;\r\n  role: string;\r\n  fullName: string;\r\n}\r\n\r\n/**\r\n * Verify if the current user session is valid by checking with the server\r\n */\r\nexport async function verifyUserSession(): Promise<{ isValid: boolean; user?: UserData }> {\r\n  try {\r\n    const token = localStorage.getItem('authToken');\r\n    \r\n    if (!token) {\r\n      console.log('üîç verifyUserSession: No token found');\r\n      return { isValid: false };\r\n    }\r\n\r\n    console.log('üîç verifyUserSession: Token found, making API call');\r\n    const response = await fetch('/api/auth/verify-session', {\r\n      method: 'GET',\r\n      headers: {\r\n        'Authorization': `Bearer ${token}`,\r\n        'Content-Type': 'application/json',\r\n      },\r\n    });\r\n\r\n    console.log('üîç verifyUserSession: API response status:', response.status);\r\n    \r\n    if (response.ok) {\r\n      const data = await response.json();\r\n      console.log('üîç verifyUserSession: API response data:', data);\r\n      \r\n      if (data.success && data.data && data.data.user) {\r\n        // Update localStorage with fresh user data\r\n        localStorage.setItem('userData', JSON.stringify(data.data.user));\r\n        console.log('‚úÖ verifyUserSession: Session valid, user:', data.data.user);\r\n        return { isValid: true, user: data.data.user };\r\n      }\r\n    }\r\n\r\n    // If verification fails, clear stored data\r\n    console.log('‚ùå verifyUserSession: Session invalid, clearing storage');\r\n    localStorage.removeItem('authToken');\r\n    localStorage.removeItem('userData');\r\n    return { isValid: false };\r\n  } catch (error) {\r\n    console.error('‚ùå verifyUserSession: Session verification failed:', error);\r\n    localStorage.removeItem('authToken');\r\n    localStorage.removeItem('userData');\r\n    return { isValid: false };\r\n  }\r\n}\r\n\r\n/**\r\n * Get the appropriate dashboard route for a user role\r\n */\r\nexport function getDashboardRoute(role: string): string {\r\n  switch (role) {\r\n    case 'super_admin':\r\n      return '/superadmin/dashboard';\r\n    case 'admin':\r\n      return '/admin/dashboard';\r\n    case 'dairy':\r\n      return '/dairy/dashboard';\r\n    case 'bmc':\r\n      return '/bmc/dashboard';\r\n    case 'society':\r\n      return '/society/dashboard';\r\n    case 'farmer':\r\n      return '/farmer/dashboard';\r\n    default:\r\n      console.warn(`Unknown role: ${role}, redirecting to login`);\r\n      return '/login';\r\n  }\r\n}\r\n\r\n/**\r\n * Check if user has valid session and redirect appropriately\r\n */\r\nexport async function checkAuthAndRedirect(router: AppRouterInstance): Promise<boolean> {\r\n  console.log('üîç checkAuthAndRedirect: Starting authentication check');\r\n  const { isValid, user } = await verifyUserSession();\r\n  \r\n  console.log('üîç checkAuthAndRedirect: Session check result:', { isValid, user });\r\n  \r\n  if (isValid && user) {\r\n    const dashboardRoute = getDashboardRoute(user.role);\r\n    console.log('‚úÖ checkAuthAndRedirect: Redirecting to:', dashboardRoute);\r\n    router.push(dashboardRoute);\r\n    return true;\r\n  }\r\n  \r\n  console.log('‚ÑπÔ∏è checkAuthAndRedirect: No valid session, staying on current page');\r\n  return false;\r\n}"],"names":[],"mappings":";;;;;;;;AAAA;AAeO,eAAe;IACpB,IAAI;QACF,MAAM,QAAQ,aAAa,OAAO,CAAC;QAEnC,IAAI,CAAC,OAAO;YACV,QAAQ,GAAG,CAAC;YACZ,OAAO;gBAAE,SAAS;YAAM;QAC1B;QAEA,QAAQ,GAAG,CAAC;QACZ,MAAM,WAAW,MAAM,MAAM,4BAA4B;YACvD,QAAQ;YACR,SAAS;gBACP,iBAAiB,CAAC,OAAO,EAAE,OAAO;gBAClC,gBAAgB;YAClB;QACF;QAEA,QAAQ,GAAG,CAAC,8CAA8C,SAAS,MAAM;QAEzE,IAAI,SAAS,EAAE,EAAE;YACf,MAAM,OAAO,MAAM,SAAS,IAAI;YAChC,QAAQ,GAAG,CAAC,4CAA4C;YAExD,IAAI,KAAK,OAAO,IAAI,KAAK,IAAI,IAAI,KAAK,IAAI,CAAC,IAAI,EAAE;gBAC/C,2CAA2C;gBAC3C,aAAa,OAAO,CAAC,YAAY,KAAK,SAAS,CAAC,KAAK,IAAI,CAAC,IAAI;gBAC9D,QAAQ,GAAG,CAAC,6CAA6C,KAAK,IAAI,CAAC,IAAI;gBACvE,OAAO;oBAAE,SAAS;oBAAM,MAAM,KAAK,IAAI,CAAC,IAAI;gBAAC;YAC/C;QACF;QAEA,2CAA2C;QAC3C,QAAQ,GAAG,CAAC;QACZ,aAAa,UAAU,CAAC;QACxB,aAAa,UAAU,CAAC;QACxB,OAAO;YAAE,SAAS;QAAM;IAC1B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qDAAqD;QACnE,aAAa,UAAU,CAAC;QACxB,aAAa,UAAU,CAAC;QACxB,OAAO;YAAE,SAAS;QAAM;IAC1B;AACF;AAKO,SAAS,kBAAkB,IAAY;IAC5C,OAAQ;QACN,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT;YACE,QAAQ,IAAI,CAAC,CAAC,cAAc,EAAE,KAAK,sBAAsB,CAAC;YAC1D,OAAO;IACX;AACF;AAKO,eAAe,qBAAqB,MAAyB;IAClE,QAAQ,GAAG,CAAC;IACZ,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,MAAM;IAEhC,QAAQ,GAAG,CAAC,kDAAkD;QAAE;QAAS;IAAK;IAE9E,IAAI,WAAW,MAAM;QACnB,MAAM,iBAAiB,kBAAkB,KAAK,IAAI;QAClD,QAAQ,GAAG,CAAC,2CAA2C;QACvD,OAAO,IAAI,CAAC;QACZ,OAAO;IACT;IAEA,QAAQ,GAAG,CAAC;IACZ,OAAO;AACT","debugId":null}},
    {"offset": {"line": 102, "column": 0}, "map": {"version":3,"sources":["file:///P:/psr-cloud-v2/src/types/user.ts"],"sourcesContent":["// User role types for client-side components\r\nexport enum UserRole {\r\n  SUPER_ADMIN = 'super_admin',\r\n  ADMIN = 'admin', \r\n  DAIRY = 'dairy',\r\n  BMC = 'bmc',\r\n  SOCIETY = 'society',\r\n  FARMER = 'farmer'\r\n}"],"names":[],"mappings":"AAAA,6CAA6C;;;;;AACtC,IAAA,AAAK,kCAAA;;;;;;;WAAA","debugId":null}}]
}